var Qt=Object.defineProperty;var Kt=(e,o,s)=>o in e?Qt(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s;var jt=(e,o,s)=>Kt(e,typeof o!="symbol"?o+"":o,s);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))a(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerPolicy&&(d.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?d.credentials="include":h.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(h){if(h.ep)return;h.ep=!0;const d=s(h);fetch(h.href,d)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(e,o,s){this.props=e,this.context=o,this.refs=D$1,this.updater=s||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(e,o){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,o,"setState")};E$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(e,o,s){this.props=e,this.context=o,this.refs=D$1,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(e,o,s){var a,h={},d=null,c=null;if(o!=null)for(a in o.ref!==void 0&&(c=o.ref),o.key!==void 0&&(d=""+o.key),o)J.call(o,a)&&!L$1.hasOwnProperty(a)&&(h[a]=o[a]);var g=arguments.length-2;if(g===1)h.children=s;else if(1<g){for(var b=Array(g),$=0;$<g;$++)b[$]=arguments[$+2];h.children=b}if(e&&e.defaultProps)for(a in g=e.defaultProps,g)h[a]===void 0&&(h[a]=g[a]);return{$$typeof:l$1,type:e,key:d,ref:c,props:h,_owner:K$1.current}}function N$1(e,o){return{$$typeof:l$1,type:e.type,key:o,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape$1(e){var o={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return o[s]})}var P$1=/\/+/g;function Q$1(e,o){return typeof e=="object"&&e!==null&&e.key!=null?escape$1(""+e.key):o.toString(36)}function R$1(e,o,s,a,h){var d=typeof e;(d==="undefined"||d==="boolean")&&(e=null);var c=!1;if(e===null)c=!0;else switch(d){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:c=!0}}if(c)return c=e,h=h(c),e=a===""?"."+Q$1(c,0):a,I$1(h)?(s="",e!=null&&(s=e.replace(P$1,"$&/")+"/"),R$1(h,o,s,"",function($){return $})):h!=null&&(O$1(h)&&(h=N$1(h,s+(!h.key||c&&c.key===h.key?"":(""+h.key).replace(P$1,"$&/")+"/")+e)),o.push(h)),1;if(c=0,a=a===""?".":a+":",I$1(e))for(var g=0;g<e.length;g++){d=e[g];var b=a+Q$1(d,g);c+=R$1(d,o,s,b,h)}else if(b=A$1(e),typeof b=="function")for(e=b.call(e),g=0;!(d=e.next()).done;)d=d.value,b=a+Q$1(d,g++),c+=R$1(d,o,s,b,h);else if(d==="object")throw o=String(e),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return c}function S$1(e,o,s){if(e==null)return e;var a=[],h=0;return R$1(e,a,"","",function(d){return o.call(s,d,h++)}),a}function T$1(e){if(e._status===-1){var o=e._result;o=o(),o.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=o)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,o,s){S$1(e,function(){o.apply(this,arguments)},s)},count:function(e){var o=0;return S$1(e,function(){o++}),o},toArray:function(e){return S$1(e,function(o){return o})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(e,o,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=C$1({},e.props),h=e.key,d=e.ref,c=e._owner;if(o!=null){if(o.ref!==void 0&&(d=o.ref,c=K$1.current),o.key!==void 0&&(h=""+o.key),e.type&&e.type.defaultProps)var g=e.type.defaultProps;for(b in o)J.call(o,b)&&!L$1.hasOwnProperty(b)&&(a[b]=o[b]===void 0&&g!==void 0?g[b]:o[b])}var b=arguments.length-2;if(b===1)a.children=s;else if(1<b){g=Array(b);for(var $=0;$<b;$++)g[$]=arguments[$+2];a.children=g}return{$$typeof:l$1,type:e.type,key:h,ref:d,props:a,_owner:c}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$1;react_production_min.createFactory=function(e){var o=M$1.bind(null,e);return o.type=e,o};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$1,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,o){return{$$typeof:x,type:e,compare:o===void 0?null:o}};react_production_min.startTransition=function(e){var o=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=o}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(e,o){return U$1.current.useCallback(e,o)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,o){return U$1.current.useEffect(e,o)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,o,s){return U$1.current.useImperativeHandle(e,o,s)};react_production_min.useInsertionEffect=function(e,o){return U$1.current.useInsertionEffect(e,o)};react_production_min.useLayoutEffect=function(e,o){return U$1.current.useLayoutEffect(e,o)};react_production_min.useMemo=function(e,o){return U$1.current.useMemo(e,o)};react_production_min.useReducer=function(e,o,s){return U$1.current.useReducer(e,o,s)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,o,s){return U$1.current.useSyncExternalStore(e,o,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q(e,o,s){var a,h={},d=null,c=null;s!==void 0&&(d=""+s),o.key!==void 0&&(d=""+o.key),o.ref!==void 0&&(c=o.ref);for(a in o)m$1.call(o,a)&&!p$2.hasOwnProperty(a)&&(h[a]=o[a]);if(e&&e.defaultProps)for(a in o=e.defaultProps,o)h[a]===void 0&&(h[a]=o[a]);return{$$typeof:k,type:e,key:d,ref:c,props:h,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function o(ht,dt){var gt=ht.length;ht.push(dt);e:for(;0<gt;){var kt=gt-1>>>1,Lt=ht[kt];if(0<h(Lt,dt))ht[kt]=dt,ht[gt]=Lt,gt=kt;else break e}}function s(ht){return ht.length===0?null:ht[0]}function a(ht){if(ht.length===0)return null;var dt=ht[0],gt=ht.pop();if(gt!==dt){ht[0]=gt;e:for(var kt=0,Lt=ht.length,Gt=Lt>>>1;kt<Gt;){var At=2*(kt+1)-1,Pt=ht[At],zt=At+1,rt=ht[zt];if(0>h(Pt,gt))zt<Lt&&0>h(rt,Pt)?(ht[kt]=rt,ht[zt]=gt,kt=zt):(ht[kt]=Pt,ht[At]=gt,kt=At);else if(zt<Lt&&0>h(rt,gt))ht[kt]=rt,ht[zt]=gt,kt=zt;else break e}}return dt}function h(ht,dt){var gt=ht.sortIndex-dt.sortIndex;return gt!==0?gt:ht.id-dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var c=Date,g=c.now();e.unstable_now=function(){return c.now()-g}}var b=[],$=[],et=1,st=null,j=3,tt=!1,nt=!1,lt=!1,ct=typeof setTimeout=="function"?setTimeout:null,ot=typeof clearTimeout=="function"?clearTimeout:null,_e=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(ht){for(var dt=s($);dt!==null;){if(dt.callback===null)a($);else if(dt.startTime<=ht)a($),dt.sortIndex=dt.expirationTime,o(b,dt);else break;dt=s($)}}function at(ht){if(lt=!1,_(ht),!nt)if(s(b)!==null)nt=!0,ut(it);else{var dt=s($);dt!==null&&bt(at,dt.startTime-ht)}}function it(ht,dt){nt=!1,lt&&(lt=!1,ot(_t),_t=-1),tt=!0;var gt=j;try{for(_(dt),st=s(b);st!==null&&(!(st.expirationTime>dt)||ht&&!Ot());){var kt=st.callback;if(typeof kt=="function"){st.callback=null,j=st.priorityLevel;var Lt=kt(st.expirationTime<=dt);dt=e.unstable_now(),typeof Lt=="function"?st.callback=Lt:st===s(b)&&a(b),_(dt)}else a(b);st=s(b)}if(st!==null)var Gt=!0;else{var At=s($);At!==null&&bt(at,At.startTime-dt),Gt=!1}return Gt}finally{st=null,j=gt,tt=!1}}var pt=!1,mt=null,_t=-1,Et=5,Tt=-1;function Ot(){return!(e.unstable_now()-Tt<Et)}function Ct(){if(mt!==null){var ht=e.unstable_now();Tt=ht;var dt=!0;try{dt=mt(!0,ht)}finally{dt?St():(pt=!1,mt=null)}}else pt=!1}var St;if(typeof _e=="function")St=function(){_e(Ct)};else if(typeof MessageChannel<"u"){var ft=new MessageChannel,yt=ft.port2;ft.port1.onmessage=Ct,St=function(){yt.postMessage(null)}}else St=function(){ct(Ct,0)};function ut(ht){mt=ht,pt||(pt=!0,St())}function bt(ht,dt){_t=ct(function(){ht(e.unstable_now())},dt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ht){ht.callback=null},e.unstable_continueExecution=function(){nt||tt||(nt=!0,ut(it))},e.unstable_forceFrameRate=function(ht){0>ht||125<ht?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Et=0<ht?Math.floor(1e3/ht):5},e.unstable_getCurrentPriorityLevel=function(){return j},e.unstable_getFirstCallbackNode=function(){return s(b)},e.unstable_next=function(ht){switch(j){case 1:case 2:case 3:var dt=3;break;default:dt=j}var gt=j;j=dt;try{return ht()}finally{j=gt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ht,dt){switch(ht){case 1:case 2:case 3:case 4:case 5:break;default:ht=3}var gt=j;j=ht;try{return dt()}finally{j=gt}},e.unstable_scheduleCallback=function(ht,dt,gt){var kt=e.unstable_now();switch(typeof gt=="object"&&gt!==null?(gt=gt.delay,gt=typeof gt=="number"&&0<gt?kt+gt:kt):gt=kt,ht){case 1:var Lt=-1;break;case 2:Lt=250;break;case 5:Lt=1073741823;break;case 4:Lt=1e4;break;default:Lt=5e3}return Lt=gt+Lt,ht={id:et++,callback:dt,priorityLevel:ht,startTime:gt,expirationTime:Lt,sortIndex:-1},gt>kt?(ht.sortIndex=gt,o($,ht),s(b)===null&&ht===s($)&&(lt?(ot(_t),_t=-1):lt=!0,bt(at,gt-kt))):(ht.sortIndex=Lt,o(b,ht),nt||tt||(nt=!0,ut(it))),ht},e.unstable_shouldYield=Ot,e.unstable_wrapCallback=function(ht){var dt=j;return function(){var gt=j;j=dt;try{return ht.apply(this,arguments)}finally{j=gt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(e){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)o+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,o){ha(e,o),ha(e+"Capture",o)}function ha(e,o){for(ea[e]=o,e=0;e<o.length;e++)da.add(o[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,o,s,a){if(s!==null&&s.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return a?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,o,s,a){if(o===null||typeof o>"u"||pa(e,o,s,a))return!0;if(a)return!1;if(s!==null)switch(s.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function v(e,o,s,a,h,d,c){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=a,this.attributeNamespace=h,this.mustUseProperty=s,this.propertyName=e,this.type=o,this.sanitizeURL=d,this.removeEmptyString=c}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var o=e[0];z[o]=new v(o,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var o=e.replace(ra,sa);z[o]=new v(o,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var o=e.replace(ra,sa);z[o]=new v(o,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var o=e.replace(ra,sa);z[o]=new v(o,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,o,s,a){var h=z.hasOwnProperty(o)?z[o]:null;(h!==null?h.type!==0:a||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(qa(o,s,h,a)&&(s=null),a||h===null?oa(o)&&(s===null?e.removeAttribute(o):e.setAttribute(o,""+s)):h.mustUseProperty?e[h.propertyName]=s===null?h.type===3?!1:"":s:(o=h.attributeName,a=h.attributeNamespace,s===null?e.removeAttribute(o):(h=h.type,s=h===3||h===4&&s===!0?"":""+s,a?e.setAttributeNS(a,o,s):e.setAttribute(o,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(s){var o=s.stack.trim().match(/\n( *(at )?)/);La=o&&o[1]||""}return`
`+La+e}var Na=!1;function Oa(e,o){if(!e||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch($){var a=$}Reflect.construct(e,[],o)}else{try{o.call()}catch($){a=$}e.call(o.prototype)}else{try{throw Error()}catch($){a=$}e()}}catch($){if($&&a&&typeof $.stack=="string"){for(var h=$.stack.split(`
`),d=a.stack.split(`
`),c=h.length-1,g=d.length-1;1<=c&&0<=g&&h[c]!==d[g];)g--;for(;1<=c&&0<=g;c--,g--)if(h[c]!==d[g]){if(c!==1||g!==1)do if(c--,g--,0>g||h[c]!==d[g]){var b=`
`+h[c].replace(" at new "," at ");return e.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",e.displayName)),b}while(1<=c&&0<=g);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var o=e.render;return e=e.displayName,e||(e=o.displayName||o.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return o=e.displayName||null,o!==null?o:Qa(e.type)||"Memo";case Ha:o=e._payload,e=e._init;try{return Qa(e(o))}catch{}}return null}function Ra(e){var o=e.type;switch(e.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=o.render,e=e.displayName||e.name||"",o.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(o);case 8:return o===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var o=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ua(e){var o=Ta(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,o),a=""+e[o];if(!e.hasOwnProperty(o)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var h=s.get,d=s.set;return Object.defineProperty(e,o,{configurable:!0,get:function(){return h.call(this)},set:function(c){a=""+c,d.call(this,c)}}),Object.defineProperty(e,o,{enumerable:s.enumerable}),{getValue:function(){return a},setValue:function(c){a=""+c},stopTracking:function(){e._valueTracker=null,delete e[o]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var o=e._valueTracker;if(!o)return!0;var s=o.getValue(),a="";return e&&(a=Ta(e)?e.checked?"true":"false":e.value),e=a,e!==s?(o.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,o){var s=o.checked;return A({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Za(e,o){var s=o.defaultValue==null?"":o.defaultValue,a=o.checked!=null?o.checked:o.defaultChecked;s=Sa(o.value!=null?o.value:s),e._wrapperState={initialChecked:a,initialValue:s,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function ab(e,o){o=o.checked,o!=null&&ta(e,"checked",o,!1)}function bb(e,o){ab(e,o);var s=Sa(o.value),a=o.type;if(s!=null)a==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}o.hasOwnProperty("value")?cb(e,o.type,s):o.hasOwnProperty("defaultValue")&&cb(e,o.type,Sa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(e.defaultChecked=!!o.defaultChecked)}function db(e,o,s){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var a=o.type;if(!(a!=="submit"&&a!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+e._wrapperState.initialValue,s||o===e.value||(e.value=o),e.defaultValue=o}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function cb(e,o,s){(o!=="number"||Xa(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var eb=Array.isArray;function fb(e,o,s,a){if(e=e.options,o){o={};for(var h=0;h<s.length;h++)o["$"+s[h]]=!0;for(s=0;s<e.length;s++)h=o.hasOwnProperty("$"+e[s].value),e[s].selected!==h&&(e[s].selected=h),h&&a&&(e[s].defaultSelected=!0)}else{for(s=""+Sa(s),o=null,h=0;h<e.length;h++){if(e[h].value===s){e[h].selected=!0,a&&(e[h].defaultSelected=!0);return}o!==null||e[h].disabled||(o=e[h])}o!==null&&(o.selected=!0)}}function gb(e,o){if(o.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},o,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,o){var s=o.value;if(s==null){if(s=o.children,o=o.defaultValue,s!=null){if(o!=null)throw Error(p$1(92));if(eb(s)){if(1<s.length)throw Error(p$1(93));s=s[0]}o=s}o==null&&(o=""),s=o}e._wrapperState={initialValue:Sa(s)}}function ib(e,o){var s=Sa(o.value),a=Sa(o.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),o.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),a!=null&&(e.defaultValue=""+a)}function jb(e){var o=e.textContent;o===e._wrapperState.initialValue&&o!==""&&o!==null&&(e.value=o)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,o){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(o):e==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,s,a,h){MSApp.execUnsafeLocalFunction(function(){return e(o,s,a,h)})}:e}(function(e,o){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=o;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;o.firstChild;)e.appendChild(o.firstChild)}});function ob(e,o){if(o){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=o;return}}e.textContent=o}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(o){o=o+e.charAt(0).toUpperCase()+e.substring(1),pb[o]=pb[e]})});function rb(e,o,s){return o==null||typeof o=="boolean"||o===""?"":s||typeof o!="number"||o===0||pb.hasOwnProperty(e)&&pb[e]?(""+o).trim():o+"px"}function sb(e,o){e=e.style;for(var s in o)if(o.hasOwnProperty(s)){var a=s.indexOf("--")===0,h=rb(s,o[s],a);s==="float"&&(s="cssFloat"),a?e.setProperty(s,h):e[s]=h}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,o){if(o){if(tb[e]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(p$1(137,e));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(p$1(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(p$1(61))}if(o.style!=null&&typeof o.style!="object")throw Error(p$1(62))}}function vb(e,o){if(e.indexOf("-")===-1)return typeof o.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p$1(280));var o=e.stateNode;o&&(o=Db(o),yb(e.stateNode,e.type,o))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,o=Ab;if(Ab=zb=null,Bb(e),o)for(e=0;e<o.length;e++)Bb(o[e])}}function Gb(e,o){return e(o)}function Hb(){}var Ib=!1;function Jb(e,o,s){if(Ib)return e(o,s);Ib=!0;try{return Gb(e,o,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,o){var s=e.stateNode;if(s===null)return null;var a=Db(s);if(a===null)return null;s=a[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(p$1(231,o,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,o,s,a,h,d,c,g,b){var $=Array.prototype.slice.call(arguments,3);try{o.apply(s,$)}catch(et){this.onError(et)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,o,s,a,h,d,c,g,b){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,o,s,a,h,d,c,g,b){if(Tb.apply(this,arguments),Ob){if(Ob){var $=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=$)}}function Vb(e){var o=e,s=e;if(e.alternate)for(;o.return;)o=o.return;else{e=o;do o=e,o.flags&4098&&(s=o.return),e=o.return;while(e)}return o.tag===3?s:null}function Wb(e){if(e.tag===13){var o=e.memoizedState;if(o===null&&(e=e.alternate,e!==null&&(o=e.memoizedState)),o!==null)return o.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p$1(188))}function Yb(e){var o=e.alternate;if(!o){if(o=Vb(e),o===null)throw Error(p$1(188));return o!==e?null:e}for(var s=e,a=o;;){var h=s.return;if(h===null)break;var d=h.alternate;if(d===null){if(a=h.return,a!==null){s=a;continue}break}if(h.child===d.child){for(d=h.child;d;){if(d===s)return Xb(h),e;if(d===a)return Xb(h),o;d=d.sibling}throw Error(p$1(188))}if(s.return!==a.return)s=h,a=d;else{for(var c=!1,g=h.child;g;){if(g===s){c=!0,s=h,a=d;break}if(g===a){c=!0,a=h,s=d;break}g=g.sibling}if(!c){for(g=d.child;g;){if(g===s){c=!0,s=d,a=h;break}if(g===a){c=!0,a=d,s=h;break}g=g.sibling}if(!c)throw Error(p$1(189))}}if(s.alternate!==a)throw Error(p$1(190))}if(s.tag!==3)throw Error(p$1(188));return s.stateNode.current===s?e:o}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var o=$b(e);if(o!==null)return o;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,o){var s=e.pendingLanes;if(s===0)return 0;var a=0,h=e.suspendedLanes,d=e.pingedLanes,c=s&268435455;if(c!==0){var g=c&~h;g!==0?a=tc(g):(d&=c,d!==0&&(a=tc(d)))}else c=s&~h,c!==0?a=tc(c):d!==0&&(a=tc(d));if(a===0)return 0;if(o!==0&&o!==a&&!(o&h)&&(h=a&-a,d=o&-o,h>=d||h===16&&(d&4194240)!==0))return o;if(a&4&&(a|=s&16),o=e.entangledLanes,o!==0)for(e=e.entanglements,o&=a;0<o;)s=31-oc(o),h=1<<s,a|=e[s],o&=~h;return a}function vc(e,o){switch(e){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,o){for(var s=e.suspendedLanes,a=e.pingedLanes,h=e.expirationTimes,d=e.pendingLanes;0<d;){var c=31-oc(d),g=1<<c,b=h[c];b===-1?(!(g&s)||g&a)&&(h[c]=vc(g,o)):b<=o&&(e.expiredLanes|=g),d&=~g}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var o=[],s=0;31>s;s++)o.push(e);return o}function Ac(e,o,s){e.pendingLanes|=o,o!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,o=31-oc(o),e[o]=s}function Bc(e,o){var s=e.pendingLanes&~o;e.pendingLanes=o,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=o,e.mutableReadLanes&=o,e.entangledLanes&=o,o=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<s;){var h=31-oc(s),d=1<<h;o[h]=0,a[h]=-1,e[h]=-1,s&=~d}}function Cc(e,o){var s=e.entangledLanes|=o;for(e=e.entanglements;s;){var a=31-oc(s),h=1<<a;h&o|e[a]&o&&(e[a]|=o),s&=~h}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,o){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(o.pointerId)}}function Tc(e,o,s,a,h,d){return e===null||e.nativeEvent!==d?(e={blockedOn:o,domEventName:s,eventSystemFlags:a,nativeEvent:d,targetContainers:[h]},o!==null&&(o=Cb(o),o!==null&&Fc(o)),e):(e.eventSystemFlags|=a,o=e.targetContainers,h!==null&&o.indexOf(h)===-1&&o.push(h),e)}function Uc(e,o,s,a,h){switch(o){case"focusin":return Lc=Tc(Lc,e,o,s,a,h),!0;case"dragenter":return Mc=Tc(Mc,e,o,s,a,h),!0;case"mouseover":return Nc=Tc(Nc,e,o,s,a,h),!0;case"pointerover":var d=h.pointerId;return Oc.set(d,Tc(Oc.get(d)||null,e,o,s,a,h)),!0;case"gotpointercapture":return d=h.pointerId,Pc.set(d,Tc(Pc.get(d)||null,e,o,s,a,h)),!0}return!1}function Vc(e){var o=Wc(e.target);if(o!==null){var s=Vb(o);if(s!==null){if(o=s.tag,o===13){if(o=Wb(s),o!==null){e.blockedOn=o,Ic(e.priority,function(){Gc(s)});return}}else if(o===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var o=e.targetContainers;0<o.length;){var s=Yc(e.domEventName,e.eventSystemFlags,o[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var a=new s.constructor(s.type,s);wb=a,s.target.dispatchEvent(a),wb=null}else return o=Cb(s),o!==null&&Fc(o),e.blockedOn=s,!1;o.shift()}return!0}function Zc(e,o,s){Xc(e)&&s.delete(o)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,o){e.blockedOn===o&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function o(h){return ad(h,e)}if(0<Kc.length){ad(Kc[0],e);for(var s=1;s<Kc.length;s++){var a=Kc[s];a.blockedOn===e&&(a.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(o),Pc.forEach(o),s=0;s<Qc.length;s++)a=Qc[s],a.blockedOn===e&&(a.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,o,s,a){var h=C,d=cd.transition;cd.transition=null;try{C=1,fd(e,o,s,a)}finally{C=h,cd.transition=d}}function gd(e,o,s,a){var h=C,d=cd.transition;cd.transition=null;try{C=4,fd(e,o,s,a)}finally{C=h,cd.transition=d}}function fd(e,o,s,a){if(dd){var h=Yc(e,o,s,a);if(h===null)hd(e,o,a,id,s),Sc(e,a);else if(Uc(h,e,o,s,a))a.stopPropagation();else if(Sc(e,a),o&4&&-1<Rc.indexOf(e)){for(;h!==null;){var d=Cb(h);if(d!==null&&Ec(d),d=Yc(e,o,s,a),d===null&&hd(e,o,a,id,s),d===h)break;h=d}h!==null&&a.stopPropagation()}else hd(e,o,a,null,s)}}var id=null;function Yc(e,o,s,a){if(id=null,e=xb(a),e=Wc(e),e!==null)if(o=Vb(e),o===null)e=null;else if(s=o.tag,s===13){if(e=Wb(o),e!==null)return e;e=null}else if(s===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;e=null}else o!==e&&(e=null);return id=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,o=ld,s=o.length,a,h="value"in kd?kd.value:kd.textContent,d=h.length;for(e=0;e<s&&o[e]===h[e];e++);var c=s-e;for(a=1;a<=c&&o[s-a]===h[d-a];a++);return md=h.slice(e,1<a?1-a:void 0)}function od(e){var o=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&o===13&&(e=13)):e=o,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function o(s,a,h,d,c){this._reactName=s,this._targetInst=h,this.type=a,this.nativeEvent=d,this.target=c,this.currentTarget=null;for(var g in e)e.hasOwnProperty(g)&&(s=e[g],this[g]=s?s(d):d[g]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),o}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(e):(e=Od[e])?!!o[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var o=Md[e.key]||e.key;if(o!=="Unidentified")return o}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(e,o){switch(e){case"keyup":return $d.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie=!1;function je(e,o){switch(e){case"compositionend":return he(o);case"keypress":return o.which!==32?null:(fe=!0,ee);case"textInput":return e=o.data,e===ee&&fe?null:e;default:return null}}function ke(e,o){if(ie)return e==="compositionend"||!ae&&ge(e,o)?(e=nd(),md=ld=kd=null,ie=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return de&&o.locale!=="ko"?null:o.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(e){var o=e&&e.nodeName&&e.nodeName.toLowerCase();return o==="input"?!!le[e.type]:o==="textarea"}function ne(e,o,s,a){Eb(a),o=oe(o,"onChange"),0<o.length&&(s=new td("onChange","change",null,s,a),e.push({event:s,listeners:o}))}var pe=null,qe=null;function re(e){se(e,0)}function te(e){var o=ue(e);if(Wa(o))return e}function ve(e,o){if(e==="change")return o}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(e){if(e.propertyName==="value"&&te(qe)){var o=[];ne(o,qe,e,xb(e)),Jb(re,o)}}function Ce(e,o,s){e==="focusin"?(Ae(),pe=o,qe=s,pe.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te(qe)}function Ee(e,o){if(e==="click")return te(o)}function Fe(e,o){if(e==="input"||e==="change")return te(o)}function Ge(e,o){return e===o&&(e!==0||1/e===1/o)||e!==e&&o!==o}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,o){if(He(e,o))return!0;if(typeof e!="object"||e===null||typeof o!="object"||o===null)return!1;var s=Object.keys(e),a=Object.keys(o);if(s.length!==a.length)return!1;for(a=0;a<s.length;a++){var h=s[a];if(!ja.call(o,h)||!He(e[h],o[h]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,o){var s=Je(e);e=0;for(var a;s;){if(s.nodeType===3){if(a=e+s.textContent.length,e<=o&&a>=o)return{node:s,offset:o-e};e=a}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(e,o){return e&&o?e===o?!0:e&&e.nodeType===3?!1:o&&o.nodeType===3?Le(e,o.parentNode):"contains"in e?e.contains(o):e.compareDocumentPosition?!!(e.compareDocumentPosition(o)&16):!1:!1}function Me(){for(var e=window,o=Xa();o instanceof e.HTMLIFrameElement;){try{var s=typeof o.contentWindow.location.href=="string"}catch{s=!1}if(s)e=o.contentWindow;else break;o=Xa(e.document)}return o}function Ne(e){var o=e&&e.nodeName&&e.nodeName.toLowerCase();return o&&(o==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||o==="textarea"||e.contentEditable==="true")}function Oe(e){var o=Me(),s=e.focusedElem,a=e.selectionRange;if(o!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(a!==null&&Ne(s)){if(o=a.start,e=a.end,e===void 0&&(e=o),"selectionStart"in s)s.selectionStart=o,s.selectionEnd=Math.min(e,s.value.length);else if(e=(o=s.ownerDocument||document)&&o.defaultView||window,e.getSelection){e=e.getSelection();var h=s.textContent.length,d=Math.min(a.start,h);a=a.end===void 0?d:Math.min(a.end,h),!e.extend&&d>a&&(h=a,a=d,d=h),h=Ke(s,d);var c=Ke(s,a);h&&c&&(e.rangeCount!==1||e.anchorNode!==h.node||e.anchorOffset!==h.offset||e.focusNode!==c.node||e.focusOffset!==c.offset)&&(o=o.createRange(),o.setStart(h.node,h.offset),e.removeAllRanges(),d>a?(e.addRange(o),e.extend(c.node,c.offset)):(o.setEnd(c.node,c.offset),e.addRange(o)))}}for(o=[],e=s;e=e.parentNode;)e.nodeType===1&&o.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<o.length;s++)e=o[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(e,o,s){var a=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te||Qe==null||Qe!==Xa(a)||(a=Qe,"selectionStart"in a&&Ne(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Se&&Ie(Se,a)||(Se=a,a=oe(Re,"onSelect"),0<a.length&&(o=new td("onSelect","select",null,o,s),e.push({event:o,listeners:a}),o.target=Qe)))}function Ve(e,o){var s={};return s[e.toLowerCase()]=o.toLowerCase(),s["Webkit"+e]="webkit"+o,s["Moz"+e]="moz"+o,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var o=We[e],s;for(s in o)if(o.hasOwnProperty(s)&&s in Ye)return Xe[e]=o[s];return e}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,o){df.set(e,o),fa(o,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,o,s){var a=e.type||"unknown-event";e.currentTarget=s,Ub(a,o,void 0,e),e.currentTarget=null}function se(e,o){o=(o&4)!==0;for(var s=0;s<e.length;s++){var a=e[s],h=a.event;a=a.listeners;e:{var d=void 0;if(o)for(var c=a.length-1;0<=c;c--){var g=a[c],b=g.instance,$=g.currentTarget;if(g=g.listener,b!==d&&h.isPropagationStopped())break e;nf(h,g,$),d=b}else for(c=0;c<a.length;c++){if(g=a[c],b=g.instance,$=g.currentTarget,g=g.listener,b!==d&&h.isPropagationStopped())break e;nf(h,g,$),d=b}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D(e,o){var s=o[of];s===void 0&&(s=o[of]=new Set);var a=e+"__bubble";s.has(a)||(pf(o,e,2,!1),s.add(a))}function qf(e,o,s){var a=0;o&&(a|=4),pf(s,e,a,o)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,e),qf(s,!0,e))});var o=e.nodeType===9?e:e.ownerDocument;o===null||o[rf]||(o[rf]=!0,qf("selectionchange",!1,o))}}function pf(e,o,s,a){switch(jd(o)){case 1:var h=ed;break;case 4:h=gd;break;default:h=fd}s=h.bind(null,o,s,e),h=void 0,!Lb||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(h=!0),a?h!==void 0?e.addEventListener(o,s,{capture:!0,passive:h}):e.addEventListener(o,s,!0):h!==void 0?e.addEventListener(o,s,{passive:h}):e.addEventListener(o,s,!1)}function hd(e,o,s,a,h){var d=a;if(!(o&1)&&!(o&2)&&a!==null)e:for(;;){if(a===null)return;var c=a.tag;if(c===3||c===4){var g=a.stateNode.containerInfo;if(g===h||g.nodeType===8&&g.parentNode===h)break;if(c===4)for(c=a.return;c!==null;){var b=c.tag;if((b===3||b===4)&&(b=c.stateNode.containerInfo,b===h||b.nodeType===8&&b.parentNode===h))return;c=c.return}for(;g!==null;){if(c=Wc(g),c===null)return;if(b=c.tag,b===5||b===6){a=d=c;continue e}g=g.parentNode}}a=a.return}Jb(function(){var $=d,et=xb(s),st=[];e:{var j=df.get(e);if(j!==void 0){var tt=td,nt=e;switch(e){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":tt=Rd;break;case"focusin":nt="focus",tt=Fd;break;case"focusout":nt="blur",tt=Fd;break;case"beforeblur":case"afterblur":tt=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":tt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":tt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":tt=Vd;break;case $e:case af:case bf:tt=Hd;break;case cf:tt=Xd;break;case"scroll":tt=vd;break;case"wheel":tt=Zd;break;case"copy":case"cut":case"paste":tt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":tt=Td}var lt=(o&4)!==0,ct=!lt&&e==="scroll",ot=lt?j!==null?j+"Capture":null:j;lt=[];for(var _e=$,_;_e!==null;){_=_e;var at=_.stateNode;if(_.tag===5&&at!==null&&(_=at,ot!==null&&(at=Kb(_e,ot),at!=null&&lt.push(tf(_e,at,_)))),ct)break;_e=_e.return}0<lt.length&&(j=new tt(j,nt,null,s,et),st.push({event:j,listeners:lt}))}}if(!(o&7)){e:{if(j=e==="mouseover"||e==="pointerover",tt=e==="mouseout"||e==="pointerout",j&&s!==wb&&(nt=s.relatedTarget||s.fromElement)&&(Wc(nt)||nt[uf]))break e;if((tt||j)&&(j=et.window===et?et:(j=et.ownerDocument)?j.defaultView||j.parentWindow:window,tt?(nt=s.relatedTarget||s.toElement,tt=$,nt=nt?Wc(nt):null,nt!==null&&(ct=Vb(nt),nt!==ct||nt.tag!==5&&nt.tag!==6)&&(nt=null)):(tt=null,nt=$),tt!==nt)){if(lt=Bd,at="onMouseLeave",ot="onMouseEnter",_e="mouse",(e==="pointerout"||e==="pointerover")&&(lt=Td,at="onPointerLeave",ot="onPointerEnter",_e="pointer"),ct=tt==null?j:ue(tt),_=nt==null?j:ue(nt),j=new lt(at,_e+"leave",tt,s,et),j.target=ct,j.relatedTarget=_,at=null,Wc(et)===$&&(lt=new lt(ot,_e+"enter",nt,s,et),lt.target=_,lt.relatedTarget=ct,at=lt),ct=at,tt&&nt)t:{for(lt=tt,ot=nt,_e=0,_=lt;_;_=vf(_))_e++;for(_=0,at=ot;at;at=vf(at))_++;for(;0<_e-_;)lt=vf(lt),_e--;for(;0<_-_e;)ot=vf(ot),_--;for(;_e--;){if(lt===ot||ot!==null&&lt===ot.alternate)break t;lt=vf(lt),ot=vf(ot)}lt=null}else lt=null;tt!==null&&wf(st,j,tt,lt,!1),nt!==null&&ct!==null&&wf(st,ct,nt,lt,!0)}}e:{if(j=$?ue($):window,tt=j.nodeName&&j.nodeName.toLowerCase(),tt==="select"||tt==="input"&&j.type==="file")var it=ve;else if(me(j))if(we)it=Fe;else{it=De;var pt=Ce}else(tt=j.nodeName)&&tt.toLowerCase()==="input"&&(j.type==="checkbox"||j.type==="radio")&&(it=Ee);if(it&&(it=it(e,$))){ne(st,it,s,et);break e}pt&&pt(e,j,$),e==="focusout"&&(pt=j._wrapperState)&&pt.controlled&&j.type==="number"&&cb(j,"number",j.value)}switch(pt=$?ue($):window,e){case"focusin":(me(pt)||pt.contentEditable==="true")&&(Qe=pt,Re=$,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(st,s,et);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(st,s,et)}var mt;if(ae)e:{switch(e){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else ie?ge(e,s)&&(_t="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(_t="onCompositionStart");_t&&(de&&s.locale!=="ko"&&(ie||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&ie&&(mt=nd()):(kd=et,ld="value"in kd?kd.value:kd.textContent,ie=!0)),pt=oe($,_t),0<pt.length&&(_t=new Ld(_t,e,null,s,et),st.push({event:_t,listeners:pt}),mt?_t.data=mt:(mt=he(s),mt!==null&&(_t.data=mt)))),(mt=ce?je(e,s):ke(e,s))&&($=oe($,"onBeforeInput"),0<$.length&&(et=new Ld("onBeforeInput","beforeinput",null,s,et),st.push({event:et,listeners:$}),et.data=mt))}se(st,o)})}function tf(e,o,s){return{instance:e,listener:o,currentTarget:s}}function oe(e,o){for(var s=o+"Capture",a=[];e!==null;){var h=e,d=h.stateNode;h.tag===5&&d!==null&&(h=d,d=Kb(e,s),d!=null&&a.unshift(tf(e,d,h)),d=Kb(e,o),d!=null&&a.push(tf(e,d,h))),e=e.return}return a}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,o,s,a,h){for(var d=o._reactName,c=[];s!==null&&s!==a;){var g=s,b=g.alternate,$=g.stateNode;if(b!==null&&b===a)break;g.tag===5&&$!==null&&(g=$,h?(b=Kb(s,d),b!=null&&c.unshift(tf(s,b,g))):h||(b=Kb(s,d),b!=null&&c.push(tf(s,b,g)))),s=s.return}c.length!==0&&e.push({event:o,listeners:c})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,o,s){if(o=zf(o),zf(e)!==o&&s)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,o){return e==="textarea"||e==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,o){var s=o,a=0;do{var h=s.nextSibling;if(e.removeChild(s),h&&h.nodeType===8)if(s=h.data,s==="/$"){if(a===0){e.removeChild(h),bd(o);return}a--}else s!=="$"&&s!=="$?"&&s!=="$!"||a++;s=h}while(s);bd(o)}function Lf(e){for(;e!=null;e=e.nextSibling){var o=e.nodeType;if(o===1||o===3)break;if(o===8){if(o=e.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var o=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(o===0)return e;o--}else s==="/$"&&o++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var o=e[Of];if(o)return o;for(var s=e.parentNode;s;){if(o=s[uf]||s[Of]){if(s=o.alternate,o.child!==null||s!==null&&s.child!==null)for(e=Mf(e);e!==null;){if(s=e[Of])return s;e=Mf(e)}return o}e=s,s=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p$1(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,o){Tf++,Sf[Tf]=e.current,e.current=o}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,o){var s=e.type.contextTypes;if(!s)return Vf;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===o)return a.__reactInternalMemoizedMaskedChildContext;var h={},d;for(d in s)h[d]=o[d];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=h),h}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E(Wf),E(H)}function ag(e,o,s){if(H.current!==Vf)throw Error(p$1(168));G(H,o),G(Wf,s)}function bg(e,o,s){var a=e.stateNode;if(o=o.childContextTypes,typeof a.getChildContext!="function")return s;a=a.getChildContext();for(var h in a)if(!(h in o))throw Error(p$1(108,Ra(e)||"Unknown",h));return A({},s,a)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,o,s){var a=e.stateNode;if(!a)throw Error(p$1(169));s?(e=bg(e,o,Xf),a.__reactInternalMemoizedMergedChildContext=e,E(Wf),E(H),G(H,e)):E(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,o=C;try{var s=eg;for(C=1;e<s.length;e++){var a=s[e];do a=a(!0);while(a!==null)}eg=null,fg=!1}catch(h){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),h}finally{C=o,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,o){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=o}function ug(e,o,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var a=rg;e=sg;var h=32-oc(a)-1;a&=~(1<<h),s+=1;var d=32-oc(o)+h;if(30<d){var c=h-h%5;d=(a&(1<<c)-1).toString(32),a>>=c,h-=c,rg=1<<32-oc(o)+h|s<<h|a,sg=d+e}else rg=1<<d|s<<h|a,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,o){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=o,s.return=e,o=e.deletions,o===null?(e.deletions=[s],e.flags|=16):o.push(s)}function Cg(e,o){switch(e.tag){case 5:var s=e.type;return o=o.nodeType!==1||s.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(e.stateNode=o,xg=e,yg=Lf(o.firstChild),!0):!1;case 6:return o=e.pendingProps===""||o.nodeType!==3?null:o,o!==null?(e.stateNode=o,xg=e,yg=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(s=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:o,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=o,s.return=e,e.child=s,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var o=yg;if(o){var s=o;if(!Cg(e,o)){if(Dg(e))throw Error(p$1(418));o=Lf(s.nextSibling);var a=xg;o&&Cg(e,o)?Ag(a,s):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p$1(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var o;if((o=e.tag!==3)&&!(o=e.tag!==5)&&(o=e.type,o=o!=="head"&&o!=="body"&&!Ef(e.type,e.memoizedProps)),o&&(o=yg)){if(Dg(e))throw Hg(),Error(p$1(418));for(;o;)Ag(e,o),o=Lf(o.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p$1(317));e:{for(e=e.nextSibling,o=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(o===0){yg=Lf(e.nextSibling);break e}o--}else s!=="$"&&s!=="$!"&&s!=="$?"||o++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,o,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p$1(309));var a=s.stateNode}if(!a)throw Error(p$1(147,e));var h=a,d=""+e;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===d?o.ref:(o=function(c){var g=h.refs;c===null?delete g[d]:g[d]=c},o._stringRef=d,o)}if(typeof e!="string")throw Error(p$1(284));if(!s._owner)throw Error(p$1(290,e))}return e}function Mg(e,o){throw e=Object.prototype.toString.call(o),Error(p$1(31,e==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":e))}function Ng(e){var o=e._init;return o(e._payload)}function Og(e){function o(ot,_e){if(e){var _=ot.deletions;_===null?(ot.deletions=[_e],ot.flags|=16):_.push(_e)}}function s(ot,_e){if(!e)return null;for(;_e!==null;)o(ot,_e),_e=_e.sibling;return null}function a(ot,_e){for(ot=new Map;_e!==null;)_e.key!==null?ot.set(_e.key,_e):ot.set(_e.index,_e),_e=_e.sibling;return ot}function h(ot,_e){return ot=Pg(ot,_e),ot.index=0,ot.sibling=null,ot}function d(ot,_e,_){return ot.index=_,e?(_=ot.alternate,_!==null?(_=_.index,_<_e?(ot.flags|=2,_e):_):(ot.flags|=2,_e)):(ot.flags|=1048576,_e)}function c(ot){return e&&ot.alternate===null&&(ot.flags|=2),ot}function g(ot,_e,_,at){return _e===null||_e.tag!==6?(_e=Qg(_,ot.mode,at),_e.return=ot,_e):(_e=h(_e,_),_e.return=ot,_e)}function b(ot,_e,_,at){var it=_.type;return it===ya?et(ot,_e,_.props.children,at,_.key):_e!==null&&(_e.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===Ha&&Ng(it)===_e.type)?(at=h(_e,_.props),at.ref=Lg(ot,_e,_),at.return=ot,at):(at=Rg(_.type,_.key,_.props,null,ot.mode,at),at.ref=Lg(ot,_e,_),at.return=ot,at)}function $(ot,_e,_,at){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==_.containerInfo||_e.stateNode.implementation!==_.implementation?(_e=Sg(_,ot.mode,at),_e.return=ot,_e):(_e=h(_e,_.children||[]),_e.return=ot,_e)}function et(ot,_e,_,at,it){return _e===null||_e.tag!==7?(_e=Tg(_,ot.mode,at,it),_e.return=ot,_e):(_e=h(_e,_),_e.return=ot,_e)}function st(ot,_e,_){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return _e=Qg(""+_e,ot.mode,_),_e.return=ot,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case va:return _=Rg(_e.type,_e.key,_e.props,null,ot.mode,_),_.ref=Lg(ot,null,_e),_.return=ot,_;case wa:return _e=Sg(_e,ot.mode,_),_e.return=ot,_e;case Ha:var at=_e._init;return st(ot,at(_e._payload),_)}if(eb(_e)||Ka(_e))return _e=Tg(_e,ot.mode,_,null),_e.return=ot,_e;Mg(ot,_e)}return null}function j(ot,_e,_,at){var it=_e!==null?_e.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return it!==null?null:g(ot,_e,""+_,at);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case va:return _.key===it?b(ot,_e,_,at):null;case wa:return _.key===it?$(ot,_e,_,at):null;case Ha:return it=_._init,j(ot,_e,it(_._payload),at)}if(eb(_)||Ka(_))return it!==null?null:et(ot,_e,_,at,null);Mg(ot,_)}return null}function tt(ot,_e,_,at,it){if(typeof at=="string"&&at!==""||typeof at=="number")return ot=ot.get(_)||null,g(_e,ot,""+at,it);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case va:return ot=ot.get(at.key===null?_:at.key)||null,b(_e,ot,at,it);case wa:return ot=ot.get(at.key===null?_:at.key)||null,$(_e,ot,at,it);case Ha:var pt=at._init;return tt(ot,_e,_,pt(at._payload),it)}if(eb(at)||Ka(at))return ot=ot.get(_)||null,et(_e,ot,at,it,null);Mg(_e,at)}return null}function nt(ot,_e,_,at){for(var it=null,pt=null,mt=_e,_t=_e=0,Et=null;mt!==null&&_t<_.length;_t++){mt.index>_t?(Et=mt,mt=null):Et=mt.sibling;var Tt=j(ot,mt,_[_t],at);if(Tt===null){mt===null&&(mt=Et);break}e&&mt&&Tt.alternate===null&&o(ot,mt),_e=d(Tt,_e,_t),pt===null?it=Tt:pt.sibling=Tt,pt=Tt,mt=Et}if(_t===_.length)return s(ot,mt),I&&tg(ot,_t),it;if(mt===null){for(;_t<_.length;_t++)mt=st(ot,_[_t],at),mt!==null&&(_e=d(mt,_e,_t),pt===null?it=mt:pt.sibling=mt,pt=mt);return I&&tg(ot,_t),it}for(mt=a(ot,mt);_t<_.length;_t++)Et=tt(mt,ot,_t,_[_t],at),Et!==null&&(e&&Et.alternate!==null&&mt.delete(Et.key===null?_t:Et.key),_e=d(Et,_e,_t),pt===null?it=Et:pt.sibling=Et,pt=Et);return e&&mt.forEach(function(Ot){return o(ot,Ot)}),I&&tg(ot,_t),it}function lt(ot,_e,_,at){var it=Ka(_);if(typeof it!="function")throw Error(p$1(150));if(_=it.call(_),_==null)throw Error(p$1(151));for(var pt=it=null,mt=_e,_t=_e=0,Et=null,Tt=_.next();mt!==null&&!Tt.done;_t++,Tt=_.next()){mt.index>_t?(Et=mt,mt=null):Et=mt.sibling;var Ot=j(ot,mt,Tt.value,at);if(Ot===null){mt===null&&(mt=Et);break}e&&mt&&Ot.alternate===null&&o(ot,mt),_e=d(Ot,_e,_t),pt===null?it=Ot:pt.sibling=Ot,pt=Ot,mt=Et}if(Tt.done)return s(ot,mt),I&&tg(ot,_t),it;if(mt===null){for(;!Tt.done;_t++,Tt=_.next())Tt=st(ot,Tt.value,at),Tt!==null&&(_e=d(Tt,_e,_t),pt===null?it=Tt:pt.sibling=Tt,pt=Tt);return I&&tg(ot,_t),it}for(mt=a(ot,mt);!Tt.done;_t++,Tt=_.next())Tt=tt(mt,ot,_t,Tt.value,at),Tt!==null&&(e&&Tt.alternate!==null&&mt.delete(Tt.key===null?_t:Tt.key),_e=d(Tt,_e,_t),pt===null?it=Tt:pt.sibling=Tt,pt=Tt);return e&&mt.forEach(function(Ct){return o(ot,Ct)}),I&&tg(ot,_t),it}function ct(ot,_e,_,at){if(typeof _=="object"&&_!==null&&_.type===ya&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case va:e:{for(var it=_.key,pt=_e;pt!==null;){if(pt.key===it){if(it=_.type,it===ya){if(pt.tag===7){s(ot,pt.sibling),_e=h(pt,_.props.children),_e.return=ot,ot=_e;break e}}else if(pt.elementType===it||typeof it=="object"&&it!==null&&it.$$typeof===Ha&&Ng(it)===pt.type){s(ot,pt.sibling),_e=h(pt,_.props),_e.ref=Lg(ot,pt,_),_e.return=ot,ot=_e;break e}s(ot,pt);break}else o(ot,pt);pt=pt.sibling}_.type===ya?(_e=Tg(_.props.children,ot.mode,at,_.key),_e.return=ot,ot=_e):(at=Rg(_.type,_.key,_.props,null,ot.mode,at),at.ref=Lg(ot,_e,_),at.return=ot,ot=at)}return c(ot);case wa:e:{for(pt=_.key;_e!==null;){if(_e.key===pt)if(_e.tag===4&&_e.stateNode.containerInfo===_.containerInfo&&_e.stateNode.implementation===_.implementation){s(ot,_e.sibling),_e=h(_e,_.children||[]),_e.return=ot,ot=_e;break e}else{s(ot,_e);break}else o(ot,_e);_e=_e.sibling}_e=Sg(_,ot.mode,at),_e.return=ot,ot=_e}return c(ot);case Ha:return pt=_._init,ct(ot,_e,pt(_._payload),at)}if(eb(_))return nt(ot,_e,_,at);if(Ka(_))return lt(ot,_e,_,at);Mg(ot,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,_e!==null&&_e.tag===6?(s(ot,_e.sibling),_e=h(_e,_),_e.return=ot,ot=_e):(s(ot,_e),_e=Qg(_,ot.mode,at),_e.return=ot,ot=_e),c(ot)):s(ot,_e)}return ct}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var o=Wg.current;E(Wg),e._currentValue=o}function bh(e,o,s){for(;e!==null;){var a=e.alternate;if((e.childLanes&o)!==o?(e.childLanes|=o,a!==null&&(a.childLanes|=o)):a!==null&&(a.childLanes&o)!==o&&(a.childLanes|=o),e===s)break;e=e.return}}function ch(e,o){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&o&&(dh=!0),e.firstContext=null)}function eh(e){var o=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:o,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return o}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,o,s,a){var h=o.interleaved;return h===null?(s.next=s,gh(o)):(s.next=h.next,h.next=s),o.interleaved=s,ih(e,a)}function ih(e,o){e.lanes|=o;var s=e.alternate;for(s!==null&&(s.lanes|=o),s=e,e=e.return;e!==null;)e.childLanes|=o,s=e.alternate,s!==null&&(s.childLanes|=o),s=e,e=e.return;return s.tag===3?s.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,o){e=e.updateQueue,o.updateQueue===e&&(o.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,o){return{eventTime:e,lane:o,tag:0,payload:null,callback:null,next:null}}function nh(e,o,s){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,K&2){var h=a.pending;return h===null?o.next=o:(o.next=h.next,h.next=o),a.pending=o,ih(e,s)}return h=a.interleaved,h===null?(o.next=o,gh(a)):(o.next=h.next,h.next=o),a.interleaved=o,ih(e,s)}function oh(e,o,s){if(o=o.updateQueue,o!==null&&(o=o.shared,(s&4194240)!==0)){var a=o.lanes;a&=e.pendingLanes,s|=a,o.lanes=s,Cc(e,s)}}function ph(e,o){var s=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,s===a)){var h=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var c={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};d===null?h=d=c:d=d.next=c,s=s.next}while(s!==null);d===null?h=d=o:d=d.next=o}else h=d=o;s={baseState:a.baseState,firstBaseUpdate:h,lastBaseUpdate:d,shared:a.shared,effects:a.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=o:e.next=o,s.lastBaseUpdate=o}function qh(e,o,s,a){var h=e.updateQueue;jh=!1;var d=h.firstBaseUpdate,c=h.lastBaseUpdate,g=h.shared.pending;if(g!==null){h.shared.pending=null;var b=g,$=b.next;b.next=null,c===null?d=$:c.next=$,c=b;var et=e.alternate;et!==null&&(et=et.updateQueue,g=et.lastBaseUpdate,g!==c&&(g===null?et.firstBaseUpdate=$:g.next=$,et.lastBaseUpdate=b))}if(d!==null){var st=h.baseState;c=0,et=$=b=null,g=d;do{var j=g.lane,tt=g.eventTime;if((a&j)===j){et!==null&&(et=et.next={eventTime:tt,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var nt=e,lt=g;switch(j=o,tt=s,lt.tag){case 1:if(nt=lt.payload,typeof nt=="function"){st=nt.call(tt,st,j);break e}st=nt;break e;case 3:nt.flags=nt.flags&-65537|128;case 0:if(nt=lt.payload,j=typeof nt=="function"?nt.call(tt,st,j):nt,j==null)break e;st=A({},st,j);break e;case 2:jh=!0}}g.callback!==null&&g.lane!==0&&(e.flags|=64,j=h.effects,j===null?h.effects=[g]:j.push(g))}else tt={eventTime:tt,lane:j,tag:g.tag,payload:g.payload,callback:g.callback,next:null},et===null?($=et=tt,b=st):et=et.next=tt,c|=j;if(g=g.next,g===null){if(g=h.shared.pending,g===null)break;j=g,g=j.next,j.next=null,h.lastBaseUpdate=j,h.shared.pending=null}}while(!0);if(et===null&&(b=st),h.baseState=b,h.firstBaseUpdate=$,h.lastBaseUpdate=et,o=h.shared.interleaved,o!==null){h=o;do c|=h.lane,h=h.next;while(h!==o)}else d===null&&(h.shared.lanes=0);rh|=c,e.lanes=c,e.memoizedState=st}}function sh(e,o,s){if(e=o.effects,o.effects=null,e!==null)for(o=0;o<e.length;o++){var a=e[o],h=a.callback;if(h!==null){if(a.callback=null,a=s,typeof h!="function")throw Error(p$1(191,h));h.call(a)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p$1(174));return e}function yh(e,o){switch(G(wh,o),G(vh,e),G(uh,th),e=o.nodeType,e){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:lb(null,"");break;default:e=e===8?o.parentNode:o,o=e.namespaceURI||null,e=e.tagName,o=lb(o,e)}E(uh),G(uh,o)}function zh(){E(uh),E(vh),E(wh)}function Ah(e){xh(wh.current);var o=xh(uh.current),s=lb(o,e.type);o!==s&&(G(vh,e),G(uh,s))}function Bh(e){vh.current===e&&(E(uh),E(vh))}var L=Uf(0);function Ch(e){for(var o=e;o!==null;){if(o.tag===13){var s=o.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===e)break;for(;o.sibling===null;){if(o.return===null||o.return===e)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$1(321))}function Mh(e,o){if(o===null)return!1;for(var s=0;s<o.length&&s<e.length;s++)if(!He(e[s],o[s]))return!1;return!0}function Nh(e,o,s,a,h,d){if(Hh=d,M=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=s(a,h),Jh){d=0;do{if(Jh=!1,Kh=0,25<=d)throw Error(p$1(301));d+=1,O=N=null,o.updateQueue=null,Fh.current=Qh,e=s(a,h)}while(Jh)}if(Fh.current=Rh,o=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,o)throw Error(p$1(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var o=O===null?M.memoizedState:O.next;if(o!==null)O=o,N=e;else{if(e===null)throw Error(p$1(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=e:O=O.next=e}return O}function Vh(e,o){return typeof o=="function"?o(e):o}function Wh(e){var o=Uh(),s=o.queue;if(s===null)throw Error(p$1(311));s.lastRenderedReducer=e;var a=N,h=a.baseQueue,d=s.pending;if(d!==null){if(h!==null){var c=h.next;h.next=d.next,d.next=c}a.baseQueue=h=d,s.pending=null}if(h!==null){d=h.next,a=a.baseState;var g=c=null,b=null,$=d;do{var et=$.lane;if((Hh&et)===et)b!==null&&(b=b.next={lane:0,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),a=$.hasEagerState?$.eagerState:e(a,$.action);else{var st={lane:et,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null};b===null?(g=b=st,c=a):b=b.next=st,M.lanes|=et,rh|=et}$=$.next}while($!==null&&$!==d);b===null?c=a:b.next=g,He(a,o.memoizedState)||(dh=!0),o.memoizedState=a,o.baseState=c,o.baseQueue=b,s.lastRenderedState=a}if(e=s.interleaved,e!==null){h=e;do d=h.lane,M.lanes|=d,rh|=d,h=h.next;while(h!==e)}else h===null&&(s.lanes=0);return[o.memoizedState,s.dispatch]}function Xh(e){var o=Uh(),s=o.queue;if(s===null)throw Error(p$1(311));s.lastRenderedReducer=e;var a=s.dispatch,h=s.pending,d=o.memoizedState;if(h!==null){s.pending=null;var c=h=h.next;do d=e(d,c.action),c=c.next;while(c!==h);He(d,o.memoizedState)||(dh=!0),o.memoizedState=d,o.baseQueue===null&&(o.baseState=d),s.lastRenderedState=d}return[d,a]}function Yh(){}function Zh(e,o){var s=M,a=Uh(),h=o(),d=!He(a.memoizedState,h);if(d&&(a.memoizedState=h,dh=!0),a=a.queue,$h(ai.bind(null,s,a,e),[e]),a.getSnapshot!==o||d||O!==null&&O.memoizedState.tag&1){if(s.flags|=2048,bi(9,ci.bind(null,s,a,h,o),void 0,null),Q===null)throw Error(p$1(349));Hh&30||di(s,o,h)}return h}function di(e,o,s){e.flags|=16384,e={getSnapshot:o,value:s},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.stores=[e]):(s=o.stores,s===null?o.stores=[e]:s.push(e))}function ci(e,o,s,a){o.value=s,o.getSnapshot=a,ei(o)&&fi(e)}function ai(e,o,s){return s(function(){ei(o)&&fi(e)})}function ei(e){var o=e.getSnapshot;e=e.value;try{var s=o();return!He(e,s)}catch{return!0}}function fi(e){var o=ih(e,1);o!==null&&gi(o,e,1,-1)}function hi(e){var o=Th();return typeof e=="function"&&(e=e()),o.memoizedState=o.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},o.queue=e,e=e.dispatch=ii.bind(null,M,e),[o.memoizedState,e]}function bi(e,o,s,a){return e={tag:e,create:o,destroy:s,deps:a,next:null},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.lastEffect=e.next=e):(s=o.lastEffect,s===null?o.lastEffect=e.next=e:(a=s.next,s.next=e,e.next=a,o.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,o,s,a){var h=Th();M.flags|=e,h.memoizedState=bi(1|o,s,void 0,a===void 0?null:a)}function li(e,o,s,a){var h=Uh();a=a===void 0?null:a;var d=void 0;if(N!==null){var c=N.memoizedState;if(d=c.destroy,a!==null&&Mh(a,c.deps)){h.memoizedState=bi(o,s,d,a);return}}M.flags|=e,h.memoizedState=bi(1|o,s,d,a)}function mi(e,o){return ki(8390656,8,e,o)}function $h(e,o){return li(2048,8,e,o)}function ni(e,o){return li(4,2,e,o)}function oi(e,o){return li(4,4,e,o)}function pi(e,o){if(typeof o=="function")return e=e(),o(e),function(){o(null)};if(o!=null)return e=e(),o.current=e,function(){o.current=null}}function qi(e,o,s){return s=s!=null?s.concat([e]):null,li(4,4,pi.bind(null,o,e),s)}function ri(){}function si(e,o){var s=Uh();o=o===void 0?null:o;var a=s.memoizedState;return a!==null&&o!==null&&Mh(o,a[1])?a[0]:(s.memoizedState=[e,o],e)}function ti(e,o){var s=Uh();o=o===void 0?null:o;var a=s.memoizedState;return a!==null&&o!==null&&Mh(o,a[1])?a[0]:(e=e(),s.memoizedState=[e,o],e)}function ui(e,o,s){return Hh&21?(He(s,o)||(s=yc(),M.lanes|=s,rh|=s,e.baseState=!0),o):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=s)}function vi(e,o){var s=C;C=s!==0&&4>s?s:4,e(!0);var a=Gh.transition;Gh.transition={};try{e(!1),o()}finally{C=s,Gh.transition=a}}function wi(){return Uh().memoizedState}function xi(e,o,s){var a=yi(e);if(s={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(o,s);else if(s=hh(e,o,s,a),s!==null){var h=R();gi(s,e,a,h),Bi(s,o,a)}}function ii(e,o,s){var a=yi(e),h={lane:a,action:s,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(o,h);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=o.lastRenderedReducer,d!==null))try{var c=o.lastRenderedState,g=d(c,s);if(h.hasEagerState=!0,h.eagerState=g,He(g,c)){var b=o.interleaved;b===null?(h.next=h,gh(o)):(h.next=b.next,b.next=h),o.interleaved=h;return}}catch{}finally{}s=hh(e,o,h,a),s!==null&&(h=R(),gi(s,e,a,h),Bi(s,o,a))}}function zi(e){var o=e.alternate;return e===M||o!==null&&o===M}function Ai(e,o){Jh=Ih=!0;var s=e.pending;s===null?o.next=o:(o.next=s.next,s.next=o),e.pending=o}function Bi(e,o,s){if(s&4194240){var a=o.lanes;a&=e.pendingLanes,s|=a,o.lanes=s,Cc(e,s)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,o){return Th().memoizedState=[e,o===void 0?null:o],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,o,s){return s=s!=null?s.concat([e]):null,ki(4194308,4,pi.bind(null,o,e),s)},useLayoutEffect:function(e,o){return ki(4194308,4,e,o)},useInsertionEffect:function(e,o){return ki(4,2,e,o)},useMemo:function(e,o){var s=Th();return o=o===void 0?null:o,e=e(),s.memoizedState=[e,o],e},useReducer:function(e,o,s){var a=Th();return o=s!==void 0?s(o):o,a.memoizedState=a.baseState=o,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},a.queue=e,e=e.dispatch=xi.bind(null,M,e),[a.memoizedState,e]},useRef:function(e){var o=Th();return e={current:e},o.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),o=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[o,e]},useMutableSource:function(){},useSyncExternalStore:function(e,o,s){var a=M,h=Th();if(I){if(s===void 0)throw Error(p$1(407));s=s()}else{if(s=o(),Q===null)throw Error(p$1(349));Hh&30||di(a,o,s)}h.memoizedState=s;var d={value:s,getSnapshot:o};return h.queue=d,mi(ai.bind(null,a,d,e),[e]),a.flags|=2048,bi(9,ci.bind(null,a,d,s,o),void 0,null),s},useId:function(){var e=Th(),o=Q.identifierPrefix;if(I){var s=sg,a=rg;s=(a&~(1<<32-oc(a)-1)).toString(32)+s,o=":"+o+"R"+s,s=Kh++,0<s&&(o+="H"+s.toString(32)),o+=":"}else s=Lh++,o=":"+o+"r"+s.toString(32)+":";return e.memoizedState=o},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var o=Uh();return ui(o,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],o=Uh().memoizedState;return[e,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var o=Uh();return N===null?o.memoizedState=e:ui(o,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],o=Uh().memoizedState;return[e,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,o){if(e&&e.defaultProps){o=A({},o),e=e.defaultProps;for(var s in e)o[s]===void 0&&(o[s]=e[s]);return o}return o}function Di(e,o,s,a){o=e.memoizedState,s=s(a,o),s=s==null?o:A({},o,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,o,s){e=e._reactInternals;var a=R(),h=yi(e),d=mh(a,h);d.payload=o,s!=null&&(d.callback=s),o=nh(e,d,h),o!==null&&(gi(o,e,h,a),oh(o,e,h))},enqueueReplaceState:function(e,o,s){e=e._reactInternals;var a=R(),h=yi(e),d=mh(a,h);d.tag=1,d.payload=o,s!=null&&(d.callback=s),o=nh(e,d,h),o!==null&&(gi(o,e,h,a),oh(o,e,h))},enqueueForceUpdate:function(e,o){e=e._reactInternals;var s=R(),a=yi(e),h=mh(s,a);h.tag=2,o!=null&&(h.callback=o),o=nh(e,h,a),o!==null&&(gi(o,e,a,s),oh(o,e,a))}};function Fi(e,o,s,a,h,d,c){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,d,c):o.prototype&&o.prototype.isPureReactComponent?!Ie(s,a)||!Ie(h,d):!0}function Gi(e,o,s){var a=!1,h=Vf,d=o.contextType;return typeof d=="object"&&d!==null?d=eh(d):(h=Zf(o)?Xf:H.current,a=o.contextTypes,d=(a=a!=null)?Yf(e,h):Vf),o=new o(s,d),e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ei,e.stateNode=o,o._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=h,e.__reactInternalMemoizedMaskedChildContext=d),o}function Hi(e,o,s,a){e=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(s,a),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(s,a),o.state!==e&&Ei.enqueueReplaceState(o,o.state,null)}function Ii(e,o,s,a){var h=e.stateNode;h.props=s,h.state=e.memoizedState,h.refs={},kh(e);var d=o.contextType;typeof d=="object"&&d!==null?h.context=eh(d):(d=Zf(o)?Xf:H.current,h.context=Yf(e,d)),h.state=e.memoizedState,d=o.getDerivedStateFromProps,typeof d=="function"&&(Di(e,o,d,s),h.state=e.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(o=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),o!==h.state&&Ei.enqueueReplaceState(h,h.state,null),qh(e,s,h,a),h.state=e.memoizedState),typeof h.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,o){try{var s="",a=o;do s+=Pa(a),a=a.return;while(a);var h=s}catch(d){h=`
Error generating stack: `+d.message+`
`+d.stack}return{value:e,source:o,stack:h,digest:null}}function Ki(e,o,s){return{value:e,source:null,stack:s??null,digest:o??null}}function Li(e,o){try{console.error(o.value)}catch(s){setTimeout(function(){throw s})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,o,s){s=mh(-1,s),s.tag=3,s.payload={element:null};var a=o.value;return s.callback=function(){Oi||(Oi=!0,Pi=a),Li(e,o)},s}function Qi(e,o,s){s=mh(-1,s),s.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var h=o.value;s.payload=function(){return a(h)},s.callback=function(){Li(e,o)}}var d=e.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(s.callback=function(){Li(e,o),typeof a!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var c=o.stack;this.componentDidCatch(o.value,{componentStack:c!==null?c:""})}),s}function Si(e,o,s){var a=e.pingCache;if(a===null){a=e.pingCache=new Mi;var h=new Set;a.set(o,h)}else h=a.get(o),h===void 0&&(h=new Set,a.set(o,h));h.has(s)||(h.add(s),e=Ti.bind(null,e,o,s),o.then(e,e))}function Ui(e){do{var o;if((o=e.tag===13)&&(o=e.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return e;e=e.return}while(e!==null);return null}function Vi(e,o,s,a,h){return e.mode&1?(e.flags|=65536,e.lanes=h,e):(e===o?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(o=mh(-1,1),o.tag=2,nh(s,o,1))),s.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,o,s,a){o.child=e===null?Vg(o,null,s,a):Ug(o,e.child,s,a)}function Yi(e,o,s,a,h){s=s.render;var d=o.ref;return ch(o,h),a=Nh(e,o,s,a,d,h),s=Sh(),e!==null&&!dh?(o.updateQueue=e.updateQueue,o.flags&=-2053,e.lanes&=~h,Zi(e,o,h)):(I&&s&&vg(o),o.flags|=1,Xi(e,o,a,h),o.child)}function $i(e,o,s,a,h){if(e===null){var d=s.type;return typeof d=="function"&&!aj(d)&&d.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(o.tag=15,o.type=d,bj(e,o,d,a,h)):(e=Rg(s.type,null,a,o,o.mode,h),e.ref=o.ref,e.return=o,o.child=e)}if(d=e.child,!(e.lanes&h)){var c=d.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(c,a)&&e.ref===o.ref)return Zi(e,o,h)}return o.flags|=1,e=Pg(d,a),e.ref=o.ref,e.return=o,o.child=e}function bj(e,o,s,a,h){if(e!==null){var d=e.memoizedProps;if(Ie(d,a)&&e.ref===o.ref)if(dh=!1,o.pendingProps=a=d,(e.lanes&h)!==0)e.flags&131072&&(dh=!0);else return o.lanes=e.lanes,Zi(e,o,h)}return cj(e,o,s,a,h)}function dj(e,o,s){var a=o.pendingProps,h=a.children,d=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=s;else{if(!(s&1073741824))return e=d!==null?d.baseLanes|s:s,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:e,cachePool:null,transitions:null},o.updateQueue=null,G(ej,fj),fj|=e,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=d!==null?d.baseLanes:s,G(ej,fj),fj|=a}else d!==null?(a=d.baseLanes|s,o.memoizedState=null):a=s,G(ej,fj),fj|=a;return Xi(e,o,h,s),o.child}function gj(e,o){var s=o.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(o.flags|=512,o.flags|=2097152)}function cj(e,o,s,a,h){var d=Zf(s)?Xf:H.current;return d=Yf(o,d),ch(o,h),s=Nh(e,o,s,a,d,h),a=Sh(),e!==null&&!dh?(o.updateQueue=e.updateQueue,o.flags&=-2053,e.lanes&=~h,Zi(e,o,h)):(I&&a&&vg(o),o.flags|=1,Xi(e,o,s,h),o.child)}function hj(e,o,s,a,h){if(Zf(s)){var d=!0;cg(o)}else d=!1;if(ch(o,h),o.stateNode===null)ij(e,o),Gi(o,s,a),Ii(o,s,a,h),a=!0;else if(e===null){var c=o.stateNode,g=o.memoizedProps;c.props=g;var b=c.context,$=s.contextType;typeof $=="object"&&$!==null?$=eh($):($=Zf(s)?Xf:H.current,$=Yf(o,$));var et=s.getDerivedStateFromProps,st=typeof et=="function"||typeof c.getSnapshotBeforeUpdate=="function";st||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(g!==a||b!==$)&&Hi(o,c,a,$),jh=!1;var j=o.memoizedState;c.state=j,qh(o,a,c,h),b=o.memoizedState,g!==a||j!==b||Wf.current||jh?(typeof et=="function"&&(Di(o,s,et,a),b=o.memoizedState),(g=jh||Fi(o,s,g,a,j,b,$))?(st||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount()),typeof c.componentDidMount=="function"&&(o.flags|=4194308)):(typeof c.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=a,o.memoizedState=b),c.props=a,c.state=b,c.context=$,a=g):(typeof c.componentDidMount=="function"&&(o.flags|=4194308),a=!1)}else{c=o.stateNode,lh(e,o),g=o.memoizedProps,$=o.type===o.elementType?g:Ci(o.type,g),c.props=$,st=o.pendingProps,j=c.context,b=s.contextType,typeof b=="object"&&b!==null?b=eh(b):(b=Zf(s)?Xf:H.current,b=Yf(o,b));var tt=s.getDerivedStateFromProps;(et=typeof tt=="function"||typeof c.getSnapshotBeforeUpdate=="function")||typeof c.UNSAFE_componentWillReceiveProps!="function"&&typeof c.componentWillReceiveProps!="function"||(g!==st||j!==b)&&Hi(o,c,a,b),jh=!1,j=o.memoizedState,c.state=j,qh(o,a,c,h);var nt=o.memoizedState;g!==st||j!==nt||Wf.current||jh?(typeof tt=="function"&&(Di(o,s,tt,a),nt=o.memoizedState),($=jh||Fi(o,s,$,a,j,nt,b)||!1)?(et||typeof c.UNSAFE_componentWillUpdate!="function"&&typeof c.componentWillUpdate!="function"||(typeof c.componentWillUpdate=="function"&&c.componentWillUpdate(a,nt,b),typeof c.UNSAFE_componentWillUpdate=="function"&&c.UNSAFE_componentWillUpdate(a,nt,b)),typeof c.componentDidUpdate=="function"&&(o.flags|=4),typeof c.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof c.componentDidUpdate!="function"||g===e.memoizedProps&&j===e.memoizedState||(o.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||g===e.memoizedProps&&j===e.memoizedState||(o.flags|=1024),o.memoizedProps=a,o.memoizedState=nt),c.props=a,c.state=nt,c.context=b,a=$):(typeof c.componentDidUpdate!="function"||g===e.memoizedProps&&j===e.memoizedState||(o.flags|=4),typeof c.getSnapshotBeforeUpdate!="function"||g===e.memoizedProps&&j===e.memoizedState||(o.flags|=1024),a=!1)}return jj(e,o,s,a,d,h)}function jj(e,o,s,a,h,d){gj(e,o);var c=(o.flags&128)!==0;if(!a&&!c)return h&&dg(o,s,!1),Zi(e,o,d);a=o.stateNode,Wi.current=o;var g=c&&typeof s.getDerivedStateFromError!="function"?null:a.render();return o.flags|=1,e!==null&&c?(o.child=Ug(o,e.child,null,d),o.child=Ug(o,null,g,d)):Xi(e,o,g,d),o.memoizedState=a.state,h&&dg(o,s,!0),o.child}function kj(e){var o=e.stateNode;o.pendingContext?ag(e,o.pendingContext,o.pendingContext!==o.context):o.context&&ag(e,o.context,!1),yh(e,o.containerInfo)}function lj(e,o,s,a,h){return Ig(),Jg(h),o.flags|=256,Xi(e,o,s,a),o.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,o,s){var a=o.pendingProps,h=L.current,d=!1,c=(o.flags&128)!==0,g;if((g=c)||(g=e!==null&&e.memoizedState===null?!1:(h&2)!==0),g?(d=!0,o.flags&=-129):(e===null||e.memoizedState!==null)&&(h|=1),G(L,h&1),e===null)return Eg(o),e=o.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(o.mode&1?e.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(c=a.children,e=a.fallback,d?(a=o.mode,d=o.child,c={mode:"hidden",children:c},!(a&1)&&d!==null?(d.childLanes=0,d.pendingProps=c):d=pj(c,a,0,null),e=Tg(e,a,s,null),d.return=o,e.return=o,d.sibling=e,o.child=d,o.child.memoizedState=nj(s),o.memoizedState=mj,e):qj(o,c));if(h=e.memoizedState,h!==null&&(g=h.dehydrated,g!==null))return rj(e,o,c,a,g,h,s);if(d){d=a.fallback,c=o.mode,h=e.child,g=h.sibling;var b={mode:"hidden",children:a.children};return!(c&1)&&o.child!==h?(a=o.child,a.childLanes=0,a.pendingProps=b,o.deletions=null):(a=Pg(h,b),a.subtreeFlags=h.subtreeFlags&14680064),g!==null?d=Pg(g,d):(d=Tg(d,c,s,null),d.flags|=2),d.return=o,a.return=o,a.sibling=d,o.child=a,a=d,d=o.child,c=e.child.memoizedState,c=c===null?nj(s):{baseLanes:c.baseLanes|s,cachePool:null,transitions:c.transitions},d.memoizedState=c,d.childLanes=e.childLanes&~s,o.memoizedState=mj,a}return d=e.child,e=d.sibling,a=Pg(d,{mode:"visible",children:a.children}),!(o.mode&1)&&(a.lanes=s),a.return=o,a.sibling=null,e!==null&&(s=o.deletions,s===null?(o.deletions=[e],o.flags|=16):s.push(e)),o.child=a,o.memoizedState=null,a}function qj(e,o){return o=pj({mode:"visible",children:o},e.mode,0,null),o.return=e,e.child=o}function sj(e,o,s,a){return a!==null&&Jg(a),Ug(o,e.child,null,s),e=qj(o,o.pendingProps.children),e.flags|=2,o.memoizedState=null,e}function rj(e,o,s,a,h,d,c){if(s)return o.flags&256?(o.flags&=-257,a=Ki(Error(p$1(422))),sj(e,o,c,a)):o.memoizedState!==null?(o.child=e.child,o.flags|=128,null):(d=a.fallback,h=o.mode,a=pj({mode:"visible",children:a.children},h,0,null),d=Tg(d,h,c,null),d.flags|=2,a.return=o,d.return=o,a.sibling=d,o.child=a,o.mode&1&&Ug(o,e.child,null,c),o.child.memoizedState=nj(c),o.memoizedState=mj,d);if(!(o.mode&1))return sj(e,o,c,null);if(h.data==="$!"){if(a=h.nextSibling&&h.nextSibling.dataset,a)var g=a.dgst;return a=g,d=Error(p$1(419)),a=Ki(d,a,void 0),sj(e,o,c,a)}if(g=(c&e.childLanes)!==0,dh||g){if(a=Q,a!==null){switch(c&-c){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(a.suspendedLanes|c)?0:h,h!==0&&h!==d.retryLane&&(d.retryLane=h,ih(e,h),gi(a,e,h,-1))}return tj(),a=Ki(Error(p$1(421))),sj(e,o,c,a)}return h.data==="$?"?(o.flags|=128,o.child=e.child,o=uj.bind(null,e),h._reactRetry=o,null):(e=d.treeContext,yg=Lf(h.nextSibling),xg=o,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=o),o=qj(o,a.children),o.flags|=4096,o)}function vj(e,o,s){e.lanes|=o;var a=e.alternate;a!==null&&(a.lanes|=o),bh(e.return,o,s)}function wj(e,o,s,a,h){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:a,tail:s,tailMode:h}:(d.isBackwards=o,d.rendering=null,d.renderingStartTime=0,d.last=a,d.tail=s,d.tailMode=h)}function xj(e,o,s){var a=o.pendingProps,h=a.revealOrder,d=a.tail;if(Xi(e,o,a.children,s),a=L.current,a&2)a=a&1|2,o.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=o.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,s,o);else if(e.tag===19)vj(e,s,o);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===o)break e;for(;e.sibling===null;){if(e.return===null||e.return===o)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(G(L,a),!(o.mode&1))o.memoizedState=null;else switch(h){case"forwards":for(s=o.child,h=null;s!==null;)e=s.alternate,e!==null&&Ch(e)===null&&(h=s),s=s.sibling;s=h,s===null?(h=o.child,o.child=null):(h=s.sibling,s.sibling=null),wj(o,!1,h,s,d);break;case"backwards":for(s=null,h=o.child,o.child=null;h!==null;){if(e=h.alternate,e!==null&&Ch(e)===null){o.child=h;break}e=h.sibling,h.sibling=s,s=h,h=e}wj(o,!0,s,null,d);break;case"together":wj(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ij(e,o){!(o.mode&1)&&e!==null&&(e.alternate=null,o.alternate=null,o.flags|=2)}function Zi(e,o,s){if(e!==null&&(o.dependencies=e.dependencies),rh|=o.lanes,!(s&o.childLanes))return null;if(e!==null&&o.child!==e.child)throw Error(p$1(153));if(o.child!==null){for(e=o.child,s=Pg(e,e.pendingProps),o.child=s,s.return=o;e.sibling!==null;)e=e.sibling,s=s.sibling=Pg(e,e.pendingProps),s.return=o;s.sibling=null}return o.child}function yj(e,o,s){switch(o.tag){case 3:kj(o),Ig();break;case 5:Ah(o);break;case 1:Zf(o.type)&&cg(o);break;case 4:yh(o,o.stateNode.containerInfo);break;case 10:var a=o.type._context,h=o.memoizedProps.value;G(Wg,a._currentValue),a._currentValue=h;break;case 13:if(a=o.memoizedState,a!==null)return a.dehydrated!==null?(G(L,L.current&1),o.flags|=128,null):s&o.child.childLanes?oj(e,o,s):(G(L,L.current&1),e=Zi(e,o,s),e!==null?e.sibling:null);G(L,L.current&1);break;case 19:if(a=(s&o.childLanes)!==0,e.flags&128){if(a)return xj(e,o,s);o.flags|=128}if(h=o.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),G(L,L.current),a)break;return null;case 22:case 23:return o.lanes=0,dj(e,o,s)}return Zi(e,o,s)}var zj,Aj,Bj,Cj;zj=function(e,o){for(var s=o.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break;for(;s.sibling===null;){if(s.return===null||s.return===o)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Aj=function(){};Bj=function(e,o,s,a){var h=e.memoizedProps;if(h!==a){e=o.stateNode,xh(uh.current);var d=null;switch(s){case"input":h=Ya(e,h),a=Ya(e,a),d=[];break;case"select":h=A({},h,{value:void 0}),a=A({},a,{value:void 0}),d=[];break;case"textarea":h=gb(e,h),a=gb(e,a),d=[];break;default:typeof h.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=Bf)}ub(s,a);var c;s=null;for($ in h)if(!a.hasOwnProperty($)&&h.hasOwnProperty($)&&h[$]!=null)if($==="style"){var g=h[$];for(c in g)g.hasOwnProperty(c)&&(s||(s={}),s[c]="")}else $!=="dangerouslySetInnerHTML"&&$!=="children"&&$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(ea.hasOwnProperty($)?d||(d=[]):(d=d||[]).push($,null));for($ in a){var b=a[$];if(g=h!=null?h[$]:void 0,a.hasOwnProperty($)&&b!==g&&(b!=null||g!=null))if($==="style")if(g){for(c in g)!g.hasOwnProperty(c)||b&&b.hasOwnProperty(c)||(s||(s={}),s[c]="");for(c in b)b.hasOwnProperty(c)&&g[c]!==b[c]&&(s||(s={}),s[c]=b[c])}else s||(d||(d=[]),d.push($,s)),s=b;else $==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,g=g?g.__html:void 0,b!=null&&g!==b&&(d=d||[]).push($,b)):$==="children"?typeof b!="string"&&typeof b!="number"||(d=d||[]).push($,""+b):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&(ea.hasOwnProperty($)?(b!=null&&$==="onScroll"&&D("scroll",e),d||g===b||(d=[])):(d=d||[]).push($,b))}s&&(d=d||[]).push("style",s);var $=d;(o.updateQueue=$)&&(o.flags|=4)}};Cj=function(e,o,s,a){s!==a&&(o.flags|=4)};function Dj(e,o){if(!I)switch(e.tailMode){case"hidden":o=e.tail;for(var s=null;o!==null;)o.alternate!==null&&(s=o),o=o.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var a=null;s!==null;)s.alternate!==null&&(a=s),s=s.sibling;a===null?o||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function S(e){var o=e.alternate!==null&&e.alternate.child===e.child,s=0,a=0;if(o)for(var h=e.child;h!==null;)s|=h.lanes|h.childLanes,a|=h.subtreeFlags&14680064,a|=h.flags&14680064,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)s|=h.lanes|h.childLanes,a|=h.subtreeFlags,a|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=a,e.childLanes=s,o}function Ej(e,o,s){var a=o.pendingProps;switch(wg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(o),null;case 1:return Zf(o.type)&&$f(),S(o),null;case 3:return a=o.stateNode,zh(),E(Wf),E(H),Eh(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Gg(o)?o.flags|=4:e===null||e.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,o),S(o),null;case 5:Bh(o);var h=xh(wh.current);if(s=o.type,e!==null&&o.stateNode!=null)Bj(e,o,s,a,h),e.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!a){if(o.stateNode===null)throw Error(p$1(166));return S(o),null}if(e=xh(uh.current),Gg(o)){a=o.stateNode,s=o.type;var d=o.memoizedProps;switch(a[Of]=o,a[Pf]=d,e=(o.mode&1)!==0,s){case"dialog":D("cancel",a),D("close",a);break;case"iframe":case"object":case"embed":D("load",a);break;case"video":case"audio":for(h=0;h<lf.length;h++)D(lf[h],a);break;case"source":D("error",a);break;case"img":case"image":case"link":D("error",a),D("load",a);break;case"details":D("toggle",a);break;case"input":Za(a,d),D("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!d.multiple},D("invalid",a);break;case"textarea":hb(a,d),D("invalid",a)}ub(s,d),h=null;for(var c in d)if(d.hasOwnProperty(c)){var g=d[c];c==="children"?typeof g=="string"?a.textContent!==g&&(d.suppressHydrationWarning!==!0&&Af(a.textContent,g,e),h=["children",g]):typeof g=="number"&&a.textContent!==""+g&&(d.suppressHydrationWarning!==!0&&Af(a.textContent,g,e),h=["children",""+g]):ea.hasOwnProperty(c)&&g!=null&&c==="onScroll"&&D("scroll",a)}switch(s){case"input":Va(a),db(a,d,!0);break;case"textarea":Va(a),jb(a);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(a.onclick=Bf)}a=h,o.updateQueue=a,a!==null&&(o.flags|=4)}else{c=h.nodeType===9?h:h.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=c.createElement(s,{is:a.is}):(e=c.createElement(s),s==="select"&&(c=e,a.multiple?c.multiple=!0:a.size&&(c.size=a.size))):e=c.createElementNS(e,s),e[Of]=o,e[Pf]=a,zj(e,o,!1,!1),o.stateNode=e;e:{switch(c=vb(s,a),s){case"dialog":D("cancel",e),D("close",e),h=a;break;case"iframe":case"object":case"embed":D("load",e),h=a;break;case"video":case"audio":for(h=0;h<lf.length;h++)D(lf[h],e);h=a;break;case"source":D("error",e),h=a;break;case"img":case"image":case"link":D("error",e),D("load",e),h=a;break;case"details":D("toggle",e),h=a;break;case"input":Za(e,a),h=Ya(e,a),D("invalid",e);break;case"option":h=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},h=A({},a,{value:void 0}),D("invalid",e);break;case"textarea":hb(e,a),h=gb(e,a),D("invalid",e);break;default:h=a}ub(s,h),g=h;for(d in g)if(g.hasOwnProperty(d)){var b=g[d];d==="style"?sb(e,b):d==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&nb(e,b)):d==="children"?typeof b=="string"?(s!=="textarea"||b!=="")&&ob(e,b):typeof b=="number"&&ob(e,""+b):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ea.hasOwnProperty(d)?b!=null&&d==="onScroll"&&D("scroll",e):b!=null&&ta(e,d,b,c))}switch(s){case"input":Va(e),db(e,a,!1);break;case"textarea":Va(e),jb(e);break;case"option":a.value!=null&&e.setAttribute("value",""+Sa(a.value));break;case"select":e.multiple=!!a.multiple,d=a.value,d!=null?fb(e,!!a.multiple,d,!1):a.defaultValue!=null&&fb(e,!!a.multiple,a.defaultValue,!0);break;default:typeof h.onClick=="function"&&(e.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return S(o),null;case 6:if(e&&o.stateNode!=null)Cj(e,o,e.memoizedProps,a);else{if(typeof a!="string"&&o.stateNode===null)throw Error(p$1(166));if(s=xh(wh.current),xh(uh.current),Gg(o)){if(a=o.stateNode,s=o.memoizedProps,a[Of]=o,(d=a.nodeValue!==s)&&(e=xg,e!==null))switch(e.tag){case 3:Af(a.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(a.nodeValue,s,(e.mode&1)!==0)}d&&(o.flags|=4)}else a=(s.nodeType===9?s:s.ownerDocument).createTextNode(a),a[Of]=o,o.stateNode=a}return S(o),null;case 13:if(E(L),a=o.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&o.mode&1&&!(o.flags&128))Hg(),Ig(),o.flags|=98560,d=!1;else if(d=Gg(o),a!==null&&a.dehydrated!==null){if(e===null){if(!d)throw Error(p$1(318));if(d=o.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(p$1(317));d[Of]=o}else Ig(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;S(o),d=!1}else zg!==null&&(Fj(zg),zg=null),d=!0;if(!d)return o.flags&65536?o:null}return o.flags&128?(o.lanes=s,o):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(o.child.flags|=8192,o.mode&1&&(e===null||L.current&1?T===0&&(T=3):tj())),o.updateQueue!==null&&(o.flags|=4),S(o),null);case 4:return zh(),Aj(e,o),e===null&&sf(o.stateNode.containerInfo),S(o),null;case 10:return ah(o.type._context),S(o),null;case 17:return Zf(o.type)&&$f(),S(o),null;case 19:if(E(L),d=o.memoizedState,d===null)return S(o),null;if(a=(o.flags&128)!==0,c=d.rendering,c===null)if(a)Dj(d,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=o.child;e!==null;){if(c=Ch(e),c!==null){for(o.flags|=128,Dj(d,!1),a=c.updateQueue,a!==null&&(o.updateQueue=a,o.flags|=4),o.subtreeFlags=0,a=s,s=o.child;s!==null;)d=s,e=a,d.flags&=14680066,c=d.alternate,c===null?(d.childLanes=0,d.lanes=e,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=c.childLanes,d.lanes=c.lanes,d.child=c.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=c.memoizedProps,d.memoizedState=c.memoizedState,d.updateQueue=c.updateQueue,d.type=c.type,e=c.dependencies,d.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return G(L,L.current&1|2),o.child}e=e.sibling}d.tail!==null&&B()>Gj&&(o.flags|=128,a=!0,Dj(d,!1),o.lanes=4194304)}else{if(!a)if(e=Ch(c),e!==null){if(o.flags|=128,a=!0,s=e.updateQueue,s!==null&&(o.updateQueue=s,o.flags|=4),Dj(d,!0),d.tail===null&&d.tailMode==="hidden"&&!c.alternate&&!I)return S(o),null}else 2*B()-d.renderingStartTime>Gj&&s!==1073741824&&(o.flags|=128,a=!0,Dj(d,!1),o.lanes=4194304);d.isBackwards?(c.sibling=o.child,o.child=c):(s=d.last,s!==null?s.sibling=c:o.child=c,d.last=c)}return d.tail!==null?(o=d.tail,d.rendering=o,d.tail=o.sibling,d.renderingStartTime=B(),o.sibling=null,s=L.current,G(L,a?s&1|2:s&1),o):(S(o),null);case 22:case 23:return Hj(),a=o.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(o.flags|=8192),a&&o.mode&1?fj&1073741824&&(S(o),o.subtreeFlags&6&&(o.flags|=8192)):S(o),null;case 24:return null;case 25:return null}throw Error(p$1(156,o.tag))}function Ij(e,o){switch(wg(o),o.tag){case 1:return Zf(o.type)&&$f(),e=o.flags,e&65536?(o.flags=e&-65537|128,o):null;case 3:return zh(),E(Wf),E(H),Eh(),e=o.flags,e&65536&&!(e&128)?(o.flags=e&-65537|128,o):null;case 5:return Bh(o),null;case 13:if(E(L),e=o.memoizedState,e!==null&&e.dehydrated!==null){if(o.alternate===null)throw Error(p$1(340));Ig()}return e=o.flags,e&65536?(o.flags=e&-65537|128,o):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(o.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,o){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(a){W(e,o,a)}else s.current=null}function Mj(e,o,s){try{s()}catch(a){W(e,o,a)}}var Nj=!1;function Oj(e,o){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var a=s.getSelection&&s.getSelection();if(a&&a.rangeCount!==0){s=a.anchorNode;var h=a.anchorOffset,d=a.focusNode;a=a.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var c=0,g=-1,b=-1,$=0,et=0,st=e,j=null;t:for(;;){for(var tt;st!==s||h!==0&&st.nodeType!==3||(g=c+h),st!==d||a!==0&&st.nodeType!==3||(b=c+a),st.nodeType===3&&(c+=st.nodeValue.length),(tt=st.firstChild)!==null;)j=st,st=tt;for(;;){if(st===e)break t;if(j===s&&++$===h&&(g=c),j===d&&++et===a&&(b=c),(tt=st.nextSibling)!==null)break;st=j,j=st.parentNode}st=tt}s=g===-1||b===-1?null:{start:g,end:b}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:e,selectionRange:s},dd=!1,V=o;V!==null;)if(o=V,e=o.child,(o.subtreeFlags&1028)!==0&&e!==null)e.return=o,V=e;else for(;V!==null;){o=V;try{var nt=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(nt!==null){var lt=nt.memoizedProps,ct=nt.memoizedState,ot=o.stateNode,_e=ot.getSnapshotBeforeUpdate(o.elementType===o.type?lt:Ci(o.type,lt),ct);ot.__reactInternalSnapshotBeforeUpdate=_e}break;case 3:var _=o.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(at){W(o,o.return,at)}if(e=o.sibling,e!==null){e.return=o.return,V=e;break}V=o.return}return nt=Nj,Nj=!1,nt}function Pj(e,o,s){var a=o.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&e)===e){var d=h.destroy;h.destroy=void 0,d!==void 0&&Mj(o,s,d)}h=h.next}while(h!==a)}}function Qj(e,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var s=o=o.next;do{if((s.tag&e)===e){var a=s.create;s.destroy=a()}s=s.next}while(s!==o)}}function Rj(e){var o=e.ref;if(o!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof o=="function"?o(e):o.current=e}}function Sj(e){var o=e.alternate;o!==null&&(e.alternate=null,Sj(o)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(o=e.stateNode,o!==null&&(delete o[Of],delete o[Pf],delete o[of],delete o[Qf],delete o[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,o,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,o?s.nodeType===8?s.parentNode.insertBefore(e,o):s.insertBefore(e,o):(s.nodeType===8?(o=s.parentNode,o.insertBefore(e,s)):(o=s,o.appendChild(e)),s=s._reactRootContainer,s!=null||o.onclick!==null||(o.onclick=Bf));else if(a!==4&&(e=e.child,e!==null))for(Vj(e,o,s),e=e.sibling;e!==null;)Vj(e,o,s),e=e.sibling}function Wj(e,o,s){var a=e.tag;if(a===5||a===6)e=e.stateNode,o?s.insertBefore(e,o):s.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(Wj(e,o,s),e=e.sibling;e!==null;)Wj(e,o,s),e=e.sibling}var X=null,Xj=!1;function Yj(e,o,s){for(s=s.child;s!==null;)Zj(e,o,s),s=s.sibling}function Zj(e,o,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Lj(s,o);case 6:var a=X,h=Xj;X=null,Yj(e,o,s),X=a,Xj=h,X!==null&&(Xj?(e=X,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):X.removeChild(s.stateNode));break;case 18:X!==null&&(Xj?(e=X,s=s.stateNode,e.nodeType===8?Kf(e.parentNode,s):e.nodeType===1&&Kf(e,s),bd(e)):Kf(X,s.stateNode));break;case 4:a=X,h=Xj,X=s.stateNode.containerInfo,Xj=!0,Yj(e,o,s),X=a,Xj=h;break;case 0:case 11:case 14:case 15:if(!U&&(a=s.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){h=a=a.next;do{var d=h,c=d.destroy;d=d.tag,c!==void 0&&(d&2||d&4)&&Mj(s,o,c),h=h.next}while(h!==a)}Yj(e,o,s);break;case 1:if(!U&&(Lj(s,o),a=s.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=s.memoizedProps,a.state=s.memoizedState,a.componentWillUnmount()}catch(g){W(s,o,g)}Yj(e,o,s);break;case 21:Yj(e,o,s);break;case 22:s.mode&1?(U=(a=U)||s.memoizedState!==null,Yj(e,o,s),U=a):Yj(e,o,s);break;default:Yj(e,o,s)}}function ak(e){var o=e.updateQueue;if(o!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Kj),o.forEach(function(a){var h=bk.bind(null,e,a);s.has(a)||(s.add(a),a.then(h,h))})}}function ck(e,o){var s=o.deletions;if(s!==null)for(var a=0;a<s.length;a++){var h=s[a];try{var d=e,c=o,g=c;e:for(;g!==null;){switch(g.tag){case 5:X=g.stateNode,Xj=!1;break e;case 3:X=g.stateNode.containerInfo,Xj=!0;break e;case 4:X=g.stateNode.containerInfo,Xj=!0;break e}g=g.return}if(X===null)throw Error(p$1(160));Zj(d,c,h),X=null,Xj=!1;var b=h.alternate;b!==null&&(b.return=null),h.return=null}catch($){W(h,o,$)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)dk(o,e),o=o.sibling}function dk(e,o){var s=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(o,e),ek(e),a&4){try{Pj(3,e,e.return),Qj(3,e)}catch(lt){W(e,e.return,lt)}try{Pj(5,e,e.return)}catch(lt){W(e,e.return,lt)}}break;case 1:ck(o,e),ek(e),a&512&&s!==null&&Lj(s,s.return);break;case 5:if(ck(o,e),ek(e),a&512&&s!==null&&Lj(s,s.return),e.flags&32){var h=e.stateNode;try{ob(h,"")}catch(lt){W(e,e.return,lt)}}if(a&4&&(h=e.stateNode,h!=null)){var d=e.memoizedProps,c=s!==null?s.memoizedProps:d,g=e.type,b=e.updateQueue;if(e.updateQueue=null,b!==null)try{g==="input"&&d.type==="radio"&&d.name!=null&&ab(h,d),vb(g,c);var $=vb(g,d);for(c=0;c<b.length;c+=2){var et=b[c],st=b[c+1];et==="style"?sb(h,st):et==="dangerouslySetInnerHTML"?nb(h,st):et==="children"?ob(h,st):ta(h,et,st,$)}switch(g){case"input":bb(h,d);break;case"textarea":ib(h,d);break;case"select":var j=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!d.multiple;var tt=d.value;tt!=null?fb(h,!!d.multiple,tt,!1):j!==!!d.multiple&&(d.defaultValue!=null?fb(h,!!d.multiple,d.defaultValue,!0):fb(h,!!d.multiple,d.multiple?[]:"",!1))}h[Pf]=d}catch(lt){W(e,e.return,lt)}}break;case 6:if(ck(o,e),ek(e),a&4){if(e.stateNode===null)throw Error(p$1(162));h=e.stateNode,d=e.memoizedProps;try{h.nodeValue=d}catch(lt){W(e,e.return,lt)}}break;case 3:if(ck(o,e),ek(e),a&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(o.containerInfo)}catch(lt){W(e,e.return,lt)}break;case 4:ck(o,e),ek(e);break;case 13:ck(o,e),ek(e),h=e.child,h.flags&8192&&(d=h.memoizedState!==null,h.stateNode.isHidden=d,!d||h.alternate!==null&&h.alternate.memoizedState!==null||(fk=B())),a&4&&ak(e);break;case 22:if(et=s!==null&&s.memoizedState!==null,e.mode&1?(U=($=U)||et,ck(o,e),U=$):ck(o,e),ek(e),a&8192){if($=e.memoizedState!==null,(e.stateNode.isHidden=$)&&!et&&e.mode&1)for(V=e,et=e.child;et!==null;){for(st=V=et;V!==null;){switch(j=V,tt=j.child,j.tag){case 0:case 11:case 14:case 15:Pj(4,j,j.return);break;case 1:Lj(j,j.return);var nt=j.stateNode;if(typeof nt.componentWillUnmount=="function"){a=j,s=j.return;try{o=a,nt.props=o.memoizedProps,nt.state=o.memoizedState,nt.componentWillUnmount()}catch(lt){W(a,s,lt)}}break;case 5:Lj(j,j.return);break;case 22:if(j.memoizedState!==null){gk(st);continue}}tt!==null?(tt.return=j,V=tt):gk(st)}et=et.sibling}e:for(et=null,st=e;;){if(st.tag===5){if(et===null){et=st;try{h=st.stateNode,$?(d=h.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(g=st.stateNode,b=st.memoizedProps.style,c=b!=null&&b.hasOwnProperty("display")?b.display:null,g.style.display=rb("display",c))}catch(lt){W(e,e.return,lt)}}}else if(st.tag===6){if(et===null)try{st.stateNode.nodeValue=$?"":st.memoizedProps}catch(lt){W(e,e.return,lt)}}else if((st.tag!==22&&st.tag!==23||st.memoizedState===null||st===e)&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===e)break e;for(;st.sibling===null;){if(st.return===null||st.return===e)break e;et===st&&(et=null),st=st.return}et===st&&(et=null),st.sibling.return=st.return,st=st.sibling}}break;case 19:ck(o,e),ek(e),a&4&&ak(e);break;case 21:break;default:ck(o,e),ek(e)}}function ek(e){var o=e.flags;if(o&2){try{e:{for(var s=e.return;s!==null;){if(Tj(s)){var a=s;break e}s=s.return}throw Error(p$1(160))}switch(a.tag){case 5:var h=a.stateNode;a.flags&32&&(ob(h,""),a.flags&=-33);var d=Uj(e);Wj(e,d,h);break;case 3:case 4:var c=a.stateNode.containerInfo,g=Uj(e);Vj(e,g,c);break;default:throw Error(p$1(161))}}catch(b){W(e,e.return,b)}e.flags&=-3}o&4096&&(e.flags&=-4097)}function hk(e,o,s){V=e,ik(e)}function ik(e,o,s){for(var a=(e.mode&1)!==0;V!==null;){var h=V,d=h.child;if(h.tag===22&&a){var c=h.memoizedState!==null||Jj;if(!c){var g=h.alternate,b=g!==null&&g.memoizedState!==null||U;g=Jj;var $=U;if(Jj=c,(U=b)&&!$)for(V=h;V!==null;)c=V,b=c.child,c.tag===22&&c.memoizedState!==null?jk(h):b!==null?(b.return=c,V=b):jk(h);for(;d!==null;)V=d,ik(d),d=d.sibling;V=h,Jj=g,U=$}kk(e)}else h.subtreeFlags&8772&&d!==null?(d.return=h,V=d):kk(e)}}function kk(e){for(;V!==null;){var o=V;if(o.flags&8772){var s=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:U||Qj(5,o);break;case 1:var a=o.stateNode;if(o.flags&4&&!U)if(s===null)a.componentDidMount();else{var h=o.elementType===o.type?s.memoizedProps:Ci(o.type,s.memoizedProps);a.componentDidUpdate(h,s.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var d=o.updateQueue;d!==null&&sh(o,d,a);break;case 3:var c=o.updateQueue;if(c!==null){if(s=null,o.child!==null)switch(o.child.tag){case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}sh(o,c,s)}break;case 5:var g=o.stateNode;if(s===null&&o.flags&4){s=g;var b=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&s.focus();break;case"img":b.src&&(s.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var $=o.alternate;if($!==null){var et=$.memoizedState;if(et!==null){var st=et.dehydrated;st!==null&&bd(st)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||o.flags&512&&Rj(o)}catch(j){W(o,o.return,j)}}if(o===e){V=null;break}if(s=o.sibling,s!==null){s.return=o.return,V=s;break}V=o.return}}function gk(e){for(;V!==null;){var o=V;if(o===e){V=null;break}var s=o.sibling;if(s!==null){s.return=o.return,V=s;break}V=o.return}}function jk(e){for(;V!==null;){var o=V;try{switch(o.tag){case 0:case 11:case 15:var s=o.return;try{Qj(4,o)}catch(b){W(o,s,b)}break;case 1:var a=o.stateNode;if(typeof a.componentDidMount=="function"){var h=o.return;try{a.componentDidMount()}catch(b){W(o,h,b)}}var d=o.return;try{Rj(o)}catch(b){W(o,d,b)}break;case 5:var c=o.return;try{Rj(o)}catch(b){W(o,c,b)}}}catch(b){W(o,o.return,b)}if(o===e){V=null;break}var g=o.sibling;if(g!==null){g.return=o.return,V=g;break}V=o.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,o,s,a){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(e,s,a),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=s),T===4&&Ck(e,Z)),Dk(e,a),s===1&&K===0&&!(o.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,o){var s=e.callbackNode;wc(e,o);var a=uc(e,e===Q?Z:0);if(a===0)s!==null&&bc(s),e.callbackNode=null,e.callbackPriority=0;else if(o=a&-a,e.callbackPriority!==o){if(s!=null&&bc(s),o===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(a)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Fk(s,Gk.bind(null,e))}e.callbackPriority=o,e.callbackNode=s}}function Gk(e,o){if(Ak=-1,Bk=0,K&6)throw Error(p$1(327));var s=e.callbackNode;if(Hk()&&e.callbackNode!==s)return null;var a=uc(e,e===Q?Z:0);if(a===0)return null;if(a&30||a&e.expiredLanes||o)o=Ik(e,a);else{o=a;var h=K;K|=2;var d=Jk();(Q!==e||Z!==o)&&(uk=null,Gj=B()+500,Kk(e,o));do try{Lk();break}catch(g){Mk(e,g)}while(!0);$g(),mk.current=d,K=h,Y!==null?o=0:(Q=null,Z=0,o=T)}if(o!==0){if(o===2&&(h=xc(e),h!==0&&(a=h,o=Nk(e,h))),o===1)throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;if(o===6)Ck(e,a);else{if(h=e.current.alternate,!(a&30)&&!Ok(h)&&(o=Ik(e,a),o===2&&(d=xc(e),d!==0&&(a=d,o=Nk(e,d))),o===1))throw s=pk,Kk(e,0),Ck(e,a),Dk(e,B()),s;switch(e.finishedWork=h,e.finishedLanes=a,o){case 0:case 1:throw Error(p$1(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,a),(a&130023424)===a&&(o=fk+500-B(),10<o)){if(uc(e,0)!==0)break;if(h=e.suspendedLanes,(h&a)!==a){R(),e.pingedLanes|=e.suspendedLanes&h;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),o);break}Pk(e,tk,uk);break;case 4:if(Ck(e,a),(a&4194240)===a)break;for(o=e.eventTimes,h=-1;0<a;){var c=31-oc(a);d=1<<c,c=o[c],c>h&&(h=c),a&=~d}if(a=h,a=B()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*lk(a/1960))-a,10<a){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),a);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(e,B()),e.callbackNode===s?Gk.bind(null,e):null}function Nk(e,o){var s=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,o).flags|=256),e=Ik(e,o),e!==2&&(o=tk,tk=s,o!==null&&Fj(o)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var o=e;;){if(o.flags&16384){var s=o.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var a=0;a<s.length;a++){var h=s[a],d=h.getSnapshot;h=h.value;try{if(!He(d(),h))return!1}catch{return!1}}}if(s=o.child,o.subtreeFlags&16384&&s!==null)s.return=o,o=s;else{if(o===e)break;for(;o.sibling===null;){if(o.return===null||o.return===e)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ck(e,o){for(o&=~rk,o&=~qk,e.suspendedLanes|=o,e.pingedLanes&=~o,e=e.expirationTimes;0<o;){var s=31-oc(o),a=1<<s;e[s]=-1,o&=~a}}function Ek(e){if(K&6)throw Error(p$1(327));Hk();var o=uc(e,0);if(!(o&1))return Dk(e,B()),null;var s=Ik(e,o);if(e.tag!==0&&s===2){var a=xc(e);a!==0&&(o=a,s=Nk(e,a))}if(s===1)throw s=pk,Kk(e,0),Ck(e,o),Dk(e,B()),s;if(s===6)throw Error(p$1(345));return e.finishedWork=e.current.alternate,e.finishedLanes=o,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,o){var s=K;K|=1;try{return e(o)}finally{K=s,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var o=K;K|=1;var s=ok.transition,a=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=a,ok.transition=s,K=o,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(e,o){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var a=s;switch(wg(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(a);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(a.type._context);break;case 22:case 23:Hj()}s=s.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=o,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(o=0;o<fh.length;o++)if(s=fh[o],a=s.interleaved,a!==null){s.interleaved=null;var h=a.next,d=s.pending;if(d!==null){var c=d.next;d.next=h,a.next=c}s.pending=a}fh=null}return e}function Mk(e,o){do{var s=Y;try{if($g(),Fh.current=Rh,Ih){for(var a=M.memoizedState;a!==null;){var h=a.queue;h!==null&&(h.pending=null),a=a.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,s===null||s.return===null){T=1,pk=o,Y=null;break}e:{var d=e,c=s.return,g=s,b=o;if(o=Z,g.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var $=b,et=g,st=et.tag;if(!(et.mode&1)&&(st===0||st===11||st===15)){var j=et.alternate;j?(et.updateQueue=j.updateQueue,et.memoizedState=j.memoizedState,et.lanes=j.lanes):(et.updateQueue=null,et.memoizedState=null)}var tt=Ui(c);if(tt!==null){tt.flags&=-257,Vi(tt,c,g,d,o),tt.mode&1&&Si(d,$,o),o=tt,b=$;var nt=o.updateQueue;if(nt===null){var lt=new Set;lt.add(b),o.updateQueue=lt}else nt.add(b);break e}else{if(!(o&1)){Si(d,$,o),tj();break e}b=Error(p$1(426))}}else if(I&&g.mode&1){var ct=Ui(c);if(ct!==null){!(ct.flags&65536)&&(ct.flags|=256),Vi(ct,c,g,d,o),Jg(Ji(b,g));break e}}d=b=Ji(b,g),T!==4&&(T=2),sk===null?sk=[d]:sk.push(d),d=c;do{switch(d.tag){case 3:d.flags|=65536,o&=-o,d.lanes|=o;var ot=Ni(d,b,o);ph(d,ot);break e;case 1:g=b;var _e=d.type,_=d.stateNode;if(!(d.flags&128)&&(typeof _e.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Ri===null||!Ri.has(_)))){d.flags|=65536,o&=-o,d.lanes|=o;var at=Qi(d,g,o);ph(d,at);break e}}d=d.return}while(d!==null)}Sk(s)}catch(it){o=it,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,o){var s=K;K|=2;var a=Jk();(Q!==e||Z!==o)&&(uk=null,Kk(e,o));do try{Tk();break}catch(h){Mk(e,h)}while(!0);if($g(),K=s,mk.current=a,Y!==null)throw Error(p$1(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var o=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,o===null?Sk(e):Y=o,nk.current=null}function Sk(e){var o=e;do{var s=o.alternate;if(e=o.return,o.flags&32768){if(s=Ij(s,o),s!==null){s.flags&=32767,Y=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(s=Ej(s,o,fj),s!==null){Y=s;return}if(o=o.sibling,o!==null){Y=o;return}Y=o=e}while(o!==null);T===0&&(T=5)}function Pk(e,o,s){var a=C,h=ok.transition;try{ok.transition=null,C=1,Wk(e,o,s,a)}finally{ok.transition=h,C=a}return null}function Wk(e,o,s,a){do Hk();while(wk!==null);if(K&6)throw Error(p$1(327));s=e.finishedWork;var h=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(p$1(177));e.callbackNode=null,e.callbackPriority=0;var d=s.lanes|s.childLanes;if(Bc(e,d),e===Q&&(Y=Q=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),d=(s.flags&15990)!==0,s.subtreeFlags&15990||d){d=ok.transition,ok.transition=null;var c=C;C=1;var g=K;K|=4,nk.current=null,Oj(e,s),dk(s,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=s,hk(s),dc(),K=g,C=c,ok.transition=d}else e.current=s;if(vk&&(vk=!1,wk=e,xk=h),d=e.pendingLanes,d===0&&(Ri=null),mc(s.stateNode),Dk(e,B()),o!==null)for(a=e.onRecoverableError,s=0;s<o.length;s++)h=o[s],a(h.value,{componentStack:h.stack,digest:h.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),d=e.pendingLanes,d&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),o=ok.transition,s=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var a=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p$1(331));var h=K;for(K|=4,V=e.current;V!==null;){var d=V,c=d.child;if(V.flags&16){var g=d.deletions;if(g!==null){for(var b=0;b<g.length;b++){var $=g[b];for(V=$;V!==null;){var et=V;switch(et.tag){case 0:case 11:case 15:Pj(8,et,d)}var st=et.child;if(st!==null)st.return=et,V=st;else for(;V!==null;){et=V;var j=et.sibling,tt=et.return;if(Sj(et),et===$){V=null;break}if(j!==null){j.return=tt,V=j;break}V=tt}}}var nt=d.alternate;if(nt!==null){var lt=nt.child;if(lt!==null){nt.child=null;do{var ct=lt.sibling;lt.sibling=null,lt=ct}while(lt!==null)}}V=d}}if(d.subtreeFlags&2064&&c!==null)c.return=d,V=c;else e:for(;V!==null;){if(d=V,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Pj(9,d,d.return)}var ot=d.sibling;if(ot!==null){ot.return=d.return,V=ot;break e}V=d.return}}var _e=e.current;for(V=_e;V!==null;){c=V;var _=c.child;if(c.subtreeFlags&2064&&_!==null)_.return=c,V=_;else e:for(c=_e;V!==null;){if(g=V,g.flags&2048)try{switch(g.tag){case 0:case 11:case 15:Qj(9,g)}}catch(it){W(g,g.return,it)}if(g===c){V=null;break e}var at=g.sibling;if(at!==null){at.return=g.return,V=at;break e}V=g.return}}if(K=h,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}a=!0}return a}finally{C=s,ok.transition=o}}return!1}function Xk(e,o,s){o=Ji(s,o),o=Ni(e,o,1),e=nh(e,o,1),o=R(),e!==null&&(Ac(e,1,o),Dk(e,o))}function W(e,o,s){if(e.tag===3)Xk(e,e,s);else for(;o!==null;){if(o.tag===3){Xk(o,e,s);break}else if(o.tag===1){var a=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Ri===null||!Ri.has(a))){e=Ji(s,e),e=Qi(o,e,1),o=nh(o,e,1),e=R(),o!==null&&(Ac(o,1,e),Dk(o,e));break}}o=o.return}}function Ti(e,o,s){var a=e.pingCache;a!==null&&a.delete(o),o=R(),e.pingedLanes|=e.suspendedLanes&s,Q===e&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=s),Dk(e,o)}function Yk(e,o){o===0&&(e.mode&1?(o=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):o=1);var s=R();e=ih(e,o),e!==null&&(Ac(e,o,s),Dk(e,s))}function uj(e){var o=e.memoizedState,s=0;o!==null&&(s=o.retryLane),Yk(e,s)}function bk(e,o){var s=0;switch(e.tag){case 13:var a=e.stateNode,h=e.memoizedState;h!==null&&(s=h.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(p$1(314))}a!==null&&a.delete(o),Yk(e,s)}var Vk;Vk=function(e,o,s){if(e!==null)if(e.memoizedProps!==o.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&s)&&!(o.flags&128))return dh=!1,yj(e,o,s);dh=!!(e.flags&131072)}else dh=!1,I&&o.flags&1048576&&ug(o,ng,o.index);switch(o.lanes=0,o.tag){case 2:var a=o.type;ij(e,o),e=o.pendingProps;var h=Yf(o,H.current);ch(o,s),h=Nh(null,o,a,e,h,s);var d=Sh();return o.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Zf(a)?(d=!0,cg(o)):d=!1,o.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,kh(o),h.updater=Ei,o.stateNode=h,h._reactInternals=o,Ii(o,a,e,s),o=jj(null,o,a,!0,d,s)):(o.tag=0,I&&d&&vg(o),Xi(null,o,h,s),o=o.child),o;case 16:a=o.elementType;e:{switch(ij(e,o),e=o.pendingProps,h=a._init,a=h(a._payload),o.type=a,h=o.tag=Zk(a),e=Ci(a,e),h){case 0:o=cj(null,o,a,e,s);break e;case 1:o=hj(null,o,a,e,s);break e;case 11:o=Yi(null,o,a,e,s);break e;case 14:o=$i(null,o,a,Ci(a.type,e),s);break e}throw Error(p$1(306,a,""))}return o;case 0:return a=o.type,h=o.pendingProps,h=o.elementType===a?h:Ci(a,h),cj(e,o,a,h,s);case 1:return a=o.type,h=o.pendingProps,h=o.elementType===a?h:Ci(a,h),hj(e,o,a,h,s);case 3:e:{if(kj(o),e===null)throw Error(p$1(387));a=o.pendingProps,d=o.memoizedState,h=d.element,lh(e,o),qh(o,a,null,s);var c=o.memoizedState;if(a=c.element,d.isDehydrated)if(d={element:a,isDehydrated:!1,cache:c.cache,pendingSuspenseBoundaries:c.pendingSuspenseBoundaries,transitions:c.transitions},o.updateQueue.baseState=d,o.memoizedState=d,o.flags&256){h=Ji(Error(p$1(423)),o),o=lj(e,o,a,s,h);break e}else if(a!==h){h=Ji(Error(p$1(424)),o),o=lj(e,o,a,s,h);break e}else for(yg=Lf(o.stateNode.containerInfo.firstChild),xg=o,I=!0,zg=null,s=Vg(o,null,a,s),o.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),a===h){o=Zi(e,o,s);break e}Xi(e,o,a,s)}o=o.child}return o;case 5:return Ah(o),e===null&&Eg(o),a=o.type,h=o.pendingProps,d=e!==null?e.memoizedProps:null,c=h.children,Ef(a,h)?c=null:d!==null&&Ef(a,d)&&(o.flags|=32),gj(e,o),Xi(e,o,c,s),o.child;case 6:return e===null&&Eg(o),null;case 13:return oj(e,o,s);case 4:return yh(o,o.stateNode.containerInfo),a=o.pendingProps,e===null?o.child=Ug(o,null,a,s):Xi(e,o,a,s),o.child;case 11:return a=o.type,h=o.pendingProps,h=o.elementType===a?h:Ci(a,h),Yi(e,o,a,h,s);case 7:return Xi(e,o,o.pendingProps,s),o.child;case 8:return Xi(e,o,o.pendingProps.children,s),o.child;case 12:return Xi(e,o,o.pendingProps.children,s),o.child;case 10:e:{if(a=o.type._context,h=o.pendingProps,d=o.memoizedProps,c=h.value,G(Wg,a._currentValue),a._currentValue=c,d!==null)if(He(d.value,c)){if(d.children===h.children&&!Wf.current){o=Zi(e,o,s);break e}}else for(d=o.child,d!==null&&(d.return=o);d!==null;){var g=d.dependencies;if(g!==null){c=d.child;for(var b=g.firstContext;b!==null;){if(b.context===a){if(d.tag===1){b=mh(-1,s&-s),b.tag=2;var $=d.updateQueue;if($!==null){$=$.shared;var et=$.pending;et===null?b.next=b:(b.next=et.next,et.next=b),$.pending=b}}d.lanes|=s,b=d.alternate,b!==null&&(b.lanes|=s),bh(d.return,s,o),g.lanes|=s;break}b=b.next}}else if(d.tag===10)c=d.type===o.type?null:d.child;else if(d.tag===18){if(c=d.return,c===null)throw Error(p$1(341));c.lanes|=s,g=c.alternate,g!==null&&(g.lanes|=s),bh(c,s,o),c=d.sibling}else c=d.child;if(c!==null)c.return=d;else for(c=d;c!==null;){if(c===o){c=null;break}if(d=c.sibling,d!==null){d.return=c.return,c=d;break}c=c.return}d=c}Xi(e,o,h.children,s),o=o.child}return o;case 9:return h=o.type,a=o.pendingProps.children,ch(o,s),h=eh(h),a=a(h),o.flags|=1,Xi(e,o,a,s),o.child;case 14:return a=o.type,h=Ci(a,o.pendingProps),h=Ci(a.type,h),$i(e,o,a,h,s);case 15:return bj(e,o,o.type,o.pendingProps,s);case 17:return a=o.type,h=o.pendingProps,h=o.elementType===a?h:Ci(a,h),ij(e,o),o.tag=1,Zf(a)?(e=!0,cg(o)):e=!1,ch(o,s),Gi(o,a,h),Ii(o,a,h,s),jj(null,o,a,!0,e,s);case 19:return xj(e,o,s);case 22:return dj(e,o,s)}throw Error(p$1(156,o.tag))};function Fk(e,o){return ac(e,o)}function $k(e,o,s,a){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,o,s,a){return new $k(e,o,s,a)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,o){var s=e.alternate;return s===null?(s=Bg(e.tag,o,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=o,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,o=e.dependencies,s.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Rg(e,o,s,a,h,d){var c=2;if(a=e,typeof e=="function")aj(e)&&(c=1);else if(typeof e=="string")c=5;else e:switch(e){case ya:return Tg(s.children,h,d,o);case za:c=8,h|=8;break;case Aa:return e=Bg(12,s,o,h|2),e.elementType=Aa,e.lanes=d,e;case Ea:return e=Bg(13,s,o,h),e.elementType=Ea,e.lanes=d,e;case Fa:return e=Bg(19,s,o,h),e.elementType=Fa,e.lanes=d,e;case Ia:return pj(s,h,d,o);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:c=10;break e;case Ca:c=9;break e;case Da:c=11;break e;case Ga:c=14;break e;case Ha:c=16,a=null;break e}throw Error(p$1(130,e==null?e:typeof e,""))}return o=Bg(c,s,o,h),o.elementType=e,o.type=a,o.lanes=d,o}function Tg(e,o,s,a){return e=Bg(7,e,a,o),e.lanes=s,e}function pj(e,o,s,a){return e=Bg(22,e,a,o),e.elementType=Ia,e.lanes=s,e.stateNode={isHidden:!1},e}function Qg(e,o,s){return e=Bg(6,e,null,o),e.lanes=s,e}function Sg(e,o,s){return o=Bg(4,e.children!==null?e.children:[],e.key,o),o.lanes=s,o.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},o}function al(e,o,s,a,h){this.tag=o,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=a,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function bl(e,o,s,a,h,d,c,g,b){return e=new al(e,o,s,g,b),o===1?(o=1,d===!0&&(o|=8)):o=0,d=Bg(3,null,null,o),e.current=d,d.stateNode=e,d.memoizedState={element:a,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(d),e}function cl(e,o,s){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:a==null?null:""+a,children:e,containerInfo:o,implementation:s}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p$1(170));var o=e;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Zf(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(p$1(171))}if(e.tag===1){var s=e.type;if(Zf(s))return bg(e,s,o)}return o}function el(e,o,s,a,h,d,c,g,b){return e=bl(s,a,!0,e,h,d,c,g,b),e.context=dl(null),s=e.current,a=R(),h=yi(s),d=mh(a,h),d.callback=o??null,nh(s,d,h),e.current.lanes=h,Ac(e,h,a),Dk(e,a),e}function fl(e,o,s,a){var h=o.current,d=R(),c=yi(h);return s=dl(s),o.context===null?o.context=s:o.pendingContext=s,o=mh(d,c),o.payload={element:e},a=a===void 0?null:a,a!==null&&(o.callback=a),e=nh(h,o,c),e!==null&&(gi(e,h,c,d),oh(e,h,c)),c}function gl$1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,o){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<o?s:o}}function il(e,o){hl(e,o),(e=e.alternate)&&hl(e,o)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var o=this._internalRoot;if(o===null)throw Error(p$1(409));fl(e,o,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var o=e.containerInfo;Rk(function(){fl(null,e,null,null)}),o[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var o=Hc();e={blockedOn:null,target:e,priority:o};for(var s=0;s<Qc.length&&o!==0&&o<Qc[s].priority;s++);Qc.splice(s,0,e),s===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,o,s,a,h){if(h){if(typeof a=="function"){var d=a;a=function(){var $=gl$1(c);d.call($)}}var c=el(o,a,e,0,null,!1,!1,"",pl);return e._reactRootContainer=c,e[uf]=c.current,sf(e.nodeType===8?e.parentNode:e),Rk(),c}for(;h=e.lastChild;)e.removeChild(h);if(typeof a=="function"){var g=a;a=function(){var $=gl$1(b);g.call($)}}var b=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=b,e[uf]=b.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(o,b,s,a)}),b}function rl(e,o,s,a,h){var d=s._reactRootContainer;if(d){var c=d;if(typeof h=="function"){var g=h;h=function(){var b=gl$1(c);g.call(b)}}fl(o,c,e,h)}else c=ql(s,o,e,h,a);return gl$1(c)}Ec=function(e){switch(e.tag){case 3:var o=e.stateNode;if(o.current.memoizedState.isDehydrated){var s=tc(o.pendingLanes);s!==0&&(Cc(o,s|1),Dk(o,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var a=ih(e,1);if(a!==null){var h=R();gi(a,e,1,h)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var o=ih(e,134217728);if(o!==null){var s=R();gi(o,e,134217728,s)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var o=yi(e),s=ih(e,o);if(s!==null){var a=R();gi(s,e,o,a)}il(e,o)}};Hc=function(){return C};Ic=function(e,o){var s=C;try{return C=e,o()}finally{C=s}};yb=function(e,o,s){switch(o){case"input":if(bb(e,s),o=s.name,s.type==="radio"&&o!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<s.length;o++){var a=s[o];if(a!==e&&a.form===e.form){var h=Db(a);if(!h)throw Error(p$1(90));Wa(a),bb(a,h)}}}break;case"textarea":ib(e,s);break;case"select":o=s.value,o!=null&&fb(e,!!s.multiple,o,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,o){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(o))throw Error(p$1(200));return cl(e,o,null,s)};reactDom_production_min.createRoot=function(e,o){if(!nl(e))throw Error(p$1(299));var s=!1,a="",h=kl;return o!=null&&(o.unstable_strictMode===!0&&(s=!0),o.identifierPrefix!==void 0&&(a=o.identifierPrefix),o.onRecoverableError!==void 0&&(h=o.onRecoverableError)),o=bl(e,1,!1,null,null,s,!1,a,h),e[uf]=o.current,sf(e.nodeType===8?e.parentNode:e),new ll(o)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var o=e._reactInternals;if(o===void 0)throw typeof e.render=="function"?Error(p$1(188)):(e=Object.keys(e).join(","),Error(p$1(268,e)));return e=Zb(o),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,o,s){if(!ol(o))throw Error(p$1(200));return rl(null,e,o,!0,s)};reactDom_production_min.hydrateRoot=function(e,o,s){if(!nl(e))throw Error(p$1(405));var a=s!=null&&s.hydratedSources||null,h=!1,d="",c=kl;if(s!=null&&(s.unstable_strictMode===!0&&(h=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(c=s.onRecoverableError)),o=el(o,null,e,1,s??null,h,!1,d,c),e[uf]=o.current,sf(e),a)for(e=0;e<a.length;e++)s=a[e],h=s._getVersion,h=h(s._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[s,h]:o.mutableSourceEagerHydrationData.push(s,h);return new ml(o)};reactDom_production_min.render=function(e,o,s){if(!ol(o))throw Error(p$1(200));return rl(null,e,o,!1,s)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p$1(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,o,s,a){if(!ol(s))throw Error(p$1(200));if(e==null||e._reactInternals===void 0)throw Error(p$1(38));return rl(e,o,s,!1,a)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;var litegraph={};(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(e,o){if(!o.prototype)throw"Cannot register a simple object, it must be a class with a prototype";o.type=e,LiteGraph.debug&&console.log("Node registered: "+e);const s=o.name,a=e.lastIndexOf("/");o.category=e.substring(0,a),o.title||(o.title=s);for(var h in LGraphNode.prototype)o.prototype[h]||(o.prototype[h]=LGraphNode.prototype[h]);const d=this.registered_node_types[e];if(d&&console.log("replacing node type: "+e),!Object.prototype.hasOwnProperty.call(o.prototype,"shape")&&(Object.defineProperty(o.prototype,"shape",{set:function(c){switch(c){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=c}},get:function(){return this._shape},enumerable:!0,configurable:!0}),o.supported_extensions))for(let c in o.supported_extensions){const g=o.supported_extensions[c];g&&g.constructor===String&&(this.node_types_by_file_extension[g.toLowerCase()]=o)}this.registered_node_types[e]=o,o.constructor.name&&(this.Nodes[s]=o),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(e,o),d&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(e,o,d),o.prototype.onPropertyChange&&console.warn("LiteGraph node class "+e+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new o(o.title||"tmpnode")},unregisterNodeType:function(e){const o=e.constructor===String?this.registered_node_types[e]:e;if(!o)throw"node type not found: "+e;delete this.registered_node_types[o.type],o.constructor.name&&delete this.Nodes[o.constructor.name]},registerNodeAndSlotType:function(e,o,s){s=s||!1;const h=(e.constructor===String&&this.registered_node_types[e]!=="anonymous"?this.registered_node_types[e]:e).constructor.type;let d=[];typeof o=="string"?d=o.split(","):o==this.EVENT||o==this.ACTION?d=["_event_"]:d=["*"];for(let c=0;c<d.length;++c){let g=d[c];g===""&&(g="*");const b=s?"registered_slot_out_types":"registered_slot_in_types";this[b][g]===void 0&&(this[b][g]={nodes:[]}),this[b][g].nodes.includes(h)||this[b][g].nodes.push(h),s?this.slot_types_out.includes(g.toLowerCase())||(this.slot_types_out.push(g.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(g.toLowerCase())||(this.slot_types_in.push(g.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(e,o){var s="";if(o.inputs)for(var a=0;a<o.inputs.length;++a){var h=o.inputs[a][0],d=o.inputs[a][1];d&&d.constructor===String&&(d='"'+d+'"'),s+="this.addInput('"+h+"',"+d+`);
`}if(o.outputs)for(var a=0;a<o.outputs.length;++a){var h=o.outputs[a][0],d=o.outputs[a][1];d&&d.constructor===String&&(d='"'+d+'"'),s+="this.addOutput('"+h+"',"+d+`);
`}if(o.properties)for(var a in o.properties){var c=o.properties[a];c&&c.constructor===String&&(c='"'+c+'"'),s+="this.addProperty('"+a+"',"+c+`);
`}s+="if(this.onCreate)this.onCreate()";var g=Function(s);for(var a in o)a!="inputs"&&a!="outputs"&&a!="properties"&&(g.prototype[a]=o[a]);return g.title=o.title||e.split("/").pop(),g.desc=o.desc||"Generated from object",this.registerNodeType(e,g),g},wrapFunctionAsNode:function(e,o,s,a,h){var d=Array(o.length),c="";if(s!==null)for(var g=LiteGraph.getParameterNames(o),b=0;b<g.length;++b){var $=0;s&&(s[b]!=null&&s[b].constructor===String?$="'"+s[b]+"'":s[b]!=null&&($=s[b])),c+="this.addInput('"+g[b]+"',"+$+`);
`}a!==null&&(c+="this.addOutput('out',"+(a!=null?a.constructor===String?"'"+a+"'":a:0)+`);
`),h&&(c+="this.properties = "+JSON.stringify(h)+`;
`);var et=Function(c);return et.title=e.split("/").pop(),et.desc="Generated from "+o.name,et.prototype.onExecute=function(){for(var j=0;j<d.length;++j)d[j]=this.getInputData(j);var tt=o.apply(this,d);this.setOutputData(0,tt)},this.registerNodeType(e,et),et},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(e,o){LGraphNode.prototype[e]=o;for(var s in this.registered_node_types){var a=this.registered_node_types[s];a.prototype[e]&&(a.prototype["_"+e]=a.prototype[e]),a.prototype[e]=o}},createNode:function(e,o,s){var a=this.registered_node_types[e];if(!a)return LiteGraph.debug&&console.log('GraphNode type "'+e+'" not registered.'),null;a.prototype,o=o||a.title||e;var h=null;if(LiteGraph.catch_exceptions)try{h=new a(o)}catch(c){return console.error(c),null}else h=new a(o);if(h.type=e,!h.title&&o&&(h.title=o),h.properties||(h.properties={}),h.properties_info||(h.properties_info=[]),h.flags||(h.flags={}),h.size||(h.size=h.computeSize()),h.pos||(h.pos=LiteGraph.DEFAULT_POSITION.concat()),h.mode||(h.mode=LiteGraph.ALWAYS),s)for(var d in s)h[d]=s[d];return h.onNodeCreated&&h.onNodeCreated(),h},getNodeType:function(e){return this.registered_node_types[e]},getNodeTypesInCategory:function(e,o){var s=[];for(var a in this.registered_node_types){var h=this.registered_node_types[a];h.filter==o&&(e==""?h.category==null&&s.push(h):h.category==e&&s.push(h))}return this.auto_sort_node_types&&s.sort(function(d,c){return d.title.localeCompare(c.title)}),s},getNodeTypesCategories:function(e){var o={"":1};for(var s in this.registered_node_types){var a=this.registered_node_types[s];if(a.category&&!a.skip_list){if(a.filter!=e)continue;o[a.category]=1}}var h=[];for(var s in o)h.push(s);return this.auto_sort_node_types?h.sort():h},reloadNodes:function(e){for(var o=document.getElementsByTagName("script"),s=[],a=0;a<o.length;a++)s.push(o[a]);var h=document.getElementsByTagName("head")[0];e=document.location.href+e;for(var a=0;a<s.length;a++){var d=s[a].src;if(!(!d||d.substr(0,e.length)!=e))try{LiteGraph.debug&&console.log("Reloading: "+d);var c=document.createElement("script");c.type="text/javascript",c.src=d,h.appendChild(c),h.removeChild(s[a])}catch(b){if(LiteGraph.throw_errors)throw b;LiteGraph.debug&&console.log("Error while reloading "+d)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(e,o){if(e==null)return null;var s=JSON.parse(JSON.stringify(e));if(!o)return s;for(var a in s)o[a]=s[a];return o},uuidv4:function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,e=>(e^Math.random()*16>>e/4).toString(16))},isValidConnection:function(e,o){if((e==""||e==="*")&&(e=0),(o==""||o==="*")&&(o=0),!e||!o||e==o||e==LiteGraph.EVENT&&o==LiteGraph.ACTION)return!0;if(e=String(e),o=String(o),e=e.toLowerCase(),o=o.toLowerCase(),e.indexOf(",")==-1&&o.indexOf(",")==-1)return e==o;for(var s=e.split(","),a=o.split(","),h=0;h<s.length;++h)for(var d=0;d<a.length;++d)if(this.isValidConnection(s[h],a[d]))return!0;return!1},registerSearchboxExtra:function(e,o,s){this.searchbox_extras[o.toLowerCase()]={type:e,desc:o,data:s}},fetchFile:function(e,o,s,a){if(!e)return null;if(o=o||"text",e.constructor===String)return e.substr(0,4)=="http"&&LiteGraph.proxy&&(e=LiteGraph.proxy+e.substr(e.indexOf(":")+3)),fetch(e).then(function(d){if(!d.ok)throw new Error("File not found");if(o=="arraybuffer")return d.arrayBuffer();if(o=="text"||o=="string")return d.text();if(o=="json")return d.json();if(o=="blob")return d.blob()}).then(function(d){s&&s(d)}).catch(function(d){console.error("error fetching file:",e),a&&a(d)});if(e.constructor===File||e.constructor===Blob){var h=new FileReader;if(h.onload=function(d){var c=d.target.result;o=="json"&&(c=JSON.parse(c)),s&&s(c)},o=="arraybuffer")return h.readAsArrayBuffer(e);if(o=="text"||o=="json")return h.readAsText(e);if(o=="blob")return h.readAsBinaryString(e)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var e=process.hrtime();return e[0]*.001+e[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(e){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),e&&this.configure(e)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var e=0;e<this._nodes.length;++e){var o=this._nodes[e];o.onRemoved&&o.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(e){if(e.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";e.graph&&e.graph!=this&&e.graph.detachCanvas(e),e.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(e)},LGraph.prototype.detachCanvas=function(e){if(this.list_of_graphcanvas){var o=this.list_of_graphcanvas.indexOf(e);o!=-1&&(e.graph=null,this.list_of_graphcanvas.splice(o,1))}},LGraph.prototype.start=function(e){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,e=e||0;var o=this;if(e==0&&typeof window<"u"&&window.requestAnimationFrame){let a=function(){o.execution_timer_id==-1&&(window.requestAnimationFrame(a),o.onBeforeStep&&o.onBeforeStep(),o.runStep(1,!o.catch_errors),o.onAfterStep&&o.onAfterStep())};var s=a;this.execution_timer_id=-1,a()}else this.execution_timer_id=setInterval(function(){o.onBeforeStep&&o.onBeforeStep(),o.runStep(1,!o.catch_errors),o.onAfterStep&&o.onAfterStep()},e)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(e,o,s){e=e||1;var a=LiteGraph.getTime();this.globaltime=.001*(a-this.starttime);var h=this._nodes_executable?this._nodes_executable:this._nodes;if(h){if(s=s||h.length,o){for(var d=0;d<e;d++){for(var c=0;c<s;++c){var g=h[c];LiteGraph.use_deferred_actions&&g._waiting_actions&&g._waiting_actions.length&&g.executePendingActions(),g.mode==LiteGraph.ALWAYS&&g.onExecute&&g.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var d=0;d<e;d++){for(var c=0;c<s;++c){var g=h[c];LiteGraph.use_deferred_actions&&g._waiting_actions&&g._waiting_actions.length&&g.executePendingActions(),g.mode==LiteGraph.ALWAYS&&g.onExecute&&g.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(et){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw et;LiteGraph.debug&&console.log("Error during execution: "+et),this.stop()}var b=LiteGraph.getTime(),$=b-a;$==0&&($=1),this.execution_time=.001*$,this.globaltime+=.001*$,this.iteration+=1,this.elapsed_time=(b-this.last_update_time)*.001,this.last_update_time=b,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var e=0;e<this._nodes_in_order.length;++e)this._nodes_in_order[e].onExecute&&this._nodes_executable.push(this._nodes_in_order[e])},LGraph.prototype.computeExecutionOrder=function(e,o){for(var s=[],a=[],h={},d={},c={},g=0,ct=this._nodes.length;g<ct;++g){var b=this._nodes[g];if(!(e&&!b.onExecute)){h[b.id]=b;var $=0;if(b.inputs)for(var et=0,st=b.inputs.length;et<st;et++)b.inputs[et]&&b.inputs[et].link!=null&&($+=1);$==0?(a.push(b),o&&(b._level=1)):(o&&(b._level=0),c[b.id]=$)}}for(;a.length!=0;){var b=a.shift();if(s.push(b),delete h[b.id],!!b.outputs)for(var g=0;g<b.outputs.length;g++){var j=b.outputs[g];if(!(j==null||j.links==null||j.links.length==0))for(var et=0;et<j.links.length;et++){var tt=j.links[et],nt=this.links[tt];if(nt&&!d[nt.id]){var lt=this.getNodeById(nt.target_id);if(lt==null){d[nt.id]=!0;continue}o&&(!lt._level||lt._level<=b._level)&&(lt._level=b._level+1),d[nt.id]=!0,c[lt.id]-=1,c[lt.id]==0&&a.push(lt)}}}}for(var g in h)s.push(h[g]);s.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var ct=s.length,g=0;g<ct;++g)s[g].order=g;s=s.sort(function(ot,_e){var _=ot.constructor.priority||ot.priority||0,at=_e.constructor.priority||_e.priority||0;return _==at?ot.order-_e.order:_-at});for(var g=0;g<ct;++g)s[g].order=g;return s},LGraph.prototype.getAncestors=function(e){for(var o=[],s=[e],a={};s.length;){var h=s.shift();if(h.inputs){!a[h.id]&&h!=e&&(a[h.id]=!0,o.push(h));for(var d=0;d<h.inputs.length;++d){var c=h.getInputNode(d);c&&o.indexOf(c)==-1&&s.push(c)}}}return o.sort(function(g,b){return g.order-b.order}),o},LGraph.prototype.arrange=function(e,o){e=e||100;const s=this.computeExecutionOrder(!1,!0),a=[];for(let d=0;d<s.length;++d){const c=s[d],g=c._level||1;a[g]||(a[g]=[]),a[g].push(c)}let h=e;for(let d=0;d<a.length;++d){const c=a[d];if(!c)continue;let g=100,b=e+LiteGraph.NODE_TITLE_HEIGHT;for(let $=0;$<c.length;++$){const et=c[$];et.pos[0]=o==LiteGraph.VERTICAL_LAYOUT?b:h,et.pos[1]=o==LiteGraph.VERTICAL_LAYOUT?h:b;const st=o==LiteGraph.VERTICAL_LAYOUT?1:0;et.size[st]>g&&(g=et.size[st]);const j=o==LiteGraph.VERTICAL_LAYOUT?0:1;b+=et.size[j]+e+LiteGraph.NODE_TITLE_HEIGHT}h+=g+e}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(e,o,s){s=s||LiteGraph.ALWAYS;var a=this._nodes_in_order?this._nodes_in_order:this._nodes;if(a)for(var h=0,d=a.length;h<d;++h){var c=a[h];if(c.constructor===LiteGraph.Subgraph&&e!="onExecute"){c.mode==s&&c.sendEventToAllNodes(e,o,s);continue}!c[e]||c.mode!=s||(o===void 0?c[e]():o&&o.constructor===Array?c[e].apply(c,o):c[e](o))}},LGraph.prototype.sendActionToCanvas=function(e,o){if(this.list_of_graphcanvas)for(var s=0;s<this.list_of_graphcanvas.length;++s){var a=this.list_of_graphcanvas[s];a[e]&&a[e].apply(a,o)}},LGraph.prototype.add=function(e,o){if(e){if(e.constructor===LGraphGroup){this._groups.push(e),this.setDirtyCanvas(!0),this.change(),e.graph=this,this._version++;return}if(e.id!=-1&&this._nodes_by_id[e.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?e.id=LiteGraph.uuidv4():e.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(e.id==null||e.id==-1)&&(e.id=LiteGraph.uuidv4()):e.id==null||e.id==-1?e.id=++this.last_node_id:this.last_node_id<e.id&&(this.last_node_id=e.id),e.graph=this,this._version++,this._nodes.push(e),this._nodes_by_id[e.id]=e,e.onAdded&&e.onAdded(this),this.config.align_to_grid&&e.alignToGrid(),o||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(e),this.setDirtyCanvas(!0),this.change(),e}},LGraph.prototype.remove=function(e){if(e.constructor===LiteGraph.LGraphGroup){var o=this._groups.indexOf(e);o!=-1&&this._groups.splice(o,1),e.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[e.id]!=null&&!e.ignore_remove){if(this.beforeChange(),e.inputs)for(var s=0;s<e.inputs.length;s++){var a=e.inputs[s];a.link!=null&&e.disconnectInput(s)}if(e.outputs)for(var s=0;s<e.outputs.length;s++){var a=e.outputs[s];a.links!=null&&a.links.length&&e.disconnectOutput(s)}if(e.onRemoved&&e.onRemoved(),e.graph=null,this._version++,this.list_of_graphcanvas)for(var s=0;s<this.list_of_graphcanvas.length;++s){var h=this.list_of_graphcanvas[s];h.selected_nodes[e.id]&&delete h.selected_nodes[e.id],h.node_dragged==e&&(h.node_dragged=null)}var d=this._nodes.indexOf(e);d!=-1&&this._nodes.splice(d,1),delete this._nodes_by_id[e.id],this.onNodeRemoved&&this.onNodeRemoved(e),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(e){return e==null?null:this._nodes_by_id[e]},LGraph.prototype.findNodesByClass=function(e,o){o=o||[],o.length=0;for(var s=0,a=this._nodes.length;s<a;++s)this._nodes[s].constructor===e&&o.push(this._nodes[s]);return o},LGraph.prototype.findNodesByType=function(s,o){var s=s.toLowerCase();o=o||[],o.length=0;for(var a=0,h=this._nodes.length;a<h;++a)this._nodes[a].type.toLowerCase()==s&&o.push(this._nodes[a]);return o},LGraph.prototype.findNodeByTitle=function(e){for(var o=0,s=this._nodes.length;o<s;++o)if(this._nodes[o].title==e)return this._nodes[o];return null},LGraph.prototype.findNodesByTitle=function(e){for(var o=[],s=0,a=this._nodes.length;s<a;++s)this._nodes[s].title==e&&o.push(this._nodes[s]);return o},LGraph.prototype.getNodeOnPos=function(e,o,s,a){s=s||this._nodes;for(var h=null,d=s.length-1;d>=0;d--){var c=s[d];if(c.isPointInside(e,o,a))return c}return h},LGraph.prototype.getGroupOnPos=function(e,o){for(var s=this._groups.length-1;s>=0;s--){var a=this._groups[s];if(a.isPointInside(e,o,2,!0))return a}return null},LGraph.prototype.checkNodeTypes=function(){for(var e=0;e<this._nodes.length;e++){var o=this._nodes[e],s=LiteGraph.registered_node_types[o.type];if(o.constructor!=s){console.log("node being replaced by newer version: "+o.type);var a=LiteGraph.createNode(o.type);this._nodes[e]=a,a.configure(o.serialize()),a.graph=this,this._nodes_by_id[a.id]=a,o.inputs&&(a.inputs=o.inputs.concat()),o.outputs&&(a.outputs=o.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(e,o,s){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var a=0;a<this._input_nodes.length;++a){var h=this._input_nodes[a];if(h.properties.name==e){h.actionDo(e,o,s);break}}},LGraph.prototype.trigger=function(e,o){this.onTrigger&&this.onTrigger(e,o)},LGraph.prototype.addInput=function(e,o,s){var a=this.inputs[e];a||(this.beforeChange(),this.inputs[e]={name:e,type:o,value:s},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(e,o),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(e,o){var s=this.inputs[e];s&&(s.value=o)},LGraph.prototype.getInputData=function(e){var o=this.inputs[e];return o?o.value:null},LGraph.prototype.renameInput=function(e,o){if(o!=e){if(!this.inputs[e])return!1;if(this.inputs[o])return console.error("there is already one input with that name"),!1;this.inputs[o]=this.inputs[e],delete this.inputs[e],this._version++,this.onInputRenamed&&this.onInputRenamed(e,o),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(e,o){if(!this.inputs[e])return!1;this.inputs[e].type&&String(this.inputs[e].type).toLowerCase()==String(o).toLowerCase()||(this.inputs[e].type=o,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(e,o))},LGraph.prototype.removeInput=function(e){return this.inputs[e]?(delete this.inputs[e],this._version++,this.onInputRemoved&&this.onInputRemoved(e),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(e,o,s){this.outputs[e]={name:e,type:o,value:s},this._version++,this.onOutputAdded&&this.onOutputAdded(e,o),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(e,o){var s=this.outputs[e];s&&(s.value=o)},LGraph.prototype.getOutputData=function(e){var o=this.outputs[e];return o?o.value:null},LGraph.prototype.renameOutput=function(e,o){if(!this.outputs[e])return!1;if(this.outputs[o])return console.error("there is already one output with that name"),!1;this.outputs[o]=this.outputs[e],delete this.outputs[e],this._version++,this.onOutputRenamed&&this.onOutputRenamed(e,o),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(e,o){if(!this.outputs[e])return!1;this.outputs[e].type&&String(this.outputs[e].type).toLowerCase()==String(o).toLowerCase()||(this.outputs[e].type=o,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(e,o))},LGraph.prototype.removeOutput=function(e){return this.outputs[e]?(delete this.outputs[e],this._version++,this.onOutputRemoved&&this.onOutputRemoved(e),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(e,o){for(var s=this.findNodesByTitle(e),a=0;a<s.length;++a)s[a].onTrigger(o)},LGraph.prototype.setCallback=function(e,o){for(var s=this.findNodesByTitle(e),a=0;a<s.length;++a)s[a].setTrigger(o)},LGraph.prototype.beforeChange=function(e){this.onBeforeChange&&this.onBeforeChange(this,e),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(e){this.onAfterChange&&this.onAfterChange(this,e),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(e,o){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(e),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var e=0;e<this.list_of_graphcanvas.length;++e){var o=this.list_of_graphcanvas[e];if(o.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var e in this.links){var o=this.links[e];o&&o._last_time&&(o._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(e,o){this.sendActionToCanvas("setDirty",[e,o])},LGraph.prototype.removeLink=function(e){var o=this.links[e];if(o){var s=this.getNodeById(o.target_id);s&&s.disconnectInput(o.target_slot)}},LGraph.prototype.serialize=function(){for(var e=[],o=0,s=this._nodes.length;o<s;++o)e.push(this._nodes[o].serialize());var a=[];for(var o in this.links){var h=this.links[o];if(!h.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var d=new LLink;for(var c in h)d[c]=h[c];this.links[o]=d,h=d}a.push(h.serialize())}for(var g=[],o=0;o<this._groups.length;++o)g.push(this._groups[o].serialize());var b={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:e,links:a,groups:g,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(b),b},LGraph.prototype.configure=function(e,o){if(e){o||this.clear();var s=e.nodes;if(e.links&&e.links.constructor===Array){for(var a=[],h=0;h<e.links.length;++h){var d=e.links[h];if(!d){console.warn("serialized graph link data contains errors, skipping.");continue}var c=new LLink;c.configure(d),a[c.id]=c}e.links=a}for(var h in e)h=="nodes"||h=="groups"||(this[h]=e[h]);var g=!1;if(this._nodes=[],s){for(var h=0,b=s.length;h<b;++h){var $=s[h],et=LiteGraph.createNode($.type,$.title);et||(LiteGraph.debug&&console.log("Node not found or has errors: "+$.type),et=new LGraphNode,et.last_serialization=$,et.has_errors=!0,g=!0),et.id=$.id,this.add(et,!0)}for(var h=0,b=s.length;h<b;++h){var $=s[h],et=this.getNodeById($.id);et&&et.configure($)}}if(this._groups.length=0,e.groups)for(var h=0;h<e.groups.length;++h){var st=new LiteGraph.LGraphGroup;st.configure(e.groups[h]),this.add(st)}return this.updateExecutionOrder(),this.extra=e.extra||{},this.onConfigure&&this.onConfigure(e),this._version++,this.setDirtyCanvas(!0,!0),g}},LGraph.prototype.load=function(e,o){var s=this;if(e.constructor===File||e.constructor===Blob){var a=new FileReader;a.addEventListener("load",function(d){var c=JSON.parse(d.target.result);s.configure(c),o&&o()}),a.readAsText(e);return}var h=new XMLHttpRequest;h.open("GET",e,!0),h.send(null),h.onload=function(d){if(h.status!==200){console.error("Error loading graph:",h.status,h.response);return}var c=JSON.parse(h.response);s.configure(c),o&&o()},h.onerror=function(d){console.error("Error loading graph:",d)}},LGraph.prototype.onNodeTrace=function(e,o,s){};function LLink(e,o,s,a,h,d){this.id=e,this.type=o,this.origin_id=s,this.origin_slot=a,this.target_id=h,this.target_slot=d,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(e){e.constructor===Array?(this.id=e[0],this.origin_id=e[1],this.origin_slot=e[2],this.target_id=e[3],this.target_slot=e[4],this.type=e[5]):(this.id=e.id,this.type=e.type,this.origin_id=e.origin_id,this.origin_slot=e.origin_slot,this.target_id=e.target_id,this.target_slot=e.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(e){this._ctor(e)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(e){this.title=e||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(e){this.graph&&this.graph._version++;for(var o in e){if(o=="properties"){for(var s in e.properties)this.properties[s]=e.properties[s],this.onPropertyChanged&&this.onPropertyChanged(s,e.properties[s]);continue}e[o]!=null&&(typeof e[o]=="object"?this[o]&&this[o].configure?this[o].configure(e[o]):this[o]=LiteGraph.cloneObject(e[o],this[o]):this[o]=e[o])}if(e.title||(this.title=this.constructor.title),this.inputs)for(var a=0;a<this.inputs.length;++a){var h=this.inputs[a],d=this.graph?this.graph.links[h.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,a,!0,d,h),this.onInputAdded&&this.onInputAdded(h)}if(this.outputs)for(var a=0;a<this.outputs.length;++a){var c=this.outputs[a];if(c.links){for(var o=0;o<c.links.length;++o){var d=this.graph?this.graph.links[c.links[o]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,a,!0,d,c)}this.onOutputAdded&&this.onOutputAdded(c)}}if(this.widgets){for(var a=0;a<this.widgets.length;++a){var g=this.widgets[a];g&&g.options&&g.options.property&&this.properties[g.options.property]!=null&&(g.value=JSON.parse(JSON.stringify(this.properties[g.options.property])))}if(e.widgets_values)for(var a=0;a<e.widgets_values.length;++a)this.widgets[a]&&(this.widgets[a].value=e.widgets_values[a])}this.onConfigure&&this.onConfigure(e)},LGraphNode.prototype.serialize=function(){var e={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(e.inputs=this.inputs),this.outputs){for(var o=0;o<this.outputs.length;o++)delete this.outputs[o]._data;e.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(e.title=this.title),this.properties&&(e.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){e.widgets_values=[];for(var o=0;o<this.widgets.length;++o)this.widgets[o]?e.widgets_values[o]=this.widgets[o].value:e.widgets_values[o]=null}return e.type||(e.type=this.constructor.type),this.color&&(e.color=this.color),this.bgcolor&&(e.bgcolor=this.bgcolor),this.boxcolor&&(e.boxcolor=this.boxcolor),this.shape&&(e.shape=this.shape),this.onSerialize&&this.onSerialize(e)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),e},LGraphNode.prototype.clone=function(){var e=LiteGraph.createNode(this.type);if(!e)return null;var o=LiteGraph.cloneObject(this.serialize());if(o.inputs)for(var s=0;s<o.inputs.length;++s)o.inputs[s].link=null;if(o.outputs)for(var s=0;s<o.outputs.length;++s)o.outputs[s].links&&(o.outputs[s].links.length=0);return delete o.id,LiteGraph.use_uuids&&(o.id=LiteGraph.uuidv4()),e.configure(o),e},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(e,o){if(this.properties||(this.properties={}),o!==this.properties[e]){var s=this.properties[e];if(this.properties[e]=o,this.onPropertyChanged&&this.onPropertyChanged(e,o,s)===!1&&(this.properties[e]=s),this.widgets)for(var a=0;a<this.widgets.length;++a){var h=this.widgets[a];if(h&&h.options.property==e){h.value=o;break}}}},LGraphNode.prototype.setOutputData=function(e,o){if(this.outputs&&!(e==-1||e>=this.outputs.length)){var s=this.outputs[e];if(s&&(s._data=o,this.outputs[e].links))for(var a=0;a<this.outputs[e].links.length;a++){var h=this.outputs[e].links[a],d=this.graph.links[h];d&&(d.data=o)}}},LGraphNode.prototype.setOutputDataType=function(e,o){if(this.outputs&&!(e==-1||e>=this.outputs.length)){var s=this.outputs[e];if(s&&(s.type=o,this.outputs[e].links))for(var a=0;a<this.outputs[e].links.length;a++){var h=this.outputs[e].links[a];this.graph.links[h].type=o}}},LGraphNode.prototype.getInputData=function(e,o){if(this.inputs&&!(e>=this.inputs.length||this.inputs[e].link==null)){var s=this.inputs[e].link,a=this.graph.links[s];if(!a)return null;if(!o)return a.data;var h=this.graph.getNodeById(a.origin_id);return h&&(h.updateOutputData?h.updateOutputData(a.origin_slot):h.onExecute&&h.onExecute()),a.data}},LGraphNode.prototype.getInputDataType=function(e){if(!this.inputs||e>=this.inputs.length||this.inputs[e].link==null)return null;var o=this.inputs[e].link,s=this.graph.links[o];if(!s)return null;var a=this.graph.getNodeById(s.origin_id);if(!a)return s.type;var h=a.outputs[s.origin_slot];return h?h.type:null},LGraphNode.prototype.getInputDataByName=function(e,o){var s=this.findInputSlot(e);return s==-1?null:this.getInputData(s,o)},LGraphNode.prototype.isInputConnected=function(e){return this.inputs?e<this.inputs.length&&this.inputs[e].link!=null:!1},LGraphNode.prototype.getInputInfo=function(e){return this.inputs&&e<this.inputs.length?this.inputs[e]:null},LGraphNode.prototype.getInputLink=function(e){if(!this.inputs)return null;if(e<this.inputs.length){var o=this.inputs[e];return this.graph.links[o.link]}return null},LGraphNode.prototype.getInputNode=function(e){if(!this.inputs||e>=this.inputs.length)return null;var o=this.inputs[e];if(!o||o.link===null)return null;var s=this.graph.links[o.link];return s?this.graph.getNodeById(s.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(e){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[e]:null;for(var o=0,s=this.inputs.length;o<s;++o){var a=this.inputs[o];if(e==a.name&&a.link!=null){var h=this.graph.links[a.link];if(h)return h.data}}return this.properties[e]},LGraphNode.prototype.getOutputData=function(e){if(!this.outputs||e>=this.outputs.length)return null;var o=this.outputs[e];return o._data},LGraphNode.prototype.getOutputInfo=function(e){return this.outputs&&e<this.outputs.length?this.outputs[e]:null},LGraphNode.prototype.isOutputConnected=function(e){return this.outputs?e<this.outputs.length&&this.outputs[e].links&&this.outputs[e].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var e=0;e<this.outputs.length;++e)if(this.outputs[e].links&&this.outputs[e].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(e){if(!this.outputs||this.outputs.length==0||e>=this.outputs.length)return null;var o=this.outputs[e];if(!o.links||o.links.length==0)return null;for(var s=[],a=0;a<o.links.length;a++){var h=o.links[a],d=this.graph.links[h];if(d){var c=this.graph.getNodeById(d.target_id);c&&s.push(c)}}return s},LGraphNode.prototype.addOnTriggerInput=function(){var e=this.findInputSlot("onTrigger");if(e==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return e},LGraphNode.prototype.addOnExecutedOutput=function(){var e=this.findOutputSlot("onExecuted");if(e==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return e},LGraphNode.prototype.onAfterExecuteNode=function(e,o){var s=this.findOutputSlot("onExecuted");s!=-1&&this.triggerSlot(s,e,null,o)},LGraphNode.prototype.changeMode=function(e){switch(e){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=e,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var e=0;e<this._waiting_actions.length;++e){var o=this._waiting_actions[e];this.onAction(o[0],o[1],o[2],o[3],o[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(e,o){o=o||{},this.onExecute&&(o.action_call||(o.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(e,o),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,o&&o.action_call&&(this.action_call=o.action_call,this.graph.nodes_executedAction[this.id]=o.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(e,o)},LGraphNode.prototype.actionDo=function(e,o,s,a){s=s||{},this.onAction&&(s.action_call||(s.action_call=this.id+"_"+(e||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=e||"actioning",this.onAction(e,o,s,a),this.graph.nodes_actioning[this.id]=!1,s&&s.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(o,s)},LGraphNode.prototype.trigger=function(e,o,s){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var a=0;a<this.outputs.length;++a){var h=this.outputs[a];!h||h.type!==LiteGraph.EVENT||e&&h.name!=e||this.triggerSlot(a,o,null,s)}}},LGraphNode.prototype.triggerSlot=function(e,o,s,a){if(a=a||{},!!this.outputs){if(e==null){console.error("slot must be a number");return}e.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var h=this.outputs[e];if(h){var d=h.links;if(!(!d||!d.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var c=0;c<d.length;++c){var g=d[c];if(!(s!=null&&s!=g)){var b=this.graph.links[d[c]];if(b){b._last_time=LiteGraph.getTime();var $=this.graph.getNodeById(b.target_id);if($){var et=$.inputs[b.target_slot];if($.mode===LiteGraph.ON_TRIGGER)a.action_call||(a.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),$.onExecute&&$.doExecute(o,a);else if($.onAction){a.action_call||(a.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var et=$.inputs[b.target_slot];LiteGraph.use_deferred_actions&&$.onExecute?($._waiting_actions||($._waiting_actions=[]),$._waiting_actions.push([et.name,o,a,b.target_slot])):$.actionDo(et.name,o,a,b.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(e,o){if(this.outputs){var s=this.outputs[e];if(s){var a=s.links;if(!(!a||!a.length))for(var h=0;h<a.length;++h){var d=a[h];if(!(o!=null&&o!=d)){var c=this.graph.links[a[h]];c&&(c._last_time=0)}}}}},LGraphNode.prototype.setSize=function(e){this.size=e,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(e,o,s,a){var h={name:e,type:s,default_value:o};if(a)for(var d in a)h[d]=a[d];return this.properties_info||(this.properties_info=[]),this.properties_info.push(h),this.properties||(this.properties={}),this.properties[e]=o,h},LGraphNode.prototype.addOutput=function(e,o,s){var a={name:e,type:o,links:null};if(s)for(var h in s)a[h]=s[h];return this.outputs||(this.outputs=[]),this.outputs.push(a),this.onOutputAdded&&this.onOutputAdded(a),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,o,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),a},LGraphNode.prototype.addOutputs=function(e){for(var o=0;o<e.length;++o){var s=e[o],a={name:s[0],type:s[1],link:null};if(e[2])for(var h in s[2])a[h]=s[2][h];this.outputs||(this.outputs=[]),this.outputs.push(a),this.onOutputAdded&&this.onOutputAdded(a),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,s[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(e){this.disconnectOutput(e),this.outputs.splice(e,1);for(var o=e;o<this.outputs.length;++o)if(!(!this.outputs[o]||!this.outputs[o].links))for(var s=this.outputs[o].links,a=0;a<s.length;++a){var h=this.graph.links[s[a]];h&&(h.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(e),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(e,o,s){o=o||0;var a={name:e,type:o,link:null};if(s)for(var h in s)a[h]=s[h];return this.inputs||(this.inputs=[]),this.inputs.push(a),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(a),LiteGraph.registerNodeAndSlotType(this,o),this.setDirtyCanvas(!0,!0),a},LGraphNode.prototype.addInputs=function(e){for(var o=0;o<e.length;++o){var s=e[o],a={name:s[0],type:s[1],link:null};if(e[2])for(var h in s[2])a[h]=s[2][h];this.inputs||(this.inputs=[]),this.inputs.push(a),this.onInputAdded&&this.onInputAdded(a),LiteGraph.registerNodeAndSlotType(this,s[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(e){this.disconnectInput(e);for(var o=this.inputs.splice(e,1),s=e;s<this.inputs.length;++s)if(this.inputs[s]){var a=this.graph.links[this.inputs[s].link];a&&(a.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(e,o[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(e,o,s,a){var h={name:e,type:o,pos:s,direction:a,links:null};return this.connections.push(h),h},LGraphNode.prototype.computeSize=function(e){if(this.constructor.size)return this.constructor.size.concat();var o=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),s=e||new Float32Array([0,0]);o=Math.max(o,1);var a=LiteGraph.NODE_TEXT_SIZE,h=nt(this.title),d=0,c=0;if(this.inputs)for(var g=0,b=this.inputs.length;g<b;++g){var $=this.inputs[g],et=$.label||$.name||"",st=nt(et);d<st&&(d=st)}if(this.outputs)for(var g=0,b=this.outputs.length;g<b;++g){var j=this.outputs[g],et=j.label||j.name||"",st=nt(et);c<st&&(c=st)}s[0]=Math.max(d+c+10,h),s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH*1.5)),s[1]=(this.constructor.slot_start_y||0)+o*LiteGraph.NODE_SLOT_HEIGHT;var tt=0;if(this.widgets&&this.widgets.length){for(var g=0,b=this.widgets.length;g<b;++g)this.widgets[g].computeSize?tt+=this.widgets[g].computeSize(s[0])[1]+4:tt+=LiteGraph.NODE_WIDGET_HEIGHT+4;tt+=8}this.widgets_up?s[1]=Math.max(s[1],tt):this.widgets_start_y!=null?s[1]=Math.max(s[1],tt+this.widgets_start_y):s[1]+=tt;function nt(lt){return lt?a*lt.length*.6:0}return this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s},LGraphNode.prototype.getPropertyInfo=function(e){var o=null;if(this.properties_info){for(var s=0;s<this.properties_info.length;++s)if(this.properties_info[s].name==e){o=this.properties_info[s];break}}return this.constructor["@"+e]&&(o=this.constructor["@"+e]),this.constructor.widgets_info&&this.constructor.widgets_info[e]&&(o=this.constructor.widgets_info[e]),!o&&this.onGetPropertyInfo&&(o=this.onGetPropertyInfo(e)),o||(o={}),o.type||(o.type=typeof this.properties[e]),o.widget=="combo"&&(o.type="enum"),o},LGraphNode.prototype.addWidget=function(e,o,s,a,h){this.widgets||(this.widgets=[]),!h&&a&&a.constructor===Object&&(h=a,a=null),h&&h.constructor===String&&(h={property:h}),a&&a.constructor===String&&(h||(h={}),h.property=a,a=null),a&&a.constructor!==Function&&(console.warn("addWidget: callback must be a function"),a=null);var d={type:e.toLowerCase(),name:o,value:s,callback:a,options:h||{}};if(d.options.y!==void 0&&(d.y=d.options.y),!a&&!d.options.callback&&!d.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),e=="combo"&&!d.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(d),this.setSize(this.computeSize()),d},LGraphNode.prototype.addCustomWidget=function(e){return this.widgets||(this.widgets=[]),this.widgets.push(e),e},LGraphNode.prototype.getBounding=function(e,o){e=e||new Float32Array(4);const s=this.pos,a=this.flags.collapsed,h=this.size;let d=0,c=1,g=0,b=0;return o&&(d=4,c=6+d,g=4,b=5+g),e[0]=s[0]-d,e[1]=s[1]-LiteGraph.NODE_TITLE_HEIGHT-g,e[2]=a?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+c:h[0]+c,e[3]=a?LiteGraph.NODE_TITLE_HEIGHT+b:h[1]+LiteGraph.NODE_TITLE_HEIGHT+b,this.onBounding&&this.onBounding(e),e},LGraphNode.prototype.isPointInside=function(e,o,s,a){s=s||0;var h=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(a&&(h=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(e,o,this.pos[0]-s,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-s,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*s,LiteGraph.NODE_TITLE_HEIGHT+2*s))return!0}else if(this.pos[0]-4-s<e&&this.pos[0]+this.size[0]+4+s>e&&this.pos[1]-h-s<o&&this.pos[1]+this.size[1]+s>o)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(e,o){var s=new Float32Array(2);if(this.inputs)for(var a=0,h=this.inputs.length;a<h;++a){var d=this.inputs[a];if(this.getConnectionPos(!0,a,s),isInsideRectangle(e,o,s[0]-10,s[1]-5,20,10))return{input:d,slot:a,link_pos:s}}if(this.outputs)for(var a=0,h=this.outputs.length;a<h;++a){var c=this.outputs[a];if(this.getConnectionPos(!1,a,s),isInsideRectangle(e,o,s[0]-10,s[1]-5,20,10))return{output:c,slot:a,link_pos:s}}return null},LGraphNode.prototype.findInputSlot=function(e,o){if(!this.inputs)return-1;for(var s=0,a=this.inputs.length;s<a;++s)if(e==this.inputs[s].name)return o?this.inputs[s]:s;return-1},LGraphNode.prototype.findOutputSlot=function(e,o){if(o=o||!1,!this.outputs)return-1;for(var s=0,a=this.outputs.length;s<a;++s)if(e==this.outputs[s].name)return o?this.outputs[s]:s;return-1},LGraphNode.prototype.findInputSlotFree=function(o){var o=o||{},s={returnObj:!1,typesNotAccepted:[]},a=Object.assign(s,o);if(!this.inputs)return-1;for(var h=0,d=this.inputs.length;h<d;++h)if(!(this.inputs[h].link&&this.inputs[h].link!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.inputs[h].type)))return a.returnObj?this.inputs[h]:h;return-1},LGraphNode.prototype.findOutputSlotFree=function(o){var o=o||{},s={returnObj:!1,typesNotAccepted:[]},a=Object.assign(s,o);if(!this.outputs)return-1;for(var h=0,d=this.outputs.length;h<d;++h)if(!(this.outputs[h].links&&this.outputs[h].links!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.outputs[h].type)))return a.returnObj?this.outputs[h]:h;return-1},LGraphNode.prototype.findInputSlotByType=function(e,o,s,a){return this.findSlotByType(!0,e,o,s,a)},LGraphNode.prototype.findOutputSlotByType=function(e,o,s,a){return this.findSlotByType(!1,e,o,s,a)},LGraphNode.prototype.findSlotByType=function(e,o,s,a,h){e=e||!1,s=s||!1,a=a||!1,h=h||!1;var d=e?this.inputs:this.outputs;if(!d)return-1;(o==""||o=="*")&&(o=0);for(var c=0,g=d.length;c<g;++c){var b=(o+"").toLowerCase().split(","),$=d[c].type=="0"||d[c].type=="*"?"0":d[c].type;$=($+"").toLowerCase().split(",");for(var et=0;et<b.length;et++)for(var st=0;st<$.length;st++)if(b[et]=="_event_"&&(b[et]=LiteGraph.EVENT),$[et]=="_event_"&&($[et]=LiteGraph.EVENT),b[et]=="*"&&(b[et]=0),$[et]=="*"&&($[et]=0),b[et]==$[st]){if(a&&d[c].links&&d[c].links!==null)continue;return s?d[c]:c}}if(a&&!h)for(var c=0,g=d.length;c<g;++c){var b=(o+"").toLowerCase().split(","),$=d[c].type=="0"||d[c].type=="*"?"0":d[c].type;$=($+"").toLowerCase().split(",");for(var et=0;et<b.length;et++)for(var st=0;st<$.length;st++)if(b[et]=="*"&&(b[et]=0),$[et]=="*"&&($[et]=0),b[et]==$[st])return s?d[c]:c}return-1},LGraphNode.prototype.connectByType=function(e,o,s,h){var h=h||{},d={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},c=Object.assign(d,h);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var g=o.findInputSlotByType(s,!1,!0);if(g>=0&&g!==null)return this.connect(e,o,g);if(c.createEventInCase&&s==LiteGraph.EVENT)return this.connect(e,o,-1);if(c.generalTypeInCase){var g=o.findInputSlotByType(0,!1,!0,!0);if(g>=0)return this.connect(e,o,g)}if(c.firstFreeIfOutputGeneralInCase&&(s==0||s=="*"||s=="")){var g=o.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(g>=0)return this.connect(e,o,g)}return console.debug("no way to connect type: ",s," to targetNODE ",o),null},LGraphNode.prototype.connectByTypeOutput=function(e,o,s,h){var h=h||{},d={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},c=Object.assign(d,h);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var g=o.findOutputSlotByType(s,!1,!0);if(g>=0&&g!==null)return o.connect(g,this,e);if(c.generalTypeInCase){var g=o.findOutputSlotByType(0,!1,!0,!0);if(g>=0)return o.connect(g,this,e)}if(c.createEventInCase&&s==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var g=o.addOnExecutedOutput();return o.connect(g,this,e)}if(c.firstFreeIfInputGeneralInCase&&(s==0||s=="*"||s=="")){var g=o.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(g>=0)return o.connect(g,this,e)}return console.debug("no way to connect byOUT type: ",s," to sourceNODE ",o),null},LGraphNode.prototype.connect=function(e,o,s){if(s=s||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(e.constructor===String){if(e=this.findOutputSlot(e),e==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+e),null}else if(!this.outputs||e>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(o&&o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw"target node is null";if(o==this)return null;if(s.constructor===String){if(s=o.findInputSlot(s),s==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+s),null}else if(s===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)o.changeMode(LiteGraph.ON_TRIGGER),s=o.findInputSlot("onTrigger");else return null;else if(!o.inputs||s>=o.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var a=!1,h=o.inputs[s],d=null,c=this.outputs[e];if(!this.outputs[e])return null;if(o.onBeforeConnectInput&&(s=o.onBeforeConnectInput(s)),s===!1||s===null||!LiteGraph.isValidConnection(c.type,h.type))return this.setDirtyCanvas(!1,!0),a&&this.graph.connectionChange(this,d),null;if(o.onConnectInput&&o.onConnectInput(s,c.type,c,this,e)===!1||this.onConnectOutput&&this.onConnectOutput(e,h.type,h,o,s)===!1)return null;if(o.inputs[s]&&o.inputs[s].link!=null&&(this.graph.beforeChange(),o.disconnectInput(s,{doProcessChange:!1}),a=!0),c.links!==null&&c.links.length)switch(c.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(e,!1,{doProcessChange:!1}),a=!0);break}var g;return LiteGraph.use_uuids?g=LiteGraph.uuidv4():g=++this.graph.last_link_id,d=new LLink(g,h.type||c.type,this.id,e,o.id,s),this.graph.links[d.id]=d,c.links==null&&(c.links=[]),c.links.push(d.id),o.inputs[s].link=d.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,e,!0,d,c),o.onConnectionsChange&&o.onConnectionsChange(LiteGraph.INPUT,s,!0,d,h),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,o,s,this,e),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,e,o,s)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,d),d},LGraphNode.prototype.disconnectOutput=function(e,o){if(e.constructor===String){if(e=this.findOutputSlot(e),e==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+e),!1}else if(!this.outputs||e>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var s=this.outputs[e];if(!s||!s.links||s.links.length==0)return!1;if(o){if(o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw"Target Node not found";for(var a=0,h=s.links.length;a<h;a++){var d=s.links[a],c=this.graph.links[d];if(c.target_id==o.id){s.links.splice(a,1);var g=o.inputs[c.target_slot];g.link=null,delete this.graph.links[d],this.graph&&this.graph._version++,o.onConnectionsChange&&o.onConnectionsChange(LiteGraph.INPUT,c.target_slot,!1,c,g),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,e,!1,c,s),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,e),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,e),this.graph.onNodeConnectionChange(LiteGraph.INPUT,o,c.target_slot));break}}}else{for(var a=0,h=s.links.length;a<h;a++){var d=s.links[a],c=this.graph.links[d];if(c){var o=this.graph.getNodeById(c.target_id),g=null;this.graph&&this.graph._version++,o&&(g=o.inputs[c.target_slot],g.link=null,o.onConnectionsChange&&o.onConnectionsChange(LiteGraph.INPUT,c.target_slot,!1,c,g),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,o,c.target_slot)),delete this.graph.links[d],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,e,!1,c,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,e),this.graph.onNodeConnectionChange(LiteGraph.INPUT,o,c.target_slot))}}s.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(e){if(e.constructor===String){if(e=this.findInputSlot(e),e==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+e),!1}else if(!this.inputs||e>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var o=this.inputs[e];if(!o)return!1;var s=this.inputs[e].link;if(s!=null){this.inputs[e].link=null;var a=this.graph.links[s];if(a){var h=this.graph.getNodeById(a.origin_id);if(!h)return!1;var d=h.outputs[a.origin_slot];if(!d||!d.links||d.links.length==0)return!1;for(var c=0,g=d.links.length;c<g;c++)if(d.links[c]==s){d.links.splice(c,1);break}delete this.graph.links[s],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,e,!1,a,o),h.onConnectionsChange&&h.onConnectionsChange(LiteGraph.OUTPUT,c,!1,a,d),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,h,c),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,e))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(e,o,s){s=s||new Float32Array(2);var a=0;e&&this.inputs&&(a=this.inputs.length),!e&&this.outputs&&(a=this.outputs.length);var h=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var d=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(s[0]=this.pos[0]+d*.5,e?s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:s[1]=this.pos[1]):(e?s[0]=this.pos[0]:s[0]=this.pos[0]+d,s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),s}return e&&o==-1?(s[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,s[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,s):e&&a>o&&this.inputs[o].pos?(s[0]=this.pos[0]+this.inputs[o].pos[0],s[1]=this.pos[1]+this.inputs[o].pos[1],s):!e&&a>o&&this.outputs[o].pos?(s[0]=this.pos[0]+this.outputs[o].pos[0],s[1]=this.pos[1]+this.outputs[o].pos[1],s):this.horizontal?(s[0]=this.pos[0]+(o+.5)*(this.size[0]/a),e?s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:s[1]=this.pos[1]+this.size[1],s):(e?s[0]=this.pos[0]+h:s[0]=this.pos[0]+this.size[0]+1-h,s[1]=this.pos[1]+(o+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),s)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(e){this.console||(this.console=[]),this.console.push(e),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,e)},LGraphNode.prototype.setDirtyCanvas=function(e,o){this.graph&&this.graph.sendActionToCanvas("setDirty",[e,o])},LGraphNode.prototype.loadImage=function(e){var o=new Image;o.src=LiteGraph.node_images_path+e,o.ready=!1;var s=this;return o.onload=function(){this.ready=!0,s.setDirtyCanvas(!0)},o},LGraphNode.prototype.captureInput=function(e){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var o=this.graph.list_of_graphcanvas,s=0;s<o.length;++s){var a=o[s];!e&&a.node_capturing_input!=this||(a.node_capturing_input=e?this:null)}},LGraphNode.prototype.collapse=function(e){this.graph._version++,!(this.constructor.collapsable===!1&&!e)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(e){this.graph._version++,e===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=e},LGraphNode.prototype.localToScreen=function(e,o,s){return[(e+this.pos[0])*s.scale+s.offset[0],(o+this.pos[1])*s.scale+s.offset[1]]};function LGraphGroup(e){this._ctor(e)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(e){this.title=e||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(o){!o||o.length<2||(this._size[0]=Math.max(140,o[0]),this._size[1]=Math.max(80,o[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(e){this.title=e.title,this._bounding.set(e.bounding),this.color=e.color,this.font_size=e.font_size},LGraphGroup.prototype.serialize=function(){var e=this._bounding;return{title:this.title,bounding:[Math.round(e[0]),Math.round(e[1]),Math.round(e[2]),Math.round(e[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(e,o,s){if(this._pos[0]+=e,this._pos[1]+=o,!s)for(var a=0;a<this._nodes.length;++a){var h=this._nodes[a];h.pos[0]+=e,h.pos[1]+=o}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var e=this.graph._nodes,o=new Float32Array(4),s=0;s<e.length;++s){var a=e[s];a.getBounding(o),overlapBounding(this._bounding,o)&&this._nodes.push(a)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(e,o){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),e&&(this.element=e,o||this.bindEvents(e))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(e){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(e,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"up",this._binded_mouse_callback),e.addEventListener("mousewheel",this._binded_mouse_callback,!1),e.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(e){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var o=this.element.width,s=this.element.height,a=-this.offset[0],h=-this.offset[1];e&&(a+=e[0]/this.scale,h+=e[1]/this.scale,o=e[2],s=e[3]);var d=a+o/this.scale,c=h+s/this.scale;this.visible_area[0]=a,this.visible_area[1]=h,this.visible_area[2]=d-a,this.visible_area[3]=c-h},DragAndScale.prototype.onMouse=function(e){if(this.enabled){var o=this.element,s=o.getBoundingClientRect(),a=e.clientX-s.left,h=e.clientY-s.top;e.canvasx=a,e.canvasy=h,e.dragging=this.dragging;var d=!this.viewport||this.viewport&&a>=this.viewport[0]&&a<this.viewport[0]+this.viewport[2]&&h>=this.viewport[1]&&h<this.viewport[1]+this.viewport[3],c=!1;if(this.onmouse&&(c=this.onmouse(e)),e.type==LiteGraph.pointerevents_method+"down"&&d)this.dragging=!0,LiteGraph.pointerListenerRemove(o,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(e.type==LiteGraph.pointerevents_method+"move"){if(!c){var g=a-this.last_mouse[0],b=h-this.last_mouse[1];this.dragging&&this.mouseDrag(g,b)}}else e.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(o,"move",this._binded_mouse_callback)):d&&(e.type=="mousewheel"||e.type=="wheel"||e.type=="DOMMouseScroll")&&(e.eventType="mousewheel",e.type=="wheel"?e.wheel=-e.deltaY:e.wheel=e.wheelDeltaY!=null?e.wheelDeltaY:e.detail*-60,e.delta=e.wheelDelta?e.wheelDelta/40:e.deltaY?-e.deltaY/3:0,this.changeDeltaScale(1+e.delta*.05));if(this.last_mouse[0]=a,this.last_mouse[1]=h,d)return e.preventDefault(),e.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(e){e.scale(this.scale,this.scale),e.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(e){return[(e[0]+this.offset[0])*this.scale,(e[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(e,o){return o=o||[0,0],o[0]=e[0]/this.scale-this.offset[0],o[1]=e[1]/this.scale-this.offset[1],o},DragAndScale.prototype.mouseDrag=function(e,o){this.offset[0]+=e/this.scale,this.offset[1]+=o/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(e,o){if(e<this.min_scale?e=this.min_scale:e>this.max_scale&&(e=this.max_scale),e!=this.scale&&this.element){var s=this.element.getBoundingClientRect();if(s){o=o||[s.width*.5,s.height*.5];var a=this.convertCanvasToOffset(o);this.scale=e,Math.abs(this.scale-1)<.01&&(this.scale=1);var h=this.convertCanvasToOffset(o),d=[h[0]-a[0],h[1]-a[1]];this.offset[0]+=d[0],this.offset[1]+=d[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(e,o){this.changeScale(this.scale*e,o)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(e,o,s){this.options=s=s||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,e&&e.constructor===String&&(e=document.querySelector(e)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=s.viewport||null,o&&o.attachCanvas(this),this.setCanvas(e,s.skip_events),this.clear(),s.skip_render||this.startRendering(),this.autoresize=s.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(e,o){if(this.graph!=e){if(o||this.clear(),!e&&this.graph){this.graph.detachCanvas(this);return}e.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(e){if(!e)throw"graph cannot be null";if(this.graph==e)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),e.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var e=this.graph._subgraph_node,o=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},o.attachCanvas(this),this.setDirty(!0,!0),e&&(this.centerOnNode(e),this.selectNodes([e])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(e,o){if(e&&e.constructor===String&&(e=document.getElementById(e),!e))throw"Error creating LiteGraph canvas: Canvas not found";if(e!==this.canvas&&(!e&&this.canvas&&(o||this.unbindEvents()),this.canvas=e,this.ds.element=e,!!e)){if(e.className+=" lgraphcanvas",e.data=this,e.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),e.getContext==null)throw e.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+e.localName:"This browser doesn't support Canvas";var s=this.ctx=e.getContext("2d");s==null&&(e.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),o||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(o){return o.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(o){return o.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var e=this.canvas,o=this.getCanvasWindow(),s=o.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(e,"down",this._mousedown_callback,!0),e.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(e,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(e,"move",this._mousemove_callback),e.addEventListener("contextmenu",this._doNothing),e.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),e.setAttribute("tabindex",1),e.addEventListener("keydown",this._key_callback,!0),s.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),e.addEventListener("dragover",this._doNothing,!1),e.addEventListener("dragend",this._doNothing,!1),e.addEventListener("drop",this._ondrop_callback,!1),e.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var e=this.getCanvasWindow(),o=e.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),o.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(e){var o=e.indexOf("?");o!=-1&&(e=e.substr(0,o));var s=e.lastIndexOf(".");return s==-1?"":e.substr(s+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(e,o){e&&(this.dirty_canvas=!0),o&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var e=this.canvas.ownerDocument;return e.defaultView||e.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,e.call(this);function e(){this.pause_rendering||this.draw();var o=this.getCanvasWindow();this.is_rendering&&o.requestAnimationFrame(e.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(e){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(e);var o=this.getCanvasWindow();o.document,LGraphCanvas.active_canvas=this;var s=this,a=e.clientX,h=e.clientY;this.ds.viewport=this.viewport;var d=!this.viewport||this.viewport&&a>=this.viewport[0]&&a<this.viewport[0]+this.viewport[2]&&h>=this.viewport[1]&&h<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(o.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(o.document,"up",this._mouseup_callback,!0)),!!d){var c=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes,5),g=!1,b=LiteGraph.getTime(),$=e.isPrimary===void 0||!e.isPrimary,et=b-this.last_mouseclick<300&&$;if(this.mouse[0]=e.clientX,this.mouse[1]=e.clientY,this.graph_mouse[0]=e.canvasX,this.graph_mouse[1]=e.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&$?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(o),!(this.onMouse&&this.onMouse(e)==!0)){if(e.which==1&&!this.pointer_is_double){e.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=e.canvasX,this.dragging_rectangle[1]=e.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,g=!0),LiteGraph.alt_drag_do_clone_nodes&&e.altKey&&c&&this.allow_interaction&&!g&&!this.read_only&&(cloned=c.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),c=cloned,g=!0,_e||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=c),this.selected_nodes[c.id]||this.processNodeSelected(c,e)));var st=!1;if(c&&(this.allow_interaction||c.flags.allow_interaction)&&!g&&!this.read_only){if(!this.live_mode&&!c.flags.pinned&&this.bringToFront(c),this.allow_interaction&&!this.connecting_node&&!c.flags.collapsed&&!this.live_mode)if(!g&&c.resizable!==!1&&isInsideRectangle(e.canvasX,e.canvasY,c.pos[0]+c.size[0]-5,c.pos[1]+c.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=c,this.canvas.style.cursor="se-resize",g=!0;else{if(c.outputs)for(var j=0,tt=c.outputs.length;j<tt;++j){var nt=c.outputs[j],lt=c.getConnectionPos(!1,j);if(isInsideRectangle(e.canvasX,e.canvasY,lt[0]-15,lt[1]-10,30,20)){this.connecting_node=c,this.connecting_output=nt,this.connecting_output.slot_index=j,this.connecting_pos=c.getConnectionPos(!1,j),this.connecting_slot=j,LiteGraph.shift_click_do_break_link_from&&e.shiftKey&&c.disconnectOutput(j),et?c.onOutputDblClick&&c.onOutputDblClick(j,e):c.onOutputClick&&c.onOutputClick(j,e),g=!0;break}}if(c.inputs)for(var j=0,tt=c.inputs.length;j<tt;++j){var ct=c.inputs[j],lt=c.getConnectionPos(!0,j);if(isInsideRectangle(e.canvasX,e.canvasY,lt[0]-15,lt[1]-10,30,20)){if(et?c.onInputDblClick&&c.onInputDblClick(j,e):c.onInputClick&&c.onInputClick(j,e),ct.link!==null){var ot=this.graph.links[ct.link];LiteGraph.click_do_break_link_to&&(c.disconnectInput(j),this.dirty_bgcanvas=!0,g=!0),(this.allow_reconnect_links||e.shiftKey)&&(LiteGraph.click_do_break_link_to||c.disconnectInput(j),this.connecting_node=this.graph._nodes_by_id[ot.origin_id],this.connecting_slot=ot.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,g=!0)}g||(this.connecting_node=c,this.connecting_input=ct,this.connecting_input.slot_index=j,this.connecting_pos=c.getConnectionPos(!0,j),this.connecting_slot=j,this.dirty_bgcanvas=!0,g=!0)}}}if(!g){var _e=!1,_=[e.canvasX-c.pos[0],e.canvasY-c.pos[1]],at=this.processNodeWidgets(c,this.graph_mouse,e);if(at&&(_e=!0,this.node_widget=[c,at]),this.allow_interaction&&et&&this.selected_nodes[c.id]&&(c.onDblClick&&c.onDblClick(e,_,this),this.processNodeDblClicked(c),_e=!0),c.onMouseDown&&c.onMouseDown(e,_,this))_e=!0;else{if(c.subgraph&&!c.skip_subgraph_button&&!c.flags.collapsed&&_[0]>c.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&_[1]<0){var s=this;setTimeout(function(){s.openSubgraph(c.subgraph)},10)}this.live_mode&&(st=!0,_e=!0)}_e?c.is_selected||this.processNodeSelected(c,e):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=c),this.processNodeSelected(c,e)),this.dirty_canvas=!0}}else if(!g){if(!this.read_only)for(var j=0;j<this.visible_links.length;++j){var it=this.visible_links[j],pt=it._pos;if(!(!pt||e.canvasX<pt[0]-4||e.canvasX>pt[0]+4||e.canvasY<pt[1]-4||e.canvasY>pt[1]+4)){this.showLinkMenu(it,e),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(e.canvasX,e.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){e.ctrlKey&&(this.dragging_rectangle=null);var mt=distance([e.canvasX,e.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);mt*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}et&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(e),e.preventDefault(),e.stopPropagation()),st=!0}!g&&st&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(e.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(c&&this.allow_interaction&&!g&&!this.read_only&&!this.connecting_node&&!c.flags.collapsed&&!this.live_mode){var _t=!1,Et=!1,Tt=!1;if(c.outputs)for(var j=0,tt=c.outputs.length;j<tt;++j){var nt=c.outputs[j],lt=c.getConnectionPos(!1,j);if(isInsideRectangle(e.canvasX,e.canvasY,lt[0]-15,lt[1]-10,30,20)){_t=nt,Et=j,Tt=!0;break}}if(c.inputs)for(var j=0,tt=c.inputs.length;j<tt;++j){var ct=c.inputs[j],lt=c.getConnectionPos(!0,j);if(isInsideRectangle(e.canvasX,e.canvasY,lt[0]-15,lt[1]-10,30,20)){_t=ct,Et=j,Tt=!1;break}}if(_t&&Et!==!1){var Ot=.5-(Et+1)/(Tt?c.outputs.length:c.inputs.length),Ct=c.getBounding(),St=[Tt?Ct[0]+Ct[2]:Ct[0],e.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:Tt?c:null,slotFrom:Tt?Et:null,nodeTo:Tt?null:c,slotTo:Tt?null:Et,position:St,nodeType:"AUTO",posAdd:[Tt?30:-30,-Ot*130],posSizeFix:[Tt?0:-1,0]})}}}else!g&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(e.which==3||this.pointer_is_double)&&this.allow_interaction&&!g&&!this.read_only&&(c&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[c.id]||e.shiftKey||e.ctrlKey||e.metaKey)?this.selected_nodes[c.id]||this.selectNodes([c],!0):this.selectNodes([c])),this.processContextMenu(c,e));return this.last_mouse[0]=e.clientX,this.last_mouse[1]=e.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!o.document.activeElement||o.document.activeElement.nodeName.toLowerCase()!="input"&&o.document.activeElement.nodeName.toLowerCase()!="textarea")&&e.preventDefault(),e.stopPropagation(),this.onMouseDown&&this.onMouseDown(e),!1}}}},LGraphCanvas.prototype.processMouseMove=function(e){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(e);var o=[e.clientX,e.clientY];this.mouse[0]=o[0],this.mouse[1]=o[1];var s=[o[0]-this.last_mouse[0],o[1]-this.last_mouse[1]];if(this.last_mouse=o,this.graph_mouse[0]=e.canvasX,this.graph_mouse[1]=e.canvasY,this.block_click)return e.preventDefault(),!1;e.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e,this.node_widget[1]),this.dirty_canvas=!0);var a=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=e.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=e.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[e.canvasX-this.selected_group.pos[0],e.canvasY-this.selected_group.pos[1]];else{var h=s[0]/this.ds.scale,d=s[1]/this.ds.scale;this.selected_group.move(h,d,e.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=s[0]/this.ds.scale,this.ds.offset[1]+=s[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||a&&a.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var c=0,g=this.graph._nodes.length;c<g;++c)this.graph._nodes[c].mouseOver&&a!=this.graph._nodes[c]&&(this.graph._nodes[c].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(e),this.node_over=null,this.dirty_canvas=!0);if(a){if(a.redraw_on_mouse&&(this.dirty_canvas=!0),a.mouseOver||(a.mouseOver=!0,this.node_over=a,this.dirty_canvas=!0,a.onMouseEnter&&a.onMouseEnter(e)),a.onMouseMove&&a.onMouseMove(e,[e.canvasX-a.pos[0],e.canvasY-a.pos[1]],this),this.connecting_node){if(this.connecting_output){var b=this._highlight_input||[0,0];if(!this.isOverNodeBox(a,e.canvasX,e.canvasY)){var $=this.isOverNodeInput(a,e.canvasX,e.canvasY,b);if($!=-1&&a.inputs[$]){var et=a.inputs[$].type;LiteGraph.isValidConnection(this.connecting_output.type,et)&&(this._highlight_input=b,this._highlight_input_slot=a.inputs[$])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var b=this._highlight_output||[0,0];if(!this.isOverNodeBox(a,e.canvasX,e.canvasY)){var $=this.isOverNodeOutput(a,e.canvasX,e.canvasY,b);if($!=-1&&a.outputs[$]){var et=a.outputs[$].type;LiteGraph.isValidConnection(this.connecting_input.type,et)&&(this._highlight_output=b)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(e.canvasX,e.canvasY,a.pos[0]+a.size[0]-5,a.pos[1]+a.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var st=null,c=0;c<this.visible_links.length;++c){var j=this.visible_links[c],tt=j._pos;if(!(!tt||e.canvasX<tt[0]-4||e.canvasX>tt[0]+4||e.canvasY<tt[1]-4||e.canvasY>tt[1]+4)){st=j;break}}st!=this.over_link_center&&(this.over_link_center=st,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=a&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var c in this.selected_nodes){var nt=this.selected_nodes[c];nt.pos[0]+=s[0]/this.ds.scale,nt.pos[1]+=s[1]/this.ds.scale,nt.is_selected||this.processNodeSelected(nt,e)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var lt=[e.canvasX-this.resizing_node.pos[0],e.canvasY-this.resizing_node.pos[1]],ct=this.resizing_node.computeSize();lt[0]=Math.max(ct[0],lt[0]),lt[1]=Math.max(ct[1],lt[1]),this.resizing_node.setSize(lt),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return e.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(e){var o=e.isPrimary===void 0||e.isPrimary;if(!o)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var s=this.getCanvasWindow(),a=s.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(a,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(a,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(e);var h=LiteGraph.getTime();if(e.click_time=h-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),e.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e),this.node_widget=null,this.selected_group){var d=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),c=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(d,c,e.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var g=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var b=this.graph._nodes,$=new Float32Array(4),et=Math.abs(this.dragging_rectangle[2]),st=Math.abs(this.dragging_rectangle[3]),j=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-et:this.dragging_rectangle[0],tt=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-st:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=j,this.dragging_rectangle[1]=tt,this.dragging_rectangle[2]=et,this.dragging_rectangle[3]=st,!g||et>10&&st>10){for(var nt=[],lt=0;lt<b.length;++lt){var ct=b[lt];ct.getBounding($),overlapBounding(this.dragging_rectangle,$)&&nt.push(ct)}nt.length&&this.selectNodes(nt,e.shiftKey)}else this.selectNodes([g],e.shiftKey||e.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var ot=this.connecting_output||this.connecting_input,_e=ot.type;if(g){if(this.connecting_output){var _=this.isOverNodeInput(g,e.canvasX,e.canvasY);_!=-1?this.connecting_node.connect(this.connecting_slot,g,_):this.connecting_node.connectByType(this.connecting_slot,g,_e)}else if(this.connecting_input){var _=this.isOverNodeOutput(g,e.canvasX,e.canvasY);_!=-1?g.connect(_,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,g,_e)}}else LiteGraph.release_link_on_empty_shows_menu&&(e.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(e,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(e,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var g=this.node_dragged;g&&e.click_time<300&&isInsideRectangle(e.canvasX,e.canvasY,g.pos[0],g.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&g.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var g=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);!g&&e.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(e,[e.canvasX-this.node_over.pos[0],e.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]])}}else e.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):e.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return o&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),e.stopPropagation(),e.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(e){if(!(!this.graph||!this.allow_dragcanvas)){var o=e.wheelDeltaY!=null?e.wheelDeltaY:e.detail*-60;this.adjustMouseEvent(e);var s=e.clientX,a=e.clientY,h=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&a>=this.viewport[1]&&a<this.viewport[1]+this.viewport[3];if(h){var d=this.ds.scale;return o>0?d*=1.1:o<0&&(d*=1/1.1),this.ds.changeScale(d,[e.clientX,e.clientY]),this.graph.change(),e.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(e,o,s){var a=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(o,s,e.pos[0]+2,e.pos[1]+2-a,a-4,a-4)},LGraphCanvas.prototype.isOverNodeInput=function(e,o,s,a){if(e.inputs)for(var h=0,d=e.inputs.length;h<d;++h){e.inputs[h];var c=e.getConnectionPos(!0,h),g=!1;if(e.horizontal?g=isInsideRectangle(o,s,c[0]-5,c[1]-10,10,20):g=isInsideRectangle(o,s,c[0]-10,c[1]-5,40,10),g)return a&&(a[0]=c[0],a[1]=c[1]),h}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(e,o,s,a){if(e.outputs)for(var h=0,d=e.outputs.length;h<d;++h){e.outputs[h];var c=e.getConnectionPos(!1,h),g=!1;if(e.horizontal?g=isInsideRectangle(o,s,c[0]-5,c[1]-10,10,20):g=isInsideRectangle(o,s,c[0]-10,c[1]-5,40,10),g)return a&&(a[0]=c[0],a[1]=c[1]),h}return-1},LGraphCanvas.prototype.processKey=function(e){if(this.graph){var o=!1;if(e.target.localName!="input"){if(e.type=="keydown"){if(e.keyCode==32&&(this.dragging_canvas=!0,o=!0),e.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),o=!0),e.keyCode==65&&e.ctrlKey&&(this.selectNodes(),o=!0),e.keyCode===67&&(e.metaKey||e.ctrlKey)&&!e.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),o=!0),e.keyCode===86&&(e.metaKey||e.ctrlKey)&&this.pasteFromClipboard(e.shiftKey),(e.keyCode==46||e.keyCode==8)&&e.target.localName!="input"&&e.target.localName!="textarea"&&(this.deleteSelectedNodes(),o=!0),this.selected_nodes)for(var s in this.selected_nodes)this.selected_nodes[s].onKeyDown&&this.selected_nodes[s].onKeyDown(e)}else if(e.type=="keyup"&&(e.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var s in this.selected_nodes)this.selected_nodes[s].onKeyUp&&this.selected_nodes[s].onKeyUp(e);if(this.graph.change(),o)return e.preventDefault(),e.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var e={nodes:[],links:[]},o=0,s=[];for(var a in this.selected_nodes){var h=this.selected_nodes[a];h.clonable!==!1&&(h._relative_id=o,s.push(h),o+=1)}for(var a=0;a<s.length;++a){var h=s[a];if(h.clonable!==!1){var d=h.clone();if(!d){console.warn("node type not found: "+h.type);continue}if(e.nodes.push(d.serialize()),h.inputs&&h.inputs.length)for(var c=0;c<h.inputs.length;++c){var g=h.inputs[c];if(!(!g||g.link==null)){var b=this.graph.links[g.link];if(b){var $=this.graph.getNodeById(b.origin_id);$&&e.links.push([$._relative_id,b.origin_slot,h._relative_id,b.target_slot,$.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(e))},LGraphCanvas.prototype.pasteFromClipboard=function(e=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&e)){var o=localStorage.getItem("litegrapheditor_clipboard");if(o){this.graph.beforeChange();for(var s=JSON.parse(o),a=!1,h=!1,d=0;d<s.nodes.length;++d)a?(a[0]>s.nodes[d].pos[0]&&(a[0]=s.nodes[d].pos[0],h[0]=d),a[1]>s.nodes[d].pos[1]&&(a[1]=s.nodes[d].pos[1],h[1]=d)):(a=[s.nodes[d].pos[0],s.nodes[d].pos[1]],h=[d,d]);for(var c=[],d=0;d<s.nodes.length;++d){var g=s.nodes[d],b=LiteGraph.createNode(g.type);b&&(b.configure(g),b.pos[0]+=this.graph_mouse[0]-a[0],b.pos[1]+=this.graph_mouse[1]-a[1],this.graph.add(b,{doProcessChange:!1}),c.push(b))}for(var d=0;d<s.links.length;++d){var $=s.links[d],et,st=$[0];if(st!=null)et=c[st];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&e){var j=$[4];j&&(et=this.graph.getNodeById(j))}var tt=c[$[2]];et&&tt?et.connect($[1],tt,$[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(c),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(e){e.preventDefault(),this.adjustMouseEvent(e);var o=e.clientX,s=e.clientY,a=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(a){var h=[e.canvasX,e.canvasY],d=this.graph?this.graph.getNodeOnPos(h[0],h[1]):null;if(!d){var c=null;this.onDropItem&&(c=this.onDropItem(event)),c||this.checkDropItem(e);return}if(d.onDropFile||d.onDropData){var g=e.dataTransfer.files;if(g&&g.length)for(var b=0;b<g.length;b++){var $=e.dataTransfer.files[0],et=$.name;if(LGraphCanvas.getFileExtension(et),d.onDropFile&&d.onDropFile($),d.onDropData){var st=new FileReader;st.onload=function(tt){var nt=tt.target.result;d.onDropData(nt,et,$)};var j=$.type.split("/")[0];j=="text"||j==""?st.readAsText($):j=="image"?st.readAsDataURL($):st.readAsArrayBuffer($)}}}return d.onDropItem&&d.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(e){if(e.dataTransfer.files.length){var o=e.dataTransfer.files[0],s=LGraphCanvas.getFileExtension(o.name).toLowerCase(),a=LiteGraph.node_types_by_file_extension[s];if(a){this.graph.beforeChange();var h=LiteGraph.createNode(a.type);h.pos=[e.canvasX,e.canvasY],this.graph.add(h),h.onDropFile&&h.onDropFile(o),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(e){this.onShowNodePanel?this.onShowNodePanel(e):this.showShowNodePanel(e),this.onNodeDblClicked&&this.onNodeDblClicked(e),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(e,o){this.selectNode(e,o&&(o.shiftKey||o.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(e)},LGraphCanvas.prototype.selectNode=function(e,o){e==null?this.deselectAllNodes():this.selectNodes([e],o)},LGraphCanvas.prototype.selectNodes=function(e,o){o||this.deselectAllNodes(),e=e||this.graph._nodes,typeof e=="string"&&(e=[e]);for(var s in e){var a=e[s];if(a.is_selected){this.deselectNode(a);continue}if(!a.is_selected&&a.onSelected&&a.onSelected(),a.is_selected=!0,this.selected_nodes[a.id]=a,a.inputs)for(var h=0;h<a.inputs.length;++h)this.highlighted_links[a.inputs[h].link]=!0;if(a.outputs)for(var h=0;h<a.outputs.length;++h){var d=a.outputs[h];if(d.links)for(var c=0;c<d.links.length;++c)this.highlighted_links[d.links[c]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(e){if(e.is_selected){if(e.onDeselected&&e.onDeselected(),e.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(e),e.inputs)for(var o=0;o<e.inputs.length;++o)delete this.highlighted_links[e.inputs[o].link];if(e.outputs)for(var o=0;o<e.outputs.length;++o){var s=e.outputs[o];if(s.links)for(var a=0;a<s.links.length;++a)delete this.highlighted_links[s.links[a]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var e=this.graph._nodes,o=0,s=e.length;o<s;++o){var a=e[o];a.is_selected&&(a.onDeselected&&a.onDeselected(),a.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(a))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var e in this.selected_nodes){var o=this.selected_nodes[e];if(!o.block_delete){if(o.inputs&&o.inputs.length&&o.outputs&&o.outputs.length&&LiteGraph.isValidConnection(o.inputs[0].type,o.outputs[0].type)&&o.inputs[0].link&&o.outputs[0].links&&o.outputs[0].links.length){var s=o.graph.links[o.inputs[0].link],a=o.graph.links[o.outputs[0].links[0]],h=o.getInputNode(0),d=o.getOutputNodes(0)[0];h&&d&&h.connect(s.origin_slot,d,a.target_slot)}this.graph.remove(o),this.onNodeDeselected&&this.onNodeDeselected(o)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(e){this.ds.offset[0]=-e.pos[0]-e.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-e.pos[1]-e.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(e){var o=0,s=0;if(this.canvas){var a=this.canvas.getBoundingClientRect();o=e.clientX-a.left,s=e.clientY-a.top}else o=e.clientX,s=e.clientY;this.last_mouse_position[0]=o,this.last_mouse_position[1]=s,e.canvasX=o/this.ds.scale-this.ds.offset[0],e.canvasY=s/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(e,o){this.ds.changeScale(e,o),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(e,o){return this.ds.convertOffsetToCanvas(e,o)},LGraphCanvas.prototype.convertCanvasToOffset=function(e,o){return this.ds.convertCanvasToOffset(e,o)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(e){var o=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([e.clientX-o.left,e.clientY-o.top])},LGraphCanvas.prototype.bringToFront=function(e){var o=this.graph._nodes.indexOf(e);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.push(e))},LGraphCanvas.prototype.sendToBack=function(e){var o=this.graph._nodes.indexOf(e);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.unshift(e))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(e,o){var s=o||[];s.length=0,e=e||this.graph._nodes;for(var a=0,h=e.length;a<h;++a){var d=e[a];this.live_mode&&!d.onDrawBackground&&!d.onDrawForeground||overlapBounding(this.visible_area,d.getBounding(temp,!0))&&s.push(d)}return s},LGraphCanvas.prototype.draw=function(e,o){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var s=LiteGraph.getTime();this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||o||this.always_render_background||this.graph&&this.graph._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||e)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var e=this.ctx;if(e){var o=this.canvas;e.start2D&&!this.viewport&&(e.start2D(),e.restore(),e.setTransform(1,0,0,1,0,0));var s=this.viewport||this.dirty_area;if(s&&(e.save(),e.beginPath(),e.rect(s[0],s[1],s[2],s[3]),e.clip()),this.clear_background&&(s?e.clearRect(s[0],s[1],s[2],s[3]):e.clearRect(0,0,o.width,o.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():e.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(o,e),this.show_info&&this.renderInfo(e,s?s[0]:0,s?s[1]:0),this.graph){e.save(),this.ds.toCanvasContext(e);for(var a=this.computeVisibleNodes(null,this.visible_nodes),h=0;h<a.length;++h){var d=a[h];e.save(),e.translate(d.pos[0],d.pos[1]),this.drawNode(d,e),e.restore()}if(this.render_execution_order&&this.drawExecutionOrder(e),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(e)),this.connecting_pos!=null){e.lineWidth=this.connections_width;var c=null,g=this.connecting_output||this.connecting_input,b=g.type,$=g.dir;$==null&&(this.connecting_output?$=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:$=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var et=g.shape;switch(b){case LiteGraph.EVENT:c=LiteGraph.EVENT_LINK_COLOR;break;default:c=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(e,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,c,$,LiteGraph.CENTER),e.beginPath(),b===LiteGraph.EVENT||et===LiteGraph.BOX_SHAPE?(e.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),e.fill(),e.beginPath(),e.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):et===LiteGraph.ARROW_SHAPE?(e.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),e.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),e.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),e.closePath()):(e.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),e.fill(),e.fillStyle="#ffcc00",this._highlight_input){e.beginPath();var st=this._highlight_input_slot.shape;st===LiteGraph.ARROW_SHAPE?(e.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),e.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),e.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),e.closePath()):e.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),e.fill()}this._highlight_output&&(e.beginPath(),st===LiteGraph.ARROW_SHAPE?(e.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),e.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),e.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),e.closePath()):e.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),e.fill())}this.dragging_rectangle&&(e.strokeStyle="#FFF",e.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(e,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(e,null),this.onDrawForeground&&this.onDrawForeground(e,this.visible_rect),e.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(e),this.onDrawOverlay&&this.onDrawOverlay(e),s&&e.restore(),e.finish2D&&e.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(e){var o=this.graph,s=o._subgraph_node;if(!s){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(o,s,e),this.drawSubgraphPanelRight(o,s,e)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(e,o,s){var a=o.inputs?o.inputs.length:0,h=200,d=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(10,10,h,(a+1)*d+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left",s.fillText("Graph Inputs",20,34),this.drawButton(h-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var c=50;if(s.font="14px Arial",o.inputs)for(var g=0;g<o.inputs.length;++g){var b=o.inputs[g];if(!b.not_subgraph_input){if(this.drawButton(20,c+2,h-20,d-2)){var $=o.constructor.input_node_type||"graph/input";this.graph.beforeChange();var et=LiteGraph.createNode($);et?(e.add(et),this.block_click=!1,this.last_click_position=null,this.selectNodes([et]),this.node_dragged=et,this.dragging_canvas=!1,et.setProperty("name",b.name),et.setProperty("type",b.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",$)}s.fillStyle="#9C9",s.beginPath(),s.arc(h-16,c+d*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(b.name,30,c+d*.75),s.fillStyle="#777",s.fillText(b.type,130,c+d*.75),c+=d}}this.drawButton(20,c+2,h-20,d-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(o)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(e,o,s){var a=o.outputs?o.outputs.length:0,h=this.bgcanvas.width,d=200,c=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(h-d-10,10,d,(a+1)*c+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left";var g="Graph Outputs",b=s.measureText(g).width;if(s.fillText(g,h-b-20,34),this.drawButton(h-d,20,20,20,"X","#151515")){this.closeSubgraph();return}var $=50;if(s.font="14px Arial",o.outputs)for(var et=0;et<o.outputs.length;++et){var st=o.outputs[et];if(!st.not_subgraph_input){if(this.drawButton(h-d,$+2,d-20,c-2)){var j=o.constructor.output_node_type||"graph/output";this.graph.beforeChange();var tt=LiteGraph.createNode(j);tt?(e.add(tt),this.block_click=!1,this.last_click_position=null,this.selectNodes([tt]),this.node_dragged=tt,this.dragging_canvas=!1,tt.setProperty("name",st.name),tt.setProperty("type",st.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",j)}s.fillStyle="#9C9",s.beginPath(),s.arc(h-d+16,$+c*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(st.name,h-d+30,$+c*.75),s.fillStyle="#777",s.fillText(st.type,h-d+130,$+c*.75),$+=c}}this.drawButton(h-d,$+2,d-20,c-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(o)},LGraphCanvas.prototype.drawButton=function(e,o,s,a,h,d,c,g){var b=this.ctx;d=d||LiteGraph.NODE_DEFAULT_COLOR,c=c||"#555",g=g||LiteGraph.NODE_TEXT_COLOR;var $=this.ds.convertOffsetToCanvas(this.graph_mouse),et=LiteGraph.isInsideRectangle($[0],$[1],e,o,s,a);if($=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,$){var st=this.canvas.getBoundingClientRect();$[0]-=st.left,$[1]-=st.top}var j=$&&LiteGraph.isInsideRectangle($[0],$[1],e,o,s,a);b.fillStyle=et?c:d,j&&(b.fillStyle="#AAA"),b.beginPath(),b.roundRect(e,o,s,a,[4]),b.fill(),h!=null&&h.constructor==String&&(b.fillStyle=g,b.textAlign="center",b.font=(a*.65|0)+"px Arial",b.fillText(h,e+s*.5,o+a*.75),b.textAlign="left");var tt=j&&!this.block_click;return j&&this.blockClick(),tt},LGraphCanvas.prototype.isAreaClicked=function(e,o,s,a,h){var d=this.mouse;LiteGraph.isInsideRectangle(d[0],d[1],e,o,s,a),d=this.last_click_position;var c=d&&LiteGraph.isInsideRectangle(d[0],d[1],e,o,s,a),g=c&&!this.block_click;return c&&h&&this.blockClick(),g},LGraphCanvas.prototype.renderInfo=function(e,o,s){o=o||10,s=s||this.canvas.height-80,e.save(),e.translate(o,s),e.font="10px Arial",e.fillStyle="#888",e.textAlign="left",this.graph?(e.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13*1),e.fillText("I: "+this.graph.iteration,5,13*2),e.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,13*3),e.fillText("V: "+this.graph._version,5,13*4),e.fillText("FPS:"+this.fps.toFixed(2),5,13*5)):e.fillText("No graph selected",5,13*1),e.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var e=this.bgcanvas;(e.width!=this.canvas.width||e.height!=this.canvas.height)&&(e.width=this.canvas.width,e.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var o=this.bgctx;o.start&&o.start();var s=this.viewport||[0,0,o.canvas.width,o.canvas.height];if(this.clear_background&&o.clearRect(s[0],s[1],s[2],s[3]),this._graph_stack&&this._graph_stack.length){o.save(),this._graph_stack[this._graph_stack.length-1];var a=this.graph._subgraph_node;o.strokeStyle=a.bgcolor,o.lineWidth=10,o.strokeRect(1,1,e.width-2,e.height-2),o.lineWidth=1,o.font="40px Arial",o.textAlign="center",o.fillStyle=a.bgcolor||"#AAA";for(var h="",d=1;d<this._graph_stack.length;++d)h+=this._graph_stack[d]._subgraph_node.getTitle()+" >> ";o.fillText(h+a.getTitle(),e.width*.5,40),o.restore()}var c=!1;if(this.onRenderBackground&&(c=this.onRenderBackground(e,o)),this.viewport||(o.restore(),o.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(o.save(),this.ds.toCanvasContext(o),this.ds.scale<1.5&&!c&&this.clear_background_color&&(o.fillStyle=this.clear_background_color,o.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!c){if(this.zoom_modify_alpha?o.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:o.globalAlpha=this.editor_alpha,o.imageSmoothingEnabled=o.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var g=this;this._bg_img.onload=function(){g.draw(!0,!0)}}var b=null;this._pattern==null&&this._bg_img.width>0?(b=o.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=b):b=this._pattern,b&&(o.fillStyle=b,o.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),o.fillStyle="transparent"),o.globalAlpha=1,o.imageSmoothingEnabled=o.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(e,o),this.onDrawBackground&&this.onDrawBackground(o,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(o.strokeStyle="#235",o.strokeRect(0,0,e.width,e.height)),this.render_connections_shadows?(o.shadowColor="#000",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=6):o.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(o),o.shadowColor="rgba(0,0,0,0)",o.restore()}o.finish&&o.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(e,o){this.current_node=e;var s=e.color||e.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,a=e.bgcolor||e.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;e.mouseOver;var h=this.ds.scale<.6;if(this.live_mode){e.flags.collapsed||(o.shadowColor="transparent",e.onDrawForeground&&e.onDrawForeground(o,this,this.canvas));return}var d=this.editor_alpha;if(o.globalAlpha=d,this.render_shadows&&!h?(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,o.shadowOffsetX=2*this.ds.scale,o.shadowOffsetY=2*this.ds.scale,o.shadowBlur=3*this.ds.scale):o.shadowColor="transparent",!(e.flags.collapsed&&e.onDrawCollapsed&&e.onDrawCollapsed(o,this)==!0)){var c=e._shape||LiteGraph.BOX_SHAPE,g=temp_vec2;temp_vec2.set(e.size);var b=e.horizontal;if(e.flags.collapsed){o.font=this.inner_text_font;var $=e.getTitle?e.getTitle():e.title;$!=null&&(e._collapsed_width=Math.min(e.size[0],o.measureText($).width+LiteGraph.NODE_TITLE_HEIGHT*2),g[0]=e._collapsed_width,g[1]=0)}e.clip_area&&(o.save(),o.beginPath(),c==LiteGraph.BOX_SHAPE?o.rect(0,0,g[0],g[1]):c==LiteGraph.ROUND_SHAPE?o.roundRect(0,0,g[0],g[1],[10]):c==LiteGraph.CIRCLE_SHAPE&&o.arc(g[0]*.5,g[1]*.5,g[0]*.5,0,Math.PI*2),o.clip()),e.has_errors&&(a="red"),this.drawNodeShape(e,o,g,s,a,e.is_selected,e.mouseOver),o.shadowColor="transparent",e.onDrawForeground&&e.onDrawForeground(o,this,this.canvas),o.textAlign=b?"center":"left",o.font=this.inner_text_font;var et=!h,st=this.connecting_output,j=this.connecting_input;o.lineWidth=1;var tt=0,nt=new Float32Array(2);if(e.flags.collapsed){if(this.render_collapsed_slots){var mt=null,_t=null;if(e.inputs)for(var lt=0;lt<e.inputs.length;lt++){var ct=e.inputs[lt];if(ct.link!=null){mt=ct;break}}if(e.outputs)for(var lt=0;lt<e.outputs.length;lt++){var ct=e.outputs[lt];!ct.links||!ct.links.length||(_t=ct)}if(mt){var Et=0,Tt=LiteGraph.NODE_TITLE_HEIGHT*-.5;b&&(Et=e._collapsed_width*.5,Tt=-LiteGraph.NODE_TITLE_HEIGHT),o.fillStyle="#686",o.beginPath(),ct.type===LiteGraph.EVENT||ct.shape===LiteGraph.BOX_SHAPE?o.rect(Et-7+.5,Tt-4,14,8):ct.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(Et+8,Tt),o.lineTo(Et+-4,Tt-4),o.lineTo(Et+-4,Tt+4),o.closePath()):o.arc(Et,Tt,4,0,Math.PI*2),o.fill()}if(_t){var Et=e._collapsed_width,Tt=LiteGraph.NODE_TITLE_HEIGHT*-.5;b&&(Et=e._collapsed_width*.5,Tt=0),o.fillStyle="#686",o.strokeStyle="black",o.beginPath(),ct.type===LiteGraph.EVENT||ct.shape===LiteGraph.BOX_SHAPE?o.rect(Et-7+.5,Tt-4,14,8):ct.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(Et+6,Tt),o.lineTo(Et-6,Tt-4),o.lineTo(Et-6,Tt+4),o.closePath()):o.arc(Et,Tt,4,0,Math.PI*2),o.fill()}}}else{if(e.inputs)for(var lt=0;lt<e.inputs.length;lt++){var ct=e.inputs[lt],ot=ct.type,_e=ct.shape;o.globalAlpha=d,this.connecting_output&&!LiteGraph.isValidConnection(ct.type,st.type)&&(o.globalAlpha=.4*d),o.fillStyle=ct.link!=null?ct.color_on||this.default_connection_color_byType[ot]||this.default_connection_color.input_on:ct.color_off||this.default_connection_color_byTypeOff[ot]||this.default_connection_color_byType[ot]||this.default_connection_color.input_off;var _=e.getConnectionPos(!0,lt,nt);_[0]-=e.pos[0],_[1]-=e.pos[1],tt<_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(tt=_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.beginPath(),ot=="array"&&(_e=LiteGraph.GRID_SHAPE);var at=!0;if(ct.type===LiteGraph.EVENT||ct.shape===LiteGraph.BOX_SHAPE?b?o.rect(_[0]-5+.5,_[1]-8+.5,10,14):o.rect(_[0]-6+.5,_[1]-5+.5,14,10):_e===LiteGraph.ARROW_SHAPE?(o.moveTo(_[0]+8,_[1]+.5),o.lineTo(_[0]-4,_[1]+6+.5),o.lineTo(_[0]-4,_[1]-6+.5),o.closePath()):_e===LiteGraph.GRID_SHAPE?(o.rect(_[0]-4,_[1]-4,2,2),o.rect(_[0]-1,_[1]-4,2,2),o.rect(_[0]+2,_[1]-4,2,2),o.rect(_[0]-4,_[1]-1,2,2),o.rect(_[0]-1,_[1]-1,2,2),o.rect(_[0]+2,_[1]-1,2,2),o.rect(_[0]-4,_[1]+2,2,2),o.rect(_[0]-1,_[1]+2,2,2),o.rect(_[0]+2,_[1]+2,2,2),at=!1):h?o.rect(_[0]-4,_[1]-4,8,8):o.arc(_[0],_[1],4,0,Math.PI*2),o.fill(),et){var it=ct.label!=null?ct.label:ct.name;it&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,b||ct.dir==LiteGraph.UP?o.fillText(it,_[0],_[1]-10):o.fillText(it,_[0]+10,_[1]+5))}}if(o.textAlign=b?"center":"right",o.strokeStyle="black",e.outputs)for(var lt=0;lt<e.outputs.length;lt++){var ct=e.outputs[lt],ot=ct.type,_e=ct.shape;this.connecting_input&&!LiteGraph.isValidConnection(ot,j.type)&&(o.globalAlpha=.4*d);var _=e.getConnectionPos(!1,lt,nt);_[0]-=e.pos[0],_[1]-=e.pos[1],tt<_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(tt=_[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.fillStyle=ct.links&&ct.links.length?ct.color_on||this.default_connection_color_byType[ot]||this.default_connection_color.output_on:ct.color_off||this.default_connection_color_byTypeOff[ot]||this.default_connection_color_byType[ot]||this.default_connection_color.output_off,o.beginPath(),ot=="array"&&(_e=LiteGraph.GRID_SHAPE);var at=!0;if(ot===LiteGraph.EVENT||_e===LiteGraph.BOX_SHAPE?b?o.rect(_[0]-5+.5,_[1]-8+.5,10,14):o.rect(_[0]-6+.5,_[1]-5+.5,14,10):_e===LiteGraph.ARROW_SHAPE?(o.moveTo(_[0]+8,_[1]+.5),o.lineTo(_[0]-4,_[1]+6+.5),o.lineTo(_[0]-4,_[1]-6+.5),o.closePath()):_e===LiteGraph.GRID_SHAPE?(o.rect(_[0]-4,_[1]-4,2,2),o.rect(_[0]-1,_[1]-4,2,2),o.rect(_[0]+2,_[1]-4,2,2),o.rect(_[0]-4,_[1]-1,2,2),o.rect(_[0]-1,_[1]-1,2,2),o.rect(_[0]+2,_[1]-1,2,2),o.rect(_[0]-4,_[1]+2,2,2),o.rect(_[0]-1,_[1]+2,2,2),o.rect(_[0]+2,_[1]+2,2,2),at=!1):h?o.rect(_[0]-4,_[1]-4,8,8):o.arc(_[0],_[1],4,0,Math.PI*2),o.fill(),!h&&at&&o.stroke(),et){var it=ct.label!=null?ct.label:ct.name;it&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,b||ct.dir==LiteGraph.DOWN?o.fillText(it,_[0],_[1]-8):o.fillText(it,_[0]-10,_[1]+5))}}if(o.textAlign="left",o.globalAlpha=1,e.widgets){var pt=tt;(b||e.widgets_up)&&(pt=2),e.widgets_start_y!=null&&(pt=e.widgets_start_y),this.drawNodeWidgets(e,pt,o,this.node_widget&&this.node_widget[0]==e?this.node_widget[1]:null)}}e.clip_area&&o.restore(),o.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(e,o){var s=o._pos;if(e.fillStyle="black",e.beginPath(),e.arc(s[0],s[1],3,0,Math.PI*2),e.fill(),o.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(e,o,this)==!0)){var a=o.data,h=null;if(a.constructor===Number?h=a.toFixed(2):a.constructor===String?h='"'+a+'"':a.constructor===Boolean?h=String(a):a.toToolTip?h=a.toToolTip():h="["+a.constructor.name+"]",h!=null){h=h.substr(0,30),e.font="14px Courier New";var d=e.measureText(h),c=d.width+20,g=24;e.shadowColor="black",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=3,e.fillStyle="#454",e.beginPath(),e.roundRect(s[0]-c*.5,s[1]-15-g,c,g,[3]),e.moveTo(s[0]-10,s[1]-15),e.lineTo(s[0]+10,s[1]-15),e.lineTo(s[0],s[1]-5),e.fill(),e.shadowColor="transparent",e.textAlign="center",e.fillStyle="#CEC",e.fillText(h,s[0],s[1]-15-g*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(e,o,s,a,h,d,c){o.strokeStyle=a,o.fillStyle=h;var g=LiteGraph.NODE_TITLE_HEIGHT,b=this.ds.scale<.5,$=e._shape||e.constructor.shape||LiteGraph.ROUND_SHAPE,et=e.constructor.title_mode,st=!0;et==LiteGraph.TRANSPARENT_TITLE||et==LiteGraph.NO_TITLE?st=!1:et==LiteGraph.AUTOHIDE_TITLE&&c&&(st=!0);var j=tmp_area;j[0]=0,j[1]=st?-g:0,j[2]=s[0]+1,j[3]=st?s[1]+g:s[1];var tt=o.globalAlpha;if(o.beginPath(),$==LiteGraph.BOX_SHAPE||b?o.fillRect(j[0],j[1],j[2],j[3]):$==LiteGraph.ROUND_SHAPE||$==LiteGraph.CARD_SHAPE?o.roundRect(j[0],j[1],j[2],j[3],$==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):$==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),o.fill(),!e.flags.collapsed&&st&&(o.shadowColor="transparent",o.fillStyle="rgba(0,0,0,0.2)",o.fillRect(0,-1,j[2],2)),o.shadowColor="transparent",e.onDrawBackground&&e.onDrawBackground(o,this,this.canvas,this.graph_mouse),st||et==LiteGraph.TRANSPARENT_TITLE){if(e.onDrawTitleBar)e.onDrawTitleBar(o,g,s,this.ds.scale,a);else if(et!=LiteGraph.TRANSPARENT_TITLE&&(e.constructor.title_color||this.render_title_colored)){var nt=e.constructor.title_color||a;if(e.flags.collapsed&&(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var lt=LGraphCanvas.gradients[nt];lt||(lt=LGraphCanvas.gradients[nt]=o.createLinearGradient(0,0,400,0),lt.addColorStop(0,nt),lt.addColorStop(1,"#000")),o.fillStyle=lt}else o.fillStyle=nt;o.beginPath(),$==LiteGraph.BOX_SHAPE||b?o.rect(0,-g,s[0]+1,g):($==LiteGraph.ROUND_SHAPE||$==LiteGraph.CARD_SHAPE)&&o.roundRect(0,-g,s[0]+1,g,e.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),o.fill(),o.shadowColor="transparent"}var ct=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[e.mode]&&(ct=LiteGraph.NODE_MODES_COLORS[e.mode]),LiteGraph.node_box_coloured_when_on&&(ct=e.action_triggered?"#FFF":e.execute_triggered?"#AAA":ct);var ot=10;if(e.onDrawTitleBox?e.onDrawTitleBox(o,g,s,this.ds.scale):$==LiteGraph.ROUND_SHAPE||$==LiteGraph.CIRCLE_SHAPE||$==LiteGraph.CARD_SHAPE?(b&&(o.fillStyle="black",o.beginPath(),o.arc(g*.5,g*-.5,ot*.5+1,0,Math.PI*2),o.fill()),o.fillStyle=e.boxcolor||ct||LiteGraph.NODE_DEFAULT_BOXCOLOR,b?o.fillRect(g*.5-ot*.5,g*-.5-ot*.5,ot,ot):(o.beginPath(),o.arc(g*.5,g*-.5,ot*.5,0,Math.PI*2),o.fill())):(b&&(o.fillStyle="black",o.fillRect((g-ot)*.5-1,(g+ot)*-.5-1,ot+2,ot+2)),o.fillStyle=e.boxcolor||ct||LiteGraph.NODE_DEFAULT_BOXCOLOR,o.fillRect((g-ot)*.5,(g+ot)*-.5,ot,ot)),o.globalAlpha=tt,e.onDrawTitleText&&e.onDrawTitleText(o,g,s,this.ds.scale,this.title_text_font,d),!b){o.font=this.title_text_font;var _e=String(e.getTitle());_e&&(d?o.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:o.fillStyle=e.constructor.title_text_color||this.node_title_color,e.flags.collapsed?(o.textAlign="left",o.measureText(_e),o.fillText(_e.substr(0,20),g,LiteGraph.NODE_TITLE_TEXT_Y-g),o.textAlign="left"):(o.textAlign="left",o.fillText(_e,g,LiteGraph.NODE_TITLE_TEXT_Y-g)))}if(!e.flags.collapsed&&e.subgraph&&!e.skip_subgraph_button){var _=LiteGraph.NODE_TITLE_HEIGHT,at=e.size[0]-_,it=LiteGraph.isInsideRectangle(this.graph_mouse[0]-e.pos[0],this.graph_mouse[1]-e.pos[1],at+2,-_+2,_-4,_-4);o.fillStyle=it?"#888":"#555",$==LiteGraph.BOX_SHAPE||b?o.fillRect(at+2,-_+2,_-4,_-4):(o.beginPath(),o.roundRect(at+2,-_+2,_-4,_-4,[4]),o.fill()),o.fillStyle="#333",o.beginPath(),o.moveTo(at+_*.2,-_*.6),o.lineTo(at+_*.8,-_*.6),o.lineTo(at+_*.5,-_*.3),o.fill()}e.onDrawTitle&&e.onDrawTitle(o)}d&&(e.onBounding&&e.onBounding(j),et==LiteGraph.TRANSPARENT_TITLE&&(j[1]-=g,j[3]+=g),o.lineWidth=1,o.globalAlpha=.8,o.beginPath(),$==LiteGraph.BOX_SHAPE?o.rect(-6+j[0],-6+j[1],12+j[2],12+j[3]):$==LiteGraph.ROUND_SHAPE||$==LiteGraph.CARD_SHAPE&&e.flags.collapsed?o.roundRect(-6+j[0],-6+j[1],12+j[2],12+j[3],[this.round_radius*2]):$==LiteGraph.CARD_SHAPE?o.roundRect(-6+j[0],-6+j[1],12+j[2],12+j[3],[this.round_radius*2,2,this.round_radius*2,2]):$==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5+6,0,Math.PI*2),o.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,o.stroke(),o.strokeStyle=a,o.globalAlpha=1),e.execute_triggered>0&&e.execute_triggered--,e.action_triggered>0&&e.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(e){var o=LiteGraph.getTime(),s=this.visible_area;margin_area[0]=s[0]-20,margin_area[1]=s[1]-20,margin_area[2]=s[2]+40,margin_area[3]=s[3]+40,e.lineWidth=this.connections_width,e.fillStyle="#AAA",e.strokeStyle="#AAA",e.globalAlpha=this.editor_alpha;for(var a=this.graph._nodes,h=0,d=a.length;h<d;++h){var c=a[h];if(!(!c.inputs||!c.inputs.length))for(var g=0;g<c.inputs.length;++g){var b=c.inputs[g];if(!(!b||b.link==null)){var $=b.link,et=this.graph.links[$];if(et){var st=this.graph.getNodeById(et.origin_id);if(st!=null){var j=et.origin_slot,tt=null;j==-1?tt=[st.pos[0]+10,st.pos[1]+10]:tt=st.getConnectionPos(!1,j,tempA);var nt=c.getConnectionPos(!0,g,tempB);if(link_bounding[0]=tt[0],link_bounding[1]=tt[1],link_bounding[2]=nt[0]-tt[0],link_bounding[3]=nt[1]-tt[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var lt=st.outputs[j],ct=c.inputs[g];if(!(!lt||!ct)){var ot=lt.dir||(st.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),_e=ct.dir||(c.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(e,tt,nt,et,!1,0,null,ot,_e),et&&et._last_time&&o-et._last_time<1e3){var _=2-(o-et._last_time)*.002,at=e.globalAlpha;e.globalAlpha=at*_,this.renderLink(e,tt,nt,et,!0,_,"white",ot,_e),e.globalAlpha=at}}}}}}}}e.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(e,o,s,a,h,d,c,g,b,$){a&&this.visible_links.push(a),!c&&a&&(c=a.color||LGraphCanvas.link_type_colors[a.type]),c||(c=this.default_link_color),a!=null&&this.highlighted_links[a.id]&&(c="#FFF"),g=g||LiteGraph.RIGHT,b=b||LiteGraph.LEFT;var et=distance(o,s);this.render_connections_border&&this.ds.scale>.6&&(e.lineWidth=this.connections_width+4),e.lineJoin="round",$=$||1,$>1&&(e.lineWidth=.5),e.beginPath();for(var st=0;st<$;st+=1){var j=(st-($-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){e.moveTo(o[0],o[1]+j);var tt=0,nt=0,lt=0,ct=0;switch(g){case LiteGraph.LEFT:tt=et*-.25;break;case LiteGraph.RIGHT:tt=et*.25;break;case LiteGraph.UP:nt=et*-.25;break;case LiteGraph.DOWN:nt=et*.25;break}switch(b){case LiteGraph.LEFT:lt=et*-.25;break;case LiteGraph.RIGHT:lt=et*.25;break;case LiteGraph.UP:ct=et*-.25;break;case LiteGraph.DOWN:ct=et*.25;break}e.bezierCurveTo(o[0]+tt,o[1]+nt+j,s[0]+lt,s[1]+ct+j,s[0],s[1]+j)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){e.moveTo(o[0],o[1]+j);var tt=0,nt=0,lt=0,ct=0;switch(g){case LiteGraph.LEFT:tt=-1;break;case LiteGraph.RIGHT:tt=1;break;case LiteGraph.UP:nt=-1;break;case LiteGraph.DOWN:nt=1;break}switch(b){case LiteGraph.LEFT:lt=-1;break;case LiteGraph.RIGHT:lt=1;break;case LiteGraph.UP:ct=-1;break;case LiteGraph.DOWN:ct=1;break}var ot=15;e.lineTo(o[0]+tt*ot,o[1]+nt*ot+j),e.lineTo(s[0]+lt*ot,s[1]+ct*ot+j),e.lineTo(s[0],s[1]+j)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){e.moveTo(o[0],o[1]);var _e=o[0],_=o[1],at=s[0],it=s[1];g==LiteGraph.RIGHT?_e+=10:_+=10,b==LiteGraph.LEFT?at-=10:it-=10,e.lineTo(_e,_),e.lineTo((_e+at)*.5,_),e.lineTo((_e+at)*.5,it),e.lineTo(at,it),e.lineTo(s[0],s[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!h&&(e.strokeStyle="rgba(0,0,0,0.5)",e.stroke()),e.lineWidth=this.connections_width,e.fillStyle=e.strokeStyle=c,e.stroke();var pt=this.computeConnectionPoint(o,s,.5,g,b);if(a&&a._pos&&(a._pos[0]=pt[0],a._pos[1]=pt[1]),this.ds.scale>=.6&&this.highquality_render&&b!=LiteGraph.CENTER){if(this.render_connection_arrows){var mt=this.computeConnectionPoint(o,s,.25,g,b),_t=this.computeConnectionPoint(o,s,.26,g,b),Et=this.computeConnectionPoint(o,s,.75,g,b),Tt=this.computeConnectionPoint(o,s,.76,g,b),Ot=0,Ct=0;this.render_curved_connections?(Ot=-Math.atan2(_t[0]-mt[0],_t[1]-mt[1]),Ct=-Math.atan2(Tt[0]-Et[0],Tt[1]-Et[1])):Ct=Ot=s[1]>o[1]?0:Math.PI,e.save(),e.translate(mt[0],mt[1]),e.rotate(Ot),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore(),e.save(),e.translate(Et[0],Et[1]),e.rotate(Ct),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore()}e.beginPath(),e.arc(pt[0],pt[1],5,0,Math.PI*2),e.fill()}if(d){e.fillStyle=c;for(var st=0;st<5;++st){var St=(LiteGraph.getTime()*.001+st*.2)%1,pt=this.computeConnectionPoint(o,s,St,g,b);e.beginPath(),e.arc(pt[0],pt[1],5,0,2*Math.PI),e.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(e,o,s,a,h){a=a||LiteGraph.RIGHT,h=h||LiteGraph.LEFT;var d=distance(e,o),c=e,g=[e[0],e[1]],b=[o[0],o[1]],$=o;switch(a){case LiteGraph.LEFT:g[0]+=d*-.25;break;case LiteGraph.RIGHT:g[0]+=d*.25;break;case LiteGraph.UP:g[1]+=d*-.25;break;case LiteGraph.DOWN:g[1]+=d*.25;break}switch(h){case LiteGraph.LEFT:b[0]+=d*-.25;break;case LiteGraph.RIGHT:b[0]+=d*.25;break;case LiteGraph.UP:b[1]+=d*-.25;break;case LiteGraph.DOWN:b[1]+=d*.25;break}var et=(1-s)*(1-s)*(1-s),st=3*((1-s)*(1-s))*s,j=3*(1-s)*(s*s),tt=s*s*s,nt=et*c[0]+st*g[0]+j*b[0]+tt*$[0],lt=et*c[1]+st*g[1]+j*b[1]+tt*$[1];return[nt,lt]},LGraphCanvas.prototype.drawExecutionOrder=function(e){e.shadowColor="transparent",e.globalAlpha=.25,e.textAlign="center",e.strokeStyle="white",e.globalAlpha=.75;for(var o=this.visible_nodes,s=0;s<o.length;++s){var a=o[s];e.fillStyle="black",e.fillRect(a.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,a.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),a.order==0&&e.strokeRect(a.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,a.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#FFF",e.fillText(a.order,a.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,a.pos[1]-6)}e.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(e,o,s,a){if(!e.widgets||!e.widgets.length)return 0;var h=e.size[0],d=e.widgets;o+=2;var c=LiteGraph.NODE_WIDGET_HEIGHT,g=this.ds.scale>.5;s.save(),s.globalAlpha=this.editor_alpha;for(var b=LiteGraph.WIDGET_OUTLINE_COLOR,$=LiteGraph.WIDGET_BGCOLOR,et=LiteGraph.WIDGET_TEXT_COLOR,st=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,j=15,tt=0;tt<d.length;++tt){var nt=d[tt],lt=o;nt.y&&(lt=nt.y),nt.last_y=lt,s.strokeStyle=b,s.fillStyle="#222",s.textAlign="left",nt.disabled&&(s.globalAlpha*=.5);var ct=nt.width||h;switch(nt.type){case"button":nt.clicked&&(s.fillStyle="#AAA",nt.clicked=!1,this.dirty_canvas=!0),s.fillRect(j,lt,ct-j*2,c),g&&!nt.disabled&&s.strokeRect(j,lt,ct-j*2,c),g&&(s.textAlign="center",s.fillStyle=et,s.fillText(nt.label||nt.name,ct*.5,lt+c*.7));break;case"toggle":if(s.textAlign="left",s.strokeStyle=b,s.fillStyle=$,s.beginPath(),g?s.roundRect(j,lt,ct-j*2,c,[c*.5]):s.rect(j,lt,ct-j*2,c),s.fill(),g&&!nt.disabled&&s.stroke(),s.fillStyle=nt.value?"#89A":"#333",s.beginPath(),s.arc(ct-j*2,lt+c*.5,c*.36,0,Math.PI*2),s.fill(),g){s.fillStyle=st;const pt=nt.label||nt.name;pt!=null&&s.fillText(pt,j*2,lt+c*.7),s.fillStyle=nt.value?et:st,s.textAlign="right",s.fillText(nt.value?nt.options.on||"true":nt.options.off||"false",ct-40,lt+c*.7)}break;case"slider":s.fillStyle=$,s.fillRect(j,lt,ct-j*2,c);var ot=nt.options.max-nt.options.min,_e=(nt.value-nt.options.min)/ot;if(_e<0&&(_e=0),_e>1&&(_e=1),s.fillStyle=nt.options.hasOwnProperty("slider_color")?nt.options.slider_color:a==nt?"#89A":"#678",s.fillRect(j,lt,_e*(ct-j*2),c),g&&!nt.disabled&&s.strokeRect(j,lt,ct-j*2,c),nt.marker){var _=(nt.marker-nt.options.min)/ot;_<0&&(_=0),_>1&&(_=1),s.fillStyle=nt.options.hasOwnProperty("marker_color")?nt.options.marker_color:"#AA9",s.fillRect(j+_*(ct-j*2),lt,2,c)}g&&(s.textAlign="center",s.fillStyle=et,s.fillText(nt.label||nt.name+"  "+Number(nt.value).toFixed(nt.options.precision!=null?nt.options.precision:3),ct*.5,lt+c*.7));break;case"number":case"combo":if(s.textAlign="left",s.strokeStyle=b,s.fillStyle=$,s.beginPath(),g?s.roundRect(j,lt,ct-j*2,c,[c*.5]):s.rect(j,lt,ct-j*2,c),s.fill(),g)if(nt.disabled||s.stroke(),s.fillStyle=et,nt.disabled||(s.beginPath(),s.moveTo(j+16,lt+5),s.lineTo(j+6,lt+c*.5),s.lineTo(j+16,lt+c-5),s.fill(),s.beginPath(),s.moveTo(ct-j-16,lt+5),s.lineTo(ct-j-6,lt+c*.5),s.lineTo(ct-j-16,lt+c-5),s.fill()),s.fillStyle=st,s.fillText(nt.label||nt.name,j*2+5,lt+c*.7),s.fillStyle=et,s.textAlign="right",nt.type=="number")s.fillText(Number(nt.value).toFixed(nt.options.precision!==void 0?nt.options.precision:3),ct-j*2-20,lt+c*.7);else{var at=nt.value;if(nt.options.values){var it=nt.options.values;it.constructor===Function&&(it=it()),it&&it.constructor!==Array&&(at=it[nt.value])}s.fillText(at,ct-j*2-20,lt+c*.7)}break;case"string":case"text":if(s.textAlign="left",s.strokeStyle=b,s.fillStyle=$,s.beginPath(),g?s.roundRect(j,lt,ct-j*2,c,[c*.5]):s.rect(j,lt,ct-j*2,c),s.fill(),g){nt.disabled||s.stroke(),s.save(),s.beginPath(),s.rect(j,lt,ct-j*2,c),s.clip(),s.fillStyle=st;const pt=nt.label||nt.name;pt!=null&&s.fillText(pt,j*2,lt+c*.7),s.fillStyle=et,s.textAlign="right",s.fillText(String(nt.value).substr(0,30),ct-j*2,lt+c*.7),s.restore()}break;default:nt.draw&&nt.draw(s,e,ct,lt,c);break}o+=(nt.computeSize?nt.computeSize(ct)[1]:c)+4,s.globalAlpha=this.editor_alpha}s.restore(),s.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let e=function(o,s,a){return values!=values_list&&(o=text_values.indexOf(o)),this.value=o,inner_value_change(this,o),that.dirty_canvas=!0,!1};var inner_clicked=e,text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:e.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(e){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(e){inner_value_change(this,e)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(e,o){e.type=="number"&&(o=Number(o)),e.value=o,e.options&&e.options.property&&node.properties[e.options.property]!==void 0&&node.setProperty(e.options.property,o),e.callback&&e.callback(e.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(e,o){if(this.graph){var s=this.graph._groups;o.save(),o.globalAlpha=.5*this.editor_alpha;for(var a=0;a<s.length;++a){var h=s[a];if(overlapBounding(this.visible_area,h._bounding)){o.fillStyle=h.color||"#335",o.strokeStyle=h.color||"#335";var d=h._pos,c=h._size;o.globalAlpha=.25*this.editor_alpha,o.beginPath(),o.rect(d[0]+.5,d[1]+.5,c[0],c[1]),o.fill(),o.globalAlpha=this.editor_alpha,o.stroke(),o.beginPath(),o.moveTo(d[0]+c[0],d[1]+c[1]),o.lineTo(d[0]+c[0]-10,d[1]+c[1]),o.lineTo(d[0]+c[0],d[1]+c[1]-10),o.fill();var g=h.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;o.font=g+"px Arial",o.textAlign="left",o.fillText(h.title,d[0]+4,d[1]+g)}}o.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var e=this.graph._nodes,o=0;o<e.length;++o)e[o].size=e[o].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(e,o){if(!e&&!o){var s=this.canvas.parentNode;e=s.offsetWidth,o=s.offsetHeight}this.canvas.width==e&&this.canvas.height==o||(this.canvas.width=e,this.canvas.height=o,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(e){if(!e){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var o=this,s=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var a=setInterval(function(){o.editor_alpha*=s,o.dirty_canvas=!0,o.dirty_bgcanvas=!0,s<1&&o.editor_alpha<.01&&(clearInterval(a),s<1&&(o.live_mode=!0)),s>1&&o.editor_alpha>.99&&(clearInterval(a),o.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(e){},LGraphCanvas.onGroupAdd=function(e,o,s){var a=LGraphCanvas.active_canvas;a.getCanvasWindow();var h=new LiteGraph.LGraphGroup;h.pos=a.convertEventToCanvasOffset(s),a.graph.add(h)},LGraphCanvas.getBoundaryNodes=function(e){let o=null,s=null,a=null,h=null;for(const d in e){const c=e[d],[g,b]=c.pos,[$,et]=c.size;(o===null||b<o.pos[1])&&(o=c),(s===null||g+$>s.pos[0]+s.size[0])&&(s=c),(a===null||b+et>a.pos[1]+a.size[1])&&(a=c),(h===null||g<h.pos[0])&&(h=c)}return{top:o,right:s,bottom:a,left:h}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(e,o,s){if(!e)return;const a=LGraphCanvas.active_canvas;let h=[];s===void 0?h=LGraphCanvas.getBoundaryNodes(e):h={top:s,right:s,bottom:s,left:s};for(const[d,c]of Object.entries(a.selected_nodes))switch(o){case"right":c.pos[0]=h.right.pos[0]+h.right.size[0]-c.size[0];break;case"left":c.pos[0]=h.left.pos[0];break;case"top":c.pos[1]=h.top.pos[1];break;case"bottom":c.pos[1]=h.bottom.pos[1]+h.bottom.size[1]-c.size[1];break}a.dirty_canvas=!0,a.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(e,o,s,a,h){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:d,parentMenu:a});function d(c){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,c.toLowerCase(),h)}},LGraphCanvas.onGroupAlign=function(e,o,s,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:h,parentMenu:a});function h(d){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,d.toLowerCase())}},LGraphCanvas.onMenuAdd=function(e,o,s,a,h){var d=LGraphCanvas.active_canvas,c=d.getCanvasWindow(),g=d.graph;if(!g)return;function b($,et){var st=LiteGraph.getNodeTypesCategories(d.filter||g.filter).filter(function(nt){return nt.startsWith($)}),j=[];st.map(function(nt){if(nt){var lt=new RegExp("^("+$+")"),ct=nt.replace(lt,"").split("/")[0],ot=$===""?ct+"/":$+ct+"/",_e=ct;_e.indexOf("::")!=-1&&(_e=_e.split("::")[1]);var _=j.findIndex(function(at){return at.value===ot});_===-1&&j.push({value:ot,content:_e,has_submenu:!0,callback:function(at,it,pt,mt){b(at.value,mt)}})}});var tt=LiteGraph.getNodeTypesInCategory($.slice(0,-1),d.filter||g.filter);tt.map(function(nt){if(!nt.skip_list){var lt={value:nt.type,content:nt.title,has_submenu:!1,callback:function(ct,ot,_e,_){var at=_.getFirstEvent();d.graph.beforeChange();var it=LiteGraph.createNode(ct.value);it&&(it.pos=d.convertEventToCanvasOffset(at),d.graph.add(it)),h&&h(it),d.graph.afterChange()}};j.push(lt)}}),new LiteGraph.ContextMenu(j,{event:s,parentMenu:et},c)}return b("",a),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(e,b,s,a,h){if(!h)return;var d=this,c=LGraphCanvas.active_canvas,g=c.getCanvasWindow(),b=h.optional_inputs;h.onGetInputs&&(b=h.onGetInputs());var $=[];if(b)for(var et=0;et<b.length;et++){var st=b[et];if(!st){$.push(null);continue}var j=st[0];st[2]||(st[2]={}),st[2].label&&(j=st[2].label),st[2].removable=!0;var tt={content:j,value:st};st[1]==LiteGraph.ACTION&&(tt.className="event"),$.push(tt)}if(h.onMenuNodeInputs){var nt=h.onMenuNodeInputs($);nt&&($=nt)}if(!$.length){console.log("no input entries");return}new LiteGraph.ContextMenu($,{event:s,callback:lt,parentMenu:a,node:h},g);function lt(ct,ot,_e){h&&(ct.callback&&ct.callback.call(d,h,ct,ot,_e),ct.value&&(h.graph.beforeChange(),h.addInput(ct.value[0],ct.value[1],ct.value[2]),h.onNodeInputAdd&&h.onNodeInputAdd(ct.value),h.setDirtyCanvas(!0,!0),h.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(e,b,s,a,h){if(!h)return;var d=this,c=LGraphCanvas.active_canvas,g=c.getCanvasWindow(),b=h.optional_outputs;h.onGetOutputs&&(b=h.onGetOutputs());var $=[];if(b)for(var et=0;et<b.length;et++){var st=b[et];if(!st){$.push(null);continue}if(!(h.flags&&h.flags.skip_repeated_outputs&&h.findOutputSlot(st[0])!=-1)){var j=st[0];st[2]||(st[2]={}),st[2].label&&(j=st[2].label),st[2].removable=!0;var tt={content:j,value:st};st[1]==LiteGraph.EVENT&&(tt.className="event"),$.push(tt)}}if(this.onMenuNodeOutputs&&($=this.onMenuNodeOutputs($)),LiteGraph.do_add_triggers_slots&&h.findOutputSlot("onExecuted")==-1&&$.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),h.onMenuNodeOutputs){var nt=h.onMenuNodeOutputs($);nt&&($=nt)}if(!$.length)return;new LiteGraph.ContextMenu($,{event:s,callback:lt,parentMenu:a,node:h},g);function lt(ct,ot,_e){if(h&&(ct.callback&&ct.callback.call(d,h,ct,ot,_e),!!ct.value)){var _=ct.value[1];if(_&&(_.constructor===Object||_.constructor===Array)){var at=[];for(var it in _)at.push({content:it,value:_[it]});return new LiteGraph.ContextMenu(at,{event:ot,callback:lt,parentMenu:a,node:h}),!1}else h.graph.beforeChange(),h.addOutput(ct.value[0],ct.value[1],ct.value[2]),h.onNodeOutputAdd&&h.onNodeOutputAdd(ct.value),h.setDirtyCanvas(!0,!0),h.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(e,o,s,a,h){if(!h||!h.properties)return;var d=LGraphCanvas.active_canvas,c=d.getCanvasWindow(),g=[];for(var b in h.properties){var e=h.properties[b]!==void 0?h.properties[b]:" ";typeof e=="object"&&(e=JSON.stringify(e));var $=h.getPropertyInfo(b);($.type=="enum"||$.type=="combo")&&(e=LGraphCanvas.getPropertyPrintableValue(e,$.values)),e=LGraphCanvas.decodeHTML(e),g.push({content:"<span class='property_name'>"+($.label?$.label:b)+"</span><span class='property_value'>"+e+"</span>",value:b})}if(!g.length)return;new LiteGraph.ContextMenu(g,{event:s,callback:et,parentMenu:a,allow_html:!0,node:h},c);function et(st,j,tt,nt){if(h){var lt=this.getBoundingClientRect();d.showEditPropertyValue(h,st.value,{position:[lt.left,lt.top]})}}return!1},LGraphCanvas.decodeHTML=function(e){var o=document.createElement("div");return o.innerText=e,o.innerHTML},LGraphCanvas.onMenuResizeNode=function(e,o,s,a,h){if(h){var d=function(b){b.size=b.computeSize(),b.onResize&&b.onResize(b.size)},c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)d(h);else for(var g in c.selected_nodes)d(c.selected_nodes[g]);h.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(e,o){var s=this,a=s.graph.getNodeById(e.origin_id),h=s.graph.getNodeById(e.target_id),d=!1;a&&a.outputs&&a.outputs[e.origin_slot]&&(d=a.outputs[e.origin_slot].type);var c=!1;h&&h.outputs&&h.outputs[e.target_slot]&&(c=h.inputs[e.target_slot].type);var g=["Add Node",null,"Delete",null],b=new LiteGraph.ContextMenu(g,{event:o,title:e.data!=null?e.data.constructor.name:null,callback:$});function $(et,st,j){switch(et){case"Add Node":LGraphCanvas.onMenuAdd(null,null,j,b,function(tt){!tt.inputs||!tt.inputs.length||!tt.outputs||!tt.outputs.length||a.connectByType(e.origin_slot,tt,d)&&(tt.connectByType(e.target_slot,h,c),tt.pos[0]-=tt.size[0]*.5)});break;case"Delete":s.graph.removeLink(e.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(o){var o=o||{},s=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},o),a=this,h=s.nodeFrom&&s.slotFrom!==null,d=!h&&s.nodeTo&&s.slotTo!==null;if(!h&&!d)return console.warn("No data passed to createDefaultNodeForSlot "+s.nodeFrom+" "+s.slotFrom+" "+s.nodeTo+" "+s.slotTo),!1;if(!s.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var c=h?s.nodeFrom:s.nodeTo,g=h?s.slotFrom:s.slotTo,b=!1;switch(typeof g){case"string":b=h?c.findOutputSlot(g,!1):c.findInputSlot(g,!1),g=h?c.outputs[g]:c.inputs[g];break;case"object":b=h?c.findOutputSlot(g.name):c.findInputSlot(g.name);break;case"number":b=g,g=h?c.outputs[g]:c.inputs[g];break;case"undefined":default:return console.warn("Cant get slot information "+g),!1}(g===!1||b===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+g+" "+b);var $=g.type==LiteGraph.EVENT?"_event_":g.type,et=h?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(et&&et[$]){if(g.link,nodeNewType=!1,typeof et[$]=="object"||typeof et[$]=="array"){for(var st in et[$])if(s.nodeType==et[$][st]||s.nodeType=="AUTO"){nodeNewType=et[$][st];break}}else(s.nodeType==et[$]||s.nodeType=="AUTO")&&(nodeNewType=et[$]);if(nodeNewType){var j=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(j=nodeNewType,nodeNewType=nodeNewType.node);var tt=LiteGraph.createNode(nodeNewType);if(tt){if(j){if(j.properties)for(var nt in j.properties)tt.addProperty(nt,j.properties[nt]);if(j.inputs){tt.inputs=[];for(var nt in j.inputs)tt.addOutput(j.inputs[nt][0],j.inputs[nt][1])}if(j.outputs){tt.outputs=[];for(var nt in j.outputs)tt.addOutput(j.outputs[nt][0],j.outputs[nt][1])}j.title&&(tt.title=j.title),j.json&&tt.configure(j.json)}return a.graph.add(tt),tt.pos=[s.position[0]+s.posAdd[0]+(s.posSizeFix[0]?s.posSizeFix[0]*tt.size[0]:0),s.position[1]+s.posAdd[1]+(s.posSizeFix[1]?s.posSizeFix[1]*tt.size[1]:0)],h?s.nodeFrom.connectByType(b,tt,$):s.nodeTo.connectByTypeOutput(b,tt,$),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(o){var o=o||{},s=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},o),a=this,h=s.nodeFrom&&s.slotFrom,d=!h&&s.nodeTo&&s.slotTo;if(!h&&!d)return console.warn("No data passed to showConnectionMenu"),!1;var c=h?s.nodeFrom:s.nodeTo,g=h?s.slotFrom:s.slotTo,b=!1;switch(typeof g){case"string":b=h?c.findOutputSlot(g,!1):c.findInputSlot(g,!1),g=h?c.outputs[g]:c.inputs[g];break;case"object":b=h?c.findOutputSlot(g.name):c.findInputSlot(g.name);break;case"number":b=g,g=h?c.outputs[g]:c.inputs[g];break;default:return console.warn("Cant get slot information "+g),!1}var $=["Add Node",null];a.allow_searchbox&&($.push("Search"),$.push(null));var et=g.type==LiteGraph.EVENT?"_event_":g.type,st=h?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(st&&st[et])if(typeof st[et]=="object"||typeof st[et]=="array")for(var j in st[et])$.push(st[et][j]);else $.push(st[et]);var tt=new LiteGraph.ContextMenu($,{event:s.e,title:(g&&g.name!=""?g.name+(et?" | ":""):"")+(g&&et?et:""),callback:nt});function nt(lt,ct,ot){switch(lt){case"Add Node":LGraphCanvas.onMenuAdd(null,null,ot,tt,function(_e){h?s.nodeFrom.connectByType(b,_e,et):s.nodeTo.connectByTypeOutput(b,_e,et)});break;case"Search":h?a.showSearchBox(ot,{node_from:s.nodeFrom,slot_from:g,type_filter_in:et}):a.showSearchBox(ot,{node_to:s.nodeTo,slot_from:g,type_filter_out:et});break;default:a.createDefaultNodeForSlot(Object.assign(s,{position:[s.e.canvasX,s.e.canvasY],nodeType:lt}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(e,o,s,a,h){var d=e.property||"title",c=h[d],g=document.createElement("div");g.is_modified=!1,g.className="graphdialog",g.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",g.close=function(){g.parentNode&&g.parentNode.removeChild(g)};var b=g.querySelector(".name");b.innerText=d;var $=g.querySelector(".value");$&&($.value=c,$.addEventListener("blur",function(_){this.focus()}),$.addEventListener("keydown",function(_){if(g.is_modified=!0,_.keyCode==27)g.close();else if(_.keyCode==13)ot();else if(_.keyCode!=13&&_.target.localName!="textarea")return;_.preventDefault(),_.stopPropagation()}));var et=LGraphCanvas.active_canvas,st=et.canvas,j=st.getBoundingClientRect(),tt=-20,nt=-20;j&&(tt-=j.left,nt-=j.top),event?(g.style.left=event.clientX+tt+"px",g.style.top=event.clientY+nt+"px"):(g.style.left=st.width*.5+tt+"px",g.style.top=st.height*.5+nt+"px");var lt=g.querySelector("button");lt.addEventListener("click",ot),st.parentNode.appendChild(g),$&&$.focus();var ct=null;g.addEventListener("mouseleave",function(_){LiteGraph.dialog_close_on_mouse_leave&&!g.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(ct=setTimeout(g.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),g.addEventListener("mouseenter",function(_){LiteGraph.dialog_close_on_mouse_leave&&ct&&clearTimeout(ct)});function ot(){$&&_e($.value)}function _e(_){e.type=="Number"?_=Number(_):e.type=="Boolean"&&(_=!!_),h[d]=_,g.parentNode&&g.parentNode.removeChild(g),h.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(e,o,s,a,h){var d=this;e=e||"";var c=document.createElement("div");c.is_modified=!1,c.className="graphdialog rounded",h?c.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":c.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",c.close=function(){d.prompt_box=null,c.parentNode&&c.parentNode.removeChild(c)};var g=LGraphCanvas.active_canvas,b=g.canvas;b.parentNode.appendChild(c),this.ds.scale>1&&(c.style.transform="scale("+this.ds.scale+")");var $=null,et=!1;LiteGraph.pointerListenerAdd(c,"leave",function(_){et||LiteGraph.dialog_close_on_mouse_leave&&!c.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&($=setTimeout(c.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(c,"enter",function(_){LiteGraph.dialog_close_on_mouse_leave&&$&&clearTimeout($)});var st=c.querySelectorAll("select");st&&st.forEach(function(_){_.addEventListener("click",function(at){et++}),_.addEventListener("blur",function(at){et=0}),_.addEventListener("change",function(at){et=-1})}),d.prompt_box&&d.prompt_box.close(),d.prompt_box=c;var j=c.querySelector(".name");j.innerText=e;var tt=c.querySelector(".value");tt.value=o;var nt=tt;nt.addEventListener("keydown",function(_){if(c.is_modified=!0,_.keyCode==27)c.close();else if(_.keyCode==13&&_.target.localName!="textarea")s&&s(this.value),c.close();else return;_.preventDefault(),_.stopPropagation()});var lt=c.querySelector("button");lt.addEventListener("click",function(_){s&&s(nt.value),d.setDirty(!0),c.close()});var ct=b.getBoundingClientRect(),ot=-20,_e=-20;return ct&&(ot-=ct.left,_e-=ct.top),a?(c.style.left=a.clientX+ot+"px",c.style.top=a.clientY+_e+"px"):(c.style.left=b.width*.5+ot+"px",c.style.top=b.height*.5+_e+"px"),setTimeout(function(){nt.focus()},10),c},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(e,o){var s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};o=Object.assign(s,o||{});var a=this,h=LGraphCanvas.active_canvas,d=h.canvas,c=d.ownerDocument||document,g=document.createElement("div");if(g.className="litegraph litesearchbox graphdialog rounded",g.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",o.do_type_filter&&(g.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",g.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),g.innerHTML+="<div class='helper'></div>",c.fullscreenElement?c.fullscreenElement.appendChild(g):(c.body.appendChild(g),c.body.style.overflow="hidden"),o.do_type_filter)var b=g.querySelector(".slot_in_type_filter"),$=g.querySelector(".slot_out_type_filter");if(g.close=function(){a.search_box=null,this.blur(),d.focus(),c.body.style.overflow="",setTimeout(function(){a.canvas.focus()},20),g.parentNode&&g.parentNode.removeChild(g)},this.ds.scale>1&&(g.style.transform="scale("+this.ds.scale+")"),o.hide_on_mouse_leave){var et=!1,st=null;LiteGraph.pointerListenerAdd(g,"enter",function(Ot){st&&(clearTimeout(st),st=null)}),LiteGraph.pointerListenerAdd(g,"leave",function(Ot){et||(st=setTimeout(function(){g.close()},500))}),o.do_type_filter&&(b.addEventListener("click",function(Ot){et++}),b.addEventListener("blur",function(Ot){et=0}),b.addEventListener("change",function(Ot){et=-1}),$.addEventListener("click",function(Ot){et++}),$.addEventListener("blur",function(Ot){et=0}),$.addEventListener("change",function(Ot){et=-1}))}a.search_box&&a.search_box.close(),a.search_box=g;var j=g.querySelector(".helper"),tt=null,nt=null,lt=null,ct=g.querySelector("input");if(ct&&(ct.addEventListener("blur",function(Ot){a.search_box&&this.focus()}),ct.addEventListener("keydown",function(Ot){if(Ot.keyCode==38)Et(!1);else if(Ot.keyCode==40)Et(!0);else if(Ot.keyCode==27)g.close();else if(Ot.keyCode==13)Tt(),lt?_t(lt.innerHTML):tt?_t(tt):g.close();else{nt&&clearInterval(nt),nt=setTimeout(Tt,250);return}return Ot.preventDefault(),Ot.stopPropagation(),Ot.stopImmediatePropagation(),!0})),o.do_type_filter){if(b){var ot=LiteGraph.slot_types_in,_e=ot.length;(o.type_filter_in==LiteGraph.EVENT||o.type_filter_in==LiteGraph.ACTION)&&(o.type_filter_in="_event_");for(var _=0;_<_e;_++){var at=document.createElement("option");at.value=ot[_],at.innerHTML=ot[_],b.appendChild(at),o.type_filter_in!==!1&&(o.type_filter_in+"").toLowerCase()==(ot[_]+"").toLowerCase()&&(at.selected=!0)}b.addEventListener("change",function(){Tt()})}if($){var ot=LiteGraph.slot_types_out,_e=ot.length;(o.type_filter_out==LiteGraph.EVENT||o.type_filter_out==LiteGraph.ACTION)&&(o.type_filter_out="_event_");for(var _=0;_<_e;_++){var at=document.createElement("option");at.value=ot[_],at.innerHTML=ot[_],$.appendChild(at),o.type_filter_out!==!1&&(o.type_filter_out+"").toLowerCase()==(ot[_]+"").toLowerCase()&&(at.selected=!0)}$.addEventListener("change",function(){Tt()})}}var it=d.getBoundingClientRect(),pt=(e?e.clientX:it.left+it.width*.5)-80,mt=(e?e.clientY:it.top+it.height*.5)-20;g.style.left=pt+"px",g.style.top=mt+"px",e.layerY>it.height-200&&(j.style.maxHeight=it.height-e.layerY-20+"px"),ct.focus(),o.show_all_on_open&&Tt();function _t(Ot){if(Ot)if(a.onSearchBoxSelection)a.onSearchBoxSelection(Ot,e,h);else{var Ct=LiteGraph.searchbox_extras[Ot.toLowerCase()];Ct&&(Ot=Ct.type),h.graph.beforeChange();var St=LiteGraph.createNode(Ot);if(St&&(St.pos=h.convertEventToCanvasOffset(e),h.graph.add(St,!1)),Ct&&Ct.data){if(Ct.data.properties)for(var ft in Ct.data.properties)St.addProperty(ft,Ct.data.properties[ft]);if(Ct.data.inputs){St.inputs=[];for(var ft in Ct.data.inputs)St.addOutput(Ct.data.inputs[ft][0],Ct.data.inputs[ft][1])}if(Ct.data.outputs){St.outputs=[];for(var ft in Ct.data.outputs)St.addOutput(Ct.data.outputs[ft][0],Ct.data.outputs[ft][1])}Ct.data.title&&(St.title=Ct.data.title),Ct.data.json&&St.configure(Ct.data.json)}if(o.node_from){var yt=!1;switch(typeof o.slot_from){case"string":yt=o.node_from.findOutputSlot(o.slot_from);break;case"object":o.slot_from.name?yt=o.node_from.findOutputSlot(o.slot_from.name):yt=-1,yt==-1&&typeof o.slot_from.slot_index<"u"&&(yt=o.slot_from.slot_index);break;case"number":yt=o.slot_from;break;default:yt=0}typeof o.node_from.outputs[yt]<"u"&&yt!==!1&&yt>-1&&o.node_from.connectByType(yt,St,o.node_from.outputs[yt].type)}if(o.node_to){var yt=!1;switch(typeof o.slot_from){case"string":yt=o.node_to.findInputSlot(o.slot_from);break;case"object":o.slot_from.name?yt=o.node_to.findInputSlot(o.slot_from.name):yt=-1,yt==-1&&typeof o.slot_from.slot_index<"u"&&(yt=o.slot_from.slot_index);break;case"number":yt=o.slot_from;break;default:yt=0}typeof o.node_to.inputs[yt]<"u"&&yt!==!1&&yt>-1&&o.node_to.connectByTypeOutput(yt,St,o.node_to.inputs[yt].type)}h.graph.afterChange()}g.close()}function Et(Ot){var Ct=lt;lt&&lt.classList.remove("selected"),lt?(lt=Ot?lt.nextSibling:lt.previousSibling,lt||(lt=Ct)):lt=Ot?j.childNodes[0]:j.childNodes[j.childNodes.length],lt&&(lt.classList.add("selected"),lt.scrollIntoView({block:"end",behavior:"smooth"}))}function Tt(){nt=null;var Ot=ct.value;if(tt=null,j.innerHTML="",!Ot&&!o.show_all_if_empty)return;if(a.onSearchBox){var Ct=a.onSearchBox(j,Ot,h);if(Ct)for(var St=0;St<Ct.length;++St)Lt(Ct[St])}else{let At=function(Pt,rt){var rt=rt||{},vt={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},xt=Object.assign(vt,rt),wt=LiteGraph.registered_node_types[Pt];if(yt&&wt.filter!=yt||(!o.show_all_if_empty||Ot)&&Pt.toLowerCase().indexOf(Ot)===-1)return!1;if(o.do_type_filter&&!xt.skipFilter){var It=Pt,Nt=ut.value;if(xt.inTypeOverride!==!1&&(Nt=xt.inTypeOverride),ut&&Nt&&LiteGraph.registered_slot_in_types[Nt]&&LiteGraph.registered_slot_in_types[Nt].nodes){var Dt=LiteGraph.registered_slot_in_types[Nt].nodes.includes(It);if(Dt===!1)return!1}var Nt=bt.value;if(xt.outTypeOverride!==!1&&(Nt=xt.outTypeOverride),bt&&Nt&&LiteGraph.registered_slot_out_types[Nt]&&LiteGraph.registered_slot_out_types[Nt].nodes){var Dt=LiteGraph.registered_slot_out_types[Nt].nodes.includes(It);if(Dt===!1)return!1}}return!0};var Gt=At,ft=0;Ot=Ot.toLowerCase();var yt=h.filter||h.graph.filter;if(o.do_type_filter&&a.search_box)var ut=a.search_box.querySelector(".slot_in_type_filter"),bt=a.search_box.querySelector(".slot_out_type_filter");else var ut=!1,bt=!1;for(var St in LiteGraph.searchbox_extras){var ht=LiteGraph.searchbox_extras[St];if(!((!o.show_all_if_empty||Ot)&&ht.desc.toLowerCase().indexOf(Ot)===-1)){var dt=LiteGraph.registered_node_types[ht.type];if(!(dt&&dt.filter!=yt)&&At(ht.type)&&(Lt(ht.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&ft++>LGraphCanvas.search_limit))break}}var gt=null;if(Array.prototype.filter)var kt=Object.keys(LiteGraph.registered_node_types),gt=kt.filter(At);else{gt=[];for(var St in LiteGraph.registered_node_types)At(St)&&gt.push(St)}for(var St=0;St<gt.length&&(Lt(gt[St]),!(LGraphCanvas.search_limit!==-1&&ft++>LGraphCanvas.search_limit));St++);if(o.show_general_after_typefiltered&&(ut.value||bt.value)){filtered_extra=[];for(var St in LiteGraph.registered_node_types)At(St,{inTypeOverride:ut&&ut.value?"*":!1,outTypeOverride:bt&&bt.value?"*":!1})&&filtered_extra.push(St);for(var St=0;St<filtered_extra.length&&(Lt(filtered_extra[St],"generic_type"),!(LGraphCanvas.search_limit!==-1&&ft++>LGraphCanvas.search_limit));St++);}if((ut.value||bt.value)&&j.childNodes.length==0&&o.show_general_if_none_on_typefilter){filtered_extra=[];for(var St in LiteGraph.registered_node_types)At(St,{skipFilter:!0})&&filtered_extra.push(St);for(var St=0;St<filtered_extra.length&&(Lt(filtered_extra[St],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&ft++>LGraphCanvas.search_limit));St++);}}function Lt(At,Pt){var zt=document.createElement("div");tt||(tt=At),zt.innerText=At,zt.dataset.type=escape(At),zt.className="litegraph lite-search-item",Pt&&(zt.className+=" "+Pt),zt.addEventListener("click",function(rt){_t(unescape(this.dataset.type))}),j.appendChild(zt)}}return g},LGraphCanvas.prototype.showEditPropertyValue=function(e,o,s){if(!e||e.properties[o]===void 0)return;s=s||{};var a=e.getPropertyInfo(o),h=a.type,d="";if(h=="string"||h=="number"||h=="array"||h=="object")d="<input autofocus type='text' class='value'/>";else if((h=="enum"||h=="combo")&&a.values){d="<select autofocus type='text' class='value'>";for(var c in a.values){var g=c;a.values.constructor===Array&&(g=a.values[c]),d+="<option value='"+g+"' "+(g==e.properties[o]?"selected":"")+">"+a.values[c]+"</option>"}d+="</select>"}else if(h=="boolean"||h=="toggle")d="<input autofocus type='checkbox' class='value' "+(e.properties[o]?"checked":"")+"/>";else{console.warn("unknown type: "+h);return}var b=this.createDialog("<span class='name'>"+(a.label?a.label:o)+"</span>"+d+"<button>OK</button>",s),$=!1;if((h=="enum"||h=="combo")&&a.values)$=b.querySelector("select"),$.addEventListener("change",function(tt){b.modified(),j(tt.target.value)});else if(h=="boolean"||h=="toggle")$=b.querySelector("input"),$&&$.addEventListener("click",function(tt){b.modified(),j(!!$.checked)});else if($=b.querySelector("input"),$){$.addEventListener("blur",function(nt){this.focus()});var g=e.properties[o]!==void 0?e.properties[o]:"";h!=="string"&&(g=JSON.stringify(g)),$.value=g,$.addEventListener("keydown",function(nt){if(nt.keyCode==27)b.close();else if(nt.keyCode==13)st();else if(nt.keyCode!=13){b.modified();return}nt.preventDefault(),nt.stopPropagation()})}$&&$.focus();var et=b.querySelector("button");et.addEventListener("click",st);function st(){j($.value)}function j(tt){a&&a.values&&a.values.constructor===Object&&a.values[tt]!=null&&(tt=a.values[tt]),typeof e.properties[o]=="number"&&(tt=Number(tt)),(h=="array"||h=="object")&&(tt=JSON.parse(tt)),e.properties[o]=tt,e.graph&&e.graph._version++,e.onPropertyChanged&&e.onPropertyChanged(o,tt),s.onclose&&s.onclose(),b.close(),e.setDirtyCanvas(!0,!0)}return b},LGraphCanvas.prototype.createDialog=function(e,o){var s={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};o=Object.assign(s,o||{});var a=document.createElement("div");a.className="graphdialog",a.innerHTML=e,a.is_modified=!1;var h=this.canvas.getBoundingClientRect(),d=-20,c=-20;if(h&&(d-=h.left,c-=h.top),o.position?(d+=o.position[0],c+=o.position[1]):o.event?(d+=o.event.clientX,c+=o.event.clientY):(d+=this.canvas.width*.5,c+=this.canvas.height*.5),a.style.left=d+"px",a.style.top=c+"px",this.canvas.parentNode.appendChild(a),o.checkForInput){var g=[],b=!1;(g=a.querySelectorAll("input"))&&g.forEach(function(j){j.addEventListener("keydown",function(tt){if(a.modified(),tt.keyCode==27)a.close();else if(tt.keyCode!=13)return;tt.preventDefault(),tt.stopPropagation()}),b||j.focus()})}a.modified=function(){a.is_modified=!0},a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var $=null,et=!1;a.addEventListener("mouseleave",function(j){et||(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&($=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("mouseenter",function(j){(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&$&&clearTimeout($)});var st=a.querySelectorAll("select");return st&&st.forEach(function(j){j.addEventListener("click",function(tt){et++}),j.addEventListener("blur",function(tt){et=0}),j.addEventListener("change",function(tt){et=-1})}),a},LGraphCanvas.prototype.createPanel=function(e,o){o=o||{};var s=o.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),o.width&&(a.style.width=o.width+(o.width.constructor===Number?"px":"")),o.height&&(a.style.height=o.height+(o.height.constructor===Number?"px":"")),o.closable){var h=document.createElement("span");h.innerHTML="&#10005;",h.classList.add("close"),h.addEventListener("click",function(){a.close()}),a.header.appendChild(h)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.innerText=e,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.close=function(){a.onClose&&typeof a.onClose=="function"&&a.onClose(),a.parentNode&&a.parentNode.removeChild(a),this.parentNode&&this.parentNode.removeChild(this)},a.toggleAltContent=function(d){if(typeof d<"u")var c=d?"block":"none",g=d?"none":"block";else var c=a.alt_content.style.display!="block"?"block":"none",g=a.alt_content.style.display!="block"?"none":"block";a.alt_content.style.display=c,a.content.style.display=g},a.toggleFooterVisibility=function(d){if(typeof d<"u")var c=d?"block":"none";else var c=a.footer.style.display!="block"?"block":"none";a.footer.style.display=c},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(d,c,g){var b=document.createElement("div");return c&&(b.className=c),b.innerHTML=d,g?a.footer.appendChild(b):a.content.appendChild(b),b},a.addButton=function(d,c,g){var b=document.createElement("button");return b.innerText=d,b.options=g,b.classList.add("btn"),b.addEventListener("click",c),a.footer.appendChild(b),b},a.addSeparator=function(){var d=document.createElement("div");d.className="separator",a.content.appendChild(d)},a.addWidget=function(d,c,g,b,$){b=b||{};var et=String(g);d=d.toLowerCase(),d=="number"&&(et=g.toFixed(3));var st=document.createElement("div");st.className="property",st.innerHTML="<span class='property_name'></span><span class='property_value'></span>",st.querySelector(".property_name").innerText=b.label||c;var j=st.querySelector(".property_value");if(j.innerText=et,st.dataset.property=c,st.dataset.type=b.type||d,st.options=b,st.value=g,d=="code")st.addEventListener("click",function(nt){a.inner_showCodePad(this.dataset.property)});else if(d=="boolean")st.classList.add("boolean"),g&&st.classList.add("bool-on"),st.addEventListener("click",function(){var nt=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",tt(nt,this.value)});else if(d=="string"||d=="number")j.setAttribute("contenteditable",!0),j.addEventListener("keydown",function(nt){nt.code=="Enter"&&(d!="string"||!nt.shiftKey)&&(nt.preventDefault(),this.blur())}),j.addEventListener("blur",function(){var nt=this.innerText,lt=this.parentNode.dataset.property,ct=this.parentNode.dataset.type;ct=="number"&&(nt=Number(nt)),tt(lt,nt)});else if(d=="enum"||d=="combo"){var et=LGraphCanvas.getPropertyPrintableValue(g,b.values);j.innerText=et,j.addEventListener("click",function(lt){var ct=b.values||[],ot=this.parentNode.dataset.property,_e=this;new LiteGraph.ContextMenu(ct,{event:lt,className:"dark",callback:_},s);function _(at,it,pt){return _e.innerText=at,tt(ot,at),!1}})}a.content.appendChild(st);function tt(nt,lt){b.callback&&b.callback(nt,lt,b),$&&$(nt,lt,b)}return st},a.onOpen&&typeof a.onOpen=="function"&&a.onOpen(),a},LGraphCanvas.getPropertyPrintableValue=function(e,o){if(!o||o.constructor===Array)return String(e);if(o.constructor===Object){var s="";for(var a in o)if(o[a]==e){s=a;break}return String(e)+" ("+s+")"}},LGraphCanvas.prototype.closePanels=function(){var e=document.querySelector("#node-panel");e&&e.close();var e=document.querySelector("#option-panel");e&&e.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(e,o,s,a){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!o||!o.event||!o.event.target||!o.event.target.lgraphcanvas){console.warn("Canvas not found");return}var h=o.event.target.lgraphcanvas}else var h=this;h.closePanels();var d=h.getCanvasWindow();panel=h.createPanel("Options",{closable:!0,window:d,onOpen:function(){h.OPTIONPANEL_IS_OPEN=!0},onClose:function(){h.OPTIONPANEL_IS_OPEN=!1,h.options_panel=null}}),h.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function c(){panel.content.innerHTML="";var g=function(st,j,tt){switch(st){default:tt&&tt.key&&(st=tt.key),tt.values&&(j=Object.values(tt.values).indexOf(j)),h[st]=j;break}},b=LiteGraph.availableCanvasOptions;b.sort();for(var $ in b){var et=b[$];panel.addWidget("boolean",et,h[et],{key:et,on:"True",off:"False"},g)}h.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[h.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},g),panel.addSeparator(),panel.footer.innerHTML=""}c(),h.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(e){this.SELECTED_NODE=e,this.closePanels();var o=this.getCanvasWindow(),s=this,a=this.createPanel(e.title||"",{closable:!0,window:o,onOpen:function(){s.NODEPANEL_IS_OPEN=!0},onClose:function(){s.NODEPANEL_IS_OPEN=!1,s.node_panel=null}});s.node_panel=a,a.id="node-panel",a.node=e,a.classList.add("settings");function h(){a.content.innerHTML="",a.addHTML("<span class='node_type'>"+e.type+"</span><span class='node_desc'>"+(e.constructor.desc||"")+"</span><span class='separator'></span>"),a.addHTML("<h3>Properties</h3>");var d=function(et,st){switch(s.graph.beforeChange(e),et){case"Title":e.title=st;break;case"Mode":var j=Object.values(LiteGraph.NODE_MODES).indexOf(st);j>=0&&LiteGraph.NODE_MODES[j]?e.changeMode(j):console.warn("unexpected mode: "+st);break;case"Color":LGraphCanvas.node_colors[st]?(e.color=LGraphCanvas.node_colors[st].color,e.bgcolor=LGraphCanvas.node_colors[st].bgcolor):console.warn("unexpected color: "+st);break;default:e.setProperty(et,st);break}s.graph.afterChange(),s.dirty_canvas=!0};a.addWidget("string","Title",e.title,{},d),a.addWidget("combo","Mode",LiteGraph.NODE_MODES[e.mode],{values:LiteGraph.NODE_MODES},d);var c="";e.color!==void 0&&(c=Object.keys(LGraphCanvas.node_colors).filter(function(et){return LGraphCanvas.node_colors[et].color==e.color})),a.addWidget("combo","Color",c,{values:Object.keys(LGraphCanvas.node_colors)},d);for(var g in e.properties){var b=e.properties[g],$=e.getPropertyInfo(g);$.type,!(e.onAddPropertyToPanel&&e.onAddPropertyToPanel(g,a))&&a.addWidget($.widget||$.type,g,b,$,d)}a.addSeparator(),e.onShowCustomPanelInfo&&e.onShowCustomPanelInfo(a),a.footer.innerHTML="",a.addButton("Delete",function(){e.block_delete||(e.graph.remove(e),a.close())}).classList.add("delete")}a.inner_showCodePad=function(d){a.classList.remove("settings"),a.classList.add("centered"),a.alt_content.innerHTML="<textarea class='code'></textarea>";var c=a.alt_content.querySelector("textarea"),g=function(){a.toggleAltContent(!1),a.toggleFooterVisibility(!0),c.parentNode.removeChild(c),a.classList.add("settings"),a.classList.remove("centered"),h()};c.value=e.properties[d],c.addEventListener("keydown",function(et){et.code=="Enter"&&et.ctrlKey&&(e.setProperty(d,c.value),g())}),a.toggleAltContent(!0),a.toggleFooterVisibility(!1),c.style.height="calc(100% - 40px)";var b=a.addButton("Assign",function(){e.setProperty(d,c.value),g()});a.alt_content.appendChild(b);var $=a.addButton("Close",g);$.style.float="right",a.alt_content.appendChild($)},h(),this.canvas.parentNode.appendChild(a)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(e){console.log("showing subgraph properties dialog");var o=this.canvas.parentNode.querySelector(".subgraph_dialog");o&&o.close();var s=this.createPanel("Subgraph Inputs",{closable:!0,width:500});s.node=e,s.classList.add("subgraph_dialog");function a(){if(s.clear(),e.inputs)for(var c=0;c<e.inputs.length;++c){var g=e.inputs[c];if(!g.not_subgraph_input){var b="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",$=s.addHTML(b,"subgraph_property");$.dataset.name=g.name,$.dataset.slot=c,$.querySelector(".name").innerText=g.name,$.querySelector(".type").innerText=g.type,$.querySelector("button").addEventListener("click",function(et){e.removeInput(Number(this.parentNode.dataset.slot)),a()})}}}var h=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",d=s.addHTML(h,"subgraph_property extra",!0);return d.querySelector("button").addEventListener("click",function(c){var g=this.parentNode,b=g.querySelector(".name").value,$=g.querySelector(".type").value;!b||e.findInputSlot(b)!=-1||(e.addInput(b,$),g.querySelector(".name").value="",g.querySelector(".type").value="",a())}),a(),this.canvas.parentNode.appendChild(s),s},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(e){var o=this.canvas.parentNode.querySelector(".subgraph_dialog");o&&o.close();var s=this.createPanel("Subgraph Outputs",{closable:!0,width:500});s.node=e,s.classList.add("subgraph_dialog");function a(){if(s.clear(),e.outputs)for(var g=0;g<e.outputs.length;++g){var b=e.outputs[g];if(!b.not_subgraph_output){var $="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",et=s.addHTML($,"subgraph_property");et.dataset.name=b.name,et.dataset.slot=g,et.querySelector(".name").innerText=b.name,et.querySelector(".type").innerText=b.type,et.querySelector("button").addEventListener("click",function(st){e.removeOutput(Number(this.parentNode.dataset.slot)),a()})}}}var h=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",d=s.addHTML(h,"subgraph_property extra",!0);d.querySelector(".name").addEventListener("keydown",function(g){g.keyCode==13&&c.apply(this)}),d.querySelector("button").addEventListener("click",function(g){c.apply(this)});function c(){var g=this.parentNode,b=g.querySelector(".name").value,$=g.querySelector(".type").value;!b||e.findOutputSlot(b)!=-1||(e.addOutput(b,$),g.querySelector(".name").value="",g.querySelector(".type").value="",a())}return a(),this.canvas.parentNode.appendChild(s),s},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var e=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),o=0;o<e.length;++o){var s=e[o];s.node&&(!s.node.graph||s.graph!=this.graph)&&s.close()}},LGraphCanvas.onMenuNodeCollapse=function(e,o,s,a,h){h.graph.beforeChange();var d=function(b){b.collapse()},c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)d(h);else for(var g in c.selected_nodes)d(c.selected_nodes[g]);h.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(e,o,s,a,h){h.pin()},LGraphCanvas.onMenuNodeMode=function(e,o,s,a,h){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:d,parentMenu:a,node:h});function d(c){if(h){var g=Object.values(LiteGraph.NODE_MODES).indexOf(c),b=function(st){g>=0&&LiteGraph.NODE_MODES[g]?st.changeMode(g):(console.warn("unexpected mode: "+c),st.changeMode(LiteGraph.ALWAYS))},$=LGraphCanvas.active_canvas;if(!$.selected_nodes||Object.keys($.selected_nodes).length<=1)b(h);else for(var et in $.selected_nodes)b($.selected_nodes[et])}}return!1},LGraphCanvas.onMenuNodeColors=function(e,o,s,a,h){if(!h)throw"no node for color";var d=[];d.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var c in LGraphCanvas.node_colors){var g=LGraphCanvas.node_colors[c],e={value:c,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+g.color+"; background-color:"+g.bgcolor+"'>"+c+"</span>"};d.push(e)}new LiteGraph.ContextMenu(d,{event:s,callback:b,parentMenu:a,node:h});function b($){if(h){var et=$.value?LGraphCanvas.node_colors[$.value]:null,st=function(nt){et?nt.constructor===LiteGraph.LGraphGroup?nt.color=et.groupcolor:(nt.color=et.color,nt.bgcolor=et.bgcolor):(delete nt.color,delete nt.bgcolor)},j=LGraphCanvas.active_canvas;if(!j.selected_nodes||Object.keys(j.selected_nodes).length<=1)st(h);else for(var tt in j.selected_nodes)st(j.selected_nodes[tt]);h.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(e,o,s,a,h){if(!h)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:d,parentMenu:a,node:h});function d(c){if(h){h.graph.beforeChange();var g=function(et){et.shape=c},b=LGraphCanvas.active_canvas;if(!b.selected_nodes||Object.keys(b.selected_nodes).length<=1)g(h);else for(var $ in b.selected_nodes)g(b.selected_nodes[$]);h.graph.afterChange(),h.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(e,o,s,a,h){if(!h)throw"no node passed";var d=h.graph;d.beforeChange();var c=function($){$.removable!==!1&&d.remove($)},g=LGraphCanvas.active_canvas;if(!g.selected_nodes||Object.keys(g.selected_nodes).length<=1)c(h);else for(var b in g.selected_nodes)c(g.selected_nodes[b]);d.afterChange(),h.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(e,o,s,a,h){var d=h.graph,c=LGraphCanvas.active_canvas;if(c){var g=Object.values(c.selected_nodes||{});g.length||(g=[h]);var b=LiteGraph.createNode("graph/subgraph");b.pos=h.pos.concat(),d.add(b),b.buildFromNodes(g),c.deselectAllNodes(),h.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(e,o,s,a,h){h.graph.beforeChange();var d={},c=function($){if($.clonable!==!1){var et=$.clone();et&&(et.pos=[$.pos[0]+5,$.pos[1]+5],$.graph.add(et),d[et.id]=et)}},g=LGraphCanvas.active_canvas;if(!g.selected_nodes||Object.keys(g.selected_nodes).length<=1)c(h);else for(var b in g.selected_nodes)c(g.selected_nodes[b]);Object.keys(d).length&&g.selectNodes(d),h.graph.afterChange(),h.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var e=null;if(this.getMenuOptions?e=this.getMenuOptions():(e=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&e.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&e.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var o=this.getExtraMenuOptions(this,e);o&&(e=e.concat(o))}return e},LGraphCanvas.prototype.getNodeMenuOptions=function(e){var o=null;if(e.getMenuOptions?o=e.getMenuOptions(this):(o=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],e.resizable!==!1&&o.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),o.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),e.onGetInputs){var s=e.onGetInputs();s&&s.length&&(o[0].disabled=!1)}if(e.onGetOutputs){var a=e.onGetOutputs();a&&a.length&&(o[1].disabled=!1)}if(e.getExtraMenuOptions){var h=e.getExtraMenuOptions(this,o);h&&(h.push(null),o=h.concat(o))}return e.clonable!==!1&&o.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&o.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),o.push(null,{content:"Remove",disabled:!(e.removable!==!1&&!e.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),e.graph&&e.graph.onGetNodeMenuOptions&&e.graph.onGetNodeMenuOptions(o,e),o},LGraphCanvas.prototype.getGroupMenuOptions=function(e){var o=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return o},LGraphCanvas.prototype.processContextMenu=function(e,o){var s=this,a=LGraphCanvas.active_canvas,h=a.getCanvasWindow(),d=null,c={event:o,callback:et,extra:e};e&&(c.title=e.type);var g=null;if(e&&(g=e.getSlotInPosition(o.canvasX,o.canvasY),LGraphCanvas.active_node=e),g){if(d=[],e.getSlotMenuOptions)d=e.getSlotMenuOptions(g);else{g&&g.output&&g.output.links&&g.output.links.length&&d.push({content:"Disconnect Links",slot:g});var b=g.input||g.output;b.removable&&d.push(b.locked?"Cannot remove":{content:"Remove Slot",slot:g}),b.nameLocked||d.push({content:"Rename Slot",slot:g})}c.title=(g.input?g.input.type:g.output.type)||"*",g.input&&g.input.type==LiteGraph.ACTION&&(c.title="Action"),g.output&&g.output.type==LiteGraph.EVENT&&(c.title="Event")}else if(e)d=this.getNodeMenuOptions(e);else{d=this.getCanvasMenuOptions();var $=this.graph.getGroupOnPos(o.canvasX,o.canvasY);$&&d.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:$,options:this.getGroupMenuOptions($)}})}if(!d)return;new LiteGraph.ContextMenu(d,c,h);function et(st,j,tt){if(st){if(st.content=="Remove Slot"){var nt=st.slot;e.graph.beforeChange(),nt.input?e.removeInput(nt.slot):nt.output&&e.removeOutput(nt.slot),e.graph.afterChange();return}else if(st.content=="Disconnect Links"){var nt=st.slot;e.graph.beforeChange(),nt.output?e.disconnectOutput(nt.slot):nt.input&&e.disconnectInput(nt.slot),e.graph.afterChange();return}else if(st.content=="Rename Slot"){var nt=st.slot,lt=nt.input?e.getInputInfo(nt.slot):e.getOutputInfo(nt.slot),ct=s.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",j),ot=ct.querySelector("input");ot&&lt&&(ot.value=lt.label||"");var _e=function(){e.graph.beforeChange(),ot.value&&(lt&&(lt.label=ot.value),s.setDirty(!0)),ct.close(),e.graph.afterChange()};ct.querySelector("button").addEventListener("click",_e),ot.addEventListener("keydown",function(at){if(ct.is_modified=!0,at.keyCode==27)ct.close();else if(at.keyCode==13)_e();else if(at.keyCode!=13&&at.target.localName!="textarea")return;at.preventDefault(),at.stopPropagation()}),ot.focus()}}}};function compareObjects(e,o){for(var s in e)if(e[s]!=o[s])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(e,o){return Math.sqrt((o[0]-e[0])*(o[0]-e[0])+(o[1]-e[1])*(o[1]-e[1]))}LiteGraph.distance=distance;function colorToString(e){return"rgba("+Math.round(e[0]*255).toFixed()+","+Math.round(e[1]*255).toFixed()+","+Math.round(e[2]*255).toFixed()+","+(e.length==4?e[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(e,o,s,a,h,d){return s<e&&s+h>e&&a<o&&a+d>o}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(e,o,s){o<e[0]?e[0]=o:o>e[2]&&(e[2]=o),s<e[1]?e[1]=s:s>e[3]&&(e[3]=s)}LiteGraph.growBounding=growBounding;function isInsideBounding(e,o){return!(e[0]<o[0][0]||e[1]<o[0][1]||e[0]>o[1][0]||e[1]>o[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(e,o){var s=e[0]+e[2],a=e[1]+e[3],h=o[0]+o[2],d=o[1]+o[3];return!(e[0]>h||e[1]>d||s<o[0]||a<o[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(e){e.charAt(0)=="#"&&(e=e.slice(1)),e=e.toUpperCase();for(var o="0123456789ABCDEF",s=new Array(3),a=0,h,d,c=0;c<6;c+=2)h=o.indexOf(e.charAt(c)),d=o.indexOf(e.charAt(c+1)),s[a]=h*16+d,a++;return s}LiteGraph.hex2num=hex2num;function num2hex(e){for(var o="0123456789ABCDEF",s="#",a,h,d=0;d<3;d++)a=e[d]/16,h=e[d]%16,s+=o.charAt(a)+o.charAt(h);return s}LiteGraph.num2hex=num2hex;function ContextMenu(e,o){o=o||{},this.options=o;var s=this;o.parentMenu&&(o.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),o.parentMenu=null):(this.parentMenu=o.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var a=null;o.event&&(a=o.event.constructor.name),a!=="MouseEvent"&&a!=="CustomEvent"&&a!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+a+")"),o.event=null);var h=document.createElement("div");h.className="litegraph litecontextmenu litemenubar-panel",o.className&&(h.className+=" "+o.className),h.style.minWidth=100,h.style.minHeight=100,h.style.pointerEvents="none",setTimeout(function(){h.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(h,"up",function(ct){return ct.preventDefault(),!0},!0),h.addEventListener("contextmenu",function(ct){return ct.button!=2||ct.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(h,"down",function(ct){if(ct.button==2)return s.close(),ct.preventDefault(),!0},!0);function d(ct){var ot=parseInt(h.style.top);return h.style.top=(ot+ct.deltaY*o.scroll_speed).toFixed()+"px",ct.preventDefault(),!0}if(o.scroll_speed||(o.scroll_speed=.1),h.addEventListener("wheel",d,!0),h.addEventListener("mousewheel",d,!0),this.root=h,o.title){var c=document.createElement("div");c.className="litemenu-title",c.innerHTML=o.title,h.appendChild(c)}for(var g=0;g<e.length;g++){var b=e.constructor==Array?e[g]:g;b!=null&&b.constructor!==String&&(b=b.content===void 0?String(b):b.content);var $=e[g];this.addItem(b,$,o)}LiteGraph.pointerListenerAdd(h,"enter",function(ct){h.closing_timer&&clearTimeout(h.closing_timer)});var et=document;o.event&&(et=o.event.target.ownerDocument),et||(et=document),et.fullscreenElement?et.fullscreenElement.appendChild(h):et.body.appendChild(h);var st=o.left||0,j=o.top||0;if(o.event){if(st=o.event.clientX-10,j=o.event.clientY-10,o.title&&(j-=20),o.parentMenu){var tt=o.parentMenu.root.getBoundingClientRect();st=tt.left+tt.width}var nt=document.body.getBoundingClientRect(),lt=h.getBoundingClientRect();nt.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),nt.width&&st>nt.width-lt.width-10&&(st=nt.width-lt.width-10),nt.height&&j>nt.height-lt.height-10&&(j=nt.height-lt.height-10)}h.style.left=st+"px",h.style.top=j+"px",o.scale&&(h.style.transform="scale("+o.scale+")")}ContextMenu.prototype.addItem=function(e,o,s){var a=this;s=s||{};var h=document.createElement("div");h.className="litemenu-entry submenu";var d=!1;o===null?h.classList.add("separator"):(h.innerHTML=o&&o.title?o.title:e,h.value=o,o&&(o.disabled&&(d=!0,h.classList.add("disabled")),(o.submenu||o.has_submenu)&&h.classList.add("has_submenu")),typeof o=="function"?(h.dataset.value=e,h.onclick_callback=o):h.dataset.value=o,o.className&&(h.className+=" "+o.className)),this.root.appendChild(h),d||h.addEventListener("click",g),!d&&s.autoopen&&LiteGraph.pointerListenerAdd(h,"enter",c);function c(b){var $=this.value;!$||!$.has_submenu||g.call(this,b)}function g(b){var $=this.value,et=!0;if(a.current_submenu&&a.current_submenu.close(b),s.callback){var st=s.callback.call(this,$,s,b,a,s.node);st===!0&&(et=!1)}if($){if($.callback&&!s.ignore_item_callbacks&&$.disabled!==!0){var st=$.callback.call(this,$,s,b,a,s.extra);st===!0&&(et=!1)}if($.submenu){if(!$.submenu.options)throw"ContextMenu submenu needs options";new a.constructor($.submenu.options,{callback:$.submenu.callback,event:b,parentMenu:a,ignore_item_callbacks:$.submenu.ignore_item_callbacks,title:$.submenu.title,extra:$.submenu.extra,autoopen:s.autoopen}),et=!1}}et&&!a.lock&&a.close()}return h},ContextMenu.prototype.close=function(e,o){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!o&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,e===void 0?this.parentMenu.close():e&&!ContextMenu.isCursorOverElement(e,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",e)),this.current_submenu&&this.current_submenu.close(e,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(e,o,s,a){var h=document.createEvent("CustomEvent");return h.initCustomEvent(o,!0,!0,s),h.srcElement=a,e.dispatchEvent?e.dispatchEvent(h):e.__events&&e.__events.dispatchEvent(h),h},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(e,o){var s=e.clientX,a=e.clientY,h=o.getBoundingClientRect();return h?a>h.top&&a<h.top+h.height&&s>h.left&&s<h.left+h.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(e){e=e||window;var o=e.document.querySelectorAll(".litecontextmenu");if(o.length){for(var s=[],a=0;a<o.length;a++)s.push(o[a]);for(var a=0;a<s.length;a++)s[a].close?s[a].close():s[a].parentNode&&s[a].parentNode.removeChild(s[a])}},LiteGraph.extendClass=function(e,o){for(var s in o)e.hasOwnProperty(s)||(e[s]=o[s]);if(o.prototype)for(var s in o.prototype)o.prototype.hasOwnProperty(s)&&(e.prototype.hasOwnProperty(s)||(o.prototype.__lookupGetter__(s)?e.prototype.__defineGetter__(s,o.prototype.__lookupGetter__(s)):e.prototype[s]=o.prototype[s],o.prototype.__lookupSetter__(s)&&e.prototype.__defineSetter__(s,o.prototype.__lookupSetter__(s))))};function CurveEditor(e){this.points=e,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(e,o){if(o){for(var s=0;s<o.length-1;++s){var a=o[s],h=o[s+1];if(!(h[0]<e)){var d=h[0]-a[0];if(Math.abs(d)<1e-5)return a[1];var c=(e-a[0])/d;return a[1]*(1-c)+h[1]*c}}return 0}},CurveEditor.prototype.draw=function(e,o,s,a,h,d){var c=this.points;if(c){this.size=o;var g=o[0]-this.margin*2,b=o[1]-this.margin*2;h=h||"#666",e.save(),e.translate(this.margin,this.margin),a&&(e.fillStyle="#111",e.fillRect(0,0,g,b),e.fillStyle="#222",e.fillRect(g*.5,0,1,b),e.strokeStyle="#333",e.strokeRect(0,0,g,b)),e.strokeStyle=h,d&&(e.globalAlpha=.5),e.beginPath();for(var $=0;$<c.length;++$){var et=c[$];e.lineTo(et[0]*g,(1-et[1])*b)}if(e.stroke(),e.globalAlpha=1,!d)for(var $=0;$<c.length;++$){var et=c[$];e.fillStyle=this.selected==$?"#FFF":this.nearest==$?"#DDD":"#AAA",e.beginPath(),e.arc(et[0]*g,(1-et[1])*b,2,0,Math.PI*2),e.fill()}e.restore()}},CurveEditor.prototype.onMouseDown=function(e,o){var s=this.points;if(s&&!(e[1]<0)){var a=this.size[0]-this.margin*2,h=this.size[1]-this.margin*2,d=e[0]-this.margin,c=e[1]-this.margin,g=[d,c],b=30/o.ds.scale;if(this.selected=this.getCloserPoint(g,b),this.selected==-1){var $=[d/a,1-c/h];s.push($),s.sort(function(et,st){return et[0]-st[0]}),this.selected=s.indexOf($),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(e,o){var s=this.points;if(s){var a=this.selected;if(!(a<0)){var h=(e[0]-this.margin)/(this.size[0]-this.margin*2),d=(e[1]-this.margin)/(this.size[1]-this.margin*2),c=[e[0]-this.margin,e[1]-this.margin],g=30/o.ds.scale;this._nearest=this.getCloserPoint(c,g);var b=s[a];if(b){var $=a==0||a==s.length-1;if(!$&&(e[0]<-10||e[0]>this.size[0]+10||e[1]<-10||e[1]>this.size[1]+10)){s.splice(a,1),this.selected=-1;return}$?b[0]=a==0?0:1:b[0]=clamp(h,0,1),b[1]=1-clamp(d,0,1),s.sort(function(et,st){return et[0]-st[0]}),this.selected=s.indexOf(b),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(e,o){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(e,o){var s=this.points;if(!s)return-1;o=o||30;for(var a=this.size[0]-this.margin*2,h=this.size[1]-this.margin*2,d=s.length,c=[0,0],g=1e6,b=-1,$=0;$<d;++$){var et=s[$];c[0]=et[0]*a,c[1]=(1-et[1])*h,c[0]<e[0];var st=vec2.distance(e,c);st>g||st>o||(b=$,g=st)}return b},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(e){return(e+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(e,o,s,a=!1){if(!(!e||!e.addEventListener||!o||typeof s!="function")){var h=LiteGraph.pointerevents_method,d=o;if(h=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+d+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),d){case"down":{h="touch",d="start";break}case"move":{h="touch";break}case"up":{h="touch",d="end";break}case"cancel":{h="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+d+" would not be called")}switch(d){case"down":case"up":case"move":case"over":case"out":case"enter":e.addEventListener(h+d,s,a);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(h!="mouse")return e.addEventListener(h+d,s,a);default:return e.addEventListener(d,s,a)}}},LiteGraph.pointerListenerRemove=function(e,o,s,a=!1){if(!(!e||!e.removeEventListener||!o||typeof s!="function"))switch(o){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&e.removeEventListener(LiteGraph.pointerevents_method+o,s,a);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return e.removeEventListener(LiteGraph.pointerevents_method+o,s,a);default:return e.removeEventListener(o,s,a)}};function clamp(e,o,s){return o>e?o:s<e?s:e}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)})})(commonjsGlobal),exports.LiteGraph=commonjsGlobal.LiteGraph,exports.LGraph=commonjsGlobal.LGraph,exports.LLink=commonjsGlobal.LLink,exports.LGraphNode=commonjsGlobal.LGraphNode,exports.LGraphGroup=commonjsGlobal.LGraphGroup,exports.DragAndScale=commonjsGlobal.DragAndScale,exports.LGraphCanvas=commonjsGlobal.LGraphCanvas,exports.ContextMenu=commonjsGlobal.ContextMenu,function(e){var o=e.LiteGraph;function s(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}s.title="Time",s.desc="Time",s.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},o.registerNodeType("basic/time",s);function a(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new o.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}a.title="Subgraph",a.desc="Graph inside a node",a.title_color="#334",a.prototype.onGetInputs=function(){return[["enabled","boolean"]]},a.prototype.onDblClick=function(ft,yt,ut){var bt=this;setTimeout(function(){ut.openSubgraph(bt.subgraph)},10)},a.prototype.onAction=function(ft,yt){this.subgraph.onAction(ft,yt)},a.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var ft=0;ft<this.inputs.length;ft++){var yt=this.inputs[ft],ut=this.getInputData(ft);this.subgraph.setInputData(yt.name,ut)}if(this.subgraph.runStep(),this.outputs)for(var ft=0;ft<this.outputs.length;ft++){var bt=this.outputs[ft],ut=this.subgraph.getOutputData(bt.name);this.setOutputData(ft,ut)}}},a.prototype.sendEventToAllNodes=function(ft,yt,ut){this.enabled&&this.subgraph.sendEventToAllNodes(ft,yt,ut)},a.prototype.onDrawBackground=function(ft,yt,ut,bt){if(this.flags.collapsed)return;var ht=this.size[1]-o.NODE_TITLE_HEIGHT+.5,dt=o.isInsideRectangle(bt[0],bt[1],this.pos[0],this.pos[1]+ht,this.size[0],o.NODE_TITLE_HEIGHT);let gt=o.isInsideRectangle(bt[0],bt[1],this.pos[0],this.pos[1]+ht,this.size[0]/2,o.NODE_TITLE_HEIGHT);ft.fillStyle=dt?"#555":"#222",ft.beginPath(),this._shape==o.BOX_SHAPE?gt?ft.rect(0,ht,this.size[0]/2+1,o.NODE_TITLE_HEIGHT):ft.rect(this.size[0]/2,ht,this.size[0]/2+1,o.NODE_TITLE_HEIGHT):gt?ft.roundRect(0,ht,this.size[0]/2+1,o.NODE_TITLE_HEIGHT,[0,0,8,8]):ft.roundRect(this.size[0]/2,ht,this.size[0]/2+1,o.NODE_TITLE_HEIGHT,[0,0,8,8]),dt?ft.fill():ft.fillRect(0,ht,this.size[0]+1,o.NODE_TITLE_HEIGHT),ft.textAlign="center",ft.font="24px Arial",ft.fillStyle=dt?"#DDD":"#999",ft.fillText("+",this.size[0]*.25,ht+24),ft.fillText("+",this.size[0]*.75,ht+24)},a.prototype.onMouseDown=function(ft,yt,ut){var bt=this.size[1]-o.NODE_TITLE_HEIGHT+.5;console.log(0),yt[1]>bt&&(yt[0]<this.size[0]/2?(console.log(1),ut.showSubgraphPropertiesDialog(this)):(console.log(2),ut.showSubgraphPropertiesDialogRight(this)))},a.prototype.computeSize=function(){var ft=this.inputs?this.inputs.length:0,yt=this.outputs?this.outputs.length:0;return[200,Math.max(ft,yt)*o.NODE_SLOT_HEIGHT+o.NODE_TITLE_HEIGHT]},a.prototype.onSubgraphTrigger=function(ft,yt){var ut=this.findOutputSlot(ft);ut!=-1&&this.triggerSlot(ut)},a.prototype.onSubgraphNewInput=function(ft,yt){var ut=this.findInputSlot(ft);ut==-1&&this.addInput(ft,yt)},a.prototype.onSubgraphRenamedInput=function(ft,yt){var ut=this.findInputSlot(ft);if(ut!=-1){var bt=this.getInputInfo(ut);bt.name=yt}},a.prototype.onSubgraphTypeChangeInput=function(ft,yt){var ut=this.findInputSlot(ft);if(ut!=-1){var bt=this.getInputInfo(ut);bt.type=yt}},a.prototype.onSubgraphRemovedInput=function(ft){var yt=this.findInputSlot(ft);yt!=-1&&this.removeInput(yt)},a.prototype.onSubgraphNewOutput=function(ft,yt){var ut=this.findOutputSlot(ft);ut==-1&&this.addOutput(ft,yt)},a.prototype.onSubgraphRenamedOutput=function(ft,yt){var ut=this.findOutputSlot(ft);if(ut!=-1){var bt=this.getOutputInfo(ut);bt.name=yt}},a.prototype.onSubgraphTypeChangeOutput=function(ft,yt){var ut=this.findOutputSlot(ft);if(ut!=-1){var bt=this.getOutputInfo(ut);bt.type=yt}},a.prototype.onSubgraphRemovedOutput=function(ft){var yt=this.findOutputSlot(ft);yt!=-1&&this.removeOutput(yt)},a.prototype.getExtraMenuOptions=function(ft){var yt=this;return[{content:"Open",callback:function(){ft.openSubgraph(yt.subgraph)}}]},a.prototype.onResize=function(ft){ft[1]+=20},a.prototype.serialize=function(){var ft=o.LGraphNode.prototype.serialize.call(this);return ft.subgraph=this.subgraph.serialize(),ft},a.prototype.reassignSubgraphUUIDs=function(ft){const yt={nodeIDs:{},linkIDs:{}};for(const ut of ft.nodes){const bt=ut.id,ht=o.uuidv4();if(ut.id=ht,yt.nodeIDs[bt]||yt.nodeIDs[ht])throw new Error(`New/old node UUID wasn't unique in changed map! ${bt} ${ht}`);yt.nodeIDs[bt]=ht,yt.nodeIDs[ht]=bt}for(const ut of ft.links){const bt=ut[0],ht=o.uuidv4();if(ut[0]=ht,yt.linkIDs[bt]||yt.linkIDs[ht])throw new Error(`New/old link UUID wasn't unique in changed map! ${bt} ${ht}`);yt.linkIDs[bt]=ht,yt.linkIDs[ht]=bt;const dt=ut[1],gt=ut[3];if(!yt.nodeIDs[dt])throw new Error(`Old node UUID not found in mapping! ${dt}`);if(ut[1]=yt.nodeIDs[dt],!yt.nodeIDs[gt])throw new Error(`Old node UUID not found in mapping! ${gt}`);ut[3]=yt.nodeIDs[gt]}for(const ut of ft.nodes){if(ut.inputs)for(const bt of ut.inputs)bt.link&&(bt.link=yt.linkIDs[bt.link]);if(ut.outputs)for(const bt of ut.outputs)bt.links&&(bt.links=bt.links.map(ht=>yt.linkIDs[ht]))}for(const ut of ft.nodes)if(ut.type==="graph/subgraph"){const bt=reassignGraphUUIDs(ut.subgraph);yt.nodeIDs.assign(bt.nodeIDs),yt.linkIDs.assign(bt.linkIDs)}},a.prototype.clone=function(){var ft=o.createNode(this.type),yt=this.serialize();if(o.use_uuids){const ut=o.cloneObject(yt.subgraph);this.reassignSubgraphUUIDs(ut),yt.subgraph=ut}return delete yt.id,delete yt.inputs,delete yt.outputs,ft.configure(yt),ft},a.prototype.buildFromNodes=function(ft){for(var yt={},ut=0,bt=0;bt<ft.length;++bt){var ht=ft[bt];yt[ht.id]=ht,ut=Math.min(ht.pos[0],ut),Math.max(ht.pos[0],ut)}for(var bt=0;bt<ft.length;++bt){var ht=ft[bt];if(ht.inputs)for(var dt=0;dt<ht.inputs.length;++dt){var gt=ht.inputs[dt];if(!(!gt||!gt.link)){var kt=ht.graph.links[gt.link];kt&&(yt[kt.origin_id]||this.subgraph.addInput(gt.name,kt.type))}}if(ht.outputs)for(var dt=0;dt<ht.outputs.length;++dt){var Lt=ht.outputs[dt];if(!(!Lt||!Lt.links||!Lt.links.length))for(var Gt=!1,At=0;At<Lt.links.length;++At){var kt=ht.graph.links[Lt.links[At]];if(kt&&!yt[kt.target_id]){Gt=!0;break}}}}},o.Subgraph=a,o.registerNodeType("graph/subgraph",a);function h(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var ft=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(yt){yt&&ft.setProperty("name",yt)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(yt){ft.setProperty("type",yt)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(yt){ft.setProperty("value",yt)}),this.widgets_up=!0,this.size=[180,90]}h.title="Input",h.desc="Input of the graph",h.prototype.onConfigure=function(){this.updateType()},h.prototype.updateType=function(){var ft=this.properties.type;this.type_widget.value=ft,this.outputs[0].type!=ft&&(o.isValidConnection(this.outputs[0].type,ft)||this.disconnectOutput(0),this.outputs[0].type=ft),ft=="number"?(this.value_widget.type="number",this.value_widget.value=0):ft=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):ft=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,ft)},h.prototype.onPropertyChanged=function(ft,yt){if(ft=="name"){if(yt==""||yt==this.name_in_graph||yt=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,yt):this.graph.addInput(yt,this.properties.type)),this.name_widget.value=yt,this.name_in_graph=yt}else ft=="type"&&this.updateType()},h.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},h.prototype.onAction=function(ft,yt){this.properties.type==o.EVENT&&this.triggerSlot(0,yt)},h.prototype.onExecute=function(){var ft=this.properties.name,yt=this.graph.inputs[ft];if(!yt){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,yt.value!==void 0?yt.value:this.properties.value)},h.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},o.GraphInput=h,o.registerNodeType("graph/input",h);function d(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}d.title="Output",d.desc="Output of the graph",d.prototype.onPropertyChanged=function(ft,yt){if(ft=="name"){if(yt==""||yt==this.name_in_graph||yt=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,yt):this.graph.addOutput(yt,this.properties.type)),this.name_widget.value=yt,this.name_in_graph=yt}else ft=="type"&&this.updateType()},d.prototype.updateType=function(){var ft=this.properties.type;this.type_widget&&(this.type_widget.value=ft),this.inputs[0].type!=ft&&((ft=="action"||ft=="event")&&(ft=o.EVENT),o.isValidConnection(this.inputs[0].type,ft)||this.disconnectInput(0),this.inputs[0].type=ft),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,ft)},d.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},d.prototype.onAction=function(ft,yt){this.properties.type==o.ACTION&&this.graph.trigger(this.properties.name,yt)},d.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},d.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},o.GraphOutput=d,o.registerNodeType("graph/output",d);function c(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}c.title="Const Number",c.desc="Constant number",c.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},c.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},c.prototype.setValue=function(ft){this.setProperty("value",ft)},c.prototype.onDrawBackground=function(ft){this.outputs[0].label=this.properties.value.toFixed(3)},o.registerNodeType("basic/const",c);function g(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}g.title="Const Boolean",g.desc="Constant boolean",g.prototype.getTitle=c.prototype.getTitle,g.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},g.prototype.setValue=c.prototype.setValue,g.prototype.onGetInputs=function(){return[["toggle",o.ACTION]]},g.prototype.onAction=function(ft){this.setValue(!this.properties.value)},o.registerNodeType("basic/boolean",g);function b(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}b.title="Const String",b.desc="Constant string",b.prototype.getTitle=c.prototype.getTitle,b.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},b.prototype.setValue=c.prototype.setValue,b.prototype.onDropFile=function(ft){var yt=this,ut=new FileReader;ut.onload=function(bt){yt.setProperty("value",bt.target.result)},ut.readAsText(ft)},o.registerNodeType("basic/string",b);function $(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}$.title="Const Object",$.desc="Constant Object",$.prototype.onExecute=function(){this.setOutputData(0,this._object)},o.registerNodeType("basic/object",$);function et(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}et.title="Const File",et.desc="Fetches a file from an url",et["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},et.prototype.onPropertyChanged=function(ft,yt){ft=="url"&&(yt==null||yt==""?this._data=null:this.fetchFile(yt))},et.prototype.onExecute=function(){var ft=this.getInputData(0)||this.properties.url;ft&&(ft!=this._url||this._type!=this.properties.type)&&this.fetchFile(ft),this.setOutputData(0,this._data)},et.prototype.setValue=c.prototype.setValue,et.prototype.fetchFile=function(ft){var yt=this;if(!ft||ft.constructor!==String){yt._data=null,yt.boxcolor=null;return}this._url=ft,this._type=this.properties.type,ft.substr(0,4)=="http"&&o.proxy&&(ft=o.proxy+ft.substr(ft.indexOf(":")+3)),fetch(ft).then(function(ut){if(!ut.ok)throw new Error("File not found");if(yt.properties.type=="arraybuffer")return ut.arrayBuffer();if(yt.properties.type=="text")return ut.text();if(yt.properties.type=="json")return ut.json();if(yt.properties.type=="blob")return ut.blob()}).then(function(ut){yt._data=ut,yt.boxcolor="#AEA"}).catch(function(ut){yt._data=null,yt.boxcolor="red",console.error("error fetching file:",ft)})},et.prototype.onDropFile=function(ft){var yt=this;this._url=ft.name,this._type=this.properties.type,this.properties.url=ft.name;var ut=new FileReader;if(ut.onload=function(bt){yt.boxcolor="#AEA";var ht=bt.target.result;yt.properties.type=="json"&&(ht=JSON.parse(ht)),yt._data=ht},yt.properties.type=="arraybuffer")ut.readAsArrayBuffer(ft);else if(yt.properties.type=="text"||yt.properties.type=="json")ut.readAsText(ft);else if(yt.properties.type=="blob")return ut.readAsBinaryString(ft)},o.registerNodeType("basic/file",et);function st(){this.addInput("parse",o.ACTION),this.addInput("json","string"),this.addOutput("done",o.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}st.title="JSON Parse",st.desc="Parses JSON String into object",st.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},st.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},st.prototype.onAction=function(ft){ft=="parse"&&this.parse()},o.registerNodeType("basic/jsonparse",st);function j(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}j.title="Const Data",j.desc="Constant Data",j.prototype.onPropertyChanged=function(ft,yt){if(this.widget.value=yt,!(yt==null||yt==""))try{this._value=JSON.parse(yt),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},j.prototype.onExecute=function(){this.setOutputData(0,this._value)},j.prototype.setValue=c.prototype.setValue,o.registerNodeType("basic/data",j);function tt(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}tt.title="Const Array",tt.desc="Constant Array",tt.prototype.onPropertyChanged=function(ft,yt){if(this.widget.value=yt,!(yt==null||yt==""))try{yt[0]!="["?this._value=JSON.parse("["+yt+"]"):this._value=JSON.parse(yt),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},tt.prototype.onExecute=function(){var ft=this.getInputData(0);if(ft&&ft.length){this._value||(this._value=new Array),this._value.length=ft.length;for(var yt=0;yt<ft.length;++yt)this._value[yt]=ft[yt]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},tt.prototype.setValue=c.prototype.setValue,o.registerNodeType("basic/array",tt);function nt(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}nt.title="Set Array",nt.desc="Sets index of array",nt.prototype.onExecute=function(){var ft=this.getInputData(0);if(ft){var yt=this.getInputData(1);yt!==void 0&&(this.properties.index&&(ft[Math.floor(this.properties.index)]=yt),this.setOutputData(0,ft))}},o.registerNodeType("basic/set_array",nt);function lt(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}lt.title="Array[i]",lt.desc="Returns an element from an array",lt.prototype.onExecute=function(){var ft=this.getInputData(0),yt=this.getInputData(1);yt==null&&(yt=this.properties.index),!(ft==null||yt==null)&&this.setOutputData(0,ft[Math.floor(Number(yt))])},o.registerNodeType("basic/array[]",lt);function ct(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}ct.title="Table[row][col]",ct.desc="Returns an element from a table",ct.prototype.onExecute=function(){var ft=this.getInputData(0),ut=this.getInputData(1),yt=this.getInputData(2);if(ut==null&&(ut=this.properties.row),yt==null&&(yt=this.properties.column),!(ft==null||ut==null||yt==null)){var ut=ft[Math.floor(Number(ut))];ut?this.setOutputData(0,ut[Math.floor(Number(yt))]):this.setOutputData(0,null)}},o.registerNodeType("basic/table[][]",ct);function ot(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}ot.title="Object property",ot.desc="Outputs the property of an object",ot.prototype.setValue=function(ft){this.properties.value=ft,this.widget.value=ft},ot.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},ot.prototype.onPropertyChanged=function(ft,yt){this.widget.value=yt},ot.prototype.onExecute=function(){var ft=this.getInputData(0);ft!=null&&this.setOutputData(0,ft[this.properties.value])},o.registerNodeType("basic/object_property",ot);function _e(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}_e.title="Object keys",_e.desc="Outputs an array with the keys of an object",_e.prototype.onExecute=function(){var ft=this.getInputData(0);ft!=null&&this.setOutputData(0,Object.keys(ft))},o.registerNodeType("basic/object_keys",_e);function _(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}_.title="Set Object",_.desc="Adds propertiesrty to object",_.prototype.onExecute=function(){var ft=this.getInputData(0);if(ft){var yt=this.getInputData(1);yt!==void 0&&(this.properties.property&&(ft[this.properties.property]=yt),this.setOutputData(0,ft))}},o.registerNodeType("basic/set_object",_);function at(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var ft=this;this.addWidget("button","clear","",function(){ft._result={}}),this.size=this.computeSize()}at.title="Merge Objects",at.desc="Creates an object copying properties from others",at.prototype.onExecute=function(){var ft=this.getInputData(0),yt=this.getInputData(1),ut=this._result;if(ft)for(var bt in ft)ut[bt]=ft[bt];if(yt)for(var bt in yt)ut[bt]=yt[bt];this.setOutputData(0,ut)},o.registerNodeType("basic/merge_objects",at);function it(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:it.LITEGRAPH},this.value=null}it.title="Variable",it.desc="store/read variable value",it.LITEGRAPH=0,it.GRAPH=1,it.GLOBALSCOPE=2,it["@container"]={type:"enum",values:{litegraph:it.LITEGRAPH,graph:it.GRAPH,global:it.GLOBALSCOPE}},it.prototype.onExecute=function(){var ft=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),ft[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,ft[this.properties.varname])},it.prototype.getContainer=function(){switch(this.properties.container){case it.GRAPH:return this.graph?this.graph.vars:{};case it.GLOBALSCOPE:return e;case it.LITEGRAPH:default:return o.Globals}},it.prototype.getTitle=function(){return this.properties.varname},o.registerNodeType("basic/variable",it),o.wrapFunctionAsNode("basic/length",pt,[""],"number");function pt(ft){return ft&&ft.length!=null?Number(ft.length):0}o.wrapFunctionAsNode("basic/not",function(ft){return!ft},[""],"boolean");function mt(){this.size=[60,30],this.addInput("data",0),this.addInput("download",o.ACTION),this.properties={filename:"data.json"},this.value=null;var ft=this;this.addWidget("button","Download","",function(yt){ft.value&&ft.downloadAsFile()})}mt.title="Download",mt.desc="Download some data",mt.prototype.downloadAsFile=function(){if(this.value!=null){var ft=null;this.value.constructor===String?ft=this.value:ft=JSON.stringify(this.value);var yt=new Blob([ft]),ut=URL.createObjectURL(yt),bt=document.createElement("a");bt.setAttribute("href",ut),bt.setAttribute("download",this.properties.filename),bt.style.display="none",document.body.appendChild(bt),bt.click(),document.body.removeChild(bt),setTimeout(function(){URL.revokeObjectURL(ut)},1e3*60)}},mt.prototype.onAction=function(ft,yt){var ut=this;setTimeout(function(){ut.downloadAsFile()},100)},mt.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},mt.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},o.registerNodeType("basic/download",mt);function _t(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}_t.title="Watch",_t.desc="Show value of input",_t.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},_t.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},_t.toString=function(ft){if(ft==null)return"null";if(ft.constructor===Number)return ft.toFixed(3);if(ft.constructor===Array){for(var yt="[",ut=0;ut<ft.length;++ut)yt+=_t.toString(ft[ut])+(ut+1!=ft.length?",":"");return yt+="]",yt}else return String(ft)},_t.prototype.onDrawBackground=function(ft){this.inputs[0].label=_t.toString(this.value)},o.registerNodeType("basic/watch",_t);function Et(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}Et.title="Cast",Et.desc="Allows to connect different types",Et.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},o.registerNodeType("basic/cast",Et);function Tt(){this.mode=o.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",o.EVENT),this.addInput("msg",0)}Tt.title="Console",Tt.desc="Show value inside the console",Tt.prototype.onAction=function(ft,yt){var ut=this.getInputData(1);ut||(ut=this.properties.msg),ut||(ut="Event: "+yt),ft=="log"?console.log(ut):ft=="warn"?console.warn(ut):ft=="error"&&console.error(ut)},Tt.prototype.onExecute=function(){var ft=this.getInputData(1);ft||(ft=this.properties.msg),ft!=null&&typeof ft<"u"&&(this.properties.msg=ft,console.log(ft))},Tt.prototype.onGetInputs=function(){return[["log",o.ACTION],["warn",o.ACTION],["error",o.ACTION]]},o.registerNodeType("basic/console",Tt);function Ot(){this.mode=o.ON_EVENT,this.addProperty("msg",""),this.addInput("",o.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}Ot.title="Alert",Ot.desc="Show an alert window",Ot.color="#510",Ot.prototype.onConfigure=function(ft){this.widget.value=ft.properties.msg},Ot.prototype.onAction=function(ft,yt){var ut=this.properties.msg;setTimeout(function(){alert(ut)},10)},o.registerNodeType("basic/alert",Ot);function Ct(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}Ct.prototype.onConfigure=function(ft){ft.properties.onExecute&&o.allow_scripts?this.compileCode(ft.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Ct.title="Script",Ct.desc="executes a code (max 256 characters)",Ct.widgets_info={onExecute:{type:"code"}},Ct.prototype.onPropertyChanged=function(ft,yt){ft=="onExecute"&&o.allow_scripts?this.compileCode(yt):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Ct.prototype.compileCode=function(ft){if(this._func=null,ft.length>256)console.warn("Script too long, max 256 chars");else{for(var yt=ft.toLowerCase(),ut=["script","body","document","eval","nodescript","function"],bt=0;bt<ut.length;++bt)if(yt.indexOf(ut[bt])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",ft)}catch(ht){console.error("Error parsing script"),console.error(ht)}}},Ct.prototype.onExecute=function(){if(this._func)try{var ft=this.getInputData(0),yt=this.getInputData(1),ut=this.getInputData(2);this.setOutputData(0,this._func(ft,yt,ut,this.data,this))}catch(bt){console.error("Error in script"),console.error(bt)}},Ct.prototype.onGetOutputs=function(){return[["C",""]]},o.registerNodeType("basic/script",Ct);function St(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:St.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:St.values}),this.size=[80,60]}St.values=["==","!="],St["@OP"]={type:"enum",title:"operation",values:St.values},St.title="Compare *",St.desc="evaluates condition between A and B",St.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},St.prototype.onExecute=function(){var ft=this.getInputData(0);ft===void 0?ft=this.properties.A:this.properties.A=ft;var yt=this.getInputData(1);yt===void 0?yt=this.properties.B:this.properties.B=yt;var ut=!1;if(typeof ft==typeof yt)switch(this.properties.OP){case"==":case"!=":switch(ut=!0,typeof ft){case"object":var bt=Object.getOwnPropertyNames(ft),ht=Object.getOwnPropertyNames(yt);if(bt.length!=ht.length){ut=!1;break}for(var dt=0;dt<bt.length;dt++){var gt=bt[dt];if(ft[gt]!==yt[gt]){ut=!1;break}}break;default:ut=ft==yt}this.properties.OP=="!="&&(ut=!ut);break}this.setOutputData(0,ut),this.setOutputData(1,!ut)},o.registerNodeType("basic/CompareValues",St)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.size=[60,30],this.addInput("event",o.ACTION)}s.title="Log Event",s.desc="Log event in console",s.prototype.onAction=function(lt,ct,ot){console.log(lt,ct)},o.registerNodeType("events/log",s);function a(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",o.EVENT),this.addOutput("change",o.EVENT),this.addOutput("false",o.EVENT),this.properties={only_on_change:!0},this.prev=0}a.title="TriggerEvent",a.desc="Triggers event if input evaluates to true",a.prototype.onExecute=function(lt,ct){var ot=this.getInputData(0),_e=ot!=this.prev;this.prev===0&&(_e=!1);var _=_e&&this.properties.only_on_change||!_e&&!this.properties.only_on_change;ot&&_&&this.triggerSlot(0,lt,null,ct),!ot&&_&&this.triggerSlot(2,lt,null,ct),_e&&this.triggerSlot(1,lt,null,ct),this.prev=ot},o.registerNodeType("events/trigger",a);function h(){var lt=this;this.addInput("",o.ACTION),this.addInput("",o.ACTION),this.addInput("",o.ACTION),this.addOutput("",o.EVENT),this.addOutput("",o.EVENT),this.addOutput("",o.EVENT),this.addWidget("button","+",null,function(){lt.addInput("",o.ACTION),lt.addOutput("",o.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}h.title="Sequence",h.desc="Triggers a sequence of events when an event arrives",h.prototype.getTitle=function(){return""},h.prototype.onAction=function(lt,ct,ot){if(this.outputs){ot=ot||{};for(var _e=0;_e<this.outputs.length;++_e)this.outputs[_e],ot.action_call?ot.action_call=ot.action_call+"_seq_"+_e:ot.action_call=this.id+"_"+(lt||"action")+"_seq_"+_e+"_"+Math.floor(Math.random()*9999),this.triggerSlot(_e,ct,null,ot)}},o.registerNodeType("events/sequence",h);function d(){var lt=this;this.addInput("",o.ACTION),this.addInput("",o.ACTION),this.addOutput("",o.EVENT),this.addWidget("button","+",null,function(){lt.addInput("",o.ACTION),lt.size[0]=90}),this.size=[90,70],this.ready=[]}d.title="WaitAll",d.desc="Wait until all input events arrive then triggers output",d.prototype.getTitle=function(){return""},d.prototype.onDrawBackground=function(lt){if(!this.flags.collapsed)for(var ct=0;ct<this.inputs.length;++ct){var ot=ct*o.NODE_SLOT_HEIGHT+10;lt.fillStyle=this.ready[ct]?"#AFB":"#000",lt.fillRect(20,ot,10,10)}},d.prototype.onAction=function(lt,ct,ot,_e){if(_e!=null){this.ready.length=this.outputs.length,this.ready[_e]=!0;for(var _=0;_<this.ready.length;++_)if(!this.ready[_])return;this.reset(),this.triggerSlot(0)}},d.prototype.reset=function(){this.ready.length=0},o.registerNodeType("events/waitAll",d);function c(){var lt=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",o.ACTION),this.addInput("reset",o.ACTION),this.addOutput("index","number"),this.addOutput("",o.EVENT),this.addOutput("",o.EVENT),this.addOutput("",o.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){lt.addOutput("",o.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}c.title="Stepper",c.desc="Trigger events sequentially when an tick arrives",c.prototype.onDrawBackground=function(lt){if(!this.flags.collapsed){var ct=this.properties.index||0;lt.fillStyle="#AFB";var ot=this.size[0],_e=(ct+1)*o.NODE_SLOT_HEIGHT+4;lt.beginPath(),lt.moveTo(ot-30,_e),lt.lineTo(ot-30,_e+o.NODE_SLOT_HEIGHT),lt.lineTo(ot-15,_e+o.NODE_SLOT_HEIGHT*.5),lt.fill()}},c.prototype.onExecute=function(){var lt=this.getInputData(0);lt!=null&&(lt=Math.floor(lt),lt=clamp(lt,0,this.outputs?this.outputs.length-2:0),lt!=this.properties.index&&(this.properties.index=lt,this.triggerSlot(lt+1))),this.setOutputData(0,this.properties.index)},c.prototype.onAction=function(lt,ct){if(lt=="reset")this.properties.index=0;else if(lt=="step"){this.triggerSlot(this.properties.index+1,ct);var ot=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%ot}},o.registerNodeType("events/stepper",c);function g(){this.size=[60,30],this.addInput("event",o.ACTION),this.addOutput("event",o.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}g.title="Filter Event",g.desc="Blocks events that do not match the filter",g.prototype.onAction=function(lt,ct,ot){if(ct!=null&&!(this.properties.equal_to&&this.properties.equal_to!=ct)){if(this.properties.has_property){var _e=ct[this.properties.has_property];if(_e==null||this.properties.property_equal_to&&this.properties.property_equal_to!=_e)return}this.triggerSlot(0,ct,null,ot)}},o.registerNodeType("events/filter",g);function b(){this.addInput("in",o.ACTION),this.addInput("cond","boolean"),this.addOutput("true",o.EVENT),this.addOutput("false",o.EVENT),this.size=[120,60],this._value=!1}b.title="Branch",b.desc="If condition is true, outputs triggers true, otherwise false",b.prototype.onExecute=function(){this._value=this.getInputData(1)},b.prototype.onAction=function(lt,ct,ot){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,ct,null,ot)},o.registerNodeType("events/branch",b);function $(){this.addInput("inc",o.ACTION),this.addInput("dec",o.ACTION),this.addInput("reset",o.ACTION),this.addOutput("change",o.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}$.title="Counter",$.desc="Counts events",$.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},$.prototype.onAction=function(lt,ct,ot){var _e=this.num;lt=="inc"?this.num+=1:lt=="dec"?this.num-=1:lt=="reset"&&(this.num=0),this.num!=_e&&this.trigger("change",this.num)},$.prototype.onDrawBackground=function(lt){this.flags.collapsed||(lt.fillStyle="#AAA",lt.font="20px Arial",lt.textAlign="center",lt.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},$.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},o.registerNodeType("events/counter",$);function et(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",o.ACTION),this.addOutput("on_time",o.EVENT),this._pending=[]}et.title="Delay",et.desc="Delays one event",et.prototype.onAction=function(lt,ct,ot){var _e=this.properties.time_in_ms;_e<=0?this.trigger(null,ct,ot):this._pending.push([_e,ct])},et.prototype.onExecute=function(lt,ct){var ot=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var _e=0;_e<this._pending.length;++_e){var _=this._pending[_e];_[0]-=ot,!(_[0]>0)&&(this._pending.splice(_e,1),--_e,this.trigger(null,_[1],ct))}},et.prototype.onGetInputs=function(){return[["event",o.ACTION],["time_in_ms","number"]]},o.registerNodeType("events/delay",et);function st(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",o.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}st.title="Timer",st.desc="Sends an event every N milliseconds",st.prototype.onStart=function(){this.time=0},st.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},st.on_color="#AAA",st.off_color="#222",st.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?st.on_color:st.off_color,this.triggered=!1},st.prototype.onExecute=function(){var lt=this.graph.elapsed_time*1e3,ct=this.time==0;if(this.time+=lt,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!ct&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},st.prototype.onGetInputs=function(){return[["interval","number"]]},st.prototype.onGetOutputs=function(){return[["tick","boolean"]]},o.registerNodeType("events/timer",st);function j(){this.addInput("go",o.ACTION),this.addInput("green",o.ACTION),this.addInput("red",o.ACTION),this.addOutput("continue",o.EVENT),this.addOutput("blocked",o.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var lt=this;this.addWidget("button","reset","",function(){lt._ready=!1})}j.title="Semaphore Event",j.desc="Until both events are not triggered, it doesnt continue.",j.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},j.prototype.onAction=function(lt,ct){lt=="go"?this.triggerSlot(this._ready?0:1):lt=="green"?this._ready=!0:lt=="red"&&(this._ready=!1)},o.registerNodeType("events/semaphore",j);function tt(){this.addInput("in",o.ACTION),this.addInput("reset",o.ACTION),this.addOutput("out",o.EVENT),this._once=!1,this.properties={};var lt=this;this.addWidget("button","reset","",function(){lt._once=!1})}tt.title="Once",tt.desc="Only passes an event once, then gets locked",tt.prototype.onAction=function(lt,ct){lt=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,ct)):lt=="reset"&&(this._once=!1)},o.registerNodeType("events/once",tt);function nt(){this.addInput("data",0),this.addInput("assign",o.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var lt=this;this.addWidget("button","store","",function(){lt.properties.data=lt._last_value})}nt.title="Data Store",nt.desc="Stores data and only changes when event is received",nt.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},nt.prototype.onAction=function(lt,ct,ot){this.properties.data=this._last_value},nt.prototype.onSerialize=function(lt){lt.data!=null&&(this.properties.serialize==!1||lt.data.constructor!==String&&lt.data.constructor!==Number&&lt.data.constructor!==Boolean&&lt.data.constructor!==Array&&lt.data.constructor!==Object)&&(lt.data=null)},o.registerNodeType("basic/data_store",nt)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addOutput("",o.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}s.title="Button",s.desc="Triggers an event",s.font="Arial",s.prototype.onDrawForeground=function(j){if(!this.flags.collapsed){var tt=10;if(j.fillStyle="black",j.fillRect(tt+1,tt+1,this.size[0]-tt*2,this.size[1]-tt*2),j.fillStyle="#AAF",j.fillRect(tt-1,tt-1,this.size[0]-tt*2,this.size[1]-tt*2),j.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",j.fillRect(tt,tt,this.size[0]-tt*2,this.size[1]-tt*2),this.properties.text||this.properties.text===0){var nt=this.properties.font_size||30;j.textAlign="center",j.fillStyle=this.clicked?"black":"white",j.font=nt+"px "+s.font,j.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+nt*.3),j.textAlign="left"}}},s.prototype.onMouseDown=function(j,tt){if(tt[0]>1&&tt[1]>1&&tt[0]<this.size[0]-2&&tt[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},s.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},s.prototype.onMouseUp=function(j){this.clicked=!1},o.registerNodeType("widget/button",s);function a(){this.addInput("","boolean"),this.addInput("e",o.ACTION),this.addOutput("v","boolean"),this.addOutput("e",o.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}a.title="Toggle",a.desc="Toggles between true or false",a.prototype.onDrawForeground=function(j){if(!this.flags.collapsed){var tt=this.size[1]*.5,nt=.25,lt=this.size[1]*.8;j.font=this.properties.font||(tt*.8).toFixed(0)+"px Arial";var ct=j.measureText(this.title).width,ot=(this.size[0]-(ct+tt))*.5;j.fillStyle="#AAA",j.fillRect(ot,lt-tt,tt,tt),j.fillStyle=this.properties.value?"#AEF":"#000",j.fillRect(ot+tt*nt,lt-tt+tt*nt,tt*(1-nt*2),tt*(1-nt*2)),j.textAlign="left",j.fillStyle="#AAA",j.fillText(this.title,tt*1.2+ot,lt*.85),j.textAlign="left"}},a.prototype.onAction=function(j){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},a.prototype.onExecute=function(){var j=this.getInputData(0);j!=null&&(this.properties.value=j),this.setOutputData(0,this.properties.value)},a.prototype.onMouseDown=function(j,tt){if(tt[0]>1&&tt[1]>1&&tt[0]<this.size[0]-2&&tt[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},o.registerNodeType("widget/toggle",a);function h(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}h.title="Number",h.desc="Widget to select number value",h.pixels_threshold=10,h.markers_color="#666",h.prototype.onDrawForeground=function(j){var tt=this.size[0]*.5,nt=this.size[1];nt>30?(j.fillStyle=h.markers_color,j.beginPath(),j.moveTo(tt,nt*.1),j.lineTo(tt+nt*.1,nt*.2),j.lineTo(tt+nt*-.1,nt*.2),j.fill(),j.beginPath(),j.moveTo(tt,nt*.9),j.lineTo(tt+nt*.1,nt*.8),j.lineTo(tt+nt*-.1,nt*.8),j.fill(),j.font=(nt*.7).toFixed(1)+"px Arial"):j.font=(nt*.8).toFixed(1)+"px Arial",j.textAlign="center",j.font=(nt*.7).toFixed(1)+"px Arial",j.fillStyle="#EEE",j.fillText(this.properties.value.toFixed(this._precision),tt,nt*.75)},h.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},h.prototype.onPropertyChanged=function(j,tt){var nt=(this.properties.step+"").split(".");this._precision=nt.length>1?nt[1].length:0},h.prototype.onMouseDown=function(j,tt){if(!(tt[1]<0))return this.old_y=j.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},h.prototype.onMouseMove=function(j){if(this.mouse_captured){var tt=this.old_y-j.canvasY;j.shiftKey&&(tt*=10),(j.metaKey||j.altKey)&&(tt*=.1),this.old_y=j.canvasY;var nt=this._remainder+tt/h.pixels_threshold;this._remainder=nt%1,nt=nt|0;var lt=clamp(this.properties.value+nt*this.properties.step,this.properties.min,this.properties.max);this.properties.value=lt,this.graph._version++,this.setDirtyCanvas(!0)}},h.prototype.onMouseUp=function(j,tt){if(j.click_time<200){var nt=tt[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+nt*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},o.registerNodeType("widget/number",h);function d(){this.addOutput("","string"),this.addOutput("change",o.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var j=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(tt){j.properties.value=tt,j.triggerSlot(1,tt)},{property:"value",values:this._values})}d.title="Combo",d.desc="Widget to select from a list",d.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},d.prototype.onPropertyChanged=function(j,tt){j=="values"?(this._values=tt.split(";"),this.widget.options.values=this._values):j=="value"&&(this.widget.value=tt)},o.registerNodeType("widget/combo",d);function c(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}c.title="Knob",c.desc="Circular controller",c.size=[80,100],c.prototype.onDrawForeground=function(j){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var tt=this.size[0]*.5,nt=this.size[1]*.5,lt=Math.min(this.size[0],this.size[1])*.5-5;j.globalAlpha=1,j.save(),j.translate(tt,nt),j.rotate(Math.PI*.75),j.fillStyle="rgba(0,0,0,0.5)",j.beginPath(),j.moveTo(0,0),j.arc(0,0,lt,0,Math.PI*1.5),j.fill(),j.strokeStyle="black",j.fillStyle=this.properties.color,j.lineWidth=2,j.beginPath(),j.moveTo(0,0),j.arc(0,0,lt-4,0,Math.PI*1.5*Math.max(.01,this.value)),j.closePath(),j.fill(),j.lineWidth=1,j.globalAlpha=1,j.restore(),j.fillStyle="black",j.beginPath(),j.arc(tt,nt,lt*.75,0,Math.PI*2,!0),j.fill(),j.fillStyle=this.mouseOver?"white":this.properties.color,j.beginPath();var ct=this.value*Math.PI*1.5+Math.PI*.75;j.arc(tt+Math.cos(ct)*lt*.65,nt+Math.sin(ct)*lt*.65,lt*.05,0,Math.PI*2,!0),j.fill(),j.fillStyle=this.mouseOver?"white":"#AAA",j.font=Math.floor(lt*.5)+"px Arial",j.textAlign="center",j.fillText(this.properties.value.toFixed(this.properties.precision),tt,nt+lt*.15)}},c.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=o.colorToString([this.value,this.value,this.value])},c.prototype.onMouseDown=function(j){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,j.canvasY-this.pos[1]<20||o.distance([j.canvasX,j.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[j.canvasX-this.pos[0],j.canvasY-this.pos[1]],this.captureInput(!0),!0)},c.prototype.onMouseMove=function(j){if(this.oldmouse){var tt=[j.canvasX-this.pos[0],j.canvasY-this.pos[1]],nt=this.value;nt-=(tt[1]-this.oldmouse[1])*.01,nt>1?nt=1:nt<0&&(nt=0),this.value=nt,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=tt,this.setDirtyCanvas(!0)}},c.prototype.onMouseUp=function(j){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},c.prototype.onPropertyChanged=function(j,tt){if(j=="min"||j=="max"||j=="value")return this.properties[j]=parseFloat(tt),!0},o.registerNodeType("widget/knob",c);function g(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var j=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(tt){j.properties.value=tt},this.properties),this.widgets_up=!0}g.title="Inner Slider",g.prototype.onPropertyChanged=function(j,tt){j=="value"&&(this.slider.value=tt)},g.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},o.registerNodeType("widget/internal_slider",g);function b(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}b.title="H.Slider",b.desc="Linear slider controller",b.prototype.onDrawForeground=function(j){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),j.globalAlpha=1,j.lineWidth=1,j.fillStyle="#000",j.fillRect(2,2,this.size[0]-4,this.size[1]-4),j.fillStyle=this.properties.color,j.beginPath(),j.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),j.fill()},b.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=o.colorToString([this.value,this.value,this.value])},b.prototype.onMouseDown=function(j){return j.canvasY-this.pos[1]<0?!1:(this.oldmouse=[j.canvasX-this.pos[0],j.canvasY-this.pos[1]],this.captureInput(!0),!0)},b.prototype.onMouseMove=function(j){if(this.oldmouse){var tt=[j.canvasX-this.pos[0],j.canvasY-this.pos[1]],nt=this.value,lt=tt[0]-this.oldmouse[0];nt+=lt/this.size[0],nt>1?nt=1:nt<0&&(nt=0),this.value=nt,this.oldmouse=tt,this.setDirtyCanvas(!0)}},b.prototype.onMouseUp=function(j){this.oldmouse=null,this.captureInput(!1)},b.prototype.onMouseLeave=function(j){},o.registerNodeType("widget/hslider",b);function $(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}$.title="Progress",$.desc="Shows data in linear progress",$.prototype.onExecute=function(){var j=this.getInputData(0);j!=null&&(this.properties.value=j)},$.prototype.onDrawForeground=function(j){j.lineWidth=1,j.fillStyle=this.properties.color;var tt=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);tt=Math.min(1,tt),tt=Math.max(0,tt),j.fillRect(2,2,(this.size[0]-4)*tt,this.size[1]-4)},o.registerNodeType("widget/progress",$);function et(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}et.title="Text",et.desc="Shows the input value",et.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],et.prototype.onDrawForeground=function(j){j.fillStyle=this.properties.color;var tt=this.properties.value;this.properties.glowSize?(j.shadowColor=this.properties.color,j.shadowOffsetX=0,j.shadowOffsetY=0,j.shadowBlur=this.properties.glowSize):j.shadowColor="transparent";var nt=this.properties.fontsize;if(j.textAlign=this.properties.align,j.font=nt.toString()+"px "+this.properties.font,this.str=typeof tt=="number"?tt.toFixed(this.properties.decimals):tt,typeof this.str=="string")for(var lt=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),ct=0;ct<lt.length;ct++)j.fillText(lt[ct],this.properties.align=="left"?15:this.size[0]-15,nt*-.15+nt*(parseInt(ct)+1));j.shadowColor="transparent",this.last_ctx=j,j.textAlign="left"},et.prototype.onExecute=function(){var j=this.getInputData(0);j!=null&&(this.properties.value=j)},et.prototype.resize=function(){if(this.last_ctx){var j=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var tt=0,nt=0;nt<j.length;nt++){var lt=this.last_ctx.measureText(j[nt]).width;tt<lt&&(tt=lt)}this.size[0]=tt+20,this.size[1]=4+j.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},et.prototype.onPropertyChanged=function(j,tt){return this.properties[j]=tt,this.str=typeof tt=="number"?tt.toFixed(3):tt,!0},o.registerNodeType("widget/text",et);function st(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}st.title="Panel",st.desc="Non interactive panel",st.widgets=[{name:"update",text:"Update",type:"button"}],st.prototype.createGradient=function(j){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=j.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},st.prototype.onDrawForeground=function(j){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(j),this.lineargradient&&(j.lineWidth=1,j.strokeStyle=this.properties.borderColor,j.fillStyle=this.lineargradient,this.properties.shadowSize?(j.shadowColor="#000",j.shadowOffsetX=0,j.shadowOffsetY=0,j.shadowBlur=this.properties.shadowSize):j.shadowColor="transparent",j.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),j.fill(),j.shadowColor="transparent",j.stroke()))},o.registerNodeType("widget/panel",st)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",o.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}s.title="Gamepad",s.desc="gets the input of the gamepad",s.CENTER=0,s.LEFT=1,s.RIGHT=2,s.UP=4,s.DOWN=8,s.zero=new Float32Array(2),s.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],s.prototype.onExecute=function(){var a=this.getGamepad(),h=this.properties.threshold||0;if(a&&(this._left_axis[0]=Math.abs(a.xbox.axes.lx)>h?a.xbox.axes.lx:0,this._left_axis[1]=Math.abs(a.xbox.axes.ly)>h?a.xbox.axes.ly:0,this._right_axis[0]=Math.abs(a.xbox.axes.rx)>h?a.xbox.axes.rx:0,this._right_axis[1]=Math.abs(a.xbox.axes.ry)>h?a.xbox.axes.ry:0,this._triggers[0]=Math.abs(a.xbox.axes.ltrigger)>h?a.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(a.xbox.axes.rtrigger)>h?a.xbox.axes.rtrigger:0),this.outputs)for(var d=0;d<this.outputs.length;d++){var c=this.outputs[d];if(!(!c.links||!c.links.length)){var g=null;if(a)switch(c.name){case"left_axis":g=this._left_axis;break;case"right_axis":g=this._right_axis;break;case"left_x_axis":g=this._left_axis[0];break;case"left_y_axis":g=this._left_axis[1];break;case"right_x_axis":g=this._right_axis[0];break;case"right_y_axis":g=this._right_axis[1];break;case"trigger_left":g=this._triggers[0];break;case"trigger_right":g=this._triggers[1];break;case"a_button":g=a.xbox.buttons.a?1:0;break;case"b_button":g=a.xbox.buttons.b?1:0;break;case"x_button":g=a.xbox.buttons.x?1:0;break;case"y_button":g=a.xbox.buttons.y?1:0;break;case"lb_button":g=a.xbox.buttons.lb?1:0;break;case"rb_button":g=a.xbox.buttons.rb?1:0;break;case"ls_button":g=a.xbox.buttons.ls?1:0;break;case"rs_button":g=a.xbox.buttons.rs?1:0;break;case"hat_left":g=a.xbox.hatmap&s.LEFT;break;case"hat_right":g=a.xbox.hatmap&s.RIGHT;break;case"hat_up":g=a.xbox.hatmap&s.UP;break;case"hat_down":g=a.xbox.hatmap&s.DOWN;break;case"hat":g=a.xbox.hatmap;break;case"start_button":g=a.xbox.buttons.start?1:0;break;case"back_button":g=a.xbox.buttons.back?1:0;break;case"button_pressed":for(var b=0;b<this._current_buttons.length;++b)this._current_buttons[b]&&!this._previous_buttons[b]&&this.triggerSlot(d,s.buttons[b]);break}else switch(c.name){case"button_pressed":break;case"left_axis":case"right_axis":g=s.zero;break;default:g=0}this.setOutputData(d,g)}}},s.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},s.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],s.prototype.getGamepad=function(){var a=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!a)return null;var h=a.call(navigator),d=null;this._previous_buttons.set(this._current_buttons);for(var c=this.properties.gamepad_index;c<4;c++)if(h[c]){d=h[c];var g=this.xbox_mapping;g||(g=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:s.CENTER}),g.axes.lx=d.axes[0],g.axes.ly=d.axes[1],g.axes.rx=d.axes[2],g.axes.ry=d.axes[3],g.axes.ltrigger=d.buttons[6].value,g.axes.rtrigger=d.buttons[7].value,g.hat="",g.hatmap=s.CENTER;for(var b=0;b<d.buttons.length;b++)if(this._current_buttons[b]=d.buttons[b].pressed,b<12)g.buttons[s.mapping_array[b]]=d.buttons[b].pressed,d.buttons[b].was_pressed&&this.trigger(s.mapping_array[b]+"_button_event");else switch(b){case 12:d.buttons[b].pressed&&(g.hat+="up",g.hatmap|=s.UP);break;case 13:d.buttons[b].pressed&&(g.hat+="down",g.hatmap|=s.DOWN);break;case 14:d.buttons[b].pressed&&(g.hat+="left",g.hatmap|=s.LEFT);break;case 15:d.buttons[b].pressed&&(g.hat+="right",g.hatmap|=s.RIGHT);break;case 16:g.buttons.home=d.buttons[b].pressed;break}return d.xbox=g,d}},s.prototype.onDrawBackground=function(a){if(!this.flags.collapsed){var h=this._left_axis,d=this._right_axis;a.strokeStyle="#88A",a.strokeRect((h[0]+1)*.5*this.size[0]-4,(h[1]+1)*.5*this.size[1]-4,8,8),a.strokeStyle="#8A8",a.strokeRect((d[0]+1)*.5*this.size[0]-4,(d[1]+1)*.5*this.size[1]-4,8,8);var c=this.size[1]/this._current_buttons.length;a.fillStyle="#AEB";for(var g=0;g<this._current_buttons.length;++g)this._current_buttons[g]&&a.fillRect(0,c*g,6,c)}},s.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",o.EVENT],["b_button_event",o.EVENT],["x_button_event",o.EVENT],["y_button_event",o.EVENT],["lb_button_event",o.EVENT],["rb_button_event",o.EVENT],["ls_button_event",o.EVENT],["rs_button_event",o.EVENT],["start_button_event",o.EVENT],["back_button_event",o.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",o.EVENT]]},o.registerNodeType("input/gamepad",s)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}s.title="Converter",s.desc="type A to type B",s.prototype.onExecute=function(){var ut=this.getInputData(0);if(ut!=null&&this.outputs)for(var bt=0;bt<this.outputs.length;bt++){var ht=this.outputs[bt];if(!(!ht.links||!ht.links.length)){var dt=null;switch(ht.name){case"number":dt=ut.length?ut[0]:parseFloat(ut);break;case"vec2":case"vec3":case"vec4":var dt=null,gt=1;switch(ht.name){case"vec2":gt=2;break;case"vec3":gt=3;break;case"vec4":gt=4;break}var dt=new Float32Array(gt);if(ut.length)for(var kt=0;kt<ut.length&&kt<dt.length;kt++)dt[kt]=ut[kt];else dt[0]=parseFloat(ut);break}this.setOutputData(bt,dt)}}},s.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},o.registerNodeType("math/converter",s);function a(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}a.title="Bypass",a.desc="removes the type",a.prototype.onExecute=function(){var ut=this.getInputData(0);this.setOutputData(0,ut)},o.registerNodeType("math/bypass",a);function h(){this.addInput("in"),this.addOutput("out")}h.title="to Number",h.desc="Cast to number",h.prototype.onExecute=function(){var ut=this.getInputData(0);this.setOutputData(0,Number(ut))},o.registerNodeType("math/to_number",h);function d(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}d.title="Range",d.desc="Convert a number from one range to another",d.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},d.prototype.onExecute=function(){if(this.inputs)for(var ut=0;ut<this.inputs.length;ut++){var bt=this.inputs[ut],ht=this.getInputData(ut);ht!==void 0&&(this.properties[bt.name]=ht)}var ht=this.properties.in;(ht==null||ht.constructor!==Number)&&(ht=0);var dt=this.properties.in_min,gt=this.properties.in_max,kt=this.properties.out_min,Lt=this.properties.out_max;this._last_v=(ht-dt)/(gt-dt)*(Lt-kt)+kt,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,kt,Lt))},d.prototype.onDrawBackground=function(ut){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},d.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},o.registerNodeType("math/range",d);function c(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}c.title="Rand",c.desc="Random number",c.prototype.onExecute=function(){if(this.inputs)for(var ut=0;ut<this.inputs.length;ut++){var bt=this.inputs[ut],ht=this.getInputData(ut);ht!==void 0&&(this.properties[bt.name]=ht)}var dt=this.properties.min,gt=this.properties.max;this._last_v=Math.random()*(gt-dt)+dt,this.setOutputData(0,this._last_v)},c.prototype.onDrawBackground=function(ut){this.outputs[0].label=(this._last_v||0).toFixed(3)},c.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},o.registerNodeType("math/rand",c);function g(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}g.title="Noise",g.desc="Random number with temporal continuity",g.data=null,g.getValue=function(gt,bt){if(!g.data){g.data=new Float32Array(1024);for(var ht=0;ht<g.data.length;++ht)g.data[ht]=Math.random()}gt=gt%1024,gt<0&&(gt+=1024);var dt=Math.floor(gt),gt=gt-dt,kt=g.data[dt],Lt=g.data[dt==1023?0:dt+1];return bt&&(gt=gt*gt*gt*(gt*(gt*6-15)+10)),kt*(1-gt)+Lt*gt},g.prototype.onExecute=function(){var ut=this.getInputData(0)||0,bt=this.properties.octaves||1,ht=0,dt=1,gt=this.properties.seed||0;ut+=gt;for(var kt=this.properties.speed||1,Lt=0,Gt=0;Gt<bt&&(ht+=g.getValue(ut*(1+Gt)*kt,this.properties.smooth)*dt,Lt+=dt,dt*=this.properties.persistence,!(dt<.001));++Gt);ht/=Lt;var At=this.properties.min,Pt=this.properties.max;this._last_v=ht*(Pt-At)+At,this.setOutputData(0,this._last_v)},g.prototype.onDrawBackground=function(ut){this.outputs[0].label=(this._last_v||0).toFixed(3)},o.registerNodeType("math/noise",g);function b(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}b.title="Spikes",b.desc="spike every random time",b.prototype.onExecute=function(){var ut=this.graph.elapsed_time;this._remaining_time-=ut,this._blink_time-=ut;var bt=0;if(this._blink_time>0){var ht=this._blink_time/this.properties.duration;bt=1/(Math.pow(ht*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,bt)},o.registerNodeType("math/spikes",b);function $(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}$.title="Clamp",$.desc="Clamp number between min and max",$.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&(ut=Math.max(this.properties.min,ut),ut=Math.min(this.properties.max,ut),this.setOutputData(0,ut))},$.prototype.getCode=function(ut){var bt="";return this.isInputConnected(0)&&(bt+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),bt},o.registerNodeType("math/clamp",$);function et(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}et.title="Lerp",et.desc="Linear Interpolation",et.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=0);var bt=this.getInputData(1);bt==null&&(bt=0);var ht=this.properties.f,dt=this.getInputData(2);dt!==void 0&&(ht=dt),this.setOutputData(0,ut*(1-ht)+bt*ht)},et.prototype.onGetInputs=function(){return[["f","number"]]},o.registerNodeType("math/lerp",et);function st(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}st.title="Abs",st.desc="Absolute",st.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&this.setOutputData(0,Math.abs(ut))},o.registerNodeType("math/abs",st);function j(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}j.title="Floor",j.desc="Floor number to remove fractional part",j.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&this.setOutputData(0,Math.floor(ut))},o.registerNodeType("math/floor",j);function tt(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}tt.title="Frac",tt.desc="Returns fractional part",tt.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&this.setOutputData(0,ut%1)},o.registerNodeType("math/frac",tt);function nt(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}nt.title="Smoothstep",nt.desc="Smoothstep",nt.prototype.onExecute=function(){var ut=this.getInputData(0);if(ut!==void 0){var bt=this.properties.A,ht=this.properties.B;ut=clamp((ut-bt)/(ht-bt),0,1),ut=ut*ut*(3-2*ut),this.setOutputData(0,ut)}},o.registerNodeType("math/smoothstep",nt);function lt(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}lt.title="Scale",lt.desc="v * factor",lt.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&this.setOutputData(0,ut*this.properties.factor)},o.registerNodeType("math/scale",lt);function ct(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}ct.title="Gate",ct.desc="if v is true, then outputs A, otherwise B",ct.prototype.onExecute=function(){var ut=this.getInputData(0);this.setOutputData(0,this.getInputData(ut?1:2))},o.registerNodeType("math/gate",ct);function ot(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}ot.title="Average",ot.desc="Average Filter",ot.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=0);var bt=this._values.length;this._values[this._current%bt]=ut,this._current+=1,this._current>bt&&(this._current=0);for(var ht=0,dt=0;dt<bt;++dt)ht+=this._values[dt];this.setOutputData(0,ht/bt)},ot.prototype.onPropertyChanged=function(ut,bt){bt<1&&(bt=1),this.properties.samples=Math.round(bt);var ht=this._values;this._values=new Float32Array(this.properties.samples),ht.length<=this._values.length?this._values.set(ht):this._values.set(ht.subarray(0,this._values.length))},o.registerNodeType("math/average",ot);function _e(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}_e.title="TendTo",_e.desc="moves the output value always closer to the input",_e.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=0);var bt=this.properties.factor;this._value==null?this._value=ut:this._value=this._value*(1-bt)+ut*bt,this.setOutputData(0,this._value)},o.registerNodeType("math/tendTo",_e);function _(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:_.values}),this._func=_.funcs[this.properties.OP],this._result=[]}_.values=["+","-","*","/","%","^","max","min"],_.funcs={"+":function(ut,bt){return ut+bt},"-":function(ut,bt){return ut-bt},x:function(ut,bt){return ut*bt},X:function(ut,bt){return ut*bt},"*":function(ut,bt){return ut*bt},"/":function(ut,bt){return ut/bt},"%":function(ut,bt){return ut%bt},"^":function(ut,bt){return Math.pow(ut,bt)},max:function(ut,bt){return Math.max(ut,bt)},min:function(ut,bt){return Math.min(ut,bt)}},_.title="Operation",_.desc="Easy math operators",_["@OP"]={type:"enum",title:"operation",values:_.values},_.size=[100,60],_.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},_.prototype.setValue=function(ut){typeof ut=="string"&&(ut=parseFloat(ut)),this.properties.value=ut},_.prototype.onPropertyChanged=function(ut,bt){ut=="OP"&&(this._func=_.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(ht){return ht}))},_.prototype.onExecute=function(){var ut=this.getInputData(0),bt=this.getInputData(1);ut!=null?ut.constructor===Number&&(this.properties.A=ut):ut=this.properties.A,bt!=null?this.properties.B=bt:bt=this.properties.B;var ht=_.funcs[this.properties.OP],dt;if(ut.constructor===Number)dt=0,dt=ht(ut,bt);else if(ut.constructor===Array){dt=this._result,dt.length=ut.length;for(var gt=0;gt<ut.length;++gt)dt[gt]=ht(ut[gt],bt)}else{dt={};for(var gt in ut)dt[gt]=ht(ut[gt],bt)}this.setOutputData(0,dt)},_.prototype.onDrawBackground=function(ut){this.flags.collapsed||(ut.font="40px Arial",ut.fillStyle="#666",ut.textAlign="center",ut.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+o.NODE_TITLE_HEIGHT)*.5),ut.textAlign="left")},o.registerNodeType("math/operation",_),o.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),o.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function at(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}at.title="Compare",at.desc="compares between two values",at.prototype.onExecute=function(){var ut=this.getInputData(0),bt=this.getInputData(1);ut!==void 0?this.properties.A=ut:ut=this.properties.A,bt!==void 0?this.properties.B=bt:bt=this.properties.B;for(var ht=0,dt=this.outputs.length;ht<dt;++ht){var gt=this.outputs[ht];if(!(!gt.links||!gt.links.length)){var kt;switch(gt.name){case"A==B":kt=ut==bt;break;case"A!=B":kt=ut!=bt;break;case"A>B":kt=ut>bt;break;case"A<B":kt=ut<bt;break;case"A<=B":kt=ut<=bt;break;case"A>=B":kt=ut>=bt;break}this.setOutputData(ht,kt)}}},at.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},o.registerNodeType("math/compare",at),o.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),o.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),o.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),o.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),o.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),o.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function it(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:it.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:it.values}),this.size=[80,60]}it.values=[">","<","==","!=","<=",">=","||","&&"],it["@OP"]={type:"enum",title:"operation",values:it.values},it.title="Condition",it.desc="evaluates condition between A and B",it.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},it.prototype.onExecute=function(){var ut=this.getInputData(0);ut===void 0?ut=this.properties.A:this.properties.A=ut;var bt=this.getInputData(1);bt===void 0?bt=this.properties.B:this.properties.B=bt;var ht=!0;switch(this.properties.OP){case">":ht=ut>bt;break;case"<":ht=ut<bt;break;case"==":ht=ut==bt;break;case"!=":ht=ut!=bt;break;case"<=":ht=ut<=bt;break;case">=":ht=ut>=bt;break;case"||":ht=ut||bt;break;case"&&":ht=ut&&bt;break}this.setOutputData(0,ht),this.setOutputData(1,!ht)},o.registerNodeType("math/condition",it);function pt(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}pt.title="Branch",pt.desc="If condition is true, outputs IN in true, otherwise in false",pt.prototype.onExecute=function(){var ut=this.getInputData(0),bt=this.getInputData(1);bt?(this.setOutputData(0,ut),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,ut))},o.registerNodeType("math/branch",pt);function mt(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}mt.title="Accumulate",mt.desc="Increments a value every time",mt.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var ut=this.getInputData(0);ut!==null?this.properties.value+=ut:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},o.registerNodeType("math/accumulate",mt);function _t(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}_t.title="Trigonometry",_t.desc="Sin Cos Tan",_t.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=0);var bt=this.properties.amplitude,ht=this.findInputSlot("amplitude");ht!=-1&&(bt=this.getInputData(ht));var dt=this.properties.offset;ht=this.findInputSlot("offset"),ht!=-1&&(dt=this.getInputData(ht));for(var gt=0,kt=this.outputs.length;gt<kt;++gt){var Lt=this.outputs[gt],Gt;switch(Lt.name){case"sin":Gt=Math.sin(ut);break;case"cos":Gt=Math.cos(ut);break;case"tan":Gt=Math.tan(ut);break;case"asin":Gt=Math.asin(ut);break;case"acos":Gt=Math.acos(ut);break;case"atan":Gt=Math.atan(ut);break}this.setOutputData(gt,bt*Gt+dt)}},_t.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},_t.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},o.registerNodeType("math/trigonometry",_t),o.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),o.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),o.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function Et(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(ut,bt,ht){ht.properties.formula=ut}),this.addWidget("toggle","allow",o.allow_scripts,function(ut){o.allow_scripts=ut}),this._func=null}Et.title="Formula",Et.desc="Compute formula",Et.size=[160,100],ot.prototype.onPropertyChanged=function(ut,bt){ut=="formula"&&(this.code_widget.value=bt)},Et.prototype.onExecute=function(){if(o.allow_scripts){var ut=this.getInputData(0),bt=this.getInputData(1);ut!=null?this.properties.x=ut:ut=this.properties.x,bt!=null?this.properties.y=bt:bt=this.properties.y,this.properties.formula;var ht;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),ht=this._func(ut,bt,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,ht)}},Et.prototype.getTitle=function(){return this._func_code||"Formula"},Et.prototype.onDrawBackground=function(){var ut=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=ut)},o.registerNodeType("math/formula",Et);function Tt(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}Tt.title="Vec2->XY",Tt.desc="vector 2 to components",Tt.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&(this.setOutputData(0,ut[0]),this.setOutputData(1,ut[1]))},o.registerNodeType("math3d/vec2-to-xy",Tt);function Ot(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}Ot.title="XY->Vec2",Ot.desc="components to vector2",Ot.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=this.properties.x);var bt=this.getInputData(1);bt==null&&(bt=this.properties.y);var ht=this._data;ht[0]=ut,ht[1]=bt,this.setOutputData(0,ht)},o.registerNodeType("math3d/xy-to-vec2",Ot);function Ct(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}Ct.title="Vec3->XYZ",Ct.desc="vector 3 to components",Ct.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&(this.setOutputData(0,ut[0]),this.setOutputData(1,ut[1]),this.setOutputData(2,ut[2]))},o.registerNodeType("math3d/vec3-to-xyz",Ct);function St(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}St.title="XYZ->Vec3",St.desc="components to vector3",St.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=this.properties.x);var bt=this.getInputData(1);bt==null&&(bt=this.properties.y);var ht=this.getInputData(2);ht==null&&(ht=this.properties.z);var dt=this._data;dt[0]=ut,dt[1]=bt,dt[2]=ht,this.setOutputData(0,dt)},o.registerNodeType("math3d/xyz-to-vec3",St);function ft(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}ft.title="Vec4->XYZW",ft.desc="vector 4 to components",ft.prototype.onExecute=function(){var ut=this.getInputData(0);ut!=null&&(this.setOutputData(0,ut[0]),this.setOutputData(1,ut[1]),this.setOutputData(2,ut[2]),this.setOutputData(3,ut[3]))},o.registerNodeType("math3d/vec4-to-xyzw",ft);function yt(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}yt.title="XYZW->Vec4",yt.desc="components to vector4",yt.prototype.onExecute=function(){var ut=this.getInputData(0);ut==null&&(ut=this.properties.x);var bt=this.getInputData(1);bt==null&&(bt=this.properties.y);var ht=this.getInputData(2);ht==null&&(ht=this.properties.z);var dt=this.getInputData(3);dt==null&&(dt=this.properties.w);var gt=this._data;gt[0]=ut,gt[1]=bt,gt[2]=ht,gt[3]=dt,this.setOutputData(0,gt)},o.registerNodeType("math3d/xyzw-to-vec4",yt)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}s.title="mat4",s.temp_quat=new Float32Array([0,0,0,1]),s.temp_mat4=new Float32Array(16),s.temp_vec3=new Float32Array(3),s.prototype.onPropertyChanged=function(ot,_e){this._must_update=!0},s.prototype.onExecute=function(){var ot=this._result,_e=s.temp_quat,_=s.temp_mat4,at=s.temp_vec3,it=this.getInputData(0),pt=this.getInputData(1),mt=this.getInputData(2);(this._must_update||it||pt||mt)&&(it=it||this.properties.T,pt=pt||this.properties.R,mt=mt||this.properties.S,mat4.identity(ot),mat4.translate(ot,ot,it),this.properties.R_in_degrees?(at.set(pt),vec3.scale(at,at,DEG2RAD),quat.fromEuler(_e,at)):quat.fromEuler(_e,pt),mat4.fromQuat(_,_e),mat4.multiply(ot,ot,_),mat4.scale(ot,ot,mt)),this.setOutputData(0,ot)},o.registerNodeType("math3d/mat4",s);function a(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:a.values}),this._result=vec3.create()}a.values=["+","-","*","/","%","^","max","min","dot","cross"],o.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),o.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),a.title="Operation",a.desc="Easy math 3D operators",a["@OP"]={type:"enum",title:"operation",values:a.values},a.size=[100,60],a.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},a.prototype.onExecute=function(){var ot=this.getInputData(0),_e=this.getInputData(1);if(!(ot==null||_e==null)){ot.constructor===Number&&(ot=[ot,ot,ot]),_e.constructor===Number&&(_e=[_e,_e,_e]);var _=this._result;switch(this.properties.OP){case"+":_=vec3.add(_,ot,_e);break;case"-":_=vec3.sub(_,ot,_e);break;case"x":case"X":case"*":_=vec3.mul(_,ot,_e);break;case"/":_=vec3.div(_,ot,_e);break;case"%":_[0]=ot[0]%_e[0],_[1]=ot[1]%_e[1],_[2]=ot[2]%_e[2];break;case"^":_[0]=Math.pow(ot[0],_e[0]),_[1]=Math.pow(ot[1],_e[1]),_[2]=Math.pow(ot[2],_e[2]);break;case"max":_[0]=Math.max(ot[0],_e[0]),_[1]=Math.max(ot[1],_e[1]),_[2]=Math.max(ot[2],_e[2]);break;case"min":_[0]=Math.min(ot[0],_e[0]),_[1]=Math.min(ot[1],_e[1]),_[2]=Math.min(ot[2],_e[2]);case"dot":_=vec3.dot(ot,_e);break;case"cross":vec3.cross(_,ot,_e);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,_)}},a.prototype.onDrawBackground=function(ot){this.flags.collapsed||(ot.font="40px Arial",ot.fillStyle="#666",ot.textAlign="center",ot.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+o.NODE_TITLE_HEIGHT)*.5),ot.textAlign="left")},o.registerNodeType("math3d/operation",a);function h(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}h.title="vec3_scale",h.desc="scales the components of a vec3",h.prototype.onExecute=function(){var ot=this.getInputData(0);if(ot!=null){var _e=this.getInputData(1);_e==null&&(_e=this.properties.f);var _=this._data;_[0]=ot[0]*_e,_[1]=ot[1]*_e,_[2]=ot[2]*_e,this.setOutputData(0,_)}},o.registerNodeType("math3d/vec3-scale",h);function d(){this.addInput("in","vec3"),this.addOutput("out","number")}d.title="vec3_length",d.desc="returns the module of a vector",d.prototype.onExecute=function(){var ot=this.getInputData(0);if(ot!=null){var _e=Math.sqrt(ot[0]*ot[0]+ot[1]*ot[1]+ot[2]*ot[2]);this.setOutputData(0,_e)}},o.registerNodeType("math3d/vec3-length",d);function c(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}c.title="vec3_normalize",c.desc="returns the vector normalized",c.prototype.onExecute=function(){var ot=this.getInputData(0);if(ot!=null){var _e=Math.sqrt(ot[0]*ot[0]+ot[1]*ot[1]+ot[2]*ot[2]),_=this._data;_[0]=ot[0]/_e,_[1]=ot[1]/_e,_[2]=ot[2]/_e,this.setOutputData(0,_)}},o.registerNodeType("math3d/vec3-normalize",c);function g(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}g.title="vec3_lerp",g.desc="returns the interpolated vector",g.prototype.onExecute=function(){var ot=this.getInputData(0);if(ot!=null){var _e=this.getInputData(1);if(_e!=null){var _=this.getInputOrProperty("f"),at=this._data;at[0]=ot[0]*(1-_)+_e[0]*_,at[1]=ot[1]*(1-_)+_e[1]*_,at[2]=ot[2]*(1-_)+_e[2]*_,this.setOutputData(0,at)}}},o.registerNodeType("math3d/vec3-lerp",g);function b(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(b.title="vec3_dot",b.desc="returns the dot product",b.prototype.onExecute=function(){var ot=this.getInputData(0);if(ot!=null){var _e=this.getInputData(1);if(_e!=null){var _=ot[0]*_e[0]+ot[1]*_e[1]+ot[2]*_e[2];this.setOutputData(0,_)}}},o.registerNodeType("math3d/vec3-dot",b),e.glMatrix){let ot=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},_e=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},_=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},at=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},it=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},pt=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},mt=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},_t=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};var $=ot,et=_e,st=_,j=at,tt=it,nt=pt,lt=mt,ct=_t;ot.title="Quaternion",ot.desc="quaternion",ot.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},ot.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},o.registerNodeType("math3d/quaternion",ot),_e.title="Rotation",_e.desc="quaternion rotation",_e.prototype.onExecute=function(){var Et=this.getInputData(0);Et==null&&(Et=this.properties.angle);var Tt=this.getInputData(1);Tt==null&&(Tt=this.properties.axis);var Ot=quat.setAxisAngle(this._value,Tt,Et*.0174532925);this.setOutputData(0,Ot)},o.registerNodeType("math3d/rotation",_e),_.title="Euler->Quat",_.desc="Converts euler angles (in degrees) to quaternion",_.prototype.onExecute=function(){var Et=this.getInputData(0);Et==null&&(Et=this.properties.euler),vec3.scale(this._degs,Et,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var Tt=quat.fromEuler(this._value,this._degs);this.setOutputData(0,Tt)},o.registerNodeType("math3d/euler_to_quat",_),at.title="Euler->Quat",at.desc="Converts rotX,rotY,rotZ in degrees to quat",at.prototype.onExecute=function(){var Et=this.getInputData(0);Et&&(quat.toEuler(this._value,Et),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},o.registerNodeType("math3d/quat_to_euler",at),it.title="Rot. Vec3",it.desc="rotate a point",it.prototype.onExecute=function(){var Et=this.getInputData(0);Et==null&&(Et=this.properties.vec);var Tt=this.getInputData(1);Tt==null?this.setOutputData(Et):this.setOutputData(0,vec3.transformQuat(vec3.create(),Et,Tt))},o.registerNodeType("math3d/rotate_vec3",it),pt.title="Mult. Quat",pt.desc="rotate quaternion",pt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var Tt=this.getInputData(1);if(Tt!=null){var Ot=quat.multiply(this._value,Et,Tt);this.setOutputData(0,Ot)}}},o.registerNodeType("math3d/mult-quat",pt),mt.title="Quat Slerp",mt.desc="quaternion spherical interpolation",mt.prototype.onExecute=function(){var Et=this.getInputData(0);if(Et!=null){var Tt=this.getInputData(1);if(Tt!=null){var Ot=this.properties.factor;this.getInputData(2)!=null&&(Ot=this.getInputData(2));var Ct=quat.slerp(this._value,Et,Tt,Ot);this.setOutputData(0,Ct)}}},o.registerNodeType("math3d/quat-slerp",mt),_t.title="Remap Range",_t.desc="remap a 3D range",_t.prototype.onExecute=function(){var Et=this.getInputData(0);Et&&this._value.set(Et);for(var Tt=this.properties.range_min,Ot=this.properties.range_max,Ct=this.properties.target_min,St=this.properties.target_max,ft=0;ft<3;++ft){var yt=Ot[ft]-Tt[ft];if(this._clamped[ft]=clamp(this._value[ft],Tt[ft],Ot[ft]),yt==0){this._value[ft]=(Ct[ft]+St[ft])*.5;continue}var ut=(this._value[ft]-Tt[ft])/yt;this.properties.clamp&&(ut=clamp(ut,0,1));var bt=St[ft]-Ct[ft];this._value[ft]=Ct[ft]+ut*bt}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},o.registerNodeType("math3d/remap_range",_t)}else o.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(et){if(et&&et.constructor===Object)try{return JSON.stringify(et)}catch{return String(et)}return String(et)}o.wrapFunctionAsNode("string/toString",s,[""],"string");function a(et,st){return et==st}o.wrapFunctionAsNode("string/compare",a,["string","string"],"boolean");function h(et,st){return et===void 0?st:st===void 0?et:et+st}o.wrapFunctionAsNode("string/concatenate",h,["string","string"],"string");function d(et,st){return et===void 0||st===void 0?!1:et.indexOf(st)!=-1}o.wrapFunctionAsNode("string/contains",d,["string","string"],"boolean");function c(et){return et!=null&&et.constructor===String?et.toUpperCase():et}o.wrapFunctionAsNode("string/toUpperCase",c,["string"],"string");function g(et,st){if(st==null&&(st=this.properties.separator),et==null)return[];if(et.constructor===String)return et.split(st||" ");if(et.constructor===Array){for(var j=[],tt=0;tt<et.length;++tt)typeof et[tt]=="string"&&(j[tt]=et[tt].split(st||" "));return j}return null}o.wrapFunctionAsNode("string/split",g,["string,array","string"],"array",{separator:","});function b(et){return et!=null&&et.constructor===Number?et.toFixed(this.properties.precision):et}o.wrapFunctionAsNode("string/toFixed",b,["number"],"string",{precision:0});function $(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}$.title="toTable",$.desc="Splits a string to table",$.prototype.onExecute=function(){var et=this.getInputData(0);if(et){var st=this.properties.separator||",";(et!=this._str||st!=this._last_separator)&&(this._last_separator=st,this._str=et,this._table=et.split(`
`).map(function(j){return j.trim().split(st)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},o.registerNodeType("string/toTable",$)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}s.title="Selector",s.desc="selects an output",s.prototype.onDrawBackground=function($){if(!this.flags.collapsed){$.fillStyle="#AFB";var et=(this.selected+1)*o.NODE_SLOT_HEIGHT+6;$.beginPath(),$.moveTo(50,et),$.lineTo(50,et+o.NODE_SLOT_HEIGHT),$.lineTo(34,et+o.NODE_SLOT_HEIGHT*.5),$.fill()}},s.prototype.onExecute=function(){var $=this.getInputData(0);($==null||$.constructor!==Number)&&($=0),this.selected=$=Math.round($)%(this.inputs.length-1);var et=this.getInputData($+1);et!==void 0&&this.setOutputData(0,et)},s.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},o.registerNodeType("logic/selector",s);function a(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}a.title="Sequence",a.desc="select one element from a sequence from a string",a.prototype.onPropertyChanged=function($,et){$=="sequence"&&(this.values=et.split(","))},a.prototype.onExecute=function(){var $=this.getInputData(1);$&&$!=this.current_sequence&&(this.values=$.split(","),this.current_sequence=$);var et=this.getInputData(0);et==null&&(et=0),this.index=et=Math.round(et)%this.values.length,this.setOutputData(0,this.values[et])},o.registerNodeType("logic/sequence",a);function h(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}h.title="AND",h.desc="Return true if all inputs are true",h.prototype.onExecute=function(){var $=!0;for(var et in this.inputs)if(!this.getInputData(et)){var $=!1;break}this.setOutputData(0,$)},h.prototype.onGetInputs=function(){return[["and","boolean"]]},o.registerNodeType("logic/AND",h);function d(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}d.title="OR",d.desc="Return true if at least one input is true",d.prototype.onExecute=function(){var $=!1;for(var et in this.inputs)if(this.getInputData(et)){$=!0;break}this.setOutputData(0,$)},d.prototype.onGetInputs=function(){return[["or","boolean"]]},o.registerNodeType("logic/OR",d);function c(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}c.title="NOT",c.desc="Return the logical negation",c.prototype.onExecute=function(){var $=!this.getInputData(0);this.setOutputData(0,$)},o.registerNodeType("logic/NOT",c);function g(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}g.title="bool == bool",g.desc="Compare for logical equality",g.prototype.onExecute=function(){var $=null,et=!0;for(var st in this.inputs)if($===null)$=this.getInputData(st);else if($!=this.getInputData(st)){et=!1;break}this.setOutputData(0,et)},g.prototype.onGetInputs=function(){return[["bool","boolean"]]},o.registerNodeType("logic/CompareBool",g);function b(){this.properties={},this.addInput("onTrigger",o.ACTION),this.addInput("condition","boolean"),this.addOutput("true",o.EVENT),this.addOutput("false",o.EVENT),this.mode=o.ON_TRIGGER}b.title="Branch",b.desc="Branch execution on condition",b.prototype.onExecute=function($,et){var st=this.getInputData(1);st?this.triggerSlot(0):this.triggerSlot(1)},o.registerNodeType("logic/IF",b)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}s.title="Plot",s.desc="Plots data over time",s.colors=["#FFF","#F99","#9F9","#99F"],s.prototype.onExecute=function(tt){if(!this.flags.collapsed)for(var nt=this.size,lt=0;lt<4;++lt){var ct=this.getInputData(lt);if(ct!=null){var ot=this.values[lt];ot.push(ct),ot.length>nt[0]&&ot.shift()}}},s.prototype.onDrawBackground=function(tt){if(!this.flags.collapsed){var nt=this.size,lt=.5*nt[1]/this.properties.scale,ct=s.colors,ot=nt[1]*.5;if(tt.fillStyle="#000",tt.fillRect(0,0,nt[0],nt[1]),tt.strokeStyle="#555",tt.beginPath(),tt.moveTo(0,ot),tt.lineTo(nt[0],ot),tt.stroke(),this.inputs)for(var _e=0;_e<4;++_e){var _=this.values[_e];if(!(!this.inputs[_e]||!this.inputs[_e].link)){tt.strokeStyle=ct[_e],tt.beginPath();var at=_[0]*lt*-1+ot;tt.moveTo(0,clamp(at,0,nt[1]));for(var it=1;it<_.length&&it<nt[0];++it){var at=_[it]*lt*-1+ot;tt.lineTo(it,clamp(at,0,nt[1]))}tt.stroke()}}}},o.registerNodeType("graphics/plot",s);function a(){this.addOutput("frame","image"),this.properties={url:""}}a.title="Image",a.desc="Image loader",a.widgets=[{name:"load",text:"Load",type:"button"}],a.supported_extensions=["jpg","jpeg","png","gif"],a.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},a.prototype.onDrawBackground=function(tt){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&tt.drawImage(this.img,0,0,this.size[0],this.size[1])},a.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},a.prototype.onPropertyChanged=function(tt,nt){return this.properties[tt]=nt,tt=="url"&&nt!=""&&this.loadImage(nt),!0},a.prototype.loadImage=function(tt,nt){if(tt==""){this.img=null;return}this.img=document.createElement("img"),tt.substr(0,4)=="http"&&o.proxy&&(tt=o.proxy+tt.substr(tt.indexOf(":")+3)),this.img.src=tt,this.boxcolor="#F95";var lt=this;this.img.onload=function(){nt&&nt(this),console.log("Image loaded, size: "+lt.img.width+"x"+lt.img.height),this.dirty=!0,lt.boxcolor="#9F9",lt.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+tt)}},a.prototype.onWidget=function(tt,nt){nt.name=="load"&&this.loadImage(this.properties.url)},a.prototype.onDropFile=function(tt){var nt=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(tt),this.properties.url=this._url,this.loadImage(this._url,function(lt){nt.size[1]=lt.height/lt.width*nt.size[0]})},o.registerNodeType("graphics/image",a);function h(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}h.title="Palette",h.desc="Generates a color",h.prototype.onExecute=function(){var tt=[];this.properties.colorA!=null&&tt.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&tt.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&tt.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&tt.push(hex2num(this.properties.colorD));var nt=this.getInputData(0);if(nt==null&&(nt=.5),nt>1?nt=1:nt<0&&(nt=0),tt.length!=0){var lt=[0,0,0];if(nt==0)lt=tt[0];else if(nt==1)lt=tt[tt.length-1];else{var ct=(tt.length-1)*nt,ot=tt[Math.floor(ct)],_e=tt[Math.floor(ct)+1],_=ct-Math.floor(ct);lt[0]=ot[0]*(1-_)+_e[0]*_,lt[1]=ot[1]*(1-_)+_e[1]*_,lt[2]=ot[2]*(1-_)+_e[2]*_}for(var at=0;at<lt.length;at++)lt[at]/=255;this.boxcolor=colorToString(lt),this.setOutputData(0,lt)}},o.registerNodeType("color/palette",h);function d(){this.addInput("","image,canvas"),this.size=[200,200]}d.title="Frame",d.desc="Frame viewerew",d.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],d.prototype.onDrawBackground=function(tt){this.frame&&!this.flags.collapsed&&tt.drawImage(this.frame,0,0,this.size[0],this.size[1])},d.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},d.prototype.onWidget=function(tt,nt){if(nt.name=="resize"&&this.frame){var lt=this.frame.width,ct=this.frame.height;!lt&&this.frame.videoWidth!=null&&(lt=this.frame.videoWidth,ct=this.frame.videoHeight),lt&&ct&&(this.size=[lt,ct]),this.setDirtyCanvas(!0,!0)}else nt.name=="view"&&this.show()},d.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},o.registerNodeType("graphics/frame",d);function c(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}c.title="Image fade",c.desc="Fades between images",c.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],c.prototype.onAdded=function(){this.createCanvas();var tt=this.canvas.getContext("2d");tt.fillStyle="#000",tt.fillRect(0,0,this.properties.width,this.properties.height)},c.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},c.prototype.onExecute=function(){var tt=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var nt=this.getInputData(0);nt!=null&&tt.drawImage(nt,0,0,this.canvas.width,this.canvas.height);var lt=this.getInputData(2);lt==null?lt=this.properties.fade:this.properties.fade=lt,tt.globalAlpha=lt;var ct=this.getInputData(1);ct!=null&&tt.drawImage(ct,0,0,this.canvas.width,this.canvas.height),tt.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},o.registerNodeType("graphics/imagefade",c);function g(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}g.title="Crop",g.desc="Crop Image",g.prototype.onAdded=function(){this.createCanvas()},g.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},g.prototype.onExecute=function(){var tt=this.getInputData(0);if(tt)if(tt.width){var nt=this.canvas.getContext("2d");nt.drawImage(tt,-this.properties.x,-this.properties.y,tt.width*this.properties.scale,tt.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},g.prototype.onDrawBackground=function(tt){this.flags.collapsed||this.canvas&&tt.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},g.prototype.onPropertyChanged=function(tt,nt){return this.properties[tt]=nt,tt=="scale"?(this.properties[tt]=parseFloat(nt),this.properties[tt]==0&&(console.error("Error in scale"),this.properties[tt]=1)):this.properties[tt]=parseInt(nt),this.createCanvas(),!0},o.registerNodeType("graphics/cropImage",g);function b(){this.addInput("clear",o.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}b.title="Canvas",b.desc="Canvas to render stuff",b.prototype.onExecute=function(){var tt=this.canvas,nt=this.properties.width|0,lt=this.properties.height|0;tt.width!=nt&&(tt.width=nt),tt.height!=lt&&(tt.height=lt),this.properties.autoclear&&this.ctx.clearRect(0,0,tt.width,tt.height),this.setOutputData(0,tt)},b.prototype.onAction=function(tt,nt){tt=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},o.registerNodeType("graphics/canvas",b);function $(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}$.title="DrawImage",$.desc="Draws image into a canvas",$.prototype.onExecute=function(){var tt=this.getInputData(0);if(tt){var nt=this.getInputOrProperty("img");if(nt){var lt=this.getInputOrProperty("x"),ct=this.getInputOrProperty("y"),ot=tt.getContext("2d");ot.drawImage(nt,lt,ct)}}},o.registerNodeType("graphics/drawImage",$);function et(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}et.title="DrawRectangle",et.desc="Draws rectangle in canvas",et.prototype.onExecute=function(){var tt=this.getInputData(0);if(tt){var nt=this.getInputOrProperty("x"),lt=this.getInputOrProperty("y"),ct=this.getInputOrProperty("w"),ot=this.getInputOrProperty("h"),_e=tt.getContext("2d");_e.fillRect(nt,lt,ct,ot)}},o.registerNodeType("graphics/drawRectangle",et);function st(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}st.title="Video",st.desc="Video playback",st.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],st.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var tt=this.getInputData(0);tt&&tt>=0&&tt<=1&&(this._video.currentTime=tt*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},st.prototype.onStart=function(){this.play()},st.prototype.onStop=function(){this.stop()},st.prototype.loadVideo=function(tt){this._video_url=tt;var nt=tt.substr(0,10).indexOf(":"),lt="";nt!=-1&&(lt=tt.substr(0,nt));var ct="";lt&&(ct=tt.substr(0,tt.indexOf("/",lt.length+3)),ct=ct.substr(lt.length+3)),this.properties.use_proxy&&lt&&o.proxy&&ct!=location.host&&(tt=o.proxy+tt.substr(tt.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=tt,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var ot=this;this._video.addEventListener("loadedmetadata",function(_e){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),ot.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(_e){console.log("video loading...")}),this._video.addEventListener("error",function(_e){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(_e){console.log("Video Ended."),this.play()})},st.prototype.onPropertyChanged=function(tt,nt){return this.properties[tt]=nt,tt=="url"&&nt!=""&&this.loadVideo(nt),!0},st.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},st.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},st.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},st.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},st.prototype.onWidget=function(tt,nt){},o.registerNodeType("graphics/video",st);function j(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}j.title="Webcam",j.desc="Webcam image",j.is_webcam_open=!1,j.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var tt={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(tt).then(this.streamReady.bind(this)).catch(lt);var nt=this;function lt(ct){console.log("Webcam rejected",ct),nt._webcam_stream=!1,j.is_webcam_open=!1,nt.boxcolor="red",nt.trigger("stream_error")}},j.prototype.closeStream=function(){if(this._webcam_stream){var tt=this._webcam_stream.getTracks();if(tt.length)for(var nt=0;nt<tt.length;++nt)tt[nt].stop();j.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},j.prototype.onPropertyChanged=function(tt,nt){tt=="facingMode"&&(this.properties.facingMode=nt,this.closeStream(),this.openStream())},j.prototype.onRemoved=function(){this.closeStream()},j.prototype.streamReady=function(tt){this._webcam_stream=tt,this.boxcolor="green";var nt=this._video;nt||(nt=document.createElement("video"),nt.autoplay=!0,nt.srcObject=tt,this._video=nt,nt.onloadedmetadata=function(lt){console.log(lt),j.is_webcam_open=!0}),this.trigger("stream_ready",nt)},j.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var tt=1;tt<this.outputs.length;++tt)if(this.outputs[tt])switch(this.outputs[tt].name){case"width":this.setOutputData(tt,this._video.videoWidth);break;case"height":this.setOutputData(tt,this._video.videoHeight);break}}},j.prototype.getExtraMenuOptions=function(tt){var nt=this,lt=nt.properties.show?"Hide Frame":"Show Frame";return[{content:lt,callback:function(){nt.properties.show=!nt.properties.show}}]},j.prototype.onDrawBackground=function(tt){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(tt.save(),tt.drawImage(this._video,0,0,this.size[0],this.size[1]),tt.restore())},j.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",o.EVENT],["stream_closed",o.EVENT],["stream_error",o.EVENT]]},o.registerNodeType("graphics/webcam",j)}(commonjsGlobal),function(e){var o=e.LiteGraph,s=e.LGraphCanvas;if(e.LGraphTexture=null,typeof GL>"u")return;s.link_type_colors.Texture="#987";function a(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[a.image_preview_size,a.image_preview_size]}e.LGraphTexture=a,a.title="Texture",a.desc="Texture",a.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},a.loadTextureCallback=null,a.image_preview_size=256,a.UNDEFINED=0,a.PASS_THROUGH=1,a.COPY=2,a.LOW=3,a.HIGH=4,a.REUSE=5,a.DEFAULT=2,a.MODE_VALUES={undefined:a.UNDEFINED,"pass through":a.PASS_THROUGH,copy:a.COPY,low:a.LOW,high:a.HIGH,reuse:a.REUSE,default:a.DEFAULT},a.getTexturesContainer=function(){return gl.textures},a.loadTexture=function(rt,vt){vt=vt||{};var xt=rt;xt.substr(0,7)=="http://"&&o.proxy&&(xt=o.proxy+xt.substr(7));var wt=a.getTexturesContainer(),It=wt[rt]=GL.Texture.fromURL(xt,vt);return It},a.getTexture=function(rt){var vt=this.getTexturesContainer();if(!vt)throw"Cannot load texture, container of textures not found";var xt=vt[rt];return!xt&&rt&&rt[0]!=":"?this.loadTexture(rt):xt},a.getTargetTexture=function(rt,vt,xt){if(!rt)throw"LGraphTexture.getTargetTexture expects a reference texture";var wt=null;switch(xt){case a.LOW:wt=gl.UNSIGNED_BYTE;break;case a.HIGH:wt=gl.HIGH_PRECISION_FORMAT;break;case a.REUSE:return rt;case a.COPY:default:wt=rt?rt.type:gl.UNSIGNED_BYTE;break}return(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=wt||vt.format!=rt.format)&&(vt=new GL.Texture(rt.width,rt.height,{type:wt,format:rt.format,filter:gl.LINEAR})),vt},a.getTextureType=function(rt,vt){var xt=vt?vt.type:gl.UNSIGNED_BYTE;switch(rt){case a.HIGH:xt=gl.HIGH_PRECISION_FORMAT;break;case a.LOW:xt=gl.UNSIGNED_BYTE;break}return xt},a.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var rt=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return rt},a.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var rt=new Uint8Array(512*512*4),vt=0;vt<512*512*4;++vt)rt[vt]=Math.random()*255;var xt=GL.Texture.fromMemory(512,512,rt,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=xt,xt},a.prototype.onDropFile=function(rt,vt,xt){if(!rt)this._drop_texture=null,this.properties.name="";else{var wt=null;if(typeof rt=="string")wt=GL.Texture.fromURL(rt);else if(vt.toLowerCase().indexOf(".dds")!=-1)wt=GL.Texture.fromDDSInMemory(rt);else{var It=new Blob([xt]),Dt=URL.createObjectURL(It);wt=GL.Texture.fromURL(Dt)}this._drop_texture=wt,this.properties.name=vt}},a.prototype.getExtraMenuOptions=function(rt){var vt=this;if(this._drop_texture)return[{content:"Clear",callback:function(){vt._drop_texture=null,vt.properties.name=""}}]},a.prototype.onExecute=function(){var rt=null;if(this.isOutputConnected(1)&&(rt=this.getInputData(0)),!rt&&this._drop_texture&&(rt=this._drop_texture),!rt&&this.properties.name&&(rt=a.getTexture(this.properties.name)),!rt){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=rt,this.properties.filter===!1?rt.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):rt.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,rt),this.setOutputData(1,rt.fullpath||rt.filename);for(var vt=2;vt<this.outputs.length;vt++){var xt=this.outputs[vt];if(xt){var wt=null;xt.name=="width"?wt=rt.width:xt.name=="height"?wt=rt.height:xt.name=="aspect"&&(wt=rt.width/rt.height),this.setOutputData(vt,wt)}}},a.prototype.onResourceRenamed=function(rt,vt){this.properties.name==rt&&(this.properties.name=vt)},a.prototype.onDrawBackground=function(rt){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&rt.webgl){rt.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(rt.webgl)this._canvas=this._last_tex;else{var vt=a.generateLowResTexturePreview(this._last_tex);if(!vt)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(vt)}this._canvas&&(rt.save(),rt.webgl||(rt.translate(0,this.size[1]),rt.scale(1,-1)),rt.drawImage(this._canvas,0,0,this.size[0],this.size[1]),rt.restore())}},a.generateLowResTexturePreview=function(rt){if(!rt)return null;var vt=a.image_preview_size,xt=rt;if(rt.format==gl.DEPTH_COMPONENT)return null;(rt.width>vt||rt.height>vt)&&(xt=this._preview_temp_tex,this._preview_temp_tex||(xt=new GL.Texture(vt,vt,{minFilter:gl.NEAREST}),this._preview_temp_tex=xt),rt.copyTo(xt),rt=xt);var wt=this._preview_canvas;return wt||(wt=createCanvas(vt,vt),this._preview_canvas=wt),xt&&xt.toCanvas(wt),wt},a.prototype.getResources=function(rt){return this.properties.name&&(rt[this.properties.name]=GL.Texture),rt},a.prototype.onGetInputs=function(){return[["in","Texture"]]},a.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},a.replaceCode=function(rt,vt){return rt.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(xt){return xt=xt.replace(/[\{\}]/g,""),vt[xt]||""})},o.registerNodeType("texture/texture",a);function h(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[a.image_preview_size,a.image_preview_size]}h.title="Preview",h.desc="Show a texture in the graph canvas",h.allow_preview=!1,h.prototype.onDrawBackground=function(rt){if(!this.flags.collapsed&&!(!rt.webgl&&!h.allow_preview)){var vt=this.getInputData(0);if(vt){var xt=null;!vt.handle&&rt.webgl?xt=vt:xt=a.generateLowResTexturePreview(vt),rt.save(),this.properties.flipY&&(rt.translate(0,this.size[1]),rt.scale(1,-1)),rt.drawImage(xt,0,0,this.size[0],this.size[1]),rt.restore()}}},o.registerNodeType("texture/preview",h);function d(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}d.title="Save",d.desc="Save a texture in the repository",d.prototype.getPreviewTexture=function(){return this._texture},d.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt){if(this.properties.generate_mipmaps&&(rt.bind(0),rt.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(rt.texture_type),rt.unbind(0)),this.properties.name)if(a.storeTexture)a.storeTexture(this.properties.name,rt);else{var vt=a.getTexturesContainer();vt[this.properties.name]=rt}this._texture=rt,this.setOutputData(0,rt),this.setOutputData(1,this.properties.name)}},o.registerNodeType("texture/save",d);function c(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>			<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:a.DEFAULT},this.has_error=!1}c.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:a.MODE_VALUES}},c.title="Operation",c.desc="Texture shader operation",c.presets={},c.prototype.getExtraMenuOptions=function(rt){var vt=this,xt=vt.properties.show?"Hide Texture":"Show Texture";return[{content:xt,callback:function(){vt.properties.show=!vt.properties.show}}]},c.prototype.onPropertyChanged=function(){this.has_error=!1},c.prototype.onDrawBackground=function(rt){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==rt&&(rt.save(),rt.drawImage(this._tex,0,0,this.size[0],this.size[1]),rt.restore())},c.prototype.onExecute=function(){var rt=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}var vt=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var xt=512,wt=512;rt?(xt=rt.width,wt=rt.height):vt&&(xt=vt.width,wt=vt.height),vt||(vt=GL.Texture.getWhiteTexture());var It=a.getTextureType(this.properties.precision,rt);!rt&&!this._tex?this._tex=new GL.Texture(xt,wt,{type:It,format:gl.RGBA,filter:gl.LINEAR}):this._tex=a.getTargetTexture(rt||this._tex,this._tex,this.properties.precision);var Dt="";this.properties.uvcode&&(Dt="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(Dt=this.properties.uvcode));var Nt="";this.properties.pixelcode&&(Nt="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(Nt=this.properties.pixelcode));var Rt=this._shader;if(!this.has_error&&(!Rt||this._shader_code!=Dt+"|"+Nt)){var Mt=a.replaceCode(c.pixel_shader,{UV_CODE:Dt,PIXEL_CODE:Nt});try{Rt=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Mt),this.boxcolor="#00FF00"}catch(Ht){GL.Shader.dumpErrorToConsole(Ht,Shader.SCREEN_VERTEX_SHADER,Mt),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=Rt,this._shader_code=Dt+"|"+Nt}if(this._shader){var Bt=this.getInputData(2);Bt!=null?this.properties.value=Bt:Bt=parseFloat(this.properties.value);var Ft=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),rt&&rt.bind(0),vt&&vt.bind(1);var Ht=Mesh.getScreenQuad();Rt.uniforms({u_texture:0,u_textureB:1,value:Bt,texSize:[xt,wt,1/xt,1/wt],time:Ft}).draw(Ht)}),this.setOutputData(0,this._tex)}}}},c.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec4 texSize;
			uniform float time;
			uniform float value;
			
			void main() {
				vec2 uv = v_coord;
				{{UV_CODE}};
				vec4 color4 = texture2D(u_texture, uv);
				vec3 color = color4.rgb;
				vec4 color4B = texture2D(u_textureB, uv);
				vec3 colorB = color4B.rgb;
				vec3 result = color;
				float alpha = 1.0;
				{{PIXEL_CODE}};
				gl_FragColor = vec4(result, alpha);
			}
			`,c.registerPreset=function(rt,vt){c.presets[rt]=vt},c.registerPreset("",""),c.registerPreset("bypass","color"),c.registerPreset("add","color + colorB * value"),c.registerPreset("substract","(color - colorB) * value"),c.registerPreset("mate","mix( color, colorB, color4B.a * value)"),c.registerPreset("invert","vec3(1.0) - color"),c.registerPreset("multiply","color * colorB * value"),c.registerPreset("divide","(color / colorB) / value"),c.registerPreset("difference","abs(color - colorB) * value"),c.registerPreset("max","max(color, colorB) * value"),c.registerPreset("min","min(color, colorB) * value"),c.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),c.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),c.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),c.registerPreset("normalmap",`
			float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
			float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
			float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
			float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
			float z4 = color.x;
			float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
			float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
			float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
			float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
			vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
			normal.xy *= value;
			result.xyz = normalize(normal) * 0.5 + vec3(0.5);
		`),c.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),c.prototype.onInspect=function(rt){var vt=this;rt.addCombo("Presets","",{values:Object.keys(c.presets),callback:function(xt){var wt=c.presets[xt];wt&&(vt.setProperty("pixelcode",wt),vt.title=xt,rt.refresh())}})},o.registerNodeType("texture/operation",c);function g(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:a.DEFAULT},this.properties.code=g.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}g.title="Shader",g.desc="Texture shader",g.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:a.MODE_VALUES}},g.prototype.onPropertyChanged=function(rt,vt){if(rt=="code"){var xt=this.getShader();if(xt){var wt=xt.uniformInfo;if(this.inputs)for(var It={},Dt=0;Dt<this.inputs.length;++Dt){var Nt=this.getInputInfo(Dt);if(Nt){if(wt[Nt.name]&&!It[Nt.name]){It[Nt.name]=!0;continue}this.removeInput(Dt),Dt--}}for(var Dt in wt){var Nt=xt.uniformInfo[Dt];if(Nt.loc!==null&&Dt!="time"){var Rt="number";if(this._shader.samplers[Dt])Rt="texture";else switch(Nt.size){case 1:Rt="number";break;case 2:Rt="vec2";break;case 3:Rt="vec3";break;case 4:Rt="vec4";break;case 9:Rt="mat3";break;case 16:Rt="mat4";break;default:continue}var Mt=this.findInputSlot(Dt);if(Mt==-1){this.addInput(Dt,Rt);continue}var Bt=this.getInputInfo(Mt);if(!Bt)this.addInput(Dt,Rt);else{if(Bt.type==Rt)continue;this.removeInput(Mt,Rt),this.addInput(Dt,Rt)}}}}}},g.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},g.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getShader();if(rt){var vt=0,xt=null;if(this.inputs)for(var wt=0;wt<this.inputs.length;++wt){var It=this.getInputInfo(wt),Dt=this.getInputData(wt);Dt!=null&&(Dt.constructor===GL.Texture&&(Dt.bind(vt),xt||(xt=Dt),Dt=vt,vt++),rt.setUniform(It.name,Dt))}var Nt=this._uniforms,Rt=a.getTextureType(this.properties.precision,xt),Mt=this.properties.width|0,Bt=this.properties.height|0;Mt==0&&(Mt=xt?xt.width:gl.canvas.width),Bt==0&&(Bt=xt?xt.height:gl.canvas.height),Nt.texSize[0]=Mt,Nt.texSize[1]=Bt,Nt.texSize[2]=1/Mt,Nt.texSize[3]=1/Bt,Nt.time=this.graph.getTime(),Nt.u_value=this.properties.u_value,Nt.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=Rt||this._tex.width!=Mt||this._tex.height!=Bt)&&(this._tex=new GL.Texture(Mt,Bt,{type:Rt,format:gl.RGBA,filter:gl.LINEAR}));var Ft=this._tex;Ft.drawTo(function(){rt.uniforms(Nt).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},g.pixel_shader=`precision highp float;
	
	varying vec2 v_coord;
	uniform float time; //time in seconds
	uniform vec4 texSize; //tex resolution
	uniform float u_value;
	uniform vec4 u_color;

	void main() {
		vec2 uv = v_coord;
		vec3 color = vec3(0.0);
		//your code here
		color.xy=uv;

		gl_FragColor = vec4(color, 1.0);
	}
	`,o.registerNodeType("texture/shader",g);function b(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:a.DEFAULT}}b.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},b.title="Scale/Offset",b.desc="Applies an scaling and offseting",b.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!this.isOutputConnected(0)||!rt)){if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}var vt=rt.width,xt=rt.height,wt=this.precision===a.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===a.DEFAULT&&(wt=rt.type),(!this._tex||this._tex.width!=vt||this._tex.height!=xt||this._tex.type!=wt)&&(this._tex=new GL.Texture(vt,xt,{type:wt,format:gl.RGBA,filter:gl.LINEAR}));var It=this._shader;It||(It=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,b.pixel_shader));var Dt=this.getInputData(1);Dt?(this.properties.scale[0]=Dt[0],this.properties.scale[1]=Dt[1]):Dt=this.properties.scale;var Nt=this.getInputData(2);Nt?(this.properties.offset[0]=Nt[0],this.properties.offset[1]=Nt[1]):Nt=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),rt.bind(0);var Rt=Mesh.getScreenQuad();It.uniforms({u_texture:0,u_scale:Dt,u_offset:Nt}).draw(Rt)}),this.setOutputData(0,this._tex)}},b.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv = uv / u_scale - u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,o.registerNodeType("texture/scaleOffset",b);function $(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:a.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}$.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},$.title="Warp",$.desc="Texture warp operation",$.prototype.onExecute=function(){var rt=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}var vt=this.getInputData(1),xt=512,wt=512;gl.UNSIGNED_BYTE,rt?(xt=rt.width,wt=rt.height,rt.type):vt&&(xt=vt.width,wt=vt.height,vt.type),!rt&&!this._tex?this._tex=new GL.Texture(xt,wt,{type:this.precision===a.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=a.getTargetTexture(rt||this._tex,this._tex,this.properties.precision);var It=this._shader;It||(It=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.pixel_shader));var Dt=this.getInputData(2);Dt!=null?this.properties.factor=Dt:Dt=parseFloat(this.properties.factor);var Nt=this._uniforms;Nt.u_factor=Dt,Nt.u_scale.set(this.properties.scale),Nt.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),rt&&rt.bind(0),vt&&vt.bind(1);var Rt=Mesh.getScreenQuad();It.uniforms(Nt).draw(Rt)}),this.setOutputData(0,this._tex)}},$.pixel_shader=`precision highp float;
			
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			varying vec2 v_coord;
			uniform float u_factor;
			uniform vec2 u_scale;
			uniform vec2 u_offset;
			
			void main() {
				vec2 uv = v_coord;
				uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
				gl_FragColor = texture2D(u_texture, uv);
			}
			`,o.registerNodeType("texture/warp",$);function et(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}et.title="to Viewport",et.desc="Texture to viewport",et._prev_viewport=new Float32Array(4),et.prototype.onDrawBackground=function(rt){if(!(this.flags.collapsed||this.size[1]<=40)){var vt=this.getInputData(0);vt&&rt.drawImage(rt==gl?vt:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},et.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var vt=this.properties.gamma||1;this.isInputConnected(1)&&(vt=this.getInputData(1)),rt.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var xt=et._prev_viewport;xt.set(gl.viewport_data);var wt=this.properties.viewport;if(gl.viewport(xt[0]+xt[2]*wt[0],xt[1]+xt[3]*wt[1],xt[2]*wt[2],xt[3]*wt[3]),gl.getViewport(),this.properties.antialiasing){et._shader||(et._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,et.aa_pixel_shader));var It=Mesh.getScreenQuad();rt.bind(0),et._shader.uniforms({u_texture:0,uViewportSize:[rt.width,rt.height],u_igamma:1/vt,inverseVP:[1/rt.width,1/rt.height]}).draw(It)}else vt!=1?(et._gamma_shader||(et._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,et.gamma_pixel_shader)),rt.toViewport(et._gamma_shader,{u_texture:0,u_igamma:1/vt})):rt.toViewport();gl.viewport(xt[0],xt[1],xt[2],xt[3])}},et.prototype.onGetInputs=function(){return[["gamma","number"]]},et.aa_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 uViewportSize;
			uniform vec2 inverseVP;
			uniform float u_igamma;
			#define FXAA_REDUCE_MIN   (1.0/ 128.0)
			#define FXAA_REDUCE_MUL   (1.0 / 8.0)
			#define FXAA_SPAN_MAX     8.0
			
			/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
			vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
			{
				vec4 color = vec4(0.0);
				/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
				vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
				vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
				vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
				vec3 luma = vec3(0.299, 0.587, 0.114);
				float lumaNW = dot(rgbNW, luma);
				float lumaNE = dot(rgbNE, luma);
				float lumaSW = dot(rgbSW, luma);
				float lumaSE = dot(rgbSE, luma);
				float lumaM  = dot(rgbM,  luma);
				float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
				float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
				
				vec2 dir;
				dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
				dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
				
				float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
				
				float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
				dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
				
				vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
				vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
					texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
				
				//return vec4(rgbA,1.0);
				float lumaB = dot(rgbB, luma);
				if ((lumaB < lumaMin) || (lumaB > lumaMax))
					color = vec4(rgbA, 1.0);
				else
					color = vec4(rgbB, 1.0);
				if(u_igamma != 1.0)
					color.xyz = pow( color.xyz, vec3(u_igamma) );
				return color;
			}
			
			void main() {
			   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
			}
			`,et.gamma_pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_igamma;
			void main() {
				vec4 color = texture2D( u_texture, v_coord);
				color.xyz = pow(color.xyz, vec3(u_igamma) );
			   gl_FragColor = color;
			}
			`,o.registerNodeType("texture/toviewport",et);function st(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:a.DEFAULT}}st.title="Copy",st.desc="Copy Texture",st.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:a.MODE_VALUES}},st.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!rt&&!this._temp_texture)&&this.isOutputConnected(0)){if(rt){var vt=rt.width,xt=rt.height;this.properties.size!=0&&(vt=this.properties.size,xt=this.properties.size);var wt=this._temp_texture,It=rt.type;if(this.properties.precision===a.LOW?It=gl.UNSIGNED_BYTE:this.properties.precision===a.HIGH&&(It=gl.HIGH_PRECISION_FORMAT),!wt||wt.width!=vt||wt.height!=xt||wt.type!=It){var Dt=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(vt)&&isPowerOfTwo(xt)&&(Dt=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(vt,xt,{type:It,format:gl.RGBA,minFilter:Dt,magFilter:gl.LINEAR})}rt.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},o.registerNodeType("texture/copy",st);function j(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:a.DEFAULT}}j.title="Downsample",j.desc="Downsample Texture",j.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:a.MODE_VALUES}},j.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!rt&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!rt||rt.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,rt);return}var vt=j._shader;vt||(j._shader=vt=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,j.pixel_shader));var xt=rt.width|0,wt=rt.height|0,It=rt.type;this.properties.precision===a.LOW?It=gl.UNSIGNED_BYTE:this.properties.precision===a.HIGH&&(It=gl.HIGH_PRECISION_FORMAT);var Dt=this.properties.iterations||1,Nt=rt,Rt=null,Mt=[],Bt={type:It,format:rt.format},Ft=vec2.create(),Ht={u_offset:Ft};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var Ut=0;Ut<Dt&&(Ft[0]=1/xt,Ft[1]=1/wt,xt=xt>>1||0,wt=wt>>1||0,Rt=GL.Texture.getTemporary(xt,wt,Bt),Mt.push(Rt),Nt.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),Nt.copyTo(Rt,vt,Ht),!(xt==1&&wt==1));++Ut)Nt=Rt;this._texture=Mt.pop();for(var Ut=0;Ut<Mt.length;++Ut)GL.Texture.releaseTemporary(Mt[Ut]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},j.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform vec2 u_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = texture2D(u_texture, v_coord );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
				color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
				color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
			   gl_FragColor = color * 0.25;
			}
			`,o.registerNodeType("texture/downsample",j);function tt(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:a.DEFAULT}}tt.title="Resize",tt.desc="Resize Texture",tt.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:a.MODE_VALUES}},tt.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!rt&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!rt||rt.texture_type!==GL.TEXTURE_2D)){var vt=this.properties.size[0]|0,xt=this.properties.size[1]|0;vt==0&&(vt=rt.width),xt==0&&(xt=rt.height);var wt=rt.type;this.properties.precision===a.LOW?wt=gl.UNSIGNED_BYTE:this.properties.precision===a.HIGH&&(wt=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=vt||this._texture.height!=xt||this._texture.type!=wt)&&(this._texture=new GL.Texture(vt,xt,{type:wt})),rt.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},o.registerNodeType("texture/resize",tt);function nt(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}nt.title="Average",nt.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,nt.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var rt=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,rt),this.setOutputData(2,(rt[0]+rt[1]+rt[2])/3)},nt.prototype.onPreRenderExecute=function(){this.updateAverage()},nt.prototype.updateAverage=function(){var rt=this.getInputData(0);if(rt&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!nt._shader){nt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,nt.pixel_shader);for(var vt=new Float32Array(16),xt=0;xt<vt.length;++xt)vt[xt]=Math.random();nt._shader.uniforms({u_samples_a:vt.subarray(0,16),u_samples_b:vt.subarray(16,32)})}var wt=this._temp_texture,It=gl.UNSIGNED_BYTE;rt.type!=It&&(It=gl.FLOAT),(!wt||wt.type!=It)&&(this._temp_texture=new GL.Texture(1,1,{type:It,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=It)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:It,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),rt.copyTo(this._temp_pot2_texture),rt=this._temp_pot2_texture,rt.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var Dt=nt._shader,Nt=this._uniforms;if(Nt.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){rt.toViewport(Dt,Nt)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var Rt=this._temp_texture.getPixels();if(Rt){var Mt=this._luminance,It=this._temp_texture.type;Mt.set(Rt),It==gl.UNSIGNED_BYTE?vec4.scale(Mt,Mt,1/255):It==GL.HALF_FLOAT||It==GL.HALF_FLOAT_OES}}}},nt.pixel_shader=`precision highp float;
			precision highp float;
			uniform mat4 u_samples_a;
			uniform mat4 u_samples_b;
			uniform sampler2D u_texture;
			uniform float u_mipmap_offset;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				//random average
				for(int i = 0; i < 4; ++i)
					for(int j = 0; j < 4; ++j)
					{
						color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
						color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
					}
			   gl_FragColor = color * 0.03125;
			}
			`,o.registerNodeType("texture/average",nt);function lt(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}lt.title="Smooth",lt.desc="Smooth texture over time",lt.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!rt||!this.isOutputConnected(0))){lt._shader||(lt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,lt.pixel_shader));var vt=this._temp_texture;if(!vt||vt.type!=rt.type||vt.width!=rt.width||vt.height!=rt.height){var xt={type:rt.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(rt.width,rt.height,xt),this._temp_texture2=new GL.Texture(rt.width,rt.height,xt),rt.copyTo(this._temp_texture2)}var wt=this._temp_texture,It=this._temp_texture2,Dt=lt._shader,Nt=this._uniforms;Nt.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),wt.drawTo(function(){It.bind(1),rt.toViewport(Dt,Nt)}),this.setOutputData(0,wt),this._temp_texture=It,this._temp_texture2=wt}},lt.pixel_shader=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_factor;
			varying vec2 v_coord;
			
			void main() {
				gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
			}
			`,o.registerNodeType("texture/temporal_smooth",lt);function ct(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}ct.title="Lineal Avg Smooth",ct.desc="Smooth texture linearly over time",ct["@samples"]={type:"number",min:1,max:64,step:1,precision:1},ct.prototype.getPreviewTexture=function(){return this._temp_texture2},ct.prototype.onExecute=function(){var rt=this.getInputData(0);if(!(!rt||!this.isOutputConnected(0))){ct._shader||(ct._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ct.pixel_shader_copy),ct._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ct.pixel_shader_avg));var vt=clamp(this.properties.samples,0,64),xt=this.frame,wt=this.properties.frames_interval;if(wt==0||xt%wt==0){var It=this._temp_texture;if(!It||It.type!=rt.type||It.width!=vt){var Dt={type:rt.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(vt,1,Dt),this._temp_texture2=new GL.Texture(vt,1,Dt),this._temp_texture_out=new GL.Texture(1,1,Dt)}var Nt=this._temp_texture,Rt=this._temp_texture2,Mt=ct._shader_copy,Bt=ct._shader_avg,Ft=this._uniforms;Ft.u_samples=vt,Ft.u_isamples=1/vt,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Nt.drawTo(function(){Rt.bind(1),rt.toViewport(Mt,Ft)}),this._temp_texture_out.drawTo(function(){Nt.toViewport(Bt,Ft)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=Rt,this._temp_texture2=Nt}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},ct.pixel_shader_copy=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				if( v_coord.x <= u_isamples )
					gl_FragColor = texture2D( u_texture, vec2(0.5) );
				else
					gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
			}
			`,ct.pixel_shader_avg=`precision highp float;
			precision highp float;
			uniform sampler2D u_texture;
			uniform int u_samples;
			uniform float u_isamples;
			varying vec2 v_coord;
			
			void main() {
				vec4 color = vec4(0.0);
				for(int i = 0; i < 64; ++i)
				{
					color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
					if(i == (u_samples - 1))
						break;
				}
				gl_FragColor = color * u_isamples;
			}
			`,o.registerNodeType("texture/linear_avg_smooth",ct);function ot(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}ot.title="Image to Texture",ot.desc="Uploads an image to the GPU",ot.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt){var vt=rt.videoWidth||rt.width,xt=rt.videoHeight||rt.height;if(rt.gltexture){this.setOutputData(0,rt.gltexture);return}var wt=this._temp_texture;(!wt||wt.width!=vt||wt.height!=xt)&&(this._temp_texture=new GL.Texture(vt,xt,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(rt)}catch(It){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+It);return}this.setOutputData(0,this._temp_texture)}},o.registerNodeType("texture/imageToTexture",ot);function _e(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:a.DEFAULT,texture:null},_e._shader||(_e._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,_e.pixel_shader))}_e.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:a.MODE_VALUES}},_e.title="LUT",_e.desc="Apply LUT to Texture",_e.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(this.properties.precision===a.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,rt);return}if(rt){var vt=this.getInputData(1);if(vt||(vt=a.getTexture(this.properties.texture)),!vt){this.setOutputData(0,rt);return}vt.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var xt=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=xt=this.getInputData(2)),this._tex=a.getTargetTexture(rt,this._tex,this.properties.precision),this._tex.drawTo(function(){vt.bind(1),rt.toViewport(_e._shader,{u_texture:0,u_textureB:1,u_amount:xt})}),this.setOutputData(0,this._tex)}}},_e.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_amount;
			
			void main() {
				 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
				 mediump float blueColor = textureColor.b * 63.0;
				 mediump vec2 quad1;
				 quad1.y = floor(floor(blueColor) / 8.0);
				 quad1.x = floor(blueColor) - (quad1.y * 8.0);
				 mediump vec2 quad2;
				 quad2.y = floor(ceil(blueColor) / 8.0);
				 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
				 highp vec2 texPos1;
				 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 highp vec2 texPos2;
				 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
				 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
				 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
				 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
				 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
				 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
			}
			`,o.registerNodeType("texture/LUT",_e);function _(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:a.DEFAULT,generate_mipmaps:!1,texture:null},_._shader||(_._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,_.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}_.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:a.MODE_VALUES}},_.title="Encode",_.desc="Apply a texture atlas to encode a texture",_.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(this.properties.precision===a.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,rt);return}if(rt){var vt=this.getInputData(1);if(vt||(vt=a.getTexture(this.properties.texture)),!vt){this.setOutputData(0,rt);return}vt.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var xt=this._uniforms;xt.u_row_simbols=Math.floor(this.properties.num_row_symbols),xt.u_symbol_size=this.properties.symbol_size,xt.u_brightness=this.properties.brightness,xt.u_invert=this.properties.invert?1:0,xt.u_colorize=this.properties.colorize?1:0,this._tex=a.getTargetTexture(rt,this._tex,this.properties.precision),xt.u_res[0]=this._tex.width,xt.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){vt.bind(1),rt.toViewport(_._shader,xt)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},_.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_textureB;
			uniform float u_row_simbols;
			uniform float u_symbol_size;
			uniform float u_brightness;
			uniform float u_invert;
			uniform float u_colorize;
			uniform vec2 u_res;
			
			void main() {
				vec2 total_symbols = u_res / u_symbol_size;
				vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
				vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
				lowp vec4 textureColor = texture2D(u_texture, uv );
				float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
				if( u_invert == 1.0 ) lum = 1.0 - lum;
				float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
				float col = mod( index, u_row_simbols );
				float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
				vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
				vec4 color = texture2D( u_textureB, simbol_uv );
				if(u_colorize == 1.0)
					color *= textureColor;
				gl_FragColor = color;
			}
			`,o.registerNodeType("texture/encode",_);function at(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),at._shader||(at._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,at.pixel_shader))}at.title="Texture to Channels",at.desc="Split texture channels",at.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt){this._channels||(this._channels=Array(4));for(var vt=gl.RGB,xt=0,wt=0;wt<4;wt++)this.isOutputConnected(wt)?((!this._channels[wt]||this._channels[wt].width!=rt.width||this._channels[wt].height!=rt.height||this._channels[wt].type!=rt.type||this._channels[wt].format!=vt)&&(this._channels[wt]=new GL.Texture(rt.width,rt.height,{type:rt.type,format:vt,filter:gl.LINEAR})),xt++):this._channels[wt]=null;if(xt){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var It=Mesh.getScreenQuad(),Dt=at._shader,Nt=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],wt=0;wt<4;wt++)this._channels[wt]&&(this._channels[wt].drawTo(function(){rt.bind(0),Dt.uniforms({u_texture:0,u_mask:Nt[wt]}).draw(It)}),this.setOutputData(wt,this._channels[wt]))}}},at.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec4 u_mask;
			
			void main() {
			   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
			}
			`,o.registerNodeType("texture/textureChannels",at);function it(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:a.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}it.title="Channels to Texture",it.desc="Split texture channels",it.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},it.prototype.onExecute=function(){var rt=a.getWhiteTexture(),vt=this.getInputData(0)||rt,xt=this.getInputData(1)||rt,wt=this.getInputData(2)||rt,It=this.getInputData(3)||rt;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Dt=Mesh.getScreenQuad();it._shader||(it._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,it.pixel_shader));var Nt=it._shader,Rt=Math.max(vt.width,xt.width,wt.width,It.width),Mt=Math.max(vt.height,xt.height,wt.height,It.height),Bt=this.properties.precision==a.HIGH?a.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=Rt||this._texture.height!=Mt||this._texture.type!=Bt)&&(this._texture=new GL.Texture(Rt,Mt,{type:Bt,format:gl.RGBA,filter:gl.LINEAR}));var Ft=this._color;Ft[0]=this.properties.R,Ft[1]=this.properties.G,Ft[2]=this.properties.B,Ft[3]=this.properties.A;var Ht=this._uniforms;this._texture.drawTo(function(){vt.bind(0),xt.bind(1),wt.bind(2),It.bind(3),Nt.uniforms(Ht).draw(Dt)}),this.setOutputData(0,this._texture)},it.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureR;
			uniform sampler2D u_textureG;
			uniform sampler2D u_textureB;
			uniform sampler2D u_textureA;
			uniform vec4 u_color;
			
			void main() {
			   gl_FragColor = u_color * vec4( 						texture2D(u_textureR, v_coord).r,						texture2D(u_textureG, v_coord).r,						texture2D(u_textureB, v_coord).r,						texture2D(u_textureA, v_coord).r);
			}
			`,o.registerNodeType("texture/channelsTexture",it);function pt(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:a.DEFAULT}}pt.title="Color",pt.desc="Generates a 1x1 texture with a constant color",pt.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},pt.prototype.onDrawBackground=function(rt){var vt=this.properties.color;rt.fillStyle="rgb("+Math.floor(clamp(vt[0],0,1)*255)+","+Math.floor(clamp(vt[1],0,1)*255)+","+Math.floor(clamp(vt[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=rt.fillStyle:rt.fillRect(0,0,this.size[0],this.size[1])},pt.prototype.onExecute=function(){var rt=this.properties.precision==a.HIGH?a.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=rt)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:rt,minFilter:gl.NEAREST}));var vt=this.properties.color;if(this.inputs)for(var xt=0;xt<this.inputs.length;xt++){var wt=this.inputs[xt],It=this.getInputData(xt);if(It!==void 0)switch(wt.name){case"RGB":case"RGBA":vt.set(It);break;case"R":vt[0]=It;break;case"G":vt[1]=It;break;case"B":vt[2]=It;break;case"A":vt[3]=It;break}}vec4.sqrDist(this._tex_color,vt)>.001&&(this._tex_color.set(vt),this._tex.fill(vt)),this.setOutputData(0,this._tex)},pt.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},o.registerNodeType("texture/color",pt);function mt(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},mt._shader||(mt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,mt.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}mt.title="Gradient",mt.desc="Generates a gradient",mt["@A"]={type:"color"},mt["@B"]={type:"color"},mt["@texture_size"]={type:"enum",values:[32,64,128,256,512]},mt.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var rt=GL.Mesh.getScreenQuad(),vt=mt._shader,xt=this.getInputData(0);xt||(xt=this.properties.A);var wt=this.getInputData(1);wt||(wt=this.properties.B);for(var It=2;It<this.inputs.length;It++){var Dt=this.inputs[It],Nt=this.getInputData(It);Nt!==void 0&&(this.properties[Dt.name]=Nt)}var Rt=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(Rt.u_colorA,xt),vec3.copy(Rt.u_colorB,wt);var Mt=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=Mt)&&(this._tex=new GL.Texture(Mt,Mt,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){vt.uniforms(Rt).draw(rt)}),this.setOutputData(0,this._tex)},mt.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},mt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform float u_angle;
			uniform float u_scale;
			uniform vec3 u_colorA;
			uniform vec3 u_colorB;
			
			vec2 rotate(vec2 v, float angle)
			{
				vec2 result;
				float _cos = cos(angle);
				float _sin = sin(angle);
				result.x = v.x * _cos - v.y * _sin;
				result.y = v.x * _sin + v.y * _cos;
				return result;
			}
			void main() {
				float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
				vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
			   gl_FragColor = vec4(color,1.0);
			}
			`,o.registerNodeType("texture/gradient",mt);function _t(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:a.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}_t.title="Mix",_t.desc="Generates a texture mixing two textures",_t.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},_t.prototype.onExecute=function(){var rt=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}var vt=this.getInputData(1);if(!(!rt||!vt)){var xt=this.getInputData(2),wt=this.getInputData(3);this._tex=a.getTargetTexture(this.properties.size_from_biggest&&vt.width>rt.width?vt:rt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var It=Mesh.getScreenQuad(),Dt=null,Nt=this._uniforms;if(xt)Dt=_t._shader_tex,Dt||(Dt=_t._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,_t.pixel_shader,{MIX_TEX:""}));else{Dt=_t._shader_factor,Dt||(Dt=_t._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,_t.pixel_shader));var Rt=wt??this.properties.factor;Nt.u_mix.set([Rt,Rt,Rt,Rt])}var Mt=this.properties.invert;this._tex.drawTo(function(){rt.bind(Mt?1:0),vt.bind(Mt?0:1),xt&&xt.bind(2),Dt.uniforms(Nt).draw(It)}),this.setOutputData(0,this._tex)}}},_t.prototype.onGetInputs=function(){return[["factor","number"]]},_t.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_textureA;
			uniform sampler2D u_textureB;
			#ifdef MIX_TEX
				uniform sampler2D u_textureMix;
			#else
				uniform vec4 u_mix;
			#endif
			
			void main() {
				#ifdef MIX_TEX
				   vec4 f = texture2D(u_textureMix, v_coord);
				#else
				   vec4 f = u_mix;
				#endif
			   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
			}
			`,o.registerNodeType("texture/mix",_t);function Et(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:a.DEFAULT},Et._shader||(Et._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Et.pixel_shader))}Et.title="Edges",Et.desc="Detects edges",Et.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},Et.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}if(rt){this._tex=a.getTargetTexture(rt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var vt=Mesh.getScreenQuad(),xt=Et._shader,wt=this.properties.invert,It=this.properties.factor,Dt=this.properties.threshold?1:0;this._tex.drawTo(function(){rt.bind(0),xt.uniforms({u_texture:0,u_isize:[1/rt.width,1/rt.height],u_factor:It,u_threshold:Dt,u_invert:wt?1:0}).draw(vt)}),this.setOutputData(0,this._tex)}}},Et.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_isize;
			uniform int u_invert;
			uniform float u_factor;
			uniform float u_threshold;
			
			void main() {
				vec4 center = texture2D(u_texture, v_coord);
				vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
				vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
				vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
				vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
				vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
				diff *= u_factor;
				if(u_invert == 1)
					diff.xyz = vec3(1.0) - diff.xyz;
				if( u_threshold == 0.0 )
					gl_FragColor = vec4( diff.xyz, center.a );
				else
					gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
			}
			`,o.registerNodeType("texture/edges",Et);function Tt(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}Tt.title="Depth Range",Tt.desc="Generates a texture with a depth range",Tt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(rt){var vt=gl.UNSIGNED_BYTE;this.properties.high_precision&&(vt=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=vt||this._temp_texture.width!=rt.width||this._temp_texture.height!=rt.height)&&(this._temp_texture=new GL.Texture(rt.width,rt.height,{type:vt,format:gl.RGBA,filter:gl.LINEAR}));var xt=this._uniforms,wt=this.properties.distance;this.isInputConnected(1)&&(wt=this.getInputData(1),this.properties.distance=wt);var It=this.properties.range;this.isInputConnected(2)&&(It=this.getInputData(2),this.properties.range=It),xt.u_distance=wt,xt.u_range=It,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var Dt=Mesh.getScreenQuad();Tt._shader||(Tt._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Tt.pixel_shader),Tt._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,Tt.pixel_shader,{ONLY_DEPTH:""}));var Nt=this.properties.only_depth?Tt._shader_onlydepth:Tt._shader,Rt=null;rt.near_far_planes?Rt=rt.near_far_planes:window.LS&&LS.Renderer._main_camera?Rt=LS.Renderer._main_camera._uniforms.u_camera_planes:Rt=[.1,1e3],xt.u_camera_planes=Rt,this._temp_texture.drawTo(function(){rt.bind(0),Nt.uniforms(xt).draw(Dt)}),this._temp_texture.near_far_planes=Rt,this.setOutputData(0,this._temp_texture)}}},Tt.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform float u_distance;
			uniform float u_range;
			
			float LinearDepth()
			{
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord).x;
				depth = depth * 2.0 - 1.0;
				return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
			}
			
			void main() {
				float depth = LinearDepth();
				#ifdef ONLY_DEPTH
				   gl_FragColor = vec4(depth);
				#else
					float diff = abs(depth * u_camera_planes.y - u_distance);
					float dof = 1.0;
					if(diff <= u_range)
						dof = diff / u_range;
				   gl_FragColor = vec4(dof);
				#endif
			}
			`,o.registerNodeType("texture/depth_range",Tt);function Ot(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:a.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}Ot.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},Ot.title="Linear Depth",Ot.desc="Creates a color texture with linear depth",Ot.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(!(!rt||rt.format!=gl.DEPTH_COMPONENT&&rt.format!=gl.DEPTH_STENCIL)){var vt=this.properties.precision==a.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=vt||this._temp_texture.width!=rt.width||this._temp_texture.height!=rt.height)&&(this._temp_texture=new GL.Texture(rt.width,rt.height,{type:vt,format:gl.RGB,filter:gl.LINEAR}));var xt=this._uniforms;xt.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var wt=Mesh.getScreenQuad();Ot._shader||(Ot._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Ot.pixel_shader));var It=Ot._shader,Dt=null;rt.near_far_planes?Dt=rt.near_far_planes:window.LS&&LS.Renderer._main_camera?Dt=LS.Renderer._main_camera._uniforms.u_camera_planes:Dt=[.1,1e3],xt.u_camera_planes=Dt,xt.u_ires.set([0,0]),this._temp_texture.drawTo(function(){rt.bind(0),It.uniforms(xt).draw(wt)}),this._temp_texture.near_far_planes=Dt,this.setOutputData(0,this._temp_texture)}}},Ot.pixel_shader=`precision highp float;
			precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_camera_planes;
			uniform int u_invert;
			uniform vec2 u_ires;
			
			void main() {
				float zNear = u_camera_planes.x;
				float zFar = u_camera_planes.y;
				float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
				float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				if( u_invert == 1 )
					f = 1.0 - f;
				gl_FragColor = vec4(vec3(f),1.0);
			}
			`,o.registerNodeType("texture/linear_depth",Ot);function Ct(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:a.DEFAULT}}Ct.title="Blur",Ct.desc="Blur a texture",Ct.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},Ct.max_iterations=20,Ct.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){var vt=this._final_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(vt=this._final_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR}));var xt=this.properties.iterations;if(this.isInputConnected(1)&&(xt=this.getInputData(1),this.properties.iterations=xt),xt=Math.min(Math.floor(xt),Ct.max_iterations),xt==0){this.setOutputData(0,rt);return}var wt=this.properties.intensity;this.isInputConnected(2)&&(wt=this.getInputData(2),this.properties.intensity=wt);var It=o.camera_aspect;!It&&window.gl!==void 0&&(It=gl.canvas.height/gl.canvas.width),It||(It=1),It=this.properties.preserve_aspect?It:1;var Dt=this.properties.scale||[1,1];rt.applyBlur(It*Dt[0],Dt[1],wt,vt);for(var Nt=1;Nt<xt;++Nt)vt.applyBlur(It*Dt[0]*(Nt+1),Dt[1]*(Nt+1),wt);this.setOutputData(0,vt)}},o.registerNodeType("texture/blur",Ct);function St(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}St.prototype.applyFX=function(rt,vt,xt,wt){var It=rt.width,Dt=rt.height,Nt={format:rt.format,type:rt.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},Rt=this._uniforms,Mt=this._textures,Vt=St._cut_shader;Vt||(Vt=St._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,St.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),Rt.u_threshold=this.threshold;var Bt=Mt[0]=GL.Texture.getTemporary(It,Dt,Nt);rt.blit(Bt,Vt.uniforms(Rt));var Ft=Bt,Ht=this.iterations;Ht=clamp(Ht,1,16)|0;var Ut=Rt.u_texel_size,$t=this.intensity;Rt.u_intensity=1,Rt.u_delta=this.scale;var Vt=St._shader;Vt||(Vt=St._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,St.scale_pixel_shader));for(var Wt=1;Wt<Ht&&(It=It>>1,(Dt|0)>1&&(Dt=Dt>>1),!(It<2));Wt++)Bt=Mt[Wt]=GL.Texture.getTemporary(It,Dt,Nt),Ut[0]=1/Ft.width,Ut[1]=1/Ft.height,Ft.blit(Bt,Vt.uniforms(Rt)),Ft=Bt;for(wt&&(Ut[0]=1/Ft.width,Ut[1]=1/Ft.height,Rt.u_intensity=$t,Rt.u_delta=1,Ft.blit(wt,Vt.uniforms(Rt))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),Rt.u_intensity=this.persistence,Rt.u_delta=.5,Wt-=2;Wt>=0;Wt--)Bt=Mt[Wt],Mt[Wt]=null,Ut[0]=1/Ft.width,Ut[1]=1/Ft.height,Ft.blit(Bt,Vt.uniforms(Rt)),GL.Texture.releaseTemporary(Ft),Ft=Bt;if(gl.disable(gl.BLEND),xt&&Ft.blit(xt),vt){var Yt=vt,Xt=this.dirt_texture,qt=this.dirt_factor;Rt.u_intensity=$t,Vt=Xt?St._dirt_final_shader:St._final_shader,Vt||(Xt?Vt=St._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,St.final_pixel_shader,{USE_DIRT:""}):Vt=St._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,St.final_pixel_shader)),Yt.drawTo(function(){rt.bind(0),Ft.bind(1),Xt&&(Vt.setUniform("u_dirt_factor",qt),Vt.setUniform("u_dirt_texture",Xt.bind(2))),Vt.toViewport(Rt)})}GL.Texture.releaseTemporary(Ft)},St.cut_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_threshold;
		void main() {
			gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
		}`,St.scale_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			gl_FragColor = u_intensity * sampleBox( v_coord );
		}`,St.final_pixel_shader=`precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform sampler2D u_glow_texture;
		#ifdef USE_DIRT
			uniform sampler2D u_dirt_texture;
		#endif
		uniform vec2 u_texel_size;
		uniform float u_delta;
		uniform float u_intensity;
		uniform float u_dirt_factor;
		
		vec4 sampleBox(vec2 uv) {
			vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
			vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
			return s * 0.25;
		}
		void main() {
			vec4 glow = sampleBox( v_coord );
			#ifdef USE_DIRT
				glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
			#endif
			gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
		}`;function ft(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:a.DEFAULT},this.fx=new St}ft.title="Glow",ft.desc="Filters a texture giving it a glow effect",ft.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:a.MODE_VALUES}},ft.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},ft.prototype.onGetOutputs=function(){return[["average","Texture"]]},ft.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isAnyOutputConnected()){if(this.properties.precision===a.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,rt);return}rt.width,rt.height;var vt=this.fx;vt.threshold=this.getInputOrProperty("threshold"),vt.iterations=this.getInputOrProperty("iterations"),vt.intensity=this.getInputOrProperty("intensity"),vt.persistence=this.getInputOrProperty("persistence"),vt.dirt_texture=this.getInputData(1),vt.dirt_factor=this.getInputOrProperty("dirt_factor"),vt.scale=this.properties.scale;var xt=a.getTextureType(this.properties.precision,rt),wt=null;this.isOutputConnected(2)&&(wt=this._average_texture,(!wt||wt.type!=rt.type||wt.format!=rt.format)&&(wt=this._average_texture=new GL.Texture(1,1,{type:rt.type,format:rt.format,filter:gl.LINEAR})));var It=null;this.isOutputConnected(1)&&(It=this._glow_texture,(!It||It.width!=rt.width||It.height!=rt.height||It.type!=xt||It.format!=rt.format)&&(It=this._glow_texture=new GL.Texture(rt.width,rt.height,{type:xt,format:rt.format,filter:gl.LINEAR})));var Dt=null;this.isOutputConnected(0)&&(Dt=this._final_texture,(!Dt||Dt.width!=rt.width||Dt.height!=rt.height||Dt.type!=xt||Dt.format!=rt.format)&&(Dt=this._final_texture=new GL.Texture(rt.width,rt.height,{type:xt,format:rt.format,filter:gl.LINEAR}))),vt.applyFX(rt,Dt,It,wt),this.isOutputConnected(0)&&this.setOutputData(0,Dt),this.isOutputConnected(1)&&this.setOutputData(1,wt),this.isOutputConnected(2)&&this.setOutputData(2,It)}},o.registerNodeType("texture/glow",ft);function yt(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}yt.title="Kuwahara Filter",yt.desc="Filters a texture giving an artistic oil canvas painting",yt.max_radius=10,yt._shaders=[],yt.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){var vt=this._temp_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(this._temp_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR}));var xt=this.properties.radius;if(xt=Math.min(Math.floor(xt),yt.max_radius),xt==0){this.setOutputData(0,rt);return}var wt=this.properties.intensity,It=o.camera_aspect;!It&&window.gl!==void 0&&(It=gl.canvas.height/gl.canvas.width),It||(It=1),It=this.properties.preserve_aspect?It:1,yt._shaders[xt]||(yt._shaders[xt]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,yt.pixel_shader,{RADIUS:xt.toFixed(0)}));var Dt=yt._shaders[xt],Nt=GL.Mesh.getScreenQuad();rt.bind(0),this._temp_texture.drawTo(function(){Dt.uniforms({u_texture:0,u_intensity:wt,u_resolution:[rt.width,rt.height],u_iResolution:[1/rt.width,1/rt.height]}).draw(Nt)}),this.setOutputData(0,this._temp_texture)}},yt.pixel_shader=`
	precision highp float;
	varying vec2 v_coord;
	uniform sampler2D u_texture;
	uniform float u_intensity;
	uniform vec2 u_resolution;
	uniform vec2 u_iResolution;
	#ifndef RADIUS
		#define RADIUS 7
	#endif
	void main() {
	
		const int radius = RADIUS;
		vec2 fragCoord = v_coord;
		vec2 src_size = u_iResolution;
		vec2 uv = v_coord;
		float n = float((radius + 1) * (radius + 1));
		int i;
		int j;
		vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
		vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
		vec3 c;
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m0 += c;
				s0 += c * c;
			}
		}
		
		for (int j = -radius; j <= 0; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m1 += c;
				s1 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = 0; i <= radius; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m2 += c;
				s2 += c * c;
			}
		}
		
		for (int j = 0; j <= radius; ++j)  {
			for (int i = -radius; i <= 0; ++i)  {
				c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
				m3 += c;
				s3 += c * c;
			}
		}
		
		float min_sigma2 = 1e+2;
		m0 /= n;
		s0 = abs(s0 / n - m0 * m0);
		
		float sigma2 = s0.r + s0.g + s0.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m0, 1.0);
		}
		
		m1 /= n;
		s1 = abs(s1 / n - m1 * m1);
		
		sigma2 = s1.r + s1.g + s1.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m1, 1.0);
		}
		
		m2 /= n;
		s2 = abs(s2 / n - m2 * m2);
		
		sigma2 = s2.r + s2.g + s2.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m2, 1.0);
		}
		
		m3 /= n;
		s3 = abs(s3 / n - m3 * m3);
		
		sigma2 = s3.r + s3.g + s3.b;
		if (sigma2 < min_sigma2) {
			min_sigma2 = sigma2;
			gl_FragColor = vec4(m3, 1.0);
		}
	}
	`,o.registerNodeType("texture/kuwahara",yt);function ut(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}ut.title="XDoG Filter",ut.desc="Filters a texture giving an artistic ink style",ut.max_radius=10,ut._shaders=[],ut.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){var vt=this._temp_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(this._temp_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR})),ut._xdog_shader||(ut._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ut.xdog_pixel_shader));var xt=ut._xdog_shader,wt=GL.Mesh.getScreenQuad(),It=this.properties.sigma,Dt=this.properties.k,Nt=this.properties.p,Rt=this.properties.epsilon,Mt=this.properties.phi;rt.bind(0),this._temp_texture.drawTo(function(){xt.uniforms({src:0,sigma:It,k:Dt,p:Nt,epsilon:Rt,phi:Mt,cvsWidth:rt.width,cvsHeight:rt.height}).draw(wt)}),this.setOutputData(0,this._temp_texture)}},ut.xdog_pixel_shader=`
	precision highp float;
	uniform sampler2D src;

	uniform float cvsHeight;
	uniform float cvsWidth;

	uniform float sigma;
	uniform float k;
	uniform float p;
	uniform float epsilon;
	uniform float phi;
	varying vec2 v_coord;

	float cosh(float val)
	{
		float tmp = exp(val);
		float cosH = (tmp + 1.0 / tmp) / 2.0;
		return cosH;
	}

	float tanh(float val)
	{
		float tmp = exp(val);
		float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
		return tanH;
	}

	float sinh(float val)
	{
		float tmp = exp(val);
		float sinH = (tmp - 1.0 / tmp) / 2.0;
		return sinH;
	}

	void main(void){
		vec3 destColor = vec3(0.0);
		float tFrag = 1.0 / cvsHeight;
		float sFrag = 1.0 / cvsWidth;
		vec2 Frag = vec2(sFrag,tFrag);
		vec2 uv = gl_FragCoord.st;
		float twoSigmaESquared = 2.0 * sigma * sigma;
		float twoSigmaRSquared = twoSigmaESquared * k * k;
		int halfWidth = int(ceil( 1.0 * sigma * k ));

		const int MAX_NUM_ITERATION = 99999;
		vec2 sum = vec2(0.0);
		vec2 norm = vec2(0.0);

		for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
			if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
			int i = int(cnt / (2*halfWidth+1)) - halfWidth;
			int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

			float d = length(vec2(i,j));
			vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
								exp( -d * d / twoSigmaRSquared ));

			vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

			norm += kernel;
			sum += kernel * L;
		}

		sum /= norm;

		float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
		float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
		destColor = vec3(edge);
		gl_FragColor = vec4(destColor, 1.0);
	}`,o.registerNodeType("texture/xDoG",ut);function bt(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}bt.title="Webcam",bt.desc="Webcam texture",bt.is_webcam_open=!1,bt.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var rt={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(rt).then(this.streamReady.bind(this)).catch(xt);var vt=this;function xt(wt){bt.is_webcam_open=!1,console.log("Webcam rejected",wt),vt._webcam_stream=!1,vt.boxcolor="red",vt.trigger("stream_error")}},bt.prototype.closeStream=function(){if(this._webcam_stream){var rt=this._webcam_stream.getTracks();if(rt.length)for(var vt=0;vt<rt.length;++vt)rt[vt].stop();bt.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},bt.prototype.streamReady=function(rt){this._webcam_stream=rt,this.boxcolor="green";var vt=this._video;vt||(vt=document.createElement("video"),vt.autoplay=!0,vt.srcObject=rt,this._video=vt,vt.onloadedmetadata=function(xt){bt.is_webcam_open=!0,console.log(xt)}),this.trigger("stream_ready",vt)},bt.prototype.onPropertyChanged=function(rt,vt){rt=="facingMode"&&(this.properties.facingMode=vt,this.closeStream(),this.openStream())},bt.prototype.onRemoved=function(){if(this._webcam_stream){var rt=this._webcam_stream.getTracks();if(rt.length)for(var vt=0;vt<rt.length;++vt)rt[vt].stop();this._webcam_stream=null,this._video=null}},bt.prototype.onDrawBackground=function(rt){this.flags.collapsed||this.size[1]<=20||this._video&&(rt.save(),rt.webgl?this._video_texture&&rt.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):rt.drawImage(this._video,0,0,this.size[0],this.size[1]),rt.restore())},bt.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var rt=this._video.videoWidth,vt=this._video.videoHeight,xt=this._video_texture;if((!xt||xt.width!=rt||xt.height!=vt)&&(this._video_texture=new GL.Texture(rt,vt,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var wt=a.getTexturesContainer();wt[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var It=1;It<this.outputs.length;++It)if(this.outputs[It])switch(this.outputs[It].name){case"width":this.setOutputData(It,this._video.videoWidth);break;case"height":this.setOutputData(It,this._video.videoHeight);break}}},bt.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",o.EVENT],["stream_closed",o.EVENT],["stream_error",o.EVENT]]},o.registerNodeType("texture/webcam",bt);function ht(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:a.LOW},this._uniforms={u_texture:0,u_factor:1}}ht.title="Lens FX",ht.desc="distortion and chromatic aberration",ht.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},ht.prototype.onGetInputs=function(){return[["enabled","boolean"]]},ht.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){if(this.properties.precision===a.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,rt);return}var vt=this._temp_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(vt=this._temp_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR}));var xt=ht._shader;xt||(xt=ht._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,ht.pixel_shader));var wt=this.getInputData(1);wt==null&&(wt=this.properties.factor);var It=this._uniforms;It.u_factor=wt,gl.disable(gl.DEPTH_TEST),vt.drawTo(function(){rt.bind(0),xt.uniforms(It).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,vt)}},ht.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_factor;
			vec2 barrelDistortion(vec2 coord, float amt) {
				vec2 cc = coord - 0.5;
				float dist = dot(cc, cc);
				return coord + cc * dist * amt;
			}
			
			float sat( float t )
			{
				return clamp( t, 0.0, 1.0 );
			}
			
			float linterp( float t ) {
				return sat( 1.0 - abs( 2.0*t - 1.0 ) );
			}
			
			float remap( float t, float a, float b ) {
				return sat( (t - a) / (b - a) );
			}
			
			vec4 spectrum_offset( float t ) {
				vec4 ret;
				float lo = step(t,0.5);
				float hi = 1.0-lo;
				float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
				ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
			
				return pow( ret, vec4(1.0/2.2) );
			}
			
			const float max_distort = 2.2;
			const int num_iter = 12;
			const float reci_num_iter_f = 1.0 / float(num_iter);
			
			void main()
			{	
				vec2 uv=v_coord;
				vec4 sumcol = vec4(0.0);
				vec4 sumw = vec4(0.0);	
				for ( int i=0; i<num_iter;++i )
				{
					float t = float(i) * reci_num_iter_f;
					vec4 w = spectrum_offset( t );
					sumw += w;
					sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
				}
				gl_FragColor = sumcol / sumw;
			}`,o.registerNodeType("texture/lensfx",ht);function dt(){this.addInput("in",""),this.properties={precision:a.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}dt.title="Data->Tex",dt.desc="Generates or applies a curve to a texture",dt.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},dt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(rt){var vt=this.properties.channels,xt=this.properties.width,wt=this.properties.height;(!xt||!wt)&&(xt=Math.floor(rt.length/vt),wt=1);var It=gl.RGBA;vt==3?It=gl.RGB:vt==1&&(It=gl.LUMINANCE);var Dt=this._temp_texture,Nt=a.getTextureType(this.properties.precision);(!Dt||Dt.width!=xt||Dt.height!=wt||Dt.type!=Nt)&&(Dt=this._temp_texture=new GL.Texture(xt,wt,{type:Nt,format:It,filter:gl.LINEAR})),Dt.uploadData(rt),this.setOutputData(0,Dt)}}},o.registerNodeType("texture/fromdata",dt);function gt(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:a.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}gt.title="Curve",gt.desc="Generates or applies a curve to a texture",gt.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},gt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0),vt=this._temp_texture;if(!rt){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var xt=a.getTextureType(this.properties.precision,rt);(!vt||vt.type!=xt||vt.width!=rt.width||vt.height!=rt.height||vt.format!=rt.format)&&(vt=this._temp_texture=new GL.Texture(rt.width,rt.height,{type:xt,format:rt.format,filter:gl.LINEAR}));var wt=gt._shader;wt||(wt=gt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,gt.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var It=this._uniforms,Dt=this._curve_texture;vt.drawTo(function(){gl.disable(gl.DEPTH_TEST),rt.bind(0),Dt.bind(1),wt.uniforms(It).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,vt)}},gt.prototype.sampleCurve=function(rt,xt){var xt=xt||this._points.RGB;if(xt){for(var wt=0;wt<xt.length-1;++wt){var It=xt[wt],Dt=xt[wt+1];if(!(Dt[0]<rt)){var Nt=Dt[0]-It[0];if(Math.abs(Nt)<1e-5)return It[1];var Rt=(rt-It[0])/Nt;return It[1]*(1-Rt)+Dt[1]*Rt}}return 0}},gt.prototype.updateCurve=function(){for(var rt=this._values,vt=rt.length/4,xt=this.properties.split_channels,wt=0;wt<vt;++wt){if(xt)rt[wt*4]=clamp(this.sampleCurve(wt/vt,this._points.R)*255,0,255),rt[wt*4+1]=clamp(this.sampleCurve(wt/vt,this._points.G)*255,0,255),rt[wt*4+2]=clamp(this.sampleCurve(wt/vt,this._points.B)*255,0,255);else{var It=this.sampleCurve(wt/vt);rt[wt*4]=rt[wt*4+1]=rt[wt*4+2]=clamp(It*255,0,255)}rt[wt*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(rt,null,!0)},gt.prototype.onSerialize=function(rt){var vt={};for(var xt in this._points)vt[xt]=this._points[xt].concat();rt.curves=vt},gt.prototype.onConfigure=function(rt){this._points=rt.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},gt.prototype.onMouseDown=function(rt,vt,xt){if(this.curve_editor){var wt=this.curve_editor.onMouseDown([vt[0],vt[1]-this.curve_offset],xt);return wt&&this.captureInput(!0),wt}},gt.prototype.onMouseMove=function(rt,vt,xt){if(this.curve_editor)return this.curve_editor.onMouseMove([vt[0],vt[1]-this.curve_offset],xt)},gt.prototype.onMouseUp=function(rt,vt,xt){if(this.curve_editor)return this.curve_editor.onMouseUp([vt[0],vt[1]-this.curve_offset],xt);this.captureInput(!1)},gt.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},gt.prototype.onDrawBackground=function(rt,vt){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new o.CurveEditor(this._points.R)),rt.save(),rt.translate(0,this.curve_offset);var xt=this.widgets[1].value;this.properties.split_channels?(xt=="RGB"&&(this.widgets[1].value=xt="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(rt,[this.size[0],this.size[1]-this.curve_offset],vt,"#111",gt.channel_line_colors.R,!0),rt.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(rt,[this.size[0],this.size[1]-this.curve_offset],vt,null,gt.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(rt,[this.size[0],this.size[1]-this.curve_offset],vt,null,gt.channel_line_colors.B,!0),rt.globalCompositeOperation="source-over"):(this.widgets[1].value=xt="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[xt],this.curve_editor.draw(rt,[this.size[0],this.size[1]-this.curve_offset],vt,this.properties.split_channels?null:"#111",gt.channel_line_colors[xt]),rt.restore()}},gt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_curve;
			uniform float u_range;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord ) * u_range;
				color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
				color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
				color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
				//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
				gl_FragColor = color;
			}`,o.registerNodeType("texture/curve",gt);function kt(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:a.LOW},this._uniforms={u_texture:0,u_exposition:1}}kt.title="Exposition",kt.desc="Controls texture exposition",kt.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:a.MODE_VALUES}},kt.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){var vt=this._temp_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(vt=this._temp_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR}));var xt=kt._shader;xt||(xt=kt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,kt.pixel_shader)),this.properties.exposition;var wt=this.getInputData(1);wt!=null&&(this.properties.exposition=wt);var It=this._uniforms;vt.drawTo(function(){gl.disable(gl.DEPTH_TEST),rt.bind(0),xt.uniforms(It).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,vt)}},kt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_exposition;
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				gl_FragColor = vec4( color.xyz * u_exposition, color.a );
			}`,o.registerNodeType("texture/exposition",kt);function Lt(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:a.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}Lt.title="Tone Mapping",Lt.desc="Applies Tone Mapping to convert from high to low",Lt.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES}},Lt.prototype.onGetInputs=function(){return[["enabled","boolean"]]},Lt.prototype.onExecute=function(){var rt=this.getInputData(0);if(rt&&this.isOutputConnected(0)){if(this.properties.precision===a.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,rt);return}var vt=this._temp_texture;(!vt||vt.width!=rt.width||vt.height!=rt.height||vt.type!=rt.type)&&(vt=this._temp_texture=new GL.Texture(rt.width,rt.height,{type:rt.type,format:gl.RGBA,filter:gl.LINEAR}));var xt=this.getInputData(1);xt==null&&(xt=this.properties.average_lum);var wt=this._uniforms,It=null;xt.constructor===Number?(this.properties.average_lum=xt,wt.u_average_lum=this.properties.average_lum,It=Lt._shader,It||(It=Lt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Lt.pixel_shader))):xt.constructor===GL.Texture&&(wt.u_average_texture=xt.bind(1),It=Lt._shader_texture,It||(It=Lt._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Lt.pixel_shader,{AVG_TEXTURE:""}))),wt.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,wt.u_scale=this.properties.scale,wt.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),vt.drawTo(function(){rt.bind(0),It.uniforms(wt).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},Lt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_scale;
			#ifdef AVG_TEXTURE
				uniform sampler2D u_average_texture;
			#else
				uniform float u_average_lum;
			#endif
			uniform float u_lumwhite2;
			uniform float u_igamma;
			vec3 RGB2xyY (vec3 rgb)
			{
				 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
										   0.2126, 0.7152, 0.0722,
										   0.0193, 0.1192, 0.9505);
				vec3 XYZ = RGB2XYZ * rgb;
				
				float f = (XYZ.x + XYZ.y + XYZ.z);
				return vec3(XYZ.x / f,
							XYZ.y / f,
							XYZ.y);
			}
			
			void main() {
				vec4 color = texture2D( u_texture, v_coord );
				vec3 rgb = color.xyz;
				float average_lum = 0.0;
				#ifdef AVG_TEXTURE
					vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
					average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
				#else
					average_lum = u_average_lum;
				#endif
				//Ld - this part of the code is the same for both versions
				float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
				float L = (u_scale / average_lum) * lum;
				float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
				//first
				//vec3 xyY = RGB2xyY(rgb);
				//xyY.z *= Ld;
				//rgb = xyYtoRGB(xyY);
				//second
				rgb = (rgb / lum) * Ld;
				rgb = max(rgb,vec3(0.001));
				rgb = pow( rgb, vec3( u_igamma ) );
				gl_FragColor = vec4( rgb, color.a );
			}`,o.registerNodeType("texture/tonemapping",Lt);function Gt(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:a.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}Gt.title="Perlin",Gt.desc="Generates a perlin noise texture",Gt.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},Gt.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},Gt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.properties.width|0,vt=this.properties.height|0;rt==0&&(rt=gl.viewport_data[2]),vt==0&&(vt=gl.viewport_data[3]);var xt=a.getTextureType(this.properties.precision),wt=this._texture;(!wt||wt.width!=rt||wt.height!=vt||wt.type!=xt)&&(wt=this._texture=new GL.Texture(rt,vt,{type:xt,format:gl.RGB,filter:gl.LINEAR}));var It=this.getInputOrProperty("persistence"),Dt=this.getInputOrProperty("octaves"),Nt=this.getInputOrProperty("offset"),Rt=this.getInputOrProperty("scale"),Mt=this.getInputOrProperty("amplitude"),Bt=this.getInputOrProperty("seed"),Ft=""+rt+vt+xt+It+Dt+Rt+Bt+Nt[0]+Nt[1]+Mt;if(Ft==this._key){this.setOutputData(0,wt);return}this._key=Ft;var Ht=this._uniforms;Ht.u_persistence=It,Ht.u_octaves=Dt,Ht.u_offset.set(Nt),Ht.u_scale=Rt,Ht.u_amplitude=Mt,Ht.u_seed=Bt*128,Ht.u_viewport[0]=rt,Ht.u_viewport[1]=vt;var Ut=Gt._shader;Ut||(Ut=Gt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Gt.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),wt.drawTo(function(){Ut.uniforms(Ht).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,wt)}},Gt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform vec2 u_offset;
			uniform float u_scale;
			uniform float u_persistence;
			uniform int u_octaves;
			uniform float u_amplitude;
			uniform vec2 u_viewport;
			uniform float u_seed;
			#define M_PI 3.14159265358979323846
			
			float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
			
			float noise(vec2 p, float freq ){
				float unit = u_viewport.x/freq;
				vec2 ij = floor(p/unit);
				vec2 xy = mod(p,unit)/unit;
				//xy = 3.*xy*xy-2.*xy*xy*xy;
				xy = .5*(1.-cos(M_PI*xy));
				float a = rand((ij+vec2(0.,0.)));
				float b = rand((ij+vec2(1.,0.)));
				float c = rand((ij+vec2(0.,1.)));
				float d = rand((ij+vec2(1.,1.)));
				float x1 = mix(a, b, xy.x);
				float x2 = mix(c, d, xy.x);
				return mix(x1, x2, xy.y);
			}
			
			float pNoise(vec2 p, int res){
				float persistance = u_persistence;
				float n = 0.;
				float normK = 0.;
				float f = 4.;
				float amp = 1.0;
				int iCount = 0;
				for (int i = 0; i<50; i++){
					n+=amp*noise(p, f);
					f*=2.;
					normK+=amp;
					amp*=persistance;
					if (iCount >= res)
						break;
					iCount++;
				}
				float nf = n/normK;
				return nf*nf*nf*nf;
			}
			void main() {
				vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
				vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
				gl_FragColor = color;
			}`,o.registerNodeType("texture/perlin",Gt);function At(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:At.default_code,width:512,height:512,clear:!0,precision:a.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}At.title="Canvas2D",At.desc="Executes Canvas2D code inside a texture or the viewport.",At.help="Set width and height to 0 to match viewport size.",At.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,At.widgets_info={precision:{widget:"combo",values:a.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},At.prototype.onPropertyChanged=function(rt,vt){rt=="code"&&this.compileCode(vt)},At.prototype.compileCode=function(rt){if(this._func=null,!!o.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",rt),this.boxcolor="#00FF00"}catch(vt){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(vt)}},At.prototype.onExecute=function(){var rt=this._func;!rt||!this.isOutputConnected(0)||this.executeDraw(rt)},At.prototype.executeDraw=function(rt){var vt=this.properties.width||gl.canvas.width,xt=this.properties.height||gl.canvas.height,wt=this._temp_texture,It=a.getTextureType(this.properties.precision);(!wt||wt.width!=vt||wt.height!=xt||wt.type!=It)&&(wt=this._temp_texture=new GL.Texture(vt,xt,{format:gl.RGBA,filter:gl.LINEAR,type:It}));var Dt=this.getInputData(0),Nt=this.properties,Rt=this,Mt=this.graph.getTime(),Bt=gl,Ft=gl.canvas;if((this.properties.use_html_canvas||!e.enableWebGLCanvas)&&(this._canvas?(Ft=this._canvas,Bt=this._ctx):(Ft=this._canvas=createCanvas(vt.height),Bt=this._ctx=Ft.getContext("2d")),Ft.width=vt,Ft.height=xt),Bt==gl)wt.drawTo(function(){gl.start2D(),Nt.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{rt.draw?rt.draw.call(Rt,Ft,Bt,Mt,rt,Dt):rt.call(Rt,Ft,Bt,Mt,rt,Dt),Rt.boxcolor="#00FF00"}catch(Ht){Rt.boxcolor="#FF0000",console.error("Error executing script"),console.error(Ht)}gl.finish2D()});else{Nt.clear&&Bt.clearRect(0,0,Ft.width,Ft.height);try{rt.draw?rt.draw.call(this,Ft,Bt,Mt,rt,Dt):rt.call(this,Ft,Bt,Mt,rt,Dt),this.boxcolor="#00FF00"}catch(Ht){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(Ht)}wt.uploadImage(Ft)}this.setOutputData(0,wt)},o.registerNodeType("texture/canvas2D",At);function Pt(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:a.DEFAULT}}Pt.title="Matte",Pt.desc="Extracts background",Pt.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:a.MODE_VALUES}},Pt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(this.properties.precision===a.PASS_THROUGH){this.setOutputData(0,rt);return}if(rt){this._tex=a.getTargetTexture(rt,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var vt=this._uniforms,xt=Mesh.getScreenQuad(),wt=Pt._shader;wt||(wt=Pt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Pt.pixel_shader)),vt.u_key_color=this.properties.key_color,vt.u_threshold=this.properties.threshold,vt.u_slope=this.properties.slope,this._tex.drawTo(function(){rt.bind(0),wt.uniforms(vt).draw(xt)}),this.setOutputData(0,this._tex)}}},Pt.pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec3 u_key_color;
			uniform float u_threshold;
			uniform float u_slope;
			
			void main() {
				vec3 color = texture2D( u_texture, v_coord ).xyz;
				float diff = length( normalize(color) - normalize(u_key_color) );
				float edge = u_threshold * (1.0 - u_slope);
				float alpha = smoothstep( edge, u_threshold, diff);
				gl_FragColor = vec4( color, alpha );
			}`,o.registerNodeType("texture/matte",Pt);function zt(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}zt.title="CubemapToTexture2D",zt.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",zt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var rt=this.getInputData(0);if(!(!rt||rt.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=rt.height||this._last_tex.type!=rt.type)&&(this._last_tex=null);var vt=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(rt,rt.height,this._last_tex,!0,vt),this.setOutputData(0,this._last_tex)}}},o.registerNodeType("texture/cubemapToTexture2D",zt)}(commonjsGlobal),function(e){if(typeof GL>"u")return;var o=e.LiteGraph;e.LGraphCanvas;var s="#345",a=o.Shaders={};a.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var h=a.GLSL_types_const=["float","vec2","vec3","vec4"],d={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},c={},g=[];b(),a.ALL_TYPES="float,vec2,vec3,vec4";function b(){g.length=0;for(var ht in d){var dt=d[ht],gt=dt.indexOf(" "),kt=dt.substr(0,gt),Lt=dt.indexOf("(",gt),Gt=dt.substr(gt,Lt-gt).trim(),At=dt.substr(Lt+1,dt.length-Lt-2).split(",");for(var Pt in At){var zt=At[Pt].split(" ").filter(function(rt){return rt});At[Pt]={type:zt[0].trim(),name:zt[1].trim()},zt[2]=="="&&(At[Pt].value=zt[3].trim())}c[ht]={return_type:kt,func:Gt,params:At},g.push(Gt)}}function $(ht,dt){dt.color=s,dt.filter="shader",dt.prototype.clearDestination=function(){this.shader_destination={}},dt.prototype.propagateDestination=function(kt){if(this.shader_destination[kt]=!0,this.inputs)for(var Lt=0;Lt<this.inputs.length;++Lt){var Gt=this.getInputNode(Lt);Gt&&Gt.propagateDestination(kt)}},dt.prototype.onPropertyChanged||(dt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),o.registerNodeType("shader::"+ht,dt)}function et(ht,dt){return"VAR_"+(dt||"TEMP")+"_"+ht.id}function st(ht,dt){if(!ht.inputs)return null;var gt=ht.getInputLink(dt);if(!gt)return null;var kt=ht.graph.getNodeById(gt.origin_id);return kt?kt.getOutputVarName?kt.getOutputVarName(gt.origin_slot):"link_"+kt.id+"_"+gt.origin_slot:null}function j(ht,dt){return ht.isOutputConnected(dt)?"link_"+ht.id+"_"+dt:null}a.registerShaderNode=$,a.getInputLinkID=st,a.getOutputLinkID=j,a.getShaderNodeVarName=et,a.parseGLSLDescriptions=b;var tt=o.valueToGLSL=function(dt,gt,kt){var Lt=5;if(kt!=null&&(Lt=kt),!gt)if(dt.constructor===Number)gt="float";else if(dt.length)switch(dt.length){case 2:gt="vec2";break;case 3:gt="vec3";break;case 4:gt="vec4";break;case 9:gt="mat3";break;case 16:gt="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+dt.constructor;switch(gt){case"float":return dt.toFixed(Lt);case"vec2":return"vec2("+dt[0].toFixed(Lt)+","+dt[1].toFixed(Lt)+")";case"color3":case"vec3":return"vec3("+dt[0].toFixed(Lt)+","+dt[1].toFixed(Lt)+","+dt[2].toFixed(Lt)+")";case"color4":case"vec4":return"vec4("+dt[0].toFixed(Lt)+","+dt[1].toFixed(Lt)+","+dt[2].toFixed(Lt)+","+dt[3].toFixed(Lt)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw gt}return""},nt=o.varToTypeGLSL=function(dt,gt,kt){if(gt==kt)return dt;if(dt==null)switch(kt){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!kt)throw"error: no output type specified";if(kt=="float")switch(gt){case"vec2":case"vec3":case"vec4":return dt+".x";default:return"0.0"}else if(kt=="vec2")switch(gt){case"float":return"vec2("+dt+")";case"vec3":case"vec4":return dt+".xy";default:return"vec2(0.0)"}else if(kt=="vec3")switch(gt){case"float":return"vec3("+dt+")";case"vec2":return"vec3("+dt+",0.0)";case"vec4":return dt+".xyz";default:return"vec3(0.0)"}else if(kt=="vec4")switch(gt){case"float":return"vec4("+dt+")";case"vec2":return"vec4("+dt+",0.0,1.0)";case"vec3":return"vec4("+dt+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},lt=o.convertVarToGLSLType=function(dt,gt,kt){if(gt==kt)return dt;if(gt=="float")return kt+"("+dt+")";if(kt=="vec2")return"vec2("+dt+".xy)";if(kt=="vec3"){if(gt=="vec2")return"vec3("+dt+",0.0)";if(gt=="vec4")return"vec4("+dt+".xyz)"}if(kt=="vec4"){if(gt=="vec2")return"vec4("+dt+",0.0,0.0)";if(kt=="vec3")return"vec4("+dt+",1.0)"}return null};function ct(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}ct.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},ct.prototype.addUniform=function(ht,dt,gt){this._uniforms[ht]=dt,gt!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[ht]=gt)},ct.prototype.addFunction=function(ht,dt){this._functions[ht]=dt},ct.prototype.addCode=function(ht,dt,gt){gt=gt||{"":""};for(var kt in gt){var Lt=kt?kt+"_"+ht:ht;this._codeparts[Lt]?this._codeparts[Lt]+=dt+`
`:this._codeparts[Lt]=dt+`
`}},ct.prototype.computeCodeBlocks=function(ht,dt){this.clear();var gt=ht.findNodesByType("shader::output/vertex");gt=gt&&gt.length?gt[0]:null;var kt=ht.findNodesByType("shader::output/fragcolor");if(kt=kt&&kt.length?kt[0]:null,!kt)return null;ht.sendEventToAllNodes("clearDestination"),gt&&gt.propagateDestination("vs"),kt&&kt.propagateDestination("fs"),ht.sendEventToAllNodes("onGetCode",this);var Lt="";for(var Gt in this._uniforms)Lt+="uniform "+this._uniforms[Gt]+" "+Gt+`;
`;if(dt)for(var Gt in dt)Lt+="uniform "+dt[Gt]+" "+Gt+`;
`;var At="";for(var Gt in this._functions)At+="//"+Gt+`
`+this._functions[Gt]+`
`;var Pt=this._codeparts;return Pt.uniforms=Lt,Pt.functions=At,Pt},ct.prototype.computeShaderCode=function(ht){var dt=this.computeCodeBlocks(ht),gt=GL.Shader.replaceCodeUsingContext(this.vs_template,dt),kt=GL.Shader.replaceCodeUsingContext(this.fs_template,dt);return{vs_code:gt,fs_code:kt}},ct.prototype.computeShader=function(ht,dt){var gt=this.computeShaderCode(ht);if(console.log(gt.vs_code,gt.fs_code),!o.catch_exceptions)return this._shader_error=!0,dt?dt.updateShader(gt.vs_code,gt.fs_code):dt=new GL.Shader(gt.vs_code,gt.fs_code),this._shader_error=!1,dt;try{return dt?dt.updateShader(gt.vs_code,gt.fs_code):dt=new GL.Shader(gt.vs_code,gt.fs_code),this._shader_error=!1,dt}catch(kt){return this._shader_error||(console.error(kt),kt.indexOf("Fragment shader")!=-1?console.log(gt.fs_code.split(`
`).map(function(Lt,Gt){return Gt+".- "+Lt}).join(`
`)):console.log(gt.vs_code)),this._shader_error=!0,null}return null},ct.prototype.getShader=function(ht){if(this._shader&&this._shader._version==ht._version)return this._shader;var dt=this.computeShader(ht,this._shader);return dt?(this._shader=dt,dt._version=ht._version,dt):null},ct.prototype.fillUniforms=function(ht,dt){if(this._uniform_value)for(var gt in this._uniform_value){var kt=this._uniform_value[gt];kt!=null&&(kt.constructor===Function?ht[gt]=kt.call(this,dt):kt.constructor===GL.Texture||(ht[gt]=kt))}},o.ShaderContext=o.Shaders.Context=ct;function ot(){this.subgraph=new o.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var ht=this.subgraph.findNodesByType("shader::input/uniform")[0];ht.pos=[200,300];var dt=o.createNode("shader::texture/sampler2D");dt.pos=[400,300],this.subgraph.add(dt);var gt=o.createNode("shader::output/fragcolor");gt.pos=[600,300],this.subgraph.add(gt),ht.connect(0,dt),dt.connect(0,gt),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new ct,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=ot.template}ot.template=`
	#define FRAGMENT
	precision highp float;
	varying vec2 v_coord;
	{{varying}}
	{{uniforms}}
	{{functions}}
	{{fs_functions}}
	void main() {

	vec2 uv = v_coord;
	vec4 fragcolor = vec4(0.0);
	vec4 fragcolor1 = vec4(0.0);
	{{fs_code}}
	gl_FragColor = fragcolor;
	}
		`,ot.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},ot.title="ShaderGraph",ot.desc="Builds a shader using a graph",ot.input_node_type="input/uniform",ot.output_node_type="output/fragcolor",ot.title_color=s,ot.prototype.onSerialize=function(ht){ht.subgraph=this.subgraph.serialize()},ot.prototype.onConfigure=function(ht){this.subgraph.configure(ht.subgraph)},ot.prototype.onExecute=function(){if(this.isOutputConnected(0)){var ht=this.getInputData(0);ht&&ht.constructor!=GL.Texture&&(ht=null);var dt=this.properties.width|0,gt=this.properties.height|0;dt==0&&(dt=ht?ht.width:gl.viewport_data[2]),gt==0&&(gt=ht?ht.height:gl.viewport_data[3]);var kt=LGraphTexture.getTextureType(this.properties.precision,ht),Lt=this._texture;(!Lt||Lt.width!=dt||Lt.height!=gt||Lt.type!=kt)&&(Lt=this._texture=new GL.Texture(dt,gt,{type:kt,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var Gt=this.getShader(this.subgraph);if(Gt){var At=this._uniforms;this._context.fillUniforms(At);var Pt=0;if(this.inputs)for(var zt=0;zt<this.inputs.length;++zt){var rt=this.inputs[zt],vt=this.getInputData(zt);rt.type=="texture"&&(vt||(vt=GL.Texture.getWhiteTexture()),vt=vt.bind(Pt++)),vt!=null&&(At["u_"+rt.name]=vt)}var xt=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),Lt.drawTo(function(){Gt.uniforms(At),Gt.draw(xt)}),this.setOutputData(0,Lt)}}},ot.prototype.onInputAdded=function(ht){var dt=o.createNode("shader::input/uniform");dt.setProperty("name",ht.name),dt.setProperty("type",ht.type),this.subgraph.add(dt)},ot.prototype.onInputRemoved=function(ht,dt){for(var gt=this.subgraph.findNodesByType("shader::input/uniform"),kt=0;kt<gt.length;++kt){var Lt=gt[kt];Lt.properties.name==dt.name&&this.subgraph.remove(Lt)}},ot.prototype.computeSize=function(){var ht=this.inputs?this.inputs.length:0,dt=this.outputs?this.outputs.length:0;return[200,Math.max(ht,dt)*o.NODE_SLOT_HEIGHT+o.NODE_TITLE_HEIGHT+10]},ot.prototype.getShader=function(){var ht=this._context.getShader(this.subgraph);return ht?this.boxcolor=null:this.boxcolor="red",ht},ot.prototype.onDrawBackground=function(ht,dt,gt,kt){if(!this.flags.collapsed){var Lt=this.getOutputData(0),Gt=this.inputs?this.inputs.length*o.NODE_SLOT_HEIGHT:0;Lt&&ht==Lt.gl&&this.size[1]>Gt+o.NODE_TITLE_HEIGHT&&ht.drawImage(Lt,10,At,this.size[0]-20,this.size[1]-Gt-o.NODE_TITLE_HEIGHT);var At=this.size[1]-o.NODE_TITLE_HEIGHT+.5,Pt=o.isInsideRectangle(kt[0],kt[1],this.pos[0],this.pos[1]+At,this.size[0],o.NODE_TITLE_HEIGHT);ht.fillStyle=Pt?"#555":"#222",ht.beginPath(),this._shape==o.BOX_SHAPE?ht.rect(0,At,this.size[0]+1,o.NODE_TITLE_HEIGHT):ht.roundRect(0,At,this.size[0]+1,o.NODE_TITLE_HEIGHT,0,8),ht.fill(),ht.textAlign="center",ht.font="24px Arial",ht.fillStyle=Pt?"#DDD":"#999",ht.fillText("+",this.size[0]*.5,At+24)}},ot.prototype.onMouseDown=function(ht,dt,gt){var kt=this.size[1]-o.NODE_TITLE_HEIGHT+.5;dt[1]>kt&&gt.showSubgraphPropertiesDialog(this)},ot.prototype.onDrawSubgraphBackground=function(ht){},ot.prototype.getExtraMenuOptions=function(ht){var dt=this,gt=[{content:"Print Code",callback:function(){var kt=dt._context.computeShaderCode();console.log(kt.vs_code,kt.fs_code)}}];return gt},o.registerNodeType("texture/shaderGraph",ot);function _e(){this.addOutput("out",""),this.properties={name:"",type:""}}_e.title="Uniform",_e.desc="Input data for the shader",_e.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},_e.prototype.onPropertyChanged=function(ht,dt){this.outputs[0].name=this.properties.type+" "+this.properties.name},_e.prototype.onGetCode=function(ht){if(this.shader_destination){var dt=this.properties.type;if(!dt){if(!ht.onGetPropertyInfo)return;var gt=ht.onGetPropertyInfo(this.property.name);if(!gt)return;dt=gt.type}dt=="number"?dt="float":dt=="texture"&&(dt="sampler2D"),a.GLSL_types.indexOf(dt)!=-1&&(ht.addUniform("u_"+this.properties.name,dt),this.setOutputData(0,dt))}},_e.prototype.getOutputVarName=function(ht){return"u_"+this.properties.name},$("input/uniform",_e);function _(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}_.title="Attribute",_.desc="Input data from mesh attribute",_.prototype.getTitle=function(){return"att. "+this.properties.name},_.prototype.onGetCode=function(ht){if(this.shader_destination){var dt=this.properties.type;!dt||a.GLSL_types.indexOf(dt)==-1||(dt=="number"&&(dt="float"),this.properties.name!="coord"&&ht.addCode("varying"," varying "+dt+" v_"+this.properties.name+";"),this.setOutputData(0,dt))}},_.prototype.getOutputVarName=function(ht){return"v_"+this.properties.name},$("input/attribute",_);function at(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}at.title="Sampler2D",at.desc="Reads a pixel from a texture",at.prototype.onGetCode=function(ht){if(this.shader_destination){var dt=st(this,0),gt=et(this),kt="vec4 "+gt+` = vec4(0.0);
`;if(dt){var Lt=st(this,1)||ht.buffer_names.uvs;kt+=gt+" = texture2D("+dt+","+Lt+`);
`}var Gt=j(this,0);Gt&&(kt+="vec4 "+j(this,0)+" = "+gt+`;
`);var At=j(this,1);At&&(kt+="vec3 "+j(this,1)+" = "+gt+`.xyz;
`),ht.addCode("code",kt,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},$("texture/sampler2D",at);function it(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:h,property:"type"}),this.updateWidgets()}it.title="const",it.prototype.getTitle=function(){return this.flags.collapsed?tt(this.properties.value,this.properties.type,2):"Const"},it.prototype.onPropertyChanged=function(ht,dt){ht=="type"&&(this.outputs[0].type!=dt&&(this.disconnectOutput(0),this.outputs[0].type=dt),this.widgets.length=1,this.updateWidgets()),ht=="value"&&(dt.length?(this.widgets[1].value=dt[1],dt.length>2&&(this.widgets[2].value=dt[2]),dt.length>3&&(this.widgets[3].value=dt[3])):this.widgets[1].value=dt)},it.prototype.updateWidgets=function(gt){var dt=this,gt=this.properties.value,kt={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=gt&&gt.length==2?[gt[0],gt[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(Lt){dt.properties.value[0]=Lt},kt),this.addWidget("number","y",this.properties.value[1],function(Lt){dt.properties.value[1]=Lt},kt);break;case"vec3":this.properties.value=gt&&gt.length==3?[gt[0],gt[1],gt[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(Lt){dt.properties.value[0]=Lt},kt),this.addWidget("number","y",this.properties.value[1],function(Lt){dt.properties.value[1]=Lt},kt),this.addWidget("number","z",this.properties.value[2],function(Lt){dt.properties.value[2]=Lt},kt);break;case"vec4":this.properties.value=gt&&gt.length==4?[gt[0],gt[1],gt[2],gt[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(Lt){dt.properties.value[0]=Lt},kt),this.addWidget("number","y",this.properties.value[1],function(Lt){dt.properties.value[1]=Lt},kt),this.addWidget("number","z",this.properties.value[2],function(Lt){dt.properties.value[2]=Lt},kt),this.addWidget("number","w",this.properties.value[3],function(Lt){dt.properties.value[3]=Lt},kt);break;default:console.error("unknown type for constant")}},it.prototype.onGetCode=function(ht){if(this.shader_destination){var dt=tt(this.properties.value,this.properties.type),gt=j(this,0);if(gt){var kt="	"+this.properties.type+" "+gt+" = "+dt+";";ht.addCode("code",kt,this.shader_destination),this.setOutputData(0,this.properties.type)}}},$("const/const",it);function pt(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}pt.title="vec2",pt.varmodes=["xy","x","y"],pt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},pt.prototype.onGetCode=function(ht){if(this.shader_destination){for(var dt=this.properties,gt=et(this),kt="	vec2 "+gt+" = "+tt([dt.x,dt.y])+`;
`,Lt=0;Lt<pt.varmodes.length;++Lt){var Gt=pt.varmodes[Lt],At=st(this,Lt);At&&(kt+="	"+gt+"."+Gt+" = "+At+`;
`)}for(var Lt=0;Lt<pt.varmodes.length;++Lt){var Gt=pt.varmodes[Lt],Pt=j(this,Lt);if(Pt){var zt=h[Gt.length-1];kt+="	"+zt+" "+Pt+" = "+gt+"."+Gt+`;
`,this.setOutputData(Lt,zt)}}ht.addCode("code",kt,this.shader_destination)}},$("const/vec2",pt);function mt(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}mt.title="vec3",mt.varmodes=["xyz","x","y","z","xy","xz","yz"],mt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},mt.prototype.onGetCode=function(ht){if(this.shader_destination){for(var dt=this.properties,gt=et(this),kt="vec3 "+gt+" = "+tt([dt.x,dt.y,dt.z])+`;
`,Lt=0;Lt<mt.varmodes.length;++Lt){var Gt=mt.varmodes[Lt],At=st(this,Lt);At&&(kt+="	"+gt+"."+Gt+" = "+At+`;
`)}for(var Lt=0;Lt<mt.varmodes.length;++Lt){var Gt=mt.varmodes[Lt],Pt=j(this,Lt);if(Pt){var zt=h[Gt.length-1];kt+="	"+zt+" "+Pt+" = "+gt+"."+Gt+`;
`,this.setOutputData(Lt,zt)}}ht.addCode("code",kt,this.shader_destination)}},$("const/vec3",mt);function _t(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}_t.title="vec4",_t.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],_t.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},_t.prototype.onGetCode=function(ht){if(this.shader_destination){for(var dt=this.properties,gt=et(this),kt="vec4 "+gt+" = "+tt([dt.x,dt.y,dt.z,dt.w])+`;
`,Lt=0;Lt<_t.varmodes.length;++Lt){var Gt=_t.varmodes[Lt],At=st(this,Lt);At&&(kt+="	"+gt+"."+Gt+" = "+At+`;
`)}for(var Lt=0;Lt<_t.varmodes.length;++Lt){var Gt=_t.varmodes[Lt],Pt=j(this,Lt);if(Pt){var zt=h[Gt.length-1];kt+="	"+zt+" "+Pt+" = "+gt+"."+Gt+`;
`,this.setOutputData(Lt,zt)}}ht.addCode("code",kt,this.shader_destination)}},$("const/vec4",_t);function Et(){this.addInput("color",a.ALL_TYPES),this.block_delete=!0}Et.title="FragColor",Et.desc="Pixel final color",Et.prototype.onGetCode=function(ht){var dt=st(this,0);if(dt){var gt=this.getInputData(0),kt=nt(dt,gt,"vec4");ht.addCode("fs_code","fragcolor = "+kt+";")}},$("output/fragcolor",Et);function Tt(){this.addInput("A",a.ALL_TYPES),this.addInput("B",a.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:Tt.operations})}Tt.title="Operation",Tt.operations=["+","-","*","/"],Tt.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},Tt.prototype.onGetCode=function(ht){if(this.shader_destination&&this.isOutputConnected(0)){for(var dt=[],gt=0;gt<3;++gt)dt.push({name:st(this,gt),type:this.getInputData(gt)||"float"});var kt=j(this,0);if(kt){for(var Lt=dt[0].type,Gt=Lt,At=this.properties.operation,Pt=[],gt=0;gt<2;++gt){var zt=dt[gt].name;zt==null&&(zt=p.value!=null?p.value:"(1.0)",dt[gt].type="float"),dt[gt].type!=Lt&&(dt[gt].type=="float"&&(At=="*"||At=="/")||(zt=lt(zt,dt[gt].type,Lt))),Pt.push(zt)}ht.addCode("code",Gt+" "+kt+" = "+Pt[0]+At+Pt[1]+";",this.shader_destination),this.setOutputData(0,Gt)}}},$("math/operation",Tt);function Ot(){this.addInput("A",a.ALL_TYPES),this.addInput("B",a.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:g})}Ot.title="Func",Ot.prototype.onPropertyChanged=function(ht,dt){if(this.graph&&this.graph._version++,ht=="func"){var gt=c[dt];if(!gt)return;for(var kt=gt.params.length;kt<this.inputs.length;++kt)this.removeInput(kt);for(var kt=0;kt<gt.params.length;++kt){var Lt=gt.params[kt];this.inputs[kt]?this.inputs[kt].name=Lt.name+(Lt.value?" ("+Lt.value+")":""):this.addInput(Lt.name,a.ALL_TYPES)}}},Ot.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},Ot.prototype.onGetCode=function(ht){if(this.shader_destination&&this.isOutputConnected(0)){for(var dt=[],gt=0;gt<3;++gt)dt.push({name:st(this,gt),type:this.getInputData(gt)||"float"});var kt=j(this,0);if(kt){var Lt=c[this.properties.func];if(Lt){var Gt=dt[0].type,At=Lt.return_type;At=="T"&&(At=Gt);for(var Pt=[],gt=0;gt<Lt.params.length;++gt){var zt=Lt.params[gt],rt=dt[gt].name;rt==null&&(rt=zt.value!=null?zt.value:"(1.0)",dt[gt].type="float"),(zt.type=="T"&&dt[gt].type!=Gt||zt.type!="T"&&dt[gt].type!=Gt)&&(rt=lt(rt,dt[gt].type,Gt)),Pt.push(rt)}ht.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),ht.addCode("code",At+" "+kt+" = "+Lt.func+"("+Pt.join(",")+");",this.shader_destination),this.setOutputData(0,At)}}}},$("math/func",Ot);function Ct(){this.addInput("A",a.ALL_TYPES),this.addInput("B",a.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}Ct.title="Snippet",Ct.prototype.onPropertyChanged=function(ht,dt){this.graph&&this.graph._version++,ht=="type"&&this.outputs[0].type!=dt&&(this.disconnectOutput(0),this.outputs[0].type=dt)},Ct.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},Ct.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=st(this,0);dt||(dt="1.0");var gt=st(this,1);gt||(gt="1.0");var kt=j(this,0);if(kt){var Lt=this.getInputData(0)||"float",Gt=this.getInputData(1)||"float",At=this.properties.type;if(Lt=="T"||Gt=="T")return null;var Pt="funcSnippet"+this.id,zt=`
`+At+" "+Pt+"( "+Lt+" A, "+Gt+` B) {
`;zt+="	"+At+" C = "+At+`(0.0);
`,zt+="	"+this.properties.code+`;
`,zt+=`	return C;
}
`,ht.addCode("functions",zt,this.shader_destination),ht.addCode("code",At+" "+kt+" = "+Pt+"("+dt+","+gt+");",this.shader_destination),this.setOutputData(0,At)}}},$("utils/snippet",Ct);function St(){this.addOutput("out","float")}St.title="Rand",St.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=j(this,0);ht.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),ht.addCode("code","float "+dt+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},$("input/rand",St);function ft(){this.addInput("out",a.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:ft.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}ft.NOISE_TYPES=["noise","rand"],ft.title="noise",ft.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=st(this,0),gt=j(this,0),kt=this.getInputData(0);dt||(kt="vec2",dt=ht.buffer_names.uvs),ht.addFunction("noise",ft.shader_functions),ht.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),kt=="float"?ht.addCode("code","float "+gt+" = snoise( vec2("+dt+") * u_noise_scale"+this.id+");",this.shader_destination):kt=="vec2"||kt=="vec3"?ht.addCode("code","float "+gt+" = snoise("+dt+" * u_noise_scale"+this.id+");",this.shader_destination):kt=="vec4"&&ht.addCode("code","float "+gt+" = snoise("+dt+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},$("math/noise",ft),ft.shader_functions=`
	vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
	
	float snoise(vec2 v){
	  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
	  vec2 i  = floor(v + dot(v, C.yy) );
	  vec2 x0 = v -   i + dot(i, C.xx);
	  vec2 i1;
	  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
	  vec4 x12 = x0.xyxy + C.xxzz;
	  x12.xy -= i1;
	  i = mod(i, 289.0);
	  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
	  + i.x + vec3(0.0, i1.x, 1.0 ));
	  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
	  m = m*m ;
	  m = m*m ;
	  vec3 x = 2.0 * fract(p * C.www) - 1.0;
	  vec3 h = abs(x) - 0.5;
	  vec3 ox = floor(x + 0.5);
	  vec3 a0 = x - ox;
	  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
	  vec3 g;
	  g.x  = a0.x  * x0.x  + h.x  * x0.y;
	  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
	  return 130.0 * dot(m, g);
	}
	vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
	vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
	
	float snoise(vec3 v){ 
	  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
	  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
	
	// First corner
	  vec3 i  = floor(v + dot(v, C.yyy) );
	  vec3 x0 =   v - i + dot(i, C.xxx) ;
	
	// Other corners
	  vec3 g = step(x0.yzx, x0.xyz);
	  vec3 l = 1.0 - g;
	  vec3 i1 = min( g.xyz, l.zxy );
	  vec3 i2 = max( g.xyz, l.zxy );
	
	  //  x0 = x0 - 0. + 0.0 * C 
	  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
	  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
	  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
	
	// Permutations
	  i = mod(i, 289.0 ); 
	  vec4 p = permute( permute( permute( 
	             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
	           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
	           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
	
	// Gradients
	// ( N*N points uniformly over a square, mapped onto an octahedron.)
	  float n_ = 1.0/7.0; // N=7
	  vec3  ns = n_ * D.wyz - D.xzx;
	
	  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
	
	  vec4 x_ = floor(j * ns.z);
	  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
	
	  vec4 x = x_ *ns.x + ns.yyyy;
	  vec4 y = y_ *ns.x + ns.yyyy;
	  vec4 h = 1.0 - abs(x) - abs(y);
	
	  vec4 b0 = vec4( x.xy, y.xy );
	  vec4 b1 = vec4( x.zw, y.zw );
	
	  vec4 s0 = floor(b0)*2.0 + 1.0;
	  vec4 s1 = floor(b1)*2.0 + 1.0;
	  vec4 sh = -step(h, vec4(0.0));
	
	  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
	  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
	
	  vec3 p0 = vec3(a0.xy,h.x);
	  vec3 p1 = vec3(a0.zw,h.y);
	  vec3 p2 = vec3(a1.xy,h.z);
	  vec3 p3 = vec3(a1.zw,h.w);
	
	//Normalise gradients
	  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
	  p0 *= norm.x;
	  p1 *= norm.y;
	  p2 *= norm.z;
	  p3 *= norm.w;
	
	// Mix final noise value
	  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
	  m = m * m;
	  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
	}
	
	vec3 hash3( vec2 p ){
	    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
					   dot(p,vec2(269.5,183.3)), 
					   dot(p,vec2(419.2,371.9)) );
		return fract(sin(q)*43758.5453);
	}
	vec4 hash4( vec3 p ){
	    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
					   dot(p,vec3(269.5,183.3,335.1)), 
					   dot(p,vec3(314.5,235.1,467.3)), 
					   dot(p,vec3(419.2,371.9,114.9)) );
		return fract(sin(q)*43758.5453);
	}
	
	float iqnoise( in vec2 x, float u, float v ){
	    vec2 p = floor(x);
	    vec2 f = fract(x);
		
		float k = 1.0+63.0*pow(1.0-v,4.0);
		
		float va = 0.0;
		float wt = 0.0;
	    for( int j=-2; j<=2; j++ )
	    for( int i=-2; i<=2; i++ )
	    {
	        vec2 g = vec2( float(i),float(j) );
			vec3 o = hash3( p + g )*vec3(u,u,1.0);
			vec2 r = g - f + o.xy;
			float d = dot(r,r);
			float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
			va += o.z*ww;
			wt += ww;
	    }
		
	    return va/wt;
	}
	`;function yt(){this.addOutput("out","float")}yt.title="Time",yt.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=j(this,0);ht.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),ht.addCode("code","float "+dt+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},$("input/time",yt);function ut(){this.addInput("in","T"),this.addOutput("out","float")}ut.title="Dither",ut.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=st(this,0),gt="float",kt=j(this,0),Lt=this.getInputData(0);dt=nt(dt,Lt,"float"),ht.addFunction("dither8x8",ut.dither_func),ht.addCode("code",gt+" "+kt+" = dither8x8("+dt+");",this.shader_destination),this.setOutputData(0,gt)}},ut.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],ut.dither_func=`
			float dither8x8(float brightness) {
			  vec2 position = vec2(0.0);
			  #ifdef FRAGMENT
				position = gl_FragCoord.xy;
			  #endif
			  int x = int(mod(position.x, 8.0));
			  int y = int(mod(position.y, 8.0));
			  int index = x + y * 8;
			  float limit = 0.0;
			  if (x < 8) {
				if(index==0) limit = 0.015625;
				`+ut.dither_values.map(function(ht,dt){return"else if(index== "+(dt+1)+") limit = "+ht+";"}).join(`
`)+`
			  }
			  return brightness < limit ? 0.0 : 1.0;
			}
`,$("math/dither",ut);function bt(){this.addInput("",a.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}bt.title="Remap",bt.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},bt.prototype.onConnectionsChange=function(){var ht=this.getInputDataType(0);this.outputs[0].type=ht||"T"},bt.prototype.onGetCode=function(ht){if(!(!this.shader_destination||!this.isOutputConnected(0))){var dt=st(this,0),gt=j(this,0);if(!(!dt&&!gt)){var kt=this.getInputDataType(0);if(this.outputs[0].type=kt,kt=="T"){console.warn("node type is T and cannot be resolved");return}if(!dt){ht.addCode("code","	"+kt+" "+gt+" = "+kt+`(0.0);
`);return}var Lt=tt(this.properties.min_value),Gt=tt(this.properties.max_value),At=tt(this.properties.min_value2),Pt=tt(this.properties.max_value2);ht.addCode("code",kt+" "+gt+" = ( ("+dt+" - "+Lt+") / ("+Gt+" - "+Lt+") ) * ("+Pt+" - "+At+") + "+At+";",this.shader_destination),this.setOutputData(0,kt)}}},$("math/remap",bt)}(commonjsGlobal),function(e){var o=e.LiteGraph,s=new Float32Array(16),a=new Float32Array(16),h=new Float32Array(16),d=new Float32Array(16),c={u_view:s,u_projection:a,u_viewprojection:h,u_model:d};o.LGraphRender={onRequestCameraMatrices:null};function g(){return Math.random()*1e5|0}function b(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:b.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var it=this;this.addWidget("button","update",null,function(){it.must_update=!0}),this.geometry={vertices:null,_id:g()},this._old_obj=null,this._last_radius=null}e.LGraphPoints3D=b,b.RECTANGLE=1,b.CIRCLE=2,b.CUBE=10,b.SPHERE=11,b.HEMISPHERE=12,b.INSIDE_SPHERE=13,b.OBJECT=20,b.OBJECT_UNIFORMLY=21,b.OBJECT_INSIDE=22,b.MODE_VALUES={rectangle:b.RECTANGLE,circle:b.CIRCLE,cube:b.CUBE,sphere:b.SPHERE,hemisphere:b.HEMISPHERE,inside_sphere:b.INSIDE_SPHERE,object:b.OBJECT,object_uniformly:b.OBJECT_UNIFORMLY,object_inside:b.OBJECT_INSIDE},b.widgets_info={mode:{widget:"combo",values:b.MODE_VALUES}},b.title="list of points",b.desc="returns an array of points",b.prototype.onPropertyChanged=function(it,pt){this.must_update=!0},b.prototype.onExecute=function(){var it=this.getInputData(0);(it!=this._old_obj||it&&it._version!=this._old_obj_version)&&(this._old_obj=it,this.must_update=!0);var pt=this.getInputData(1);pt==null&&(pt=this.properties.radius),this._last_radius!=pt&&(this._last_radius=pt,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},b.prototype.updatePoints=function(){var it=this.properties.num_points|0;it<1&&(it=1),(!this.points||this.points.length!=it*3)&&(this.points=new Float32Array(it*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var pt=this._last_radius||this.properties.radius,mt=this.properties.mode,_t=this.getInputData(0);this._old_obj_version=_t?_t._version:null,this.points=b.generatePoints(pt,it,mt,this.points,this.normals,this.properties.regular,_t),this.version++},b.generatePoints=function(it,pt,mt,_t,Et,Tt,Ot){var Ct=pt*3;(!_t||_t.length!=Ct)&&(_t=new Float32Array(Ct));var St=new Float32Array(3),ft=new Float32Array([0,1,0]);if(Tt){if(mt==b.RECTANGLE){for(var yt=Math.floor(Math.sqrt(pt)),ut=0;ut<yt;++ut)for(var bt=0;bt<yt;++bt){var ht=ut*3+bt*3*yt;_t[ht]=(ut/yt-.5)*it*2,_t[ht+1]=0,_t[ht+2]=(bt/yt-.5)*it*2}if(_t=new Float32Array(_t.subarray(0,yt*yt*3)),Et)for(var ut=0;ut<Et.length;ut+=3)Et.set(ft,ut)}else if(mt==b.SPHERE){for(var yt=Math.floor(Math.sqrt(pt)),ut=0;ut<yt;++ut)for(var bt=0;bt<yt;++bt){var ht=ut*3+bt*3*yt;polarToCartesian(St,ut/yt*2*Math.PI,(bt/yt-.5)*2*Math.PI,it),_t[ht]=St[0],_t[ht+1]=St[1],_t[ht+2]=St[2]}_t=new Float32Array(_t.subarray(0,yt*yt*3)),Et&&b.generateSphericalNormals(_t,Et)}else if(mt==b.CIRCLE){for(var ut=0;ut<Ct;ut+=3){var dt=2*Math.PI*(ut/Ct);_t[ut]=Math.cos(dt)*it,_t[ut+1]=0,_t[ut+2]=Math.sin(dt)*it}if(Et)for(var ut=0;ut<Et.length;ut+=3)Et.set(ft,ut)}}else if(mt==b.RECTANGLE){for(var ut=0;ut<Ct;ut+=3)_t[ut]=(Math.random()-.5)*it*2,_t[ut+1]=0,_t[ut+2]=(Math.random()-.5)*it*2;if(Et)for(var ut=0;ut<Et.length;ut+=3)Et.set(ft,ut)}else if(mt==b.CUBE){for(var ut=0;ut<Ct;ut+=3)_t[ut]=(Math.random()-.5)*it*2,_t[ut+1]=(Math.random()-.5)*it*2,_t[ut+2]=(Math.random()-.5)*it*2;if(Et)for(var ut=0;ut<Et.length;ut+=3)Et.set(ft,ut)}else mt==b.SPHERE?(b.generateSphere(_t,Ct,it),Et&&b.generateSphericalNormals(_t,Et)):mt==b.HEMISPHERE?(b.generateHemisphere(_t,Ct,it),Et&&b.generateSphericalNormals(_t,Et)):mt==b.CIRCLE?(b.generateInsideCircle(_t,Ct,it),Et&&b.generateSphericalNormals(_t,Et)):mt==b.INSIDE_SPHERE?(b.generateInsideSphere(_t,Ct,it),Et&&b.generateSphericalNormals(_t,Et)):mt==b.OBJECT?b.generateFromObject(_t,Et,Ct,Ot,!1):mt==b.OBJECT_UNIFORMLY?b.generateFromObject(_t,Et,Ct,Ot,!0):mt==b.OBJECT_INSIDE?b.generateFromInsideObject(_t,Ct,Ot):console.warn("wrong mode in LGraphPoints3D");return _t},b.generateSphericalNormals=function(it,pt){for(var mt=new Float32Array(3),_t=0;_t<pt.length;_t+=3)mt[0]=it[_t],mt[1]=it[_t+1],mt[2]=it[_t+2],vec3.normalize(mt,mt),pt.set(mt,_t)},b.generateSphere=function(it,pt,mt){for(var _t=0;_t<pt;_t+=3){var Et=Math.random(),Tt=Math.random(),Ot=2*Math.cos(2*Math.PI*Et)*Math.sqrt(Tt*(1-Tt)),Ct=1-2*Tt,St=2*Math.sin(2*Math.PI*Et)*Math.sqrt(Tt*(1-Tt));it[_t]=Ot*mt,it[_t+1]=Ct*mt,it[_t+2]=St*mt}},b.generateHemisphere=function(it,pt,mt){for(var _t=0;_t<pt;_t+=3){var Et=Math.random(),Tt=Math.random(),Ot=Math.cos(2*Math.PI*Et)*Math.sqrt(1-Tt*Tt),Ct=Tt,St=Math.sin(2*Math.PI*Et)*Math.sqrt(1-Tt*Tt);it[_t]=Ot*mt,it[_t+1]=Ct*mt,it[_t+2]=St*mt}},b.generateInsideCircle=function(it,pt,mt){for(var _t=0;_t<pt;_t+=3){var Et=Math.random(),Tt=Math.random(),Ot=Math.cos(2*Math.PI*Et)*Math.sqrt(1-Tt*Tt),Ct=Math.sin(2*Math.PI*Et)*Math.sqrt(1-Tt*Tt);it[_t]=Ot*mt,it[_t+1]=0,it[_t+2]=Ct*mt}},b.generateInsideSphere=function(it,pt,mt){for(var _t=0;_t<pt;_t+=3){var Et=Math.random(),Tt=Math.random(),Ot=Et*2*Math.PI,Ct=Math.acos(2*Tt-1),St=Math.cbrt(Math.random())*mt,ft=Math.sin(Ot),yt=Math.cos(Ot),ut=Math.sin(Ct),bt=Math.cos(Ct);it[_t]=St*ut*yt,it[_t+1]=St*ut*ft,it[_t+2]=St*bt}};function $(it,pt){var mt=it.length,_t=0,Et=0,Tt=mt;if(mt==0)return-1;if(mt==1)return 0;for(;Tt>=_t;){Et=(Tt+_t)*.5|0;var Ot=it[Et];if(Ot==pt)return Et;if(_t==Tt-1)return _t;Ot<pt?_t=Et:Tt=Et}return Et}b.generateFromObject=function(it,pt,mt,_t,Et){if(_t){var Tt=null,Ot=null,Ct=null,St=null;if(_t.constructor===GL.Mesh&&(Tt=_t.vertexBuffers.vertices.data,Ot=_t.vertexBuffers.normals?_t.vertexBuffers.normals.data:null,Ct=_t.indexBuffers.indices?_t.indexBuffers.indices.data:null,Ct||(Ct=_t.indexBuffers.triangles?_t.indexBuffers.triangles.data:null)),!Tt)return null;var ft=Ct?Ct.length/3:Tt.length/(3*3),yt=0;if(Et){St=new Float32Array(ft);for(var ut=0;ut<ft;++ut){Ct?(zt=Ct[ut*3]*3,rt=Ct[ut*3+1]*3,vt=Ct[ut*3+2]*3):(zt=ut*9,rt=ut*9+3,vt=ut*9+6);var bt=Tt.subarray(zt,zt+3),ht=Tt.subarray(rt,rt+3),dt=Tt.subarray(vt,vt+3),gt=vec3.distance(bt,ht),kt=vec3.distance(ht,dt),Lt=vec3.distance(dt,bt),Gt=(gt+kt+Lt)/2;yt+=Math.sqrt(Gt*(Gt-gt)*(Gt-kt)*(Gt-Lt)),St[ut]=yt}for(var ut=0;ut<ft;++ut)St[ut]/=yt}for(var ut=0;ut<mt;ut+=3){var At=Math.random(),Pt=Et?$(St,At):Math.floor(At*ft),zt=0,rt=0,vt=0;Ct?(zt=Ct[Pt*3]*3,rt=Ct[Pt*3+1]*3,vt=Ct[Pt*3+2]*3):(zt=Pt*9,rt=Pt*9+3,vt=Pt*9+6);var Gt=Math.random(),xt=Math.random(),wt=Math.sqrt(Gt),It=1-wt,Dt=wt*(1-xt),Nt=xt*wt;if(it[ut]=It*Tt[zt]+Dt*Tt[rt]+Nt*Tt[vt],it[ut+1]=It*Tt[zt+1]+Dt*Tt[rt+1]+Nt*Tt[vt+1],it[ut+2]=It*Tt[zt+2]+Dt*Tt[rt+2]+Nt*Tt[vt+2],pt&&Ot){pt[ut]=It*Ot[zt]+Dt*Ot[rt]+Nt*Ot[vt],pt[ut+1]=It*Ot[zt+1]+Dt*Ot[rt+1]+Nt*Ot[vt+1],pt[ut+2]=It*Ot[zt+2]+Dt*Ot[rt+2]+Nt*Ot[vt+2];var Rt=pt.subarray(ut,ut+3);vec3.normalize(Rt,Rt)}}}},b.generateFromInsideObject=function(it,pt,mt){if(!(!mt||mt.constructor!==GL.Mesh)){var _t=mt.getBoundingBox();mt.octree||(mt.octree=new GL.Octree(mt));for(var Et=mt.octree,Tt=vec3.create(),Ot=vec3.fromValues(1,0,0),Ct=vec3.create(),St=0,ft=0;St<pt&&ft<it.length*10;){ft+=1;var yt=vec3.random(Ct);yt[0]=(yt[0]*2-1)*_t[3]+_t[0],yt[1]=(yt[1]*2-1)*_t[4]+_t[1],yt[2]=(yt[2]*2-1)*_t[5]+_t[2],Tt.set(yt);var ut=Et.testRay(Tt,Ot,0,1e4,!0,GL.Octree.ALL);!ut||ut.length%2==0||(it.set(yt,St),St+=3)}}},o.registerNodeType("geometry/points3D",b);function et(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}et.NORMAL=0,et.VERTICAL=1,et.SPHERICAL=2,et.RANDOM=3,et.RANDOM_VERTICAL=4,et.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},et.widgets_info={mode:{widget:"combo",values:et.modes}},et.title="points to inst",et.prototype.onExecute=function(){var it=this.getInputData(0);if(!it){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var pt=it._version!=this._version||it._id!=this._geometry_id;(pt&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(it)),this.setOutputData(0,this.matrices)}},et.prototype.updateInstances=function(it){var pt=it.vertices;if(!pt)return null;var mt=it.normals,_t=this.matrices,Et=pt.length/3;_t.length!=Et&&(_t.length=Et);var Tt=mat4.create(),Ot=vec3.create();vec3.create();var Ct=vec3.fromValues(0,1,0),St=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var ft=quat.create(),yt=vec3.create(),ut=vec3.create(),bt=vec3.create(),ht=0;ht<pt.length;ht+=3){var dt=ht/3,gt=_t[dt];gt||(gt=_t[dt]=mat4.create()),gt.set(Tt);var kt=pt.subarray(ht,ht+3);switch(this.properties.mode){case et.NORMAL:if(mat4.setTranslation(gt,kt),mt){var Lt=mt.subarray(ht,ht+3);bt.set(Lt),vec3.normalize(bt,bt),vec3.cross(ut,St,bt),vec3.normalize(ut,ut),vec3.cross(yt,ut,bt),vec3.normalize(yt,yt),gt.set(ut,0),gt.set(bt,4),gt.set(yt,8),mat4.setTranslation(gt,kt)}break;case et.VERTICAL:mat4.setTranslation(gt,kt);break;case et.SPHERICAL:yt.set(kt),vec3.normalize(yt,yt),vec3.cross(ut,Ct,yt),vec3.normalize(ut,ut),vec3.cross(bt,yt,ut),vec3.normalize(bt,bt),gt.set(ut,0),gt.set(bt,4),gt.set(yt,8),mat4.setTranslation(gt,kt);break;case et.RANDOM:Ot[0]=Math.random()*2-1,Ot[1]=Math.random()*2-1,Ot[2]=Math.random()*2-1,vec3.normalize(Ot,Ot),quat.setAxisAngle(ft,Ot,Math.random()*2*Math.PI),mat4.fromQuat(gt,ft),mat4.setTranslation(gt,kt);break;case et.RANDOM_VERTICAL:quat.setAxisAngle(ft,Ct,Math.random()*2*Math.PI),mat4.fromQuat(gt,ft),mat4.setTranslation(gt,kt);break}}this._version=it._version,this._geometry_id=it._id},o.registerNodeType("geometry/points_to_instances",et);function st(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:g(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}st.title="Transform",st.prototype.onExecute=function(){var it=this.getInputData(0),pt=this.getInputData(1);if(it){if(it.constructor===Array){if(it.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!pt){this.setOutputData(0,it);return}this._output||(this._output=new Array),this._output.length!=it.length&&(this._output.length=it.length);for(var mt=0;mt<it.length;++mt){var _t=this._output[mt];_t||(_t=this._output[mt]=mat4.create()),mat4.multiply(_t,it[mt],pt)}this.setOutputData(0,this._output);return}if(!(!it.vertices||!it.vertices.length)){var Et=it;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!pt){this.setOutputData(0,Et);return}var Tt=typedArrayToArray(pt).join(",");(this.must_update||Et._id!=this._last_geometry_id||Et._version!=this._last_version||Tt!=this._last_key)&&(this.updateGeometry(Et,pt),this._last_key=Tt,this._last_version=Et._version,this._last_geometry_id=Et._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},st.prototype.updateGeometry=function(it,pt){var mt=it.vertices,_t=this.geometry.vertices;(!_t||_t.length!=mt.length)&&(_t=this.geometry.vertices=new Float32Array(mt.length));for(var Et=vec3.create(),Tt=0,Ot=_t.length;Tt<Ot;Tt+=3)Et[0]=mt[Tt],Et[1]=mt[Tt+1],Et[2]=mt[Tt+2],mat4.multiplyVec3(Et,pt,Et),_t[Tt]=Et[0],_t[Tt+1]=Et[1],_t[Tt+2]=Et[2];if(it.normals){(!this.geometry.normals||this.geometry.normals.length!=it.normals.length)&&(this.geometry.normals=new Float32Array(it.normals.length));var Ct=this.geometry.normals,St=mat4.invert(mat4.create(),pt);St&&mat4.transpose(St,St);for(var ft=it.normals,Tt=0,Ot=Ct.length;Tt<Ot;Tt+=3)Et[0]=ft[Tt],Et[1]=ft[Tt+1],Et[2]=ft[Tt+2],mat4.multiplyVec3(Et,St,Et),Ct[Tt]=Et[0],Ct[Tt+1]=Et[1],Ct[Tt+2]=Et[2]}this.geometry.type=it.type,this.geometry._version++},o.registerNodeType("geometry/transform",st);function j(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:g()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}j.title="Polygon",j.prototype.onExecute=function(){if(this.isOutputConnected(0)){var it=this.getInputOrProperty("sides"),pt=this.getInputOrProperty("radius");it=Math.max(3,it)|0,(this.last_info.sides!=it||this.last_info.radius!=pt)&&this.updateGeometry(it,pt),this.setOutputData(0,this.geometry)}},j.prototype.updateGeometry=function(it,pt){var mt=3*it,_t=this.geometry.vertices;(!_t||_t.length!=mt)&&(_t=this.geometry.vertices=new Float32Array(3*it));var Et=Math.PI*2/it,Tt=this.properties.uvs;Tt&&(uvs=this.geometry.coords=new Float32Array(3*it));for(var Ot=0;Ot<it;++Ot){var Ct=Et*-Ot,St=Math.cos(Ct)*pt,ft=0,yt=Math.sin(Ct)*pt;_t[Ot*3]=St,_t[Ot*3+1]=ft,_t[Ot*3+2]=yt}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=it,this.last_info.radius=pt},o.registerNodeType("geometry/polygon",j);function tt(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}tt.title="extrude",tt.prototype.onPropertyChanged=function(it,pt){this._must_update=!0},tt.prototype.onExecute=function(){var it=this.getInputData(0);!it||!this.isOutputConnected(0)||((it.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(it,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},tt.prototype.extrudeGeometry=function(it){var pt=it.vertices,mt=pt.length/3,_t=vec3.create(),Et=vec3.create(),Tt=vec3.create(),Ot=vec3.create(),Ct=new Float32Array(this.properties.offset);if(it.type=="line_loop")for(var St=new Float32Array(mt*6*3),ft=0,yt=0,ut=pt.length;yt<ut;yt+=3)_t[0]=pt[yt],_t[1]=pt[yt+1],_t[2]=pt[yt+2],yt+3<ut?(Et[0]=pt[yt+3],Et[1]=pt[yt+4],Et[2]=pt[yt+5]):(Et[0]=pt[0],Et[1]=pt[1],Et[2]=pt[2]),vec3.add(Tt,_t,Ct),vec3.add(Ot,Et,Ct),St.set(_t,ft),ft+=3,St.set(Et,ft),ft+=3,St.set(Tt,ft),ft+=3,St.set(Et,ft),ft+=3,St.set(Ot,ft),ft+=3,St.set(Tt,ft),ft+=3;var bt={_id:g(),type:"triangles",vertices:St};return bt},o.registerNodeType("geometry/extrude",tt);function nt(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}nt.title="geoeval",nt.desc="eval code",nt.widgets_info={code:{widget:"code"}},nt.prototype.onConfigure=function(it){this.compileCode()},nt.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},nt.prototype.onPropertyChanged=function(it,pt){it=="code"&&(this.properties.code=pt,this.compileCode())},nt.prototype.onExecute=function(){var it=this.getInputData(0);if(it){if(!this.func){this.setOutputData(0,it);return}if(this.geometry_id!=it._id||this.version!=it._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=it._id,this.properties.execute_every_frame?this.version++:this.version=it._version;var pt=this.func,mt=getTime();this.geometry||(this.geometry={});for(var _t in it)it[_t]!=null&&(it[_t].constructor==Float32Array?this.geometry[_t]=new Float32Array(it[_t]):this.geometry[_t]=it[_t]);this.geometry._id=it._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=it._version+1;var Et=vec3.create(),Tt=this.vertices;!Tt||this.vertices.length!=it.vertices.length?Tt=this.vertices=new Float32Array(it.vertices):Tt.set(it.vertices);for(var _t=0;_t<Tt.length;_t+=3)Et[0]=Tt[_t],Et[1]=Tt[_t+1],Et[2]=Tt[_t+2],pt(Et,_t/3,mt),Tt[_t]=Et[0],Tt[_t+1]=Et[1],Tt[_t+2]=Et[2];this.geometry.vertices=Tt}this.setOutputData(0,this.geometry)}},o.registerNodeType("geometry/eval",nt);function lt(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(lt.title="connect points",lt.desc="adds indices between near points",lt.prototype.onPropertyChanged=function(it,pt){this.must_update=!0},lt.prototype.onExecute=function(){var it=this.getInputData(0);if(it){if(this.geometry_id!=it._id||this.version!=it._version||this.must_update){this.must_update=!1,this.geometry_id=it._id,this.version=it._version,this.geometry={};for(var pt in it)this.geometry[pt]=it[pt];this.geometry._id=g(),this.geometry._version=this.my_version++;for(var mt=it.vertices,_t=mt.length,Et=this.properties.min_dist,Tt=this.properties.max_dist,Ot=this.properties.probability,Ct=this.properties.max_connections,St=[],pt=0;pt<_t;pt+=3)for(var ft=mt[pt],yt=mt[pt+1],ut=mt[pt+2],bt=0,ht=pt+3;ht<_t;ht+=3){var dt=mt[ht],gt=mt[ht+1],kt=mt[ht+2],Lt=Math.sqrt((ft-dt)*(ft-dt)+(yt-gt)*(yt-gt)+(ut-kt)*(ut-kt));if(!(Lt>Tt||Lt<Et||Ot<1&&Ot<Math.random())&&(St.push(pt/3,ht/3),bt+=1,Ct&&bt>Ct))break}this.geometry.indices=this.indices=new Uint32Array(St)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},o.registerNodeType("geometry/connectPoints",lt),typeof GL>"u")return;function ct(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}ct.title="to geometry",ct.desc="converts a mesh to geometry",ct.prototype.onExecute=function(){var it=this.getInputData(0);if(it){if(it!=this.last_mesh){this.last_mesh=it;for(i in it.vertexBuffers){var pt=it.vertexBuffers[i];this.geometry[i]=pt.data}it.indexBuffers.triangles&&(this.geometry.indices=it.indexBuffers.triangles.data),this.geometry._id=g(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},o.registerNodeType("geometry/toGeometry",ct);function ot(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}ot.title="Geo to Mesh",ot.prototype.updateMesh=function(it){this.mesh||(this.mesh=new GL.Mesh);for(var pt in it)if(pt[0]!="_"){var mt=it[pt],_t=GL.Mesh.common_buffers[pt];if(!(!_t&&pt!="indices")){var Et=_t?_t.spacing:3,Tt=this.mesh.vertexBuffers[pt];!Tt||Tt.data.length!=mt.length?Tt=new GL.Buffer(pt=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,mt,Et,GL.DYNAMIC_DRAW):(Tt.data.set(mt),Tt.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(pt,Tt)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var Ot=new Float32Array([0,1,0]),Ct=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),pt=0;pt<Ct.length;pt+=3)Ct.set(Ot,pt);Tt=new GL.Buffer(GL.ARRAY_BUFFER,Ct,3),this.mesh.addBuffer("normals",Tt)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=it._id,this.version=this.mesh.version=it._version,this.mesh},ot.prototype.onExecute=function(){var it=this.getInputData(0);it&&((this.version!=it._version||this.geometry_id!=it._id)&&this.updateMesh(it),this.setOutputData(0,this.mesh))},o.registerNodeType("geometry/toMesh",ot);function _e(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}_e.title="Render Mesh",_e.desc="renders a mesh flat",_e.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},_e.widgets_info={primitive:{widget:"combo",values:_e.PRIMITIVE_VALUES},color:{widget:"color"}},_e.prototype.onExecute=function(){if(this.properties.enabled){var it=this.getInputData(0);if(it){if(!o.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}o.LGraphRender.onRequestCameraMatrices(s,a,h);var pt=null,mt=this.getInputData(2);mt?(pt=gl.shaders.textured,pt||(pt=gl.shaders.textured=new GL.Shader(at.vertex_shader_code,at.fragment_shader_code,{USE_TEXTURE:""}))):(pt=gl.shaders.flat,pt||(pt=gl.shaders.flat=new GL.Shader(at.vertex_shader_code,at.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var _t=this.model_matrix,Et=this.getInputData(1);Et?_t.set(Et):mat4.identity(_t),this.uniforms.u_point_size=1;var Tt=this.properties.primitive;pt.uniforms(c),pt.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var Ot="indices";it.indexBuffers.triangles&&(Ot="triangles"),pt.draw(it,Tt,Ot),gl.disable(gl.BLEND),gl.depthMask(!0)}}},o.registerNodeType("geometry/render_mesh",_e);function _(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}_.title="Primitive",_.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},_.widgets_info={type:{widget:"combo",values:_.VALID}},_.prototype.onExecute=function(){if(this.isOutputConnected(0)){var it=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=it||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,it,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},_.prototype.updateMesh=function(it,pt,mt){switch(mt=Math.max(0,mt)|0,it){case 1:this._mesh=GL.Mesh.cube({size:pt,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:pt,xz:!0,detail:mt,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:pt,subdivisions:mt,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:pt,long:mt,lat:mt,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:pt,slices:mt,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:pt,long:mt,lat:mt,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:pt,subdivisions:mt});break;case 8:this._mesh=GL.Mesh.cone({radius:pt,height:pt,subdivisions:mt});break;case 9:this._mesh=GL.Mesh.plane({size:pt,xz:!1,detail:mt,normals:!0,coords:!0});break}this.last_info.type=it,this.last_info.size=pt,this.last_info.subdivisions=mt,this._mesh.version=this.version++},o.registerNodeType("geometry/mesh_primitive",_);function at(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}at.title="renderPoints",at.desc="render points with a texture",at.widgets_info={color:{widget:"color"}},at.prototype.updateMesh=function(it){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=it.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,it.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(it.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=it._id,this.version=this.mesh.version=it._version},at.prototype.onExecute=function(){if(this.properties.enabled){var it=this.getInputData(0);if(it){if((this.version!=it._version||this.geometry_id!=it._id)&&this.updateMesh(it),!o.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}o.LGraphRender.onRequestCameraMatrices(s,a,h);var pt=null,mt=this.getInputData(2);mt?(pt=gl.shaders.textured_points,pt||(pt=gl.shaders.textured_points=new GL.Shader(at.vertex_shader_code,at.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(pt=gl.shaders.points,pt||(pt=gl.shaders.points=new GL.Shader(at.vertex_shader_code,at.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var _t=this.getInputData(1);_t?d.set(_t):mat4.identity(d),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*a[5],pt.uniforms(c),pt.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),pt.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},o.registerNodeType("geometry/render_points",at),at.vertex_shader_code=`			precision mediump float;
			attribute vec3 a_vertex;
			varying vec3 v_vertex;
			attribute vec3 a_normal;
			varying vec3 v_normal;
			#ifdef USE_COLOR
				attribute vec4 a_color;
				varying vec4 v_color;
			#endif
			attribute vec2 a_coord;
			varying vec2 v_coord;
			#ifdef USE_SIZE
				attribute float a_extra;
			#endif
			#ifdef USE_INSTANCING
				attribute mat4 u_model;
			#else
				uniform mat4 u_model;
			#endif
			uniform mat4 u_viewprojection;
			uniform float u_point_size;
			uniform float u_perspective;
			uniform float u_point_perspective;
			float computePointSize(float radius, float w)
			{
				if(radius < 0.0)
					return -radius;
				return u_perspective * radius / w;
			}
			void main() {
				v_coord = a_coord;
				#ifdef USE_COLOR
					v_color = a_color;
				#endif
				v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
				v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
				gl_Position = u_viewprojection * vec4(v_vertex,1.0);
				gl_PointSize = u_point_size;
				#ifdef USE_SIZE
					gl_PointSize = a_extra;
				#endif
				if(u_point_perspective != 0.0)
					gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
			}		`,at.fragment_shader_code=`			precision mediump float;
			uniform vec4 u_color;
			#ifdef USE_COLOR
				varying vec4 v_color;
			#endif
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			void main() {
				vec4 color = u_color;
				#ifdef USE_TEXTURED_POINTS
					color *= texture2D(u_texture, gl_PointCoord.xy);
				#else
					#ifdef USE_TEXTURE
					  color *= texture2D(u_texture, v_coord);
					  if(color.a < 0.1)
						discard;
					#endif
					#ifdef USE_POINTS
						float dist = length( gl_PointCoord.xy - vec2(0.5) );
						if( dist > 0.45 )
							discard;
					#endif
				#endif
				#ifdef USE_COLOR
					color *= v_color;
				#endif
				gl_FragColor = color;
			}		`}(commonjsGlobal),function(e){var o=e.LiteGraph,s=e.LGraphTexture;if(typeof GL<"u"){let g=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:s.DEFAULT},g._shader||(g._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,g.pixel_shader),g._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},b=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},$=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:s.DEFAULT}},et=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:s.DEFAULT},et._shader||(et._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,et.pixel_shader))};var a=g,h=b,d=$,c=et;g.title="Lens",g.desc="Camera Lens distortion",g.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},g.prototype.onExecute=function(){var st=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,st);return}if(st){this._tex=s.getTargetTexture(st,this._tex,this.properties.precision);var j=this.properties.aberration;this.isInputConnected(1)&&(j=this.getInputData(1),this.properties.aberration=j);var tt=this.properties.distortion;this.isInputConnected(2)&&(tt=this.getInputData(2),this.properties.distortion=tt);var nt=this.properties.blur;this.isInputConnected(3)&&(nt=this.getInputData(3),this.properties.blur=nt),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var lt=Mesh.getScreenQuad(),ct=g._shader;this._tex.drawTo(function(){st.bind(0),ct.uniforms({u_texture:0,u_aberration:j,u_distortion:tt,u_blur:nt}).draw(lt)}),this.setOutputData(0,this._tex)}},g.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_aberration;
				uniform float u_distortion;
				uniform float u_blur;
				
				void main() {
					vec2 coord = v_coord;
					float dist = distance(vec2(0.5), coord);
					vec2 dist_coord = coord - vec2(0.5);
					float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
					dist_coord *= percent;
					coord = dist_coord + vec2(0.5);
					vec4 color = texture2D(u_texture,coord, u_blur * dist);
					color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
					color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
					gl_FragColor = color;
				}
				`,o.registerNodeType("fx/lens",g),e.LGraphFXLens=g,b.title="Bokeh",b.desc="applies an Bokeh effect",b.widgets_info={shape:{widget:"texture"}},b.prototype.onExecute=function(){var st=this.getInputData(0),j=this.getInputData(1),tt=this.getInputData(2);if(!st||!tt||!this.properties.shape){this.setOutputData(0,st);return}j||(j=st);var nt=s.getTexture(this.properties.shape);if(nt){var lt=this.properties.threshold;this.isInputConnected(3)&&(lt=this.getInputData(3),this.properties.threshold=lt);var ct=gl.UNSIGNED_BYTE;this.properties.high_precision&&(ct=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=ct||this._temp_texture.width!=st.width||this._temp_texture.height!=st.height)&&(this._temp_texture=new GL.Texture(st.width,st.height,{type:ct,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var ot=b._first_shader;ot||(ot=b._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,b._first_pixel_shader));var _e=b._second_shader;_e||(_e=b._second_shader=new GL.Shader(b._second_vertex_shader,b._second_pixel_shader));var _=this._points_mesh;(!_||_._width!=st.width||_._height!=st.height||_._spacing!=2)&&(_=this.createPointsMesh(st.width,st.height,2));var at=Mesh.getScreenQuad(),it=this.properties.size;this.properties.min_light;var pt=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){st.bind(0),j.bind(1),tt.bind(2),ot.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[st.width,st.height]}).draw(at)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),st.bind(0),nt.bind(3),_e.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:pt,u_threshold:lt,u_pointSize:it,u_itexsize:[1/st.width,1/st.height]}).draw(_,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},b.prototype.createPointsMesh=function(st,j,tt){for(var nt=Math.round(st/tt),lt=Math.round(j/tt),ct=new Float32Array(nt*lt*2),ot=-1,_e=2/st*tt,_=2/j*tt,at=0;at<lt;++at){for(var it=-1,pt=0;pt<nt;++pt){var mt=at*nt*2+pt*2;ct[mt]=it,ct[mt+1]=ot,it+=_e}ot+=_}return this._points_mesh=GL.Mesh.load({vertices2D:ct}),this._points_mesh._width=st,this._points_mesh._height=j,this._points_mesh._spacing=tt,this._points_mesh},b._first_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_texture_blur;
				uniform sampler2D u_mask;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec4 blurred_color = texture2D(u_texture_blur, v_coord);
					float mask = texture2D(u_mask, v_coord).x;
				   gl_FragColor = mix(color, blurred_color, mask);
				}
				`,b._second_vertex_shader=`precision highp float;
				attribute vec2 a_vertex2D;
				varying vec4 v_color;
				uniform sampler2D u_texture;
				uniform sampler2D u_mask;
				uniform vec2 u_itexsize;
				uniform float u_pointSize;
				uniform float u_threshold;
				void main() {
					vec2 coord = a_vertex2D * 0.5 + 0.5;
					v_color = texture2D( u_texture, coord );
					v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
					v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
					v_color += texture2D( u_texture, coord + u_itexsize);
					v_color *= 0.25;
					float mask = texture2D(u_mask, coord).x;
					float luminance = length(v_color) * mask;
					/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
					luminance -= u_threshold;
					if(luminance < 0.0)
					{
						gl_Position.x = -100.0;
						return;
					}
					gl_PointSize = u_pointSize;
					gl_Position = vec4(a_vertex2D,0.0,1.0);
				}
				`,b._second_pixel_shader=`precision highp float;
				varying vec4 v_color;
				uniform sampler2D u_shape;
				uniform float u_alpha;
				
				void main() {
					vec4 color = texture2D( u_shape, gl_PointCoord );
					color *= v_color * u_alpha;
					gl_FragColor = color;
				}
`,o.registerNodeType("fx/bokeh",b),e.LGraphFXBokeh=b,$.title="FX",$.desc="applies an FX from a list",$.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:s.MODE_VALUES}},$.shaders={},$.prototype.onExecute=function(){if(this.isOutputConnected(0)){var st=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,st);return}if(st){this._tex=s.getTargetTexture(st,this._tex,this.properties.precision);var j=this.properties.value1;this.isInputConnected(1)&&(j=this.getInputData(1),this.properties.value1=j);var tt=this.properties.value2;this.isInputConnected(2)&&(tt=this.getInputData(2),this.properties.value2=tt);var nt=this.properties.fx,lt=$.shaders[nt];if(!lt){var ct=$["pixel_shader_"+nt];if(!ct)return;lt=$.shaders[nt]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,ct)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var ot=Mesh.getScreenQuad(),_e=e.LS?LS.Renderer._current_camera:null,_;_e?_=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:_=[1,100];var at=null;nt=="noise"&&(at=s.getNoiseTexture()),this._tex.drawTo(function(){st.bind(0),nt=="noise"&&at.bind(1),lt.uniforms({u_texture:0,u_noise:1,u_size:[st.width,st.height],u_rand:[Math.random(),Math.random()],u_value1:j,u_value2:tt,u_camera_planes:_}).draw(ot)}),this.setOutputData(0,this._tex)}}},$.pixel_shader_halftone=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				float pattern() {
					float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
					vec2 tex = v_coord * u_size.xy;
					vec2 point = vec2(
					   c * tex.x - s * tex.y ,
					   s * tex.x + c * tex.y 
					) * u_value2;
					return (sin(point.x) * sin(point.y)) * 4.0;
				}
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float average = (color.r + color.g + color.b) / 3.0;
					gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
				}
`,$.pixel_shader_pixelate=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
					vec4 color = texture2D(u_texture, coord);
					gl_FragColor = color;
				}
`,$.pixel_shader_lowpalette=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					gl_FragColor = floor(color * u_value1) / u_value1;
				}
`,$.pixel_shader_noise=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_noise;
				uniform vec2 u_size;
				uniform float u_value1;
				uniform float u_value2;
				uniform vec2 u_rand;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
					gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
				}
`,$.pixel_shader_gamma=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_value1;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord);
					float gamma = 1.0 / u_value1;
					gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
				}
`,o.registerNodeType("fx/generic",$),e.LGraphFXGeneric=$,et.title="Vigneting",et.desc="Vigneting",et.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},et.prototype.onExecute=function(){var st=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,st);return}if(st){this._tex=s.getTargetTexture(st,this._tex,this.properties.precision);var j=this.properties.intensity;this.isInputConnected(1)&&(j=this.getInputData(1),this.properties.intensity=j),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var tt=Mesh.getScreenQuad(),nt=et._shader,lt=this.properties.invert;this._tex.drawTo(function(){st.bind(0),nt.uniforms({u_texture:0,u_intensity:j,u_isize:[1/st.width,1/st.height],u_invert:lt?1:0}).draw(tt)}),this.setOutputData(0,this._tex)}},et.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_intensity;
				uniform int u_invert;
				
				void main() {
					float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
					vec4 color = texture2D(u_texture, v_coord);
					if(u_invert == 1)
						luminance = 1.0 - luminance;
					luminance = mix(1.0, luminance, u_intensity);
				   gl_FragColor = vec4( luminance * color.xyz, color.a);
				}
				`,o.registerNodeType("fx/vigneting",et),e.LGraphFXVigneting=et}}(commonjsGlobal),function(e){var o=e.LiteGraph,s="#243";function a(_e){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),_e&&this.setup(_e)}o.MIDIEvent=a,a.prototype.fromJSON=function(_e){this.setup(_e.data)},a.prototype.setup=function(_e){var _=_e;_e.constructor===Object&&(_=_e.data),this.data.set(_);var at=_[0];this.status=at;var it=at&240;at>=240?this.cmd=at:this.cmd=it,this.cmd==a.NOTEON&&this.velocity==0&&(this.cmd=a.NOTEOFF),this.cmd_str=a.commands[this.cmd]||"",(it>=a.NOTEON||it<=a.NOTEOFF)&&(this.channel=at&15)},Object.defineProperty(a.prototype,"velocity",{get:function(){return this.cmd==a.NOTEON?this.data[2]:-1},set:function(_e){this.data[2]=_e},enumerable:!0}),a.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],a.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(a.prototype,"note",{get:function(){return this.cmd!=a.NOTEON?-1:a.toNoteString(this.data[1],!0)},set:function(_e){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){if(this.cmd!=a.NOTEON)return-1;var _e=this.data[1]-24;return Math.floor(_e/12+1)},set:function(_e){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),a.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},a.computePitch=function(_e){return Math.pow(2,(_e-69)/12)*440},a.prototype.getCC=function(){return this.data[1]},a.prototype.getCCValue=function(){return this.data[2]},a.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},a.computePitchBend=function(_e,_){return _e+(_<<7)-8192},a.prototype.setCommandFromString=function(_e){this.cmd=a.computeCommandFromString(_e)},a.computeCommandFromString=function(_e){if(!_e)return 0;if(_e&&_e.constructor===Number)return _e;switch(_e=_e.toUpperCase(),_e){case"NOTE ON":case"NOTEON":return a.NOTEON;case"NOTE OFF":case"NOTEOFF":return a.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return a.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return a.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return a.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return a.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return a.PITCHBEND;case"TIME TICK":case"TIMETICK":return a.TIMETICK;default:return Number(_e)}},a.toNoteString=function(_e,_){_e=Math.round(_e);var at=_e-21,it=Math.floor((_e-24)/12+1);return at=at%12,at<0&&(at=12+at),a.notes[at]+(_?"":it)},a.NoteStringToPitch=function(_e){_e=_e.toUpperCase();var _=_e[0],at=4;_e[1]=="#"?(_+="#",_e.length>2&&(at=Number(_e[2]))):_e.length>1&&(at=Number(_e[1]));var it=a.note_to_index[_];return it==null?null:(at-1)*12+it+21},a.prototype.toString=function(){var _e=""+this.channel+". ";switch(this.cmd){case a.NOTEON:_e+="NOTEON "+a.toNoteString(this.data[1]);break;case a.NOTEOFF:_e+="NOTEOFF "+a.toNoteString(this.data[1]);break;case a.CONTROLLERCHANGE:_e+="CC "+this.data[1]+" "+this.data[2];break;case a.PROGRAMCHANGE:_e+="PC "+this.data[1];break;case a.PITCHBEND:_e+="PITCHBEND "+this.getPitchBend();break;case a.KEYPRESSURE:_e+="KEYPRESS "+this.data[1];break}return _e},a.prototype.toHexString=function(){for(var _e="",_=0;_<this.data.length;_++)_e+=this.data[_].toString(16)+" "},a.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},a.NOTEOFF=128,a.NOTEON=144,a.KEYPRESSURE=160,a.CONTROLLERCHANGE=176,a.PROGRAMCHANGE=192,a.CHANNELPRESSURE=208,a.PITCHBEND=224,a.TIMETICK=248,a.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},a.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},a.commands_reversed={};for(var h in a.commands)a.commands_reversed[a.commands[h]]=h;function d(_e,_){if(!navigator.requestMIDIAccess){this.error="not suppoorted",_?_("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=_e,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}d.input=null,d.MIDIEvent=a,d.prototype.onMIDISuccess=function(_e){console.log("MIDI ready!"),console.log(_e),this.midi=_e,this.updatePorts(),this.on_ready&&this.on_ready(this)},d.prototype.updatePorts=function(){var _e=this.midi;this.input_ports=_e.inputs,this.input_ports_info=[],this.output_ports=_e.outputs,this.output_ports_info=[];for(var _=0,it=this.input_ports.values(),pt=it.next();pt&&pt.done===!1;){var at=pt.value;this.input_ports_info.push(at),console.log("Input port [type:'"+at.type+"'] id:'"+at.id+"' manufacturer:'"+at.manufacturer+"' name:'"+at.name+"' version:'"+at.version+"'"),_++,pt=it.next()}this.num_input_ports=_,_=0;for(var it=this.output_ports.values(),pt=it.next();pt&&pt.done===!1;){var at=pt.value;this.output_ports_info.push(at),console.log("Output port [type:'"+at.type+"'] id:'"+at.id+"' manufacturer:'"+at.manufacturer+"' name:'"+at.name+"' version:'"+at.version+"'"),_++,pt=it.next()}this.num_output_ports=_},d.prototype.onMIDIFailure=function(_e){console.error("Failed to get MIDI access - "+_e)},d.prototype.openInputPort=function(_e,_){var at=this.input_ports.get("input-"+_e);if(!at)return!1;d.input=this;var it=this;return at.onmidimessage=function(pt){var mt=new a(pt.data);it.updateState(mt),_&&_(pt.data,mt),d.on_message&&d.on_message(pt.data,mt)},console.log("port open: ",at),!0},d.parseMsg=function(_e){},d.prototype.updateState=function(_e){switch(_e.cmd){case a.NOTEON:this.state.note[_e.value1|0]=_e.value2;break;case a.NOTEOFF:this.state.note[_e.value1|0]=0;break;case a.CONTROLLERCHANGE:this.state.cc[_e.getCC()]=_e.getCCValue();break}},d.prototype.sendMIDI=function(_e,_){if(_){var at=this.output_ports_info[_e];at&&(d.output=this,_.constructor===a?at.send(_.data):at.send(_))}};function c(){this.addOutput("on_midi",o.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var _e=this;new d(function(_){_e._midi=_,_e._waiting&&_e.onStart(),_e._waiting=!1})}c.MIDIInterface=d,c.title="MIDI Input",c.desc="Reads MIDI from a input port",c.color=s,c.prototype.getPropertyInfo=function(_e){if(this._midi&&_e=="port"){for(var _={},at=0;at<this._midi.input_ports_info.length;++at){var it=this._midi.input_ports_info[at];_[at]=at+".- "+it.name+" version:"+it.version}return{type:"enum",values:_}}},c.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},c.prototype.onMIDIEvent=function(_e,_){this._last_midi_event=_,this.boxcolor="#AFA",this._last_time=o.getTime(),this.trigger("on_midi",_),_.cmd==a.NOTEON?this.trigger("on_noteon",_):_.cmd==a.NOTEOFF?this.trigger("on_noteoff",_):_.cmd==a.CONTROLLERCHANGE?this.trigger("on_cc",_):_.cmd==a.PROGRAMCHANGE?this.trigger("on_pc",_):_.cmd==a.PITCHBEND&&this.trigger("on_pitchbend",_)},c.prototype.onDrawBackground=function(_e){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){_e.fillStyle="white";var _=o.getTime(),at=1-Math.max(0,(_-this._last_time)*.001);if(at>0){var it=_e.globalAlpha;_e.globalAlpha*=at,_e.font="12px Tahoma",_e.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),_e.globalAlpha=it}}},c.prototype.onExecute=function(){if(this.outputs)for(var _e=this._last_midi_event,_=0;_<this.outputs.length;++_){var at=this.outputs[_],it=null;switch(at.name){case"midi":it=this._midi;break;case"last_midi":it=_e;break;default:continue}this.setOutputData(_,it)}},c.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",o.EVENT],["on_noteon",o.EVENT],["on_noteoff",o.EVENT],["on_cc",o.EVENT],["on_pc",o.EVENT],["on_pitchbend",o.EVENT]]},o.registerNodeType("midi/input",c);function g(){this.addInput("send",o.EVENT),this.properties={port:0};var _e=this;new d(function(_){_e._midi=_,_e.widget.options.values=_e.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}g.MIDIInterface=d,g.title="MIDI Output",g.desc="Sends MIDI to output channel",g.color=s,g.prototype.onGetPropertyInfo=function(_e){if(this._midi&&_e=="port"){var _=this.getMIDIOutputs();return{type:"enum",values:_}}},g.default_ports={0:"unknown"},g.prototype.getMIDIOutputs=function(){var _e={};if(!this._midi)return g.default_ports;if(this._midi.output_ports_info)for(var _=0;_<this._midi.output_ports_info.length;++_){var at=this._midi.output_ports_info[_];if(at){var it=_+".- "+at.name+" version:"+at.version;_e[_]=it}}return _e},g.prototype.onAction=function(_e,_){this._midi&&(_e=="send"&&this._midi.sendMIDI(this.properties.port,_),this.trigger("midi",_))},g.prototype.onGetInputs=function(){return[["send",o.ACTION]]},g.prototype.onGetOutputs=function(){return[["on_midi",o.EVENT]]},o.registerNodeType("midi/output",g);function b(){this.addInput("on_midi",o.EVENT),this._str="",this.size=[200,40]}b.title="MIDI Show",b.desc="Shows MIDI in the graph",b.color=s,b.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},b.prototype.onAction=function(_e,_){_&&(_.constructor===a?this._str=_.toString():this._str="???")},b.prototype.onDrawForeground=function(_e){!this._str||this.flags.collapsed||(_e.font="30px Arial",_e.fillText(this._str,10,this.size[1]*.8))},b.prototype.onGetInputs=function(){return[["in",o.ACTION]]},b.prototype.onGetOutputs=function(){return[["on_midi",o.EVENT]]},o.registerNodeType("midi/show",b);function $(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var _e=this;this._learning=!1,this.addWidget("button","Learn","",function(){_e._learning=!0,_e.boxcolor="#FA3"}),this.addInput("in",o.EVENT),this.addOutput("on_midi",o.EVENT),this.boxcolor="#AAA"}$.title="MIDI Filter",$.desc="Filters MIDI messages",$.color=s,$["@cmd"]={type:"enum",title:"Command",values:a.commands_reversed},$.prototype.getTitle=function(){var _e=null;return this.properties.cmd==-1?_e="Nothing":_e=a.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(_e+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+_e},$.prototype.onPropertyChanged=function(_e,_){if(_e=="cmd"){var at=Number(_);isNaN(at)&&(at=a.commands[_]||0),this.properties.cmd=at}},$.prototype.onAction=function(_e,_){if(!(!_||_.constructor!==a)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=_.channel,this.properties.cmd=_.cmd,this.properties.min_value=this.properties.max_value=_.data[1];else if(this.properties.channel!=-1&&_.channel!=this.properties.channel||this.properties.cmd!=-1&&_.cmd!=this.properties.cmd||this.properties.min_value!=-1&&_.data[1]<this.properties.min_value||this.properties.max_value!=-1&&_.data[1]>this.properties.max_value)return;this.trigger("on_midi",_)}},o.registerNodeType("midi/filter",$);function et(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",o.EVENT),this.addInput("assign",o.EVENT),this.addOutput("on_midi",o.EVENT),this.midi_event=new a,this.gate=!1}et.title="MIDIEvent",et.desc="Create a MIDI Event",et.color=s,et.prototype.onAction=function(_e,at){if(_e=="assign"){this.properties.channel=at.channel,this.properties.cmd=at.cmd,this.properties.value1=at.data[1],this.properties.value2=at.data[2],at.cmd==a.NOTEON?this.gate=!0:at.cmd==a.NOTEOFF&&(this.gate=!1);return}var at=this.midi_event;at.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?at.setCommandFromString(this.properties.cmd):at.cmd=this.properties.cmd,at.data[0]=at.cmd|at.channel,at.data[1]=Number(this.properties.value1),at.data[2]=Number(this.properties.value2),this.trigger("on_midi",at)},et.prototype.onExecute=function(){var _e=this.properties;if(this.inputs)for(var _=0;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=-1)switch(at.name){case"note":var it=this.getInputData(_);it!=null&&(it.constructor===String&&(it=a.NoteStringToPitch(it)),this.properties.value1=(it|0)%255);break;case"cmd":var it=this.getInputData(_);it!=null&&(this.properties.cmd=it);break;case"value1":var it=this.getInputData(_);it!=null&&(this.properties.value1=clamp(it|0,0,127));break;case"value2":var it=this.getInputData(_);it!=null&&(this.properties.value2=clamp(it|0,0,127));break}}if(this.outputs)for(var _=0;_<this.outputs.length;++_){var pt=this.outputs[_],it=null;switch(pt.name){case"midi":it=new a,it.setup([_e.cmd,_e.value1,_e.value2]),it.channel=_e.channel;break;case"command":it=_e.cmd;break;case"cc":it=_e.value1;break;case"cc_value":it=_e.value2;break;case"note":it=_e.cmd==a.NOTEON||_e.cmd==a.NOTEOFF?_e.value1:null;break;case"velocity":it=_e.cmd==a.NOTEON?_e.value2:null;break;case"pitch":it=_e.cmd==a.NOTEON?a.computePitch(_e.value1):null;break;case"pitchbend":it=_e.cmd==a.PITCHBEND?a.computePitchBend(_e.value1,_e.value2):null;break;case"gate":it=this.gate;break;default:continue}it!==null&&this.setOutputData(_,it)}},et.prototype.onPropertyChanged=function(_e,_){_e=="cmd"&&(this.properties.cmd=a.computeCommandFromString(_))},et.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},et.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",o.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},o.registerNodeType("midi/event",et);function st(){this.properties={cc:1,value:0},this.addOutput("value","number")}st.title="MIDICC",st.desc="gets a Controller Change",st.color=s,st.prototype.onExecute=function(){this.properties,d.input&&(this.properties.value=d.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},o.registerNodeType("midi/cc",st);function j(){this.addInput("generate",o.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",o.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=j.processScale(this.properties.notes),this.sequence_index=0}j.title="MIDI Generator",j.desc="Generates a random MIDI note",j.color=s,j.processScale=function(_e){for(var _=_e.split(","),at=0;at<_.length;++at){var it=_[at];it.length==2&&it[1]!="#"||it.length>2?_[at]=-o.MIDIEvent.NoteStringToPitch(it):_[at]=a.note_to_index[it]||0}return _},j.prototype.onPropertyChanged=function(_e,_){_e=="notes"&&(this.notes_pitches=j.processScale(_))},j.prototype.onExecute=function(){var _e=this.getInputData(2);_e!=null&&(this.properties.octave=_e);var _=this.getInputData(1);_&&(this.notes_pitches=j.processScale(_))},j.prototype.onAction=function(_e,_t){var at=0,it=this.notes_pitches.length,pt=0;this.properties.mode=="sequence"?pt=this.sequence_index=(this.sequence_index+1)%it:this.properties.mode=="random"&&(pt=Math.floor(Math.random()*it));var mt=this.notes_pitches[pt];mt>=0?at=mt+(this.properties.octave-1)*12+33:at=-mt;var _t=new a;_t.setup([a.NOTEON,at,10]);var Et=this.properties.duration||1;this.trigger("note",_t),setTimeout((function(){var Tt=new a;Tt.setup([a.NOTEOFF,at,0]),this.trigger("note",Tt)}).bind(this),Et*1e3)},o.registerNodeType("midi/generator",j);function tt(){this.properties={amount:0},this.addInput("in",o.ACTION),this.addInput("amount","number"),this.addOutput("out",o.EVENT),this.midi_event=new a}tt.title="MIDI Transpose",tt.desc="Transpose a MIDI note",tt.color=s,tt.prototype.onAction=function(_e,_){!_||_.constructor!==a||(_.data[0]==a.NOTEON||_.data[0]==a.NOTEOFF?(this.midi_event=new a,this.midi_event.setup(_.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",_))},tt.prototype.onExecute=function(){var _e=this.getInputData(1);_e!=null&&(this.properties.amount=_e)},o.registerNodeType("midi/transpose",tt);function nt(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",o.ACTION),this.addInput("scale","string"),this.addOutput("out",o.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}nt.title="MIDI Quantize Pitch",nt.desc="Transpose a MIDI note tp fit an scale",nt.color=s,nt.prototype.onPropertyChanged=function(_e,_){_e=="scale"&&this.processScale(_)},nt.prototype.processScale=function(_e){this._current_scale=_e,this.notes_pitches=j.processScale(_e);for(var _=0;_<12;++_)this.valid_notes[_]=this.notes_pitches.indexOf(_)!=-1;for(var _=0;_<12;++_){if(this.valid_notes[_]){this.offset_notes[_]=0;continue}for(var at=1;at<12;++at){if(this.valid_notes[(_-at)%12]){this.offset_notes[_]=-at;break}if(this.valid_notes[(_+at)%12]){this.offset_notes[_]=at;break}}}},nt.prototype.onAction=function(_e,_){if(!(!_||_.constructor!==a))if(_.data[0]==a.NOTEON||_.data[0]==a.NOTEOFF){this.midi_event=new a,this.midi_event.setup(_.data);var at=_.note,it=a.note_to_index[at],pt=this.offset_notes[it];this.midi_event.data[1]+=pt,this.trigger("out",this.midi_event)}else this.trigger("out",_)},nt.prototype.onExecute=function(){var _e=this.getInputData(1);_e!=null&&_e!=this._current_scale&&this.processScale(_e)},o.registerNodeType("midi/quantize",nt);function lt(){this.properties={url:"",autoplay:!0},this.addInput("play",o.ACTION),this.addInput("pause",o.ACTION),this.addOutput("note",o.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}lt.title="MIDI fromFile",lt.desc="Plays a MIDI file",lt.color=s,lt.prototype.onAction=function(_e){_e=="play"?this.play():_e=="pause"&&(this._playing=!this._playing)},lt.prototype.onPropertyChanged=function(_e,_){_e=="url"&&this.loadMIDIFile(_)},lt.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var _e=this._current_time*100,_=0;_<this._midi.tracks;++_){var at=this._midi.track[_];at._last_pos||(at._last_pos=0,at._time=0);var it=at.event[at._last_pos];if(it&&at._time+it.deltaTime<=_e&&(at._last_pos++,at._time+=it.deltaTime,it.data)){var pt=it.type<<4+it.channel,mt=new a;mt.setup([pt,it.data[0],it.data[1]]),this.trigger("note",mt)}}}},lt.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var _e=0;_e<this._midi.tracks;++_e){var _=this._midi.track[_e];_._last_pos=0,_._time=0}},lt.prototype.loadMIDIFile=function(_e){var _=this;o.fetchFile(_e,"arraybuffer",function(at){_.boxcolor="#AFA",_._midi=MidiParser.parse(new Uint8Array(at)),_.properties.autoplay&&_.play()},function(at){_.boxcolor="#FAA",_._midi=null})},lt.prototype.onDropFile=function(_e){this.properties.url="",this.loadMIDIFile(_e)},o.registerNodeType("midi/fromFile",lt);function ct(){if(this.properties={volume:.5,duration:1},this.addInput("note",o.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",o.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var _e=this.synth=new AudioSynth;this.instrument=_e.createInstrument("piano")}}ct.title="MIDI Play",ct.desc="Plays a MIDI note",ct.color=s,ct.prototype.onAction=function(_e,_){if(!(!_||_.constructor!==a)){if(this.instrument&&_.data[0]==a.NOTEON){var at=_.note;if(!at||at=="undefined"||at.constructor!==String)return;this.instrument.play(at,_.octave,this.properties.duration,this.properties.volume)}this.trigger("note",_)}},ct.prototype.onExecute=function(){var _e=this.getInputData(1);_e!=null&&(this.properties.volume=_e);var _=this.getInputData(2);_!=null&&(this.properties.duration=_)},o.registerNodeType("midi/play",ct);function ot(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",o.ACTION),this.addInput("reset",o.ACTION),this.addOutput("note",o.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}ot.title="MIDI Keys",ot.desc="Keyboard to play notes",ot.color=s,ot.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],ot.prototype.onDrawForeground=function(_e){if(!this.flags.collapsed){var _=this.properties.num_octaves*12;this.keys.length=_;var at=this.size[0]/(this.properties.num_octaves*7),it=this.size[1];_e.globalAlpha=1;for(var pt=0;pt<2;pt++)for(var mt=0;mt<_;++mt){var _t=ot.keys[mt%12];if(_t.t==pt){var Et=Math.floor(mt/12),Tt=Et*7*at+_t.x*at;pt==0?_e.fillStyle=this.keys[mt]?"#CCC":"white":_e.fillStyle=this.keys[mt]?"#333":"black",_e.fillRect(Tt+1,0,at*_t.w-2,it*_t.h)}}}},ot.prototype.getKeyIndex=function(_e){this.properties.num_octaves*12;for(var _=this.size[0]/(this.properties.num_octaves*7),at=this.size[1],it=1;it>=0;it--)for(var pt=0;pt<this.keys.length;++pt){var mt=ot.keys[pt%12];if(mt.t==it){var _t=Math.floor(pt/12),Et=_t*7*_+mt.x*_,Tt=_*mt.w,Ot=at*mt.h;if(!(_e[0]<Et||_e[0]>Et+Tt||_e[1]>Ot))return pt}}return-1},ot.prototype.onAction=function(_e,_){if(_e=="reset"){for(var at=0;at<this.keys.length;++at)this.keys[at]=!1;return}if(!(!_||_.constructor!==a)){var it=_,pt=(this.properties.start_octave-1)*12+29,mt=it.data[1]-pt;mt>=0&&mt<this.keys.length&&(it.data[0]==a.NOTEON?this.keys[mt]=!0:it.data[0]==a.NOTEOFF&&(this.keys[mt]=!1)),this.trigger("note",it)}},ot.prototype.onMouseDown=function(_e,_){if(!(_[1]<0)){var at=this.getKeyIndex(_);this.keys[at]=!0,this._last_key=at;var it=(this.properties.start_octave-1)*12+29+at,pt=new a;return pt.setup([a.NOTEON,it,100]),this.trigger("note",pt),!0}},ot.prototype.onMouseMove=function(_e,_){if(!(_[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var at=this.getKeyIndex(_);if(this._last_key==at)return!0;this.keys[this._last_key]=!1;var it=(this.properties.start_octave-1)*12+29+this._last_key,pt=new a;pt.setup([a.NOTEOFF,it,100]),this.trigger("note",pt),this.keys[at]=!0;var it=(this.properties.start_octave-1)*12+29+at,pt=new a;return pt.setup([a.NOTEON,it,100]),this.trigger("note",pt),this._last_key=at,!0}},ot.prototype.onMouseUp=function(_e,_){if(!(_[1]<0)){var at=this.getKeyIndex(_);this.keys[at]=!1,this._last_key=-1;var it=(this.properties.start_octave-1)*12+29+at,pt=new a;return pt.setup([a.NOTEOFF,it,100]),this.trigger("note",pt),!0}},o.registerNodeType("midi/keys",ot)}(commonjsGlobal),function(e){var o=e.LiteGraph,s={};e.LGAudio=s,s.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(_){console.log("msg",_)},this._audio_context.onended=function(_){console.log("ended",_)},this._audio_context.oncomplete=function(_){console.log("complete",_)}}return this._audio_context},s.connect=function(_,at){try{_.connect(at)}catch(it){console.warn("LGraphAudio:",it)}},s.disconnect=function(_,at){try{_.disconnect(at)}catch(it){console.warn("LGraphAudio:",it)}},s.changeAllAudiosConnections=function(_,at){if(_.inputs)for(var it=0;it<_.inputs.length;++it){var pt=_.inputs[it],mt=_.graph.links[pt.link];if(mt){var _t=_.graph.getNodeById(mt.origin_id),Et=null;_t.getAudioNodeInOutputSlot?Et=_t.getAudioNodeInOutputSlot(mt.origin_slot):Et=_t.audionode;var Tt=null;_.getAudioNodeInInputSlot?Tt=_.getAudioNodeInInputSlot(it):Tt=_.audionode,at?s.connect(Et,Tt):s.disconnect(Et,Tt)}}if(_.outputs)for(var it=0;it<_.outputs.length;++it)for(var Ot=_.outputs[it],Ct=0;Ct<Ot.links.length;++Ct){var mt=_.graph.links[Ot.links[Ct]];if(mt){var Et=null;_.getAudioNodeInOutputSlot?Et=_.getAudioNodeInOutputSlot(it):Et=_.audionode;var St=_.graph.getNodeById(mt.target_id),Tt=null;St.getAudioNodeInInputSlot?Tt=St.getAudioNodeInInputSlot(mt.target_slot):Tt=St.audionode,at?s.connect(Et,Tt):s.disconnect(Et,Tt)}}},s.onConnectionsChange=function(_,at,it,pt){if(_==o.OUTPUT){var mt=null;if(pt&&(mt=this.graph.getNodeById(pt.target_id)),!!mt){var _t=null;this.getAudioNodeInOutputSlot?_t=this.getAudioNodeInOutputSlot(at):_t=this.audionode;var Et=null;mt.getAudioNodeInInputSlot?Et=mt.getAudioNodeInInputSlot(pt.target_slot):Et=mt.audionode,it?s.connect(_t,Et):s.disconnect(_t,Et)}}},s.createAudioNodeWrapper=function(_){var at=_.prototype.onPropertyChanged;_.prototype.onPropertyChanged=function(it,pt){at&&at.call(this,it,pt),this.audionode&&this.audionode[it]!==void 0&&(this.audionode[it].value!==void 0?this.audionode[it].value=pt:this.audionode[it]=pt)},_.prototype.onConnectionsChange=s.onConnectionsChange},s.cached_audios={},s.loadSound=function(_,at,it){if(s.cached_audios[_]&&_.indexOf("blob:")==-1){at&&at(s.cached_audios[_]);return}s.onProcessAudioURL&&(_=s.onProcessAudioURL(_));var pt=new XMLHttpRequest;pt.open("GET",_,!0),pt.responseType="arraybuffer";var mt=s.getAudioContext();pt.onload=function(){console.log("AudioSource loaded"),mt.decodeAudioData(pt.response,function(Et){console.log("AudioSource decoded"),s.cached_audios[_]=Et,at&&at(Et)},_t)},pt.send();function _t(Et){console.log("Audio loading sample error:",Et),it&&it(Et)}return pt};function a(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var _=s.getAudioContext();this.audionode=_.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}a.desc="Plays an audio file",a["@src"]={widget:"resource"},a.supported_extensions=["wav","ogg","mp3"],a.prototype.onAdded=function(_){_.status===LGraph.STATUS_RUNNING&&this.onStart()},a.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},a.prototype.onStop=function(){this.stopAllSounds()},a.prototype.onPause=function(){this.pauseAllSounds()},a.prototype.onUnpause=function(){this.unpauseAllSounds()},a.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},a.prototype.stopAllSounds=function(){for(var _=0;_<this._audionodes.length;++_)this._audionodes[_].started&&(this._audionodes[_].started=!1,this._audionodes[_].stop());this._audionodes.length=0},a.prototype.pauseAllSounds=function(){s.getAudioContext().suspend()},a.prototype.unpauseAllSounds=function(){s.getAudioContext().resume()},a.prototype.onExecute=function(){if(this.inputs)for(var _=0;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=null){var it=this.getInputData(_);if(it!==void 0){if(at.name=="gain")this.audionode.gain.value=it;else if(at.name=="src")this.setProperty("src",it);else if(at.name=="playbackRate"){this.properties.playbackRate=it;for(var pt=0;pt<this._audionodes.length;++pt)this._audionodes[pt].playbackRate.value=it}}}}if(this.outputs)for(var _=0;_<this.outputs.length;++_){var mt=this.outputs[_];mt.name=="buffer"&&this._audiobuffer&&this.setOutputData(_,this._audiobuffer)}},a.prototype.onAction=function(_){this._audiobuffer&&(_=="Play"?this.playBuffer(this._audiobuffer):_=="Stop"&&this.stopAllSounds())},a.prototype.onPropertyChanged=function(_,at){if(_=="src")this.loadSound(at);else if(_=="gain")this.audionode.gain.value=at;else if(_=="playbackRate")for(var it=0;it<this._audionodes.length;++it)this._audionodes[it].playbackRate.value=at},a.prototype.playBuffer=function(_){var at=this,it=s.getAudioContext(),pt=it.createBufferSource();return this._last_sourcenode=pt,pt.graphnode=this,pt.buffer=_,pt.loop=this.properties.loop,pt.playbackRate.value=this.properties.playbackRate,this._audionodes.push(pt),pt.connect(this.audionode),this._audionodes.push(pt),this.trigger("start"),pt.onended=function(){at.trigger("ended");var mt=at._audionodes.indexOf(pt);mt!=-1&&at._audionodes.splice(mt,1)},pt.started||(pt.started=!0,pt.start()),pt},a.prototype.loadSound=function(_){var at=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!_)return;this._request=s.loadSound(_,it),this._loading_audio=!0,this.boxcolor="#AA4";function it(pt){this.boxcolor=o.NODE_DEFAULT_BOXCOLOR,at._audiobuffer=pt,at._loading_audio=!1,at.graph&&at.graph.status===LGraph.STATUS_RUNNING&&at.onStart()}},a.prototype.onConnectionsChange=s.onConnectionsChange,a.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",o.ACTION],["Stop",o.ACTION]]},a.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",o.EVENT],["ended",o.EVENT]]},a.prototype.onDropFile=function(_){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var at=URL.createObjectURL(_);this.properties.src=at,this.loadSound(at),this._dropped_url=at},a.title="Source",a.desc="Plays audio",o.registerNodeType("audio/source",a);function h(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var _=s.getAudioContext();this.audionode=_.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}h.prototype.onAdded=function(_){_.status===LGraph.STATUS_RUNNING&&this.onStart()},h.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},h.prototype.onStop=function(){this.audionode.gain.value=0},h.prototype.onPause=function(){this.audionode.gain.value=0},h.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},h.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var _=this._media_stream.getTracks();_.length&&_[0].stop()}},h.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(at);var _=this;function at(it){console.log("Media rejected",it),_._media_stream=!1,_.boxcolor="red"}},h.prototype.streamReady=function(_){this._media_stream=_,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var at=s.getAudioContext();this.audiosource_node=at.createMediaStreamSource(_),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},h.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var _=0;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=null){var it=this.getInputData(_);it!==void 0&&at.name=="gain"&&(this.audionode.gain.value=this.properties.gain=it)}}},h.prototype.onAction=function(_){_=="Play"?this.audionode.gain.value=this.properties.gain:_=="Stop"&&(this.audionode.gain.value=0)},h.prototype.onPropertyChanged=function(_,at){_=="gain"&&(this.audionode.gain.value=at)},h.prototype.onConnectionsChange=s.onConnectionsChange,h.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",o.ACTION],["Stop",o.ACTION]]},h.title="MediaSource",h.desc="Plays microphone",o.registerNodeType("audio/media_source",h);function d(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var _=s.getAudioContext();this.audionode=_.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}d.prototype.onPropertyChanged=function(_,at){this.audionode[_]=at},d.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=_)&&(this._freq_bin=new Uint8Array(_)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var _=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=_)&&(this._time_bin=new Uint8Array(_)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var at=1;at<this.inputs.length;++at){var it=this.inputs[at];if(it.link!=null){var pt=this.getInputData(at);pt!==void 0&&(this.audionode[it.name].value=pt)}}},d.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},d.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},d.title="Analyser",d.desc="Audio Analyser",o.registerNodeType("audio/analyser",d);function c(){this.properties={gain:1},this.audionode=s.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}c.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var _=1;_<this.inputs.length;++_){var at=this.inputs[_],it=this.getInputData(_);it!==void 0&&(this.audionode[at.name].value=it)}},s.createAudioNodeWrapper(c),c.title="Gain",c.desc="Audio gain",o.registerNodeType("audio/gain",c);function g(){this.properties={impulse_src:"",normalize:!0},this.audionode=s.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}s.createAudioNodeWrapper(g),g.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},g.prototype.onPropertyChanged=function(_,at){_=="impulse_src"?this.loadImpulse(at):_=="normalize"&&(this.audionode.normalize=at)},g.prototype.onDropFile=function(_){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(_),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},g.prototype.loadImpulse=function(_){var at=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!_)return;this._request=s.loadSound(_,it),this._loading_impulse=!0;function it(pt){at._impulse_buffer=pt,at.audionode.buffer=pt,console.log("Impulse signal set"),at._loading_impulse=!1}},g.title="Convolver",g.desc="Convolves the signal (used for reverb)",o.registerNodeType("audio/convolver",g);function b(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=s.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}s.createAudioNodeWrapper(b),b.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var _=1;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=null){var it=this.getInputData(_);it!==void 0&&(this.audionode[at.name].value=it)}}},b.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},b.title="DynamicsCompressor",b.desc="Dynamics Compressor",o.registerNodeType("audio/dynamicsCompressor",b);function $(){this.properties={},this.audionode=s.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}$.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var _=this.getInputData(1);_!==void 0&&(this.audionode.curve=_)}},$.prototype.setWaveShape=function(_){this.audionode.curve=_},s.createAudioNodeWrapper($);function et(){this.properties={gain1:.5,gain2:.5},this.audionode=s.getAudioContext().createGain(),this.audionode1=s.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=s.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}et.prototype.getAudioNodeInInputSlot=function(_){if(_==0)return this.audionode1;if(_==2)return this.audionode2},et.prototype.onPropertyChanged=function(_,at){_=="gain1"?this.audionode1.gain.value=at:_=="gain2"&&(this.audionode2.gain.value=at)},et.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var _=1;_<this.inputs.length;++_){var at=this.inputs[_];if(!(at.link==null||at.type=="audio")){var it=this.getInputData(_);it!==void 0&&(_==1?this.audionode1.gain.value=it:_==3&&(this.audionode2.gain.value=it))}}},s.createAudioNodeWrapper(et),et.title="Mixer",et.desc="Audio mixer",o.registerNodeType("audio/mixer",et);function st(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=s.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}st.prototype.onExecute=function(){var _=s.getAudioContext(),at=_.currentTime,it=this.audionode,pt=it.gain,mt=this.getInputData(1),_t=this.getInputOrProperty("A"),Et=this.getInputOrProperty("D"),Tt=this.getInputOrProperty("S"),Ot=this.getInputOrProperty("R");!this.gate&&mt?(pt.cancelScheduledValues(0),pt.setValueAtTime(0,at),pt.linearRampToValueAtTime(1,at+_t),pt.linearRampToValueAtTime(Tt,at+_t+Et)):this.gate&&!mt&&(pt.cancelScheduledValues(0),pt.setValueAtTime(pt.value,at),pt.linearRampToValueAtTime(0,at+Ot)),this.gate=mt},st.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},s.createAudioNodeWrapper(st),st.title="ADSR",st.desc="Audio envelope",o.registerNodeType("audio/adsr",st);function j(){this.properties={delayTime:.5},this.audionode=s.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}s.createAudioNodeWrapper(j),j.prototype.onExecute=function(){var _=this.getInputData(1);_!==void 0&&(this.audionode.delayTime.value=_)},j.title="Delay",j.desc="Audio delay",o.registerNodeType("audio/delay",j);function tt(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=s.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}tt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var _=1;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=null){var it=this.getInputData(_);it!==void 0&&(this.audionode[at.name].value=it)}}},tt.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},s.createAudioNodeWrapper(tt),tt.title="BiquadFilter",tt.desc="Audio filter",o.registerNodeType("audio/biquadfilter",tt);function nt(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=s.getAudioContext().createOscillator(),this.addOutput("out","audio")}nt.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},nt.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},nt.prototype.onPause=function(){this.onStop()},nt.prototype.onUnpause=function(){this.onStart()},nt.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var _=0;_<this.inputs.length;++_){var at=this.inputs[_];if(at.link!=null){var it=this.getInputData(_);it!==void 0&&(this.audionode[at.name].value=it)}}},nt.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},s.createAudioNodeWrapper(nt),nt.title="Oscillator",nt.desc="Oscillator",o.registerNodeType("audio/oscillator",nt);function lt(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}lt.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var _=this.getInputData(1);_!==void 0&&(this.properties.mark=_),this.setDirtyCanvas(!0,!1)},lt.prototype.onDrawForeground=function(_){if(this._last_buffer){var at=this._last_buffer,it=at.length/this.size[0],pt=this.size[1];_.fillStyle="black",_.fillRect(0,0,this.size[0],this.size[1]),_.strokeStyle="white",_.beginPath();var mt=0;if(this.properties.continuous){_.moveTo(mt,pt);for(var _t=0;_t<at.length;_t+=it)_.lineTo(mt,pt-at[_t|0]/255*pt),mt++}else for(var _t=0;_t<at.length;_t+=it)_.moveTo(mt+.5,pt),_.lineTo(mt+.5,pt-at[_t|0]/255*pt),mt++;if(_.stroke(),this.properties.mark>=0){var Et=s.getAudioContext().sampleRate,Tt=Et/at.length,mt=2*(this.properties.mark/Tt)/it;mt>=this.size[0]&&(mt=this.size[0]-1),_.strokeStyle="red",_.beginPath(),_.moveTo(mt,pt),_.lineTo(mt,0),_.stroke()}}},lt.title="Visualization",lt.desc="Audio Visualization",o.registerNodeType("audio/visualization",lt);function ct(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}ct.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var _=this.properties.band,mt=this.getInputData(1);mt!==void 0&&(_=mt);var at=s.getAudioContext().sampleRate,it=at/this._freqs.length,pt=2*(_/it),mt=0;if(pt<0&&(mt=this._freqs[0]),pt>=this._freqs.length)mt=this._freqs[this._freqs.length-1];else{var _t=pt|0,Et=this._freqs[_t],Tt=this._freqs[_t+1],Ot=pt-_t;mt=Et*(1-Ot)+Tt*Ot}this.setOutputData(0,mt/255*this.properties.amplitude)}},ct.prototype.onGetInputs=function(){return[["band","number"]]},ct.title="Signal",ct.desc="extract the signal of some frequency",o.registerNodeType("audio/signal",ct);function ot(){if(!ot.default_code){var _=ot.default_function.toString(),at=_.indexOf("{")+1,it=_.lastIndexOf("}");ot.default_code=_.substr(at,it-at)}this.properties={code:ot.default_code};var pt=s.getAudioContext();pt.createScriptProcessor?this.audionode=pt.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=pt.createGain()),this.processCode(),ot._bypass_function||(ot._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}ot.prototype.onAdded=function(_){_.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},ot["@code"]={widget:"code",type:"code"},ot.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},ot.prototype.onStop=function(){this.audionode.onaudioprocess=ot._bypass_function},ot.prototype.onPause=function(){this.audionode.onaudioprocess=ot._bypass_function},ot.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},ot.prototype.onExecute=function(){},ot.prototype.onRemoved=function(){this.audionode.onaudioprocess=ot._bypass_function},ot.prototype.processCode=function(){try{var _=new Function("properties",this.properties.code);this._script=new _(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(at){console.error("Error in onaudioprocess code",at),this._callback=ot._bypass_function,this.audionode.onaudioprocess=this._callback}},ot.prototype.onPropertyChanged=function(_,at){_=="code"&&(this.properties.code=at,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},ot.default_function=function(){this.onaudioprocess=function(_){for(var at=_.inputBuffer,it=_.outputBuffer,pt=0;pt<it.numberOfChannels;pt++)for(var mt=at.getChannelData(pt),_t=it.getChannelData(pt),Et=0;Et<at.length;Et++)_t[Et]=mt[Et]}},s.createAudioNodeWrapper(ot),ot.title="Script",ot.desc="apply script to signal",o.registerNodeType("audio/script",ot);function _e(){this.audionode=s.getAudioContext().destination,this.addInput("in","audio")}_e.title="Destination",_e.desc="Audio output",o.registerNodeType("audio/destination",_e)}(commonjsGlobal),function(e){var o=e.LiteGraph;function s(){this.size=[60,20],this.addInput("send",o.ACTION),this.addOutput("received",o.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}s.title="WebSocket",s.desc="Send data through a websocket",s.prototype.onPropertyChanged=function(d,c){d=="url"&&this.connectSocket()},s.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var d=this.properties.room,c=this.properties.only_send_changes,g=1;g<this.inputs.length;++g){var b=this.getInputData(g);if(b!=null){var $;try{$=JSON.stringify({type:0,room:d,channel:g,data:b})}catch{continue}c&&this._last_sent_data[g]==$||(this._last_sent_data[g]=$,this._ws.send($))}}for(var g=1;g<this.outputs.length;++g)this.setOutputData(g,this._last_received_data[g]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},s.prototype.connectSocket=function(){var d=this,c=this.properties.url;c.substr(0,2)!="ws"&&(c="ws://"+c),this._ws=new WebSocket(c),this._ws.onopen=function(){console.log("ready"),d.boxcolor="#6C6"},this._ws.onmessage=function(g){d.boxcolor="#AFA";var b=JSON.parse(g.data);if(!(b.room&&b.room!=d.properties.room))if(b.type==1)if(b.data.object_class&&o[b.data.object_class]){var $=null;try{$=new o[b.data.object_class](b.data),d.triggerSlot(0,$)}catch{return}}else d.triggerSlot(0,b.data);else d._last_received_data[b.channel||0]=b.data},this._ws.onerror=function(g){console.log("couldnt connect to websocket"),d.boxcolor="#E88"},this._ws.onclose=function(g){console.log("connection closed"),d.boxcolor="#000"}},s.prototype.send=function(d){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:d}))},s.prototype.onAction=function(d,c){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:d,data:c})},s.prototype.onGetInputs=function(){return[["in",0]]},s.prototype.onGetOutputs=function(){return[["out",0]]},o.registerNodeType("network/websocket",s);function a(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",o.ACTION),this.addOutput("received",o.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}a.title="SillyClient",a.desc="Connects to SillyServer to broadcast messages",a.prototype.onPropertyChanged=function(d,c){d=="room"&&(this.room_widget.value=c),this.connectSocket()},a.prototype.setRoom=function(d){this.properties.room=d,this.room_widget.value=d,this.connectSocket()},a.prototype.onDrawForeground=function(){for(var d=1;d<this.inputs.length;++d){var c=this.inputs[d];c.label="in_"+d}for(var d=1;d<this.outputs.length;++d){var c=this.outputs[d];c.label="out_"+d}},a.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var d=this.properties.only_send_changes,c=1;c<this.inputs.length;++c){var g=this.getInputData(c),b=this._last_sent_data[c];if(g!=null){if(d){var $=!0;if(g&&g.length&&b&&b.length==g.length&&g.constructor!==String){for(var et=0;et<g.length;++et)if(b[et]!=g[et]){$=!1;break}}else this._last_sent_data[c]!=g&&($=!1);if($)continue}if(this._server.sendMessage({type:0,channel:c,data:g}),g.length&&g.constructor!==String)if(this._last_sent_data[c]){this._last_sent_data[c].length=g.length;for(var et=0;et<g.length;++et)this._last_sent_data[c][et]=g[et]}else g.constructor===Array?this._last_sent_data[c]=g.concat():this._last_sent_data[c]=new g.constructor(g);else this._last_sent_data[c]=g}}for(var c=1;c<this.outputs.length;++c)this.setOutputData(c,this._last_received_data[c]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},a.prototype.connectSocket=function(){var d=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),d.boxcolor="#6C6"},this._server.on_message=function(c,g){var b=null;try{b=JSON.parse(g)}catch{return}if(b.type==1)if(b.data.object_class&&o[b.data.object_class]){var $=null;try{$=new o[b.data.object_class](b.data),d.triggerSlot(0,$)}catch{return}}else d.triggerSlot(0,b.data);else d._last_received_data[b.channel||0]=b.data;d.boxcolor="#AFA"},this._server.on_error=function(c){console.log("couldnt connect to websocket"),d.boxcolor="#E88"},this._server.on_close=function(c){console.log("connection closed"),d.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(c){console.error("SillyServer error: "+c),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},a.prototype.send=function(d){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:d})},a.prototype.onAction=function(d,c){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:d,data:c})},a.prototype.onGetInputs=function(){return[["in",0]]},a.prototype.onGetOutputs=function(){return[["out",0]]},o.registerNodeType("network/sillyclient",a);function h(){this.addInput("request",o.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",o.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}h.title="HTTP Request",h.desc="Fetch data through HTTP",h.prototype.fetch=function(){var d=this.properties.url;if(d){this.boxcolor="#FF0";var c=this;this._fetching=fetch(d).then(g=>{if(!g.ok)this.boxcolor="#F00",c.trigger("error");else return this.boxcolor="#0F0",g.text()}).then(g=>{c._data=g,c._fetching=null,c.trigger("ready")})}},h.prototype.onAction=function(d){d=="request"&&this.fetch()},h.prototype.onExecute=function(){this.setOutputData(1,this._data)},h.prototype.onGetOutputs=function(){return[["error",o.EVENT]]},o.registerNodeType("network/httprequest",h)}(commonjsGlobal)})(litegraph);const xorJSON='{"last_node_id":12,"last_link_id":12,"nodes":[{"id":3,"type":"logic/NOT","pos":[250,100],"size":{"0":140,"1":26},"flags":{},"order":4,"mode":0,"inputs":[{"name":"in","type":"boolean","link":1}],"outputs":[{"name":"out","type":"boolean","links":[5]}],"properties":{}},{"id":5,"type":"logic/AND","pos":[450,100],"size":{"0":140,"1":46},"flags":{},"order":7,"mode":0,"inputs":[{"name":"a","type":"boolean","link":5},{"name":"b","type":"boolean","link":4}],"outputs":[{"name":"out","type":"boolean","links":[7]}],"properties":{}},{"id":1,"type":"basic/boolean","pos":[50,99],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[1,2]}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":10,"type":"basic/boolean","pos":[174,471],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[10],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":9,"type":"custom/XOR","pos":{"0":425,"1":513,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":6,"mode":0,"inputs":[{"name":"A","type":"boolean","link":10},{"name":"B","type":"boolean","link":11}],"outputs":[{"name":"XOR","type":"boolean","links":[12],"slot_index":0}],"title":"异或门","properties":{"precision":1}},{"id":11,"type":"basic/boolean","pos":[171,593],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[11],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":12,"type":"basic/watch","pos":[705,515],"size":{"0":140,"1":26},"flags":{},"order":9,"mode":0,"inputs":[{"name":"value","type":0,"link":12,"label":"false"}],"title":"输出","properties":{}},{"id":4,"type":"logic/NOT","pos":[250,327],"size":{"0":140,"1":26},"flags":{},"order":5,"mode":0,"inputs":[{"name":"in","type":"boolean","link":3}],"outputs":[{"name":"out","type":"boolean","links":[6]}],"properties":{}},{"id":2,"type":"basic/boolean","pos":[47,319],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[3,4]}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":6,"type":"logic/AND","pos":[446,314],"size":{"0":140,"1":46},"flags":{},"order":8,"mode":0,"inputs":[{"name":"a","type":"boolean","link":2},{"name":"b","type":"boolean","link":6}],"outputs":[{"name":"out","type":"boolean","links":[8]}],"properties":{}},{"id":7,"type":"logic/OR","pos":[633,197],"size":{"0":140,"1":46},"flags":{},"order":10,"mode":0,"inputs":[{"name":"a","type":"boolean","link":7},{"name":"b","type":"boolean","link":8}],"outputs":[{"name":"out","type":"boolean","links":[9]}],"properties":{}},{"id":8,"type":"basic/watch","pos":[825,196],"size":{"0":140,"1":26},"flags":{},"order":11,"mode":0,"inputs":[{"name":"value","type":0,"link":9,"label":"false"}],"title":"输出","properties":{}}],"links":[[1,1,0,3,0,"boolean"],[2,1,0,6,0,"boolean"],[3,2,0,4,0,"boolean"],[4,2,0,5,1,"boolean"],[5,3,0,5,0,"boolean"],[6,4,0,6,1,"boolean"],[7,5,0,7,0,"boolean"],[8,6,0,7,1,"boolean"],[9,7,0,8,0,"boolean"],[10,10,0,9,0,"boolean"],[11,11,0,9,1,"boolean"],[12,9,0,12,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',addJSON='{"last_node_id":30,"last_link_id":52,"nodes":[{"id":22,"type":"custom/XOR","pos":{"0":429,"1":63,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":9,"mode":0,"inputs":[{"name":"A","type":"boolean","link":39},{"name":"B","type":"boolean","link":41}],"outputs":[{"name":"XOR","type":"boolean","links":[46],"slot_index":0}],"title":"异或门","properties":{"precision":1}},{"id":18,"type":"logic/AND","pos":[450,200],"size":{"0":140,"1":46},"flags":{},"order":10,"mode":0,"inputs":[{"name":"a","type":"boolean","link":40},{"name":"b","type":"boolean","link":42}],"outputs":[{"name":"out","type":"boolean","links":[44],"slot_index":0}],"properties":{}},{"id":21,"type":"custom/XOR","pos":{"0":242,"1":254,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":6,"mode":0,"inputs":[{"name":"A","type":"boolean","link":35},{"name":"B","type":"boolean","link":36}],"outputs":[{"name":"XOR","type":"boolean","links":[41,42],"slot_index":0}],"title":"异或门","properties":{"precision":1}},{"id":19,"type":"logic/AND","pos":[242,437],"size":{"0":140,"1":46},"flags":{},"order":7,"mode":0,"inputs":[{"name":"a","type":"boolean","link":37},{"name":"b","type":"boolean","link":38}],"outputs":[{"name":"out","type":"boolean","links":[43],"slot_index":0}],"properties":{}},{"id":23,"type":"logic/OR","pos":[630,365],"size":{"0":140,"1":46},"flags":{},"order":14,"mode":0,"inputs":[{"name":"a","type":"boolean","link":44},{"name":"b","type":"boolean","link":43}],"outputs":[{"name":"out","type":"boolean","links":[45],"slot_index":0}],"properties":{}},{"id":13,"type":"basic/boolean","pos":[14,458],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[36,38],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":16,"type":"basic/watch","pos":[826,63],"size":{"0":140,"1":26},"flags":{},"order":13,"mode":0,"inputs":[{"name":"value","type":0,"link":46,"label":"false"}],"title":"Y","properties":{}},{"id":17,"type":"basic/watch","pos":[826,363],"size":{"0":140,"1":26},"flags":{"collapsed":false},"order":15,"mode":0,"inputs":[{"name":"value","type":0,"link":45,"label":"false"}],"title":"C_out","properties":{}},{"id":27,"type":"basic/boolean","pos":[228,664],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[52],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":28,"type":"basic/boolean","pos":[227,739],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[49],"slot_index":0}],"title":"C_in","properties":{"value":false},"widgets_values":[false]},{"id":25,"type":"custom/ADD","pos":{"0":487,"1":625,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":8,"mode":0,"inputs":[{"name":"A","type":"boolean","link":47},{"name":"B","type":"boolean","link":52},{"name":"C_in","type":"boolean","link":49}],"outputs":[{"name":"Y","type":"boolean","links":[50],"slot_index":0},{"name":"C_out","type":"boolean","links":[51],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":29,"type":"basic/watch","pos":[761,593],"size":{"0":140,"1":26},"flags":{},"order":11,"mode":0,"inputs":[{"name":"value","type":0,"link":50,"label":"false"}],"title":"Y","properties":{}},{"id":30,"type":"basic/watch","pos":[758,670],"size":{"0":140,"1":26},"flags":{"collapsed":false},"order":12,"mode":0,"inputs":[{"name":"value","type":0,"link":51,"label":"false"}],"title":"C_out","properties":{}},{"id":26,"type":"basic/boolean","pos":[229,588],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[47],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":24,"type":"basic/boolean","pos":[18,101],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[39,40],"slot_index":0}],"title":"C_in","properties":{"value":false},"widgets_values":[false]},{"id":12,"type":"basic/boolean","pos":[17,252],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[35,37],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]}],"links":[[35,12,0,21,0,"boolean"],[36,13,0,21,1,"boolean"],[37,12,0,19,0,"boolean"],[38,13,0,19,1,"boolean"],[39,24,0,22,0,"boolean"],[40,24,0,18,0,"boolean"],[41,21,0,22,1,"boolean"],[42,21,0,18,1,"boolean"],[43,19,0,23,1,"boolean"],[44,18,0,23,0,"boolean"],[45,23,0,17,0,"boolean"],[46,22,0,16,0,"boolean"],[47,26,0,25,0,"boolean"],[49,28,0,25,2,"boolean"],[50,25,0,29,0,"boolean"],[51,25,1,30,0,"boolean"],[52,27,0,25,1,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',ALUJSON='{"last_node_id":78,"last_link_id":87,"nodes":[{"id":24,"type":"custom/ADD","pos":{"0":80,"1":211,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":37,"mode":0,"inputs":[{"name":"A","type":"boolean","link":45},{"name":"B","type":"boolean","link":46},{"name":"C_in","type":"boolean","link":25}],"outputs":[{"name":"Y","type":"boolean","links":[36],"slot_index":0},{"name":"C_out","type":"boolean","links":[26],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":23,"type":"custom/ADD","pos":{"0":-75,"1":213,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":34,"mode":0,"inputs":[{"name":"A","type":"boolean","link":33,"slot_index":0},{"name":"B","type":"boolean","link":34},{"name":"C_in","type":"boolean","link":59}],"outputs":[{"name":"Y","type":"boolean","links":[35],"slot_index":0},{"name":"C_out","type":"boolean","links":[25],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":19,"type":"custom/ADD","pos":{"0":235,"1":212,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":47,"mode":0,"inputs":[{"name":"A","type":"boolean","link":47},{"name":"B","type":"boolean","link":48},{"name":"C_in","type":"boolean","link":26}],"outputs":[{"name":"Y","type":"boolean","links":[37],"slot_index":0},{"name":"C_out","type":"boolean","links":[28],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":35,"type":"basic/boolean","pos":[-70,127],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[34],"slot_index":0}],"title":"B（低位）","properties":{"value":false},"widgets_values":[false]},{"id":37,"type":"basic/boolean","pos":[235,128],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[48],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":27,"type":"basic/boolean","pos":[84,52],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[45],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":29,"type":"basic/boolean","pos":[237,47],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[47],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":20,"type":"custom/ADD","pos":{"0":391,"1":214,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":49,"mode":0,"inputs":[{"name":"A","type":"boolean","link":49},{"name":"B","type":"boolean","link":50},{"name":"C_in","type":"boolean","link":28}],"outputs":[{"name":"Y","type":"boolean","links":[38],"slot_index":0},{"name":"C_out","type":"boolean","links":[29],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":30,"type":"basic/boolean","pos":[390,47],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[49],"slot_index":0}],"title":"A","properties":{"value":true},"widgets_values":[true]},{"id":38,"type":"basic/boolean","pos":[387,128],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[50],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":21,"type":"custom/ADD","pos":{"0":548,"1":214,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":51,"mode":0,"inputs":[{"name":"A","type":"boolean","link":51},{"name":"B","type":"boolean","link":52},{"name":"C_in","type":"boolean","link":29}],"outputs":[{"name":"Y","type":"boolean","links":[39],"slot_index":0},{"name":"C_out","type":"boolean","links":[30],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":39,"type":"basic/boolean","pos":[544,131],"size":[140,30],"flags":{},"order":6,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[52],"slot_index":0}],"title":"B","properties":{"value":true},"widgets_values":[true]},{"id":31,"type":"basic/boolean","pos":[543,51],"size":[140,30],"flags":{},"order":7,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[51],"slot_index":0}],"title":"A","properties":{"value":true},"widgets_values":[true]},{"id":22,"type":"custom/ADD","pos":{"0":708,"1":216,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":53,"mode":0,"inputs":[{"name":"A","type":"boolean","link":53},{"name":"B","type":"boolean","link":54},{"name":"C_in","type":"boolean","link":30}],"outputs":[{"name":"Y","type":"boolean","links":[40],"slot_index":0},{"name":"C_out","type":"boolean","links":[31],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":40,"type":"basic/boolean","pos":[706,131],"size":[140,30],"flags":{},"order":8,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[54],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":32,"type":"basic/boolean","pos":[706,52],"size":[140,30],"flags":{},"order":9,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[53],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":26,"type":"custom/ADD","pos":{"0":866,"1":218,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":55,"mode":0,"inputs":[{"name":"A","type":"boolean","link":55},{"name":"B","type":"boolean","link":56},{"name":"C_in","type":"boolean","link":31}],"outputs":[{"name":"Y","type":"boolean","links":[41],"slot_index":0},{"name":"C_out","type":"boolean","links":[32],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":41,"type":"basic/boolean","pos":[863,133],"size":[140,30],"flags":{},"order":10,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[56],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":33,"type":"basic/boolean","pos":[859,51],"size":[140,30],"flags":{},"order":11,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[55],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":44,"type":"basic/watch","pos":[83,331],"size":{"0":140,"1":26},"flags":{},"order":46,"mode":0,"inputs":[{"name":"value","type":0,"link":36,"label":"true"}],"title":"Y","properties":{}},{"id":45,"type":"basic/watch","pos":[242,335],"size":{"0":140,"1":26},"flags":{},"order":48,"mode":0,"inputs":[{"name":"value","type":0,"link":37,"label":"false"}],"title":"Y","properties":{}},{"id":46,"type":"basic/watch","pos":[393,337],"size":{"0":140,"1":26},"flags":{},"order":50,"mode":0,"inputs":[{"name":"value","type":0,"link":38,"label":"true"}],"title":"Y","properties":{}},{"id":47,"type":"basic/watch","pos":[547,335],"size":{"0":140,"1":26},"flags":{},"order":52,"mode":0,"inputs":[{"name":"value","type":0,"link":39,"label":"false"}],"title":"Y","properties":{}},{"id":48,"type":"basic/watch","pos":[707,335],"size":{"0":140,"1":26},"flags":{},"order":54,"mode":0,"inputs":[{"name":"value","type":0,"link":40,"label":"true"}],"title":"Y","properties":{}},{"id":49,"type":"basic/watch","pos":[868,335],"size":{"0":140,"1":26},"flags":{},"order":56,"mode":0,"inputs":[{"name":"value","type":0,"link":41,"label":"false"}],"title":"Y","properties":{}},{"id":42,"type":"basic/boolean","pos":[1020,138],"size":[140,30],"flags":{},"order":12,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[58],"slot_index":0}],"title":"B（高位）","properties":{"value":false},"widgets_values":[false]},{"id":36,"type":"basic/boolean","pos":[82,127],"size":[140,30],"flags":{},"order":13,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[46],"slot_index":0}],"title":"B","properties":{"value":true},"widgets_values":[true]},{"id":50,"type":"basic/watch","pos":[1024,337],"size":{"0":140,"1":26},"flags":{},"order":58,"mode":0,"inputs":[{"name":"value","type":0,"link":42,"label":"false"}],"title":"Y（高位）","properties":{}},{"id":25,"type":"custom/ADD","pos":{"0":1023,"1":219,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":66},"flags":{},"order":57,"mode":0,"inputs":[{"name":"A","type":"boolean","link":57,"slot_index":0},{"name":"B","type":"boolean","link":58},{"name":"C_in","type":"boolean","link":32}],"outputs":[{"name":"Y","type":"boolean","links":[42],"slot_index":0},{"name":"C_out","type":"boolean","links":[60],"slot_index":1}],"title":"全加器","properties":{"precision":1}},{"id":51,"type":"basic/boolean","pos":[-238,249],"size":[140,30],"flags":{},"order":14,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[59],"slot_index":0}],"title":"初始进位恒为0","properties":{"value":false},"widgets_values":[false]},{"id":28,"type":"basic/boolean","pos":[-66,48],"size":[140,30],"flags":{},"order":15,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[33],"slot_index":0}],"title":"A（低位）","properties":{"value":false},"widgets_values":[false]},{"id":34,"type":"basic/boolean","pos":[1017,54],"size":[140,30],"flags":{},"order":16,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[57],"slot_index":0}],"title":"A（高位）","properties":{"value":false},"widgets_values":[false]},{"id":43,"type":"basic/watch","pos":[-75,330],"size":{"0":140,"1":26},"flags":{},"order":36,"mode":0,"inputs":[{"name":"value","type":0,"link":35,"label":"false"}],"title":"Y（低位）","properties":{}},{"id":53,"type":"basic/boolean","pos":[93,458],"size":[140,30],"flags":{},"order":17,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[62],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":56,"type":"basic/boolean","pos":[409,459],"size":[140,30],"flags":{},"order":18,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[65],"slot_index":0}],"title":"A","properties":{"value":true},"widgets_values":[true]},{"id":57,"type":"basic/boolean","pos":[563,457],"size":[140,30],"flags":{},"order":19,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[67],"slot_index":0}],"title":"A","properties":{"value":true},"widgets_values":[true]},{"id":58,"type":"basic/boolean","pos":[716,454],"size":[140,30],"flags":{},"order":20,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[68],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":59,"type":"basic/boolean","pos":[869,455],"size":[140,30],"flags":{},"order":21,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[69],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":60,"type":"basic/boolean","pos":[1020,451],"size":[140,30],"flags":{},"order":22,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[70],"slot_index":0}],"title":"A（高位）","properties":{"value":false},"widgets_values":[false]},{"id":61,"type":"basic/boolean","pos":[-69,541],"size":[140,30],"flags":{},"order":23,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[71],"slot_index":0}],"title":"B（低位）","properties":{"value":false},"widgets_values":[false]},{"id":62,"type":"basic/boolean","pos":[86,539],"size":[140,30],"flags":{},"order":24,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[72],"slot_index":0}],"title":"B","properties":{"value":true},"widgets_values":[true]},{"id":63,"type":"basic/boolean","pos":[245,536],"size":[140,30],"flags":{},"order":25,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[73],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":64,"type":"basic/boolean","pos":[402,532],"size":[140,30],"flags":{},"order":26,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[74],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":65,"type":"basic/boolean","pos":[560,530],"size":[140,30],"flags":{},"order":27,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[75],"slot_index":0}],"title":"B","properties":{"value":true},"widgets_values":[true]},{"id":66,"type":"basic/boolean","pos":[715,526],"size":[140,30],"flags":{},"order":28,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[76],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":67,"type":"basic/boolean","pos":[868,525],"size":[140,30],"flags":{},"order":29,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[77],"slot_index":0}],"title":"B","properties":{"value":false},"widgets_values":[false]},{"id":68,"type":"basic/boolean","pos":[1023,521],"size":[140,30],"flags":{},"order":30,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[78],"slot_index":0}],"title":"B（高位）","properties":{"value":false},"widgets_values":[false]},{"id":54,"type":"basic/boolean","pos":[-64,460],"size":[140,30],"flags":{},"order":31,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[66],"slot_index":0}],"title":"A（低位）","properties":{"value":false},"widgets_values":[false]},{"id":55,"type":"basic/boolean","pos":[250,458],"size":[140,30],"flags":{},"order":32,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[63],"slot_index":0}],"title":"A","properties":{"value":false},"widgets_values":[false]},{"id":69,"type":"custom/ALU","pos":{"0":434,"1":612,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":346},"flags":{},"order":35,"mode":0,"inputs":[{"name":"A0","type":"boolean","link":66},{"name":"A1","type":"boolean","link":62},{"name":"A2","type":"boolean","link":63},{"name":"A3","type":"boolean","link":65},{"name":"A4","type":"boolean","link":67},{"name":"A5","type":"boolean","link":68},{"name":"A6","type":"boolean","link":69},{"name":"A7","type":"boolean","link":70},{"name":"B0","type":"boolean","link":71},{"name":"B1","type":"boolean","link":72},{"name":"B2","type":"boolean","link":73},{"name":"B3","type":"boolean","link":74},{"name":"B4","type":"boolean","link":75},{"name":"B5","type":"boolean","link":76},{"name":"B6","type":"boolean","link":77},{"name":"B7","type":"boolean","link":78},{"name":"LU","type":"boolean","link":79}],"outputs":[{"name":"O0","type":"boolean","links":[80],"slot_index":0},{"name":"O1","type":"boolean","links":[81],"slot_index":1},{"name":"O2","type":"boolean","links":[82],"slot_index":2},{"name":"O3","type":"boolean","links":[83],"slot_index":3},{"name":"O4","type":"boolean","links":[84],"slot_index":4},{"name":"O5","type":"boolean","links":[85],"slot_index":5},{"name":"O6","type":"boolean","links":[86],"slot_index":6},{"name":"O7","type":"boolean","links":[87],"slot_index":7}],"title":"8位加法器","properties":{"precision":1}},{"id":78,"type":"basic/boolean","pos":[-36,763],"size":[140,30],"flags":{},"order":33,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[79],"slot_index":0}],"title":"控制位","properties":{"value":true},"widgets_values":[true]},{"id":70,"type":"basic/watch","pos":[-66,1011],"size":{"0":140,"1":26},"flags":{},"order":38,"mode":0,"inputs":[{"name":"value","type":0,"link":80,"label":"false"}],"title":"Y（低位）","properties":{}},{"id":71,"type":"basic/watch","pos":[89,1010],"size":{"0":140,"1":26},"flags":{},"order":39,"mode":0,"inputs":[{"name":"value","type":0,"link":81,"label":"true"}],"title":"Y","properties":{}},{"id":72,"type":"basic/watch","pos":[241,1010],"size":{"0":140,"1":26},"flags":{},"order":40,"mode":0,"inputs":[{"name":"value","type":0,"link":82,"label":"false"}],"title":"Y","properties":{}},{"id":73,"type":"basic/watch","pos":[396,1012],"size":{"0":140,"1":26},"flags":{},"order":41,"mode":0,"inputs":[{"name":"value","type":0,"link":83,"label":"true"}],"title":"Y","properties":{}},{"id":74,"type":"basic/watch","pos":[553,1013],"size":{"0":140,"1":26},"flags":{},"order":42,"mode":0,"inputs":[{"name":"value","type":0,"link":84,"label":"false"}],"title":"Y","properties":{}},{"id":75,"type":"basic/watch","pos":[711,1015],"size":{"0":140,"1":26},"flags":{},"order":43,"mode":0,"inputs":[{"name":"value","type":0,"link":85,"label":"true"}],"title":"Y","properties":{}},{"id":76,"type":"basic/watch","pos":[862,1015],"size":{"0":140,"1":26},"flags":{},"order":44,"mode":0,"inputs":[{"name":"value","type":0,"link":86,"label":"false"}],"title":"Y","properties":{}},{"id":77,"type":"basic/watch","pos":[1015,1014],"size":{"0":140,"1":26},"flags":{},"order":45,"mode":0,"inputs":[{"name":"value","type":0,"link":87,"label":"false"}],"title":"Y（高位）","properties":{}},{"id":52,"type":"basic/watch","pos":[1198,240],"size":[157.69551971054057,26],"flags":{},"order":59,"mode":0,"inputs":[{"name":"value","type":0,"link":60,"label":"false"}],"title":"最高进位为1则溢出","properties":{}}],"links":[[25,23,1,24,2,"boolean"],[26,24,1,19,2,"boolean"],[28,19,1,20,2,"boolean"],[29,20,1,21,2,"boolean"],[30,21,1,22,2,"boolean"],[31,22,1,26,2,"boolean"],[32,26,1,25,2,"boolean"],[33,28,0,23,0,"boolean"],[34,35,0,23,1,"boolean"],[35,23,0,43,0,"boolean"],[36,24,0,44,0,"boolean"],[37,19,0,45,0,"boolean"],[38,20,0,46,0,"boolean"],[39,21,0,47,0,"boolean"],[40,22,0,48,0,"boolean"],[41,26,0,49,0,"boolean"],[42,25,0,50,0,"boolean"],[45,27,0,24,0,"boolean"],[46,36,0,24,1,"boolean"],[47,29,0,19,0,"boolean"],[48,37,0,19,1,"boolean"],[49,30,0,20,0,"boolean"],[50,38,0,20,1,"boolean"],[51,31,0,21,0,"boolean"],[52,39,0,21,1,"boolean"],[53,32,0,22,0,"boolean"],[54,40,0,22,1,"boolean"],[55,33,0,26,0,"boolean"],[56,41,0,26,1,"boolean"],[57,34,0,25,0,"boolean"],[58,42,0,25,1,"boolean"],[59,51,0,23,2,"boolean"],[60,25,1,52,0,"boolean"],[62,53,0,69,1,"boolean"],[63,55,0,69,2,"boolean"],[65,56,0,69,3,"boolean"],[66,54,0,69,0,"boolean"],[67,57,0,69,4,"boolean"],[68,58,0,69,5,"boolean"],[69,59,0,69,6,"boolean"],[70,60,0,69,7,"boolean"],[71,61,0,69,8,"boolean"],[72,62,0,69,9,"boolean"],[73,63,0,69,10,"boolean"],[74,64,0,69,11,"boolean"],[75,65,0,69,12,"boolean"],[76,66,0,69,13,"boolean"],[77,67,0,69,14,"boolean"],[78,68,0,69,15,"boolean"],[79,78,0,69,16,"boolean"],[80,69,0,70,0,"boolean"],[81,69,1,71,0,"boolean"],[82,69,2,72,0,"boolean"],[83,69,3,73,0,"boolean"],[84,69,4,74,0,"boolean"],[85,69,5,75,0,"boolean"],[86,69,6,76,0,"boolean"],[87,69,7,77,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',triggerJSON='{"last_node_id":17,"last_link_id":24,"nodes":[{"id":14,"type":"custom/NOR","pos":{"0":354,"1":140,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":2,"mode":0,"inputs":[{"name":"A","type":"boolean","link":18},{"name":"B","type":"boolean","link":22}],"outputs":[{"name":"NOR","type":"boolean","links":[21,23],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":15,"type":"custom/NOR","pos":{"0":351,"1":305,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":3,"mode":0,"inputs":[{"name":"A","type":"boolean","link":21},{"name":"B","type":"boolean","link":20}],"outputs":[{"name":"NOR","type":"boolean","links":[22,24],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":12,"type":"basic/boolean","pos":[110,139],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[18],"slot_index":0}],"title":"R","properties":{"value":true},"widgets_values":[true]},{"id":13,"type":"basic/boolean","pos":[110,310],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[20],"slot_index":0}],"title":"S","properties":{"value":true},"widgets_values":[true]},{"id":16,"type":"basic/watch","pos":[609,144],"size":{"0":140,"1":26},"flags":{},"order":4,"mode":0,"inputs":[{"name":"value","type":0,"link":23,"label":"false"}],"title":"Q","properties":{}},{"id":17,"type":"basic/watch","pos":[611,305],"size":{"0":140,"1":26},"flags":{},"order":5,"mode":0,"inputs":[{"name":"value","type":0,"link":24,"label":"false"}],"title":"Q非","properties":{}}],"links":[[18,12,0,14,0,"boolean"],[20,13,0,15,1,"boolean"],[21,14,0,15,0,"boolean"],[22,15,0,14,1,"boolean"],[23,14,0,16,0,"boolean"],[24,15,0,17,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',latchJSON='{"last_node_id":24,"last_link_id":36,"nodes":[{"id":14,"type":"custom/NOR","pos":{"0":581,"1":143,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":9,"mode":0,"inputs":[{"name":"A","type":"boolean","link":25},{"name":"B","type":"boolean","link":22}],"outputs":[{"name":"NOR","type":"boolean","links":[21,23],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":15,"type":"custom/NOR","pos":{"0":580,"1":323,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":10,"mode":0,"inputs":[{"name":"A","type":"boolean","link":21},{"name":"B","type":"boolean","link":26}],"outputs":[{"name":"NOR","type":"boolean","links":[22,24],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":18,"type":"logic/AND","pos":[338,136],"size":{"0":140,"1":46},"flags":{},"order":7,"mode":0,"inputs":[{"name":"a","type":"boolean","link":28},{"name":"b","type":"boolean","link":30}],"outputs":[{"name":"out","type":"boolean","links":[25],"slot_index":0}],"properties":{}},{"id":19,"type":"logic/AND","pos":[345,338],"size":{"0":140,"1":46},"flags":{},"order":4,"mode":0,"inputs":[{"name":"a","type":"boolean","link":31},{"name":"b","type":"boolean","link":27}],"outputs":[{"name":"out","type":"boolean","links":[26],"slot_index":0}],"properties":{}},{"id":20,"type":"logic/NOT","pos":[183,253],"size":{"0":140,"1":26},"flags":{},"order":5,"mode":0,"inputs":[{"name":"in","type":"boolean","link":29}],"outputs":[{"name":"out","type":"boolean","links":[30],"slot_index":0}],"properties":{}},{"id":17,"type":"basic/watch","pos":[806,324],"size":{"0":140,"1":26},"flags":{},"order":12,"mode":0,"inputs":[{"name":"value","type":0,"link":24,"label":"false"}],"title":"Q非","properties":{}},{"id":16,"type":"basic/watch","pos":[802,146],"size":{"0":140,"1":26},"flags":{},"order":11,"mode":0,"inputs":[{"name":"value","type":0,"link":23,"label":"true"}],"title":"Q","properties":{}},{"id":21,"type":"custom/Latch","pos":{"0":397,"1":539,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":6,"mode":0,"inputs":[{"name":"EN","type":"boolean","link":36},{"name":"DI","type":"boolean","link":35}],"outputs":[{"name":"DO","type":"boolean","links":[32],"slot_index":0}],"title":"锁存器","properties":{"precision":1}},{"id":24,"type":"basic/watch","pos":[685,540],"size":{"0":140,"1":26},"flags":{},"order":8,"mode":0,"inputs":[{"name":"value","type":0,"link":32,"label":"true"}],"title":"Q","properties":{}},{"id":13,"type":"basic/boolean","pos":[47,351],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[27,29],"slot_index":0}],"title":"数据端","properties":{"value":true},"widgets_values":[true]},{"id":23,"type":"basic/boolean","pos":[64,608],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[35],"slot_index":0}],"title":"数据端","properties":{"value":true},"widgets_values":[true]},{"id":12,"type":"basic/boolean","pos":[39,134],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[28,31],"slot_index":0}],"title":"控制端","properties":{"value":true},"widgets_values":[true]},{"id":22,"type":"basic/boolean","pos":[61,490],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[36],"slot_index":0}],"title":"控制端","properties":{"value":true},"widgets_values":[true]}],"links":[[21,14,0,15,0,"boolean"],[22,15,0,14,1,"boolean"],[23,14,0,16,0,"boolean"],[24,15,0,17,0,"boolean"],[25,18,0,14,0,"boolean"],[26,19,0,15,1,"boolean"],[27,13,0,19,1,"boolean"],[28,12,0,18,0,"boolean"],[29,13,0,20,0,"boolean"],[30,20,0,18,1,"boolean"],[31,12,0,19,0,"boolean"],[32,21,0,24,0,"boolean"],[35,23,0,21,1,"boolean"],[36,22,0,21,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',RWMemoryJSON='{"last_node_id":48,"last_link_id":67,"nodes":[{"id":23,"type":"logic/AND","pos":[393,70],"size":{"0":140,"1":46},"flags":{},"order":9,"mode":0,"inputs":[{"name":"a","type":"boolean","link":36},{"name":"b","type":"boolean","link":37}],"outputs":[{"name":"out","type":"boolean","links":[35],"slot_index":0}],"properties":{}},{"id":24,"type":"logic/AND","pos":[248,199],"size":{"0":140,"1":46},"flags":{},"order":8,"mode":0,"inputs":[{"name":"a","type":"boolean","link":43},{"name":"b","type":"boolean","link":44}],"outputs":[{"name":"out","type":"boolean","links":[61],"slot_index":0}],"properties":{}},{"id":42,"type":"custom/Latch","pos":{"0":433,"1":240,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":11,"mode":0,"inputs":[{"name":"EN","type":"boolean","link":61},{"name":"DI","type":"boolean","link":59}],"outputs":[{"name":"DO","type":"boolean","links":[60],"slot_index":0}],"title":"锁存器","properties":{"precision":1}},{"id":22,"type":"logic/AND","pos":[649,110],"size":{"0":140,"1":46},"flags":{},"order":13,"mode":0,"inputs":[{"name":"a","type":"boolean","link":35},{"name":"b","type":"boolean","link":60}],"outputs":[{"name":"out","type":"boolean","links":[34],"slot_index":0}],"properties":{}},{"id":16,"type":"basic/watch","pos":[827,111],"size":{"0":140,"1":26},"flags":{},"order":14,"mode":0,"inputs":[{"name":"value","type":0,"link":34,"label":"true"}],"title":"输出","properties":{}},{"id":44,"type":"basic/watch","pos":[660,559],"size":{"0":140,"1":26},"flags":{},"order":12,"mode":0,"inputs":[{"name":"value","type":0,"link":63,"label":"true"}],"title":"输出","properties":{}},{"id":43,"type":"custom/RWMemory","pos":{"0":426,"1":555,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":10,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":66},{"name":"ENI","type":"boolean","link":65},{"name":"ENO","type":"boolean","link":64},{"name":"DI","type":"boolean","link":67}],"outputs":[{"name":"DO","type":"boolean","links":[63],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":25,"type":"basic/boolean","pos":[22,133],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[37,43],"slot_index":0}],"title":"地址控制端","properties":{"value":true},"widgets_values":[true]},{"id":48,"type":"basic/boolean","pos":[93,534],"size":[140,30],"flags":{},"order":6,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[66],"slot_index":0}],"title":"地址控制端","properties":{"value":true},"widgets_values":[true]},{"id":47,"type":"basic/boolean","pos":[93,450],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[64],"slot_index":0}],"title":"读取控制端","properties":{"value":true},"widgets_values":[true]},{"id":21,"type":"basic/boolean","pos":[23,64],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[36],"slot_index":0}],"title":"读取控制端","properties":{"value":true},"widgets_values":[true]},{"id":12,"type":"basic/boolean","pos":[21,202],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[44],"slot_index":0}],"title":"写入控制端","properties":{"value":true},"widgets_values":[true]},{"id":13,"type":"basic/boolean","pos":[21,301],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[59],"slot_index":0}],"title":"数据端","properties":{"value":true},"widgets_values":[true]},{"id":45,"type":"basic/boolean","pos":[91,619],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[65],"slot_index":0}],"title":"写入控制端","properties":{"value":true},"widgets_values":[true]},{"id":46,"type":"basic/boolean","pos":[92,708],"size":[140,30],"flags":{},"order":7,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[67],"slot_index":0}],"title":"数据端","properties":{"value":true},"widgets_values":[true]}],"links":[[34,22,0,16,0,"boolean"],[35,23,0,22,0,"boolean"],[36,21,0,23,0,"boolean"],[37,25,0,23,1,"boolean"],[43,25,0,24,0,"boolean"],[44,12,0,24,1,"boolean"],[59,13,0,42,1,"boolean"],[60,42,0,22,1,"boolean"],[61,24,0,42,0,"boolean"],[63,43,0,44,0,"boolean"],[64,47,0,43,2,"boolean"],[65,45,0,43,1,"boolean"],[66,48,0,43,0,"boolean"],[67,46,0,43,3,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',CacheJSON='{"last_node_id":125,"last_link_id":251,"nodes":[{"id":53,"type":"custom/RWMemory","pos":{"0":508.92022705078125,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":23,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":223},{"name":"ENI","type":"boolean","link":88},{"name":"ENO","type":"boolean","link":89},{"name":"DI","type":"boolean","link":98}],"outputs":[{"name":"DO","type":"boolean","links":[214],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":56,"type":"custom/RWMemory","pos":{"0":204.9215087890625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":21,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":221},{"name":"ENI","type":"boolean","link":92},{"name":"ENO","type":"boolean","link":93},{"name":"DI","type":"boolean","link":94}],"outputs":[{"name":"DO","type":"boolean","links":[212],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":55,"type":"custom/RWMemory","pos":{"0":357.9213562011719,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":22,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":222},{"name":"ENI","type":"boolean","link":90},{"name":"ENO","type":"boolean","link":91},{"name":"DI","type":"boolean","link":96}],"outputs":[{"name":"DO","type":"boolean","links":[213],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":52,"type":"custom/RWMemory","pos":{"0":658.92041015625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":25,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":225},{"name":"ENI","type":"boolean","link":86},{"name":"ENO","type":"boolean","link":87},{"name":"DI","type":"boolean","link":100}],"outputs":[{"name":"DO","type":"boolean","links":[215],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":49,"type":"custom/RWMemory","pos":{"0":810.9204711914062,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":24,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":224},{"name":"ENI","type":"boolean","link":84},{"name":"ENO","type":"boolean","link":85},{"name":"DI","type":"boolean","link":102}],"outputs":[{"name":"DO","type":"boolean","links":[216],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":50,"type":"custom/RWMemory","pos":{"0":959.9210205078125,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":26,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":226},{"name":"ENI","type":"boolean","link":82},{"name":"ENO","type":"boolean","link":83},{"name":"DI","type":"boolean","link":104}],"outputs":[{"name":"DO","type":"boolean","links":[218],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":51,"type":"custom/RWMemory","pos":{"0":1114.9227294921875,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":27,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":227},{"name":"ENI","type":"boolean","link":80},{"name":"ENO","type":"boolean","link":81},{"name":"DI","type":"boolean","link":106}],"outputs":[{"name":"DO","type":"boolean","links":[219],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":54,"type":"custom/RWMemory","pos":{"0":1271.9224853515625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":28,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":228},{"name":"ENI","type":"boolean","link":78},{"name":"ENO","type":"boolean","link":79},{"name":"DI","type":"boolean","link":108}],"outputs":[{"name":"DO","type":"boolean","links":[220],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":62,"type":"basic/boolean","pos":[357.9212409344491,53.70643766967732],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[96],"slot_index":0}],"title":"输入1","properties":{"value":true},"widgets_values":[true]},{"id":63,"type":"basic/boolean","pos":[508.9212409344491,53.70643766967732],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[98],"slot_index":0}],"title":"输入2","properties":{"value":true},"widgets_values":[true]},{"id":64,"type":"basic/boolean","pos":[658.9212409344483,53.70643766967732],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[100],"slot_index":0}],"title":"输入3","properties":{"value":true},"widgets_values":[true]},{"id":65,"type":"basic/boolean","pos":[810.9212409344486,53.70643766967732],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[102],"slot_index":0}],"title":"输入4","properties":{"value":false},"widgets_values":[false]},{"id":66,"type":"basic/boolean","pos":[959.9212409344489,53.70643766967732],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[104],"slot_index":0}],"title":"输入5","properties":{"value":false},"widgets_values":[false]},{"id":67,"type":"basic/boolean","pos":[1114.9212409344493,53.70643766967732],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[106],"slot_index":0}],"title":"输入6","properties":{"value":false},"widgets_values":[false]},{"id":68,"type":"basic/boolean","pos":[1271.9212409344486,53.70643766967732],"size":[140,30],"flags":{},"order":6,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[108],"slot_index":0}],"title":"输入7","properties":{"value":false},"widgets_values":[false]},{"id":60,"type":"basic/boolean","pos":[26,53],"size":[140,30],"flags":{},"order":7,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[78,80,82,84,86,88,90,92],"slot_index":0}],"title":"写入","properties":{"value":true},"widgets_values":[true]},{"id":58,"type":"basic/boolean","pos":[201,55],"size":[140,30],"flags":{},"order":8,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[94],"slot_index":0}],"title":"输入0","properties":{"value":true},"widgets_values":[true]},{"id":117,"type":"basic/watch","pos":[374.98367755520013,738.132573903907],"size":{"0":140,"1":26},"flags":{},"order":39,"mode":0,"inputs":[{"name":"value","type":0,"link":240,"label":"true"}],"title":"输出1","properties":{}},{"id":118,"type":"basic/watch","pos":[523.9836775552001,736.132573903907],"size":{"0":140,"1":26},"flags":{},"order":40,"mode":0,"inputs":[{"name":"value","type":0,"link":241,"label":"true"}],"title":"输出2","properties":{}},{"id":119,"type":"basic/watch","pos":[673.9836775552003,735.132573903907],"size":{"0":140,"1":26},"flags":{},"order":41,"mode":0,"inputs":[{"name":"value","type":0,"link":242,"label":"true"}],"title":"输出3","properties":{}},{"id":120,"type":"basic/watch","pos":[823.9836775552003,733.132573903907],"size":{"0":140,"1":26},"flags":{},"order":42,"mode":0,"inputs":[{"name":"value","type":0,"link":243,"label":"true"}],"title":"输出4","properties":{}},{"id":121,"type":"basic/watch","pos":[973.9836775552003,732.132573903907],"size":{"0":140,"1":26},"flags":{},"order":43,"mode":0,"inputs":[{"name":"value","type":0,"link":244,"label":"true"}],"title":"输出5","properties":{}},{"id":122,"type":"basic/watch","pos":[1123.9836775552005,731.132573903907],"size":{"0":140,"1":26},"flags":{},"order":44,"mode":0,"inputs":[{"name":"value","type":0,"link":245,"label":"true"}],"title":"输出6","properties":{}},{"id":123,"type":"basic/watch","pos":[1276.9836775552005,729.132573903907],"size":{"0":140,"1":26},"flags":{},"order":45,"mode":0,"inputs":[{"name":"value","type":0,"link":246,"label":"true"}],"title":"输出7","properties":{}},{"id":61,"type":"basic/boolean","pos":[25,288],"size":[140,30],"flags":{},"order":9,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[79,81,83,85,87,89,91,93],"slot_index":0}],"title":"读取","properties":{"value":true},"widgets_values":[true]},{"id":124,"type":"basic/boolean","pos":[25,156],"size":[140,30],"flags":{},"order":10,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[221,222,223,224,225,226,227,228],"slot_index":0}],"title":"恒为1","properties":{"value":true},"widgets_values":[true]},{"id":76,"type":"basic/watch","pos":[201,283],"size":{"0":140,"1":26},"flags":{},"order":30,"mode":0,"inputs":[{"name":"value","type":0,"link":212,"label":"true"}],"title":"输出0","properties":{}},{"id":77,"type":"basic/watch","pos":[356,282],"size":{"0":140,"1":26},"flags":{},"order":31,"mode":0,"inputs":[{"name":"value","type":0,"link":213,"label":"true"}],"title":"输出1","properties":{}},{"id":78,"type":"basic/watch","pos":[510,283],"size":{"0":140,"1":26},"flags":{},"order":32,"mode":0,"inputs":[{"name":"value","type":0,"link":214,"label":"true"}],"title":"输出2","properties":{}},{"id":79,"type":"basic/watch","pos":[661,280],"size":{"0":140,"1":26},"flags":{},"order":34,"mode":0,"inputs":[{"name":"value","type":0,"link":215,"label":"true"}],"title":"输出3","properties":{}},{"id":80,"type":"basic/watch","pos":[815,279],"size":{"0":140,"1":26},"flags":{},"order":33,"mode":0,"inputs":[{"name":"value","type":0,"link":216,"label":"false"}],"title":"输出4","properties":{}},{"id":81,"type":"basic/watch","pos":[967,280],"size":{"0":140,"1":26},"flags":{},"order":35,"mode":0,"inputs":[{"name":"value","type":0,"link":218,"label":"false"}],"title":"输出5","properties":{}},{"id":82,"type":"basic/watch","pos":[1123,279],"size":{"0":140,"1":26},"flags":{},"order":36,"mode":0,"inputs":[{"name":"value","type":0,"link":219,"label":"false"}],"title":"输出6","properties":{}},{"id":83,"type":"basic/watch","pos":[1277,280],"size":{"0":140,"1":26},"flags":{},"order":37,"mode":0,"inputs":[{"name":"value","type":0,"link":220,"label":"false"}],"title":"输出7","properties":{}},{"id":116,"type":"basic/watch","pos":[224.98367755520022,738.132573903907],"size":{"0":140,"1":26},"flags":{},"order":38,"mode":0,"inputs":[{"name":"value","type":0,"link":239,"label":"true"}],"title":"输出0","properties":{}},{"id":103,"type":"basic/boolean","pos":[205.11763207146043,375.65755915991025],"size":[140,30],"flags":{},"order":11,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[231],"slot_index":0}],"title":"输入0","properties":{"value":true},"widgets_values":[true]},{"id":106,"type":"basic/boolean","pos":[509.1176320714603,375.65755915991025],"size":[140,30],"flags":{},"order":13,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[233],"slot_index":0}],"title":"输入2","properties":{"value":true},"widgets_values":[true]},{"id":108,"type":"basic/boolean","pos":[811.1176320714596,375.65755915991025],"size":[140,30],"flags":{},"order":15,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[251],"slot_index":0}],"title":"输入4","properties":{"value":true},"widgets_values":[true]},{"id":110,"type":"basic/boolean","pos":[1115.1176320714617,375.65755915991025],"size":[140,30],"flags":{},"order":17,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[237],"slot_index":0}],"title":"输入6","properties":{"value":true},"widgets_values":[true]},{"id":125,"type":"custom/Cache","pos":{"0":701,"1":465,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":206},"flags":{},"order":29,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":231},{"name":"I1","type":"boolean","link":232},{"name":"I2","type":"boolean","link":233},{"name":"I3","type":"boolean","link":250},{"name":"I4","type":"boolean","link":251},{"name":"I5","type":"boolean","link":236},{"name":"I6","type":"boolean","link":237},{"name":"I7","type":"boolean","link":238},{"name":"AI","type":"boolean","link":247},{"name":"AO","type":"boolean","link":248}],"outputs":[{"name":"O0","type":"boolean","links":[239],"slot_index":0},{"name":"O1","type":"boolean","links":[240],"slot_index":1},{"name":"O2","type":"boolean","links":[241],"slot_index":2},{"name":"O3","type":"boolean","links":[242],"slot_index":3},{"name":"O4","type":"boolean","links":[243],"slot_index":4},{"name":"O5","type":"boolean","links":[244],"slot_index":5},{"name":"O6","type":"boolean","links":[245],"slot_index":6},{"name":"O7","type":"boolean","links":[246],"slot_index":7}],"title":"存储器","properties":{"precision":1}},{"id":105,"type":"basic/boolean","pos":[358.1176320714601,375.65755915991025],"size":[140,30],"flags":{},"order":12,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[232],"slot_index":0}],"title":"输入1","properties":{"value":true},"widgets_values":[true]},{"id":107,"type":"basic/boolean","pos":[659.1176320714593,375.65755915991025],"size":[140,30],"flags":{},"order":14,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[250],"slot_index":0}],"title":"输入3","properties":{"value":true},"widgets_values":[true]},{"id":109,"type":"basic/boolean","pos":[960.1176320714599,375.65755915991025],"size":[140,30],"flags":{},"order":16,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[236],"slot_index":0}],"title":"输入5","properties":{"value":true},"widgets_values":[true]},{"id":111,"type":"basic/boolean","pos":[1272.117632071461,375.65755915991025],"size":[140,30],"flags":{},"order":18,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[238],"slot_index":0}],"title":"输入7","properties":{"value":true},"widgets_values":[true]},{"id":104,"type":"basic/boolean","pos":[54,515],"size":[140,30],"flags":{},"order":19,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[247],"slot_index":0}],"title":"写入","properties":{"value":false},"widgets_values":[false]},{"id":115,"type":"basic/boolean","pos":[53,607],"size":[140,30],"flags":{},"order":20,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[248],"slot_index":0}],"title":"读取","properties":{"value":true},"widgets_values":[true]}],"links":[[78,60,0,54,1,"boolean"],[79,61,0,54,2,"boolean"],[80,60,0,51,1,"boolean"],[81,61,0,51,2,"boolean"],[82,60,0,50,1,"boolean"],[83,61,0,50,2,"boolean"],[84,60,0,49,1,"boolean"],[85,61,0,49,2,"boolean"],[86,60,0,52,1,"boolean"],[87,61,0,52,2,"boolean"],[88,60,0,53,1,"boolean"],[89,61,0,53,2,"boolean"],[90,60,0,55,1,"boolean"],[91,61,0,55,2,"boolean"],[92,60,0,56,1,"boolean"],[93,61,0,56,2,"boolean"],[94,58,0,56,3,"boolean"],[96,62,0,55,3,"boolean"],[98,63,0,53,3,"boolean"],[100,64,0,52,3,"boolean"],[102,65,0,49,3,"boolean"],[104,66,0,50,3,"boolean"],[106,67,0,51,3,"boolean"],[108,68,0,54,3,"boolean"],[212,56,0,76,0,"boolean"],[213,55,0,77,0,"boolean"],[214,53,0,78,0,"boolean"],[215,52,0,79,0,"boolean"],[216,49,0,80,0,"boolean"],[218,50,0,81,0,"boolean"],[219,51,0,82,0,"boolean"],[220,54,0,83,0,"boolean"],[221,124,0,56,0,"boolean"],[222,124,0,55,0,"boolean"],[223,124,0,53,0,"boolean"],[224,124,0,49,0,"boolean"],[225,124,0,52,0,"boolean"],[226,124,0,50,0,"boolean"],[227,124,0,51,0,"boolean"],[228,124,0,54,0,"boolean"],[231,103,0,125,0,"boolean"],[232,105,0,125,1,"boolean"],[233,106,0,125,2,"boolean"],[236,109,0,125,5,"boolean"],[237,110,0,125,6,"boolean"],[238,111,0,125,7,"boolean"],[239,125,0,116,0,"boolean"],[240,125,1,117,0,"boolean"],[241,125,2,118,0,"boolean"],[242,125,3,119,0,"boolean"],[243,125,4,120,0,"boolean"],[244,125,5,121,0,"boolean"],[245,125,6,122,0,"boolean"],[246,125,7,123,0,"boolean"],[247,104,0,125,8,"boolean"],[248,115,0,125,9,"boolean"],[250,107,0,125,3,"boolean"],[251,108,0,125,4,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',RAMJSON='{"last_node_id":123,"last_link_id":211,"nodes":[{"id":53,"type":"custom/RWMemory","pos":{"0":508.92022705078125,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":30,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":72},{"name":"ENI","type":"boolean","link":88},{"name":"ENO","type":"boolean","link":89},{"name":"DI","type":"boolean","link":98}],"outputs":[{"name":"DO","type":"boolean","links":[157],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":56,"type":"custom/RWMemory","pos":{"0":204.9215087890625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":32,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":70},{"name":"ENI","type":"boolean","link":92},{"name":"ENO","type":"boolean","link":93},{"name":"DI","type":"boolean","link":94}],"outputs":[{"name":"DO","type":"boolean","links":[153],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":55,"type":"custom/RWMemory","pos":{"0":357.9213562011719,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":31,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":71},{"name":"ENI","type":"boolean","link":90},{"name":"ENO","type":"boolean","link":91},{"name":"DI","type":"boolean","link":96}],"outputs":[{"name":"DO","type":"boolean","links":[155],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":91,"type":"custom/RWMemory","pos":{"0":204.9215087890625,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":34,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":181},{"name":"ENI","type":"boolean","link":128},{"name":"ENO","type":"boolean","link":137},{"name":"DI","type":"boolean","link":110}],"outputs":[{"name":"DO","type":"boolean","links":[154],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":90,"type":"custom/RWMemory","pos":{"0":357.9213562011719,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":35,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":182},{"name":"ENI","type":"boolean","link":129},{"name":"ENO","type":"boolean","link":138},{"name":"DI","type":"boolean","link":111}],"outputs":[{"name":"DO","type":"boolean","links":[156],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":88,"type":"custom/RWMemory","pos":{"0":508.92022705078125,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":36,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":183},{"name":"ENI","type":"boolean","link":130},{"name":"ENO","type":"boolean","link":139},{"name":"DI","type":"boolean","link":112}],"outputs":[{"name":"DO","type":"boolean","links":[158],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":95,"type":"logic/OR","pos":[512.3632692352302,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":52,"mode":0,"inputs":[{"name":"a","type":"boolean","link":157},{"name":"b","type":"boolean","link":158}],"outputs":[{"name":"out","type":"boolean","links":[147],"slot_index":0}],"properties":{}},{"id":94,"type":"logic/OR","pos":[361.3632692352302,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":51,"mode":0,"inputs":[{"name":"a","type":"boolean","link":155},{"name":"b","type":"boolean","link":156}],"outputs":[{"name":"out","type":"boolean","links":[146],"slot_index":0}],"properties":{}},{"id":93,"type":"logic/OR","pos":[208.3632692352298,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":50,"mode":0,"inputs":[{"name":"a","type":"boolean","link":153},{"name":"b","type":"boolean","link":154}],"outputs":[{"name":"out","type":"boolean","links":[145],"slot_index":0}],"properties":{}},{"id":97,"type":"logic/OR","pos":[814.3632692352298,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":54,"mode":0,"inputs":[{"name":"a","type":"boolean","link":161},{"name":"b","type":"boolean","link":162}],"outputs":[{"name":"out","type":"boolean","links":[149],"slot_index":0}],"properties":{}},{"id":77,"type":"basic/watch","pos":[361.3632692352302,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":59,"mode":0,"inputs":[{"name":"value","type":0,"link":146,"label":"true"}],"title":"输出1","properties":{}},{"id":78,"type":"basic/watch","pos":[512.3632692352302,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":60,"mode":0,"inputs":[{"name":"value","type":0,"link":147,"label":"true"}],"title":"输出2","properties":{}},{"id":96,"type":"logic/OR","pos":[662.3632692352295,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":53,"mode":0,"inputs":[{"name":"a","type":"boolean","link":159},{"name":"b","type":"boolean","link":160}],"outputs":[{"name":"out","type":"boolean","links":[148],"slot_index":0}],"properties":{}},{"id":79,"type":"basic/watch","pos":[662.3632692352295,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":61,"mode":0,"inputs":[{"name":"value","type":0,"link":148,"label":"true"}],"title":"输出3","properties":{}},{"id":87,"type":"custom/RWMemory","pos":{"0":658.92041015625,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":37,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":184},{"name":"ENI","type":"boolean","link":131},{"name":"ENO","type":"boolean","link":140},{"name":"DI","type":"boolean","link":116}],"outputs":[{"name":"DO","type":"boolean","links":[160],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":52,"type":"custom/RWMemory","pos":{"0":658.92041015625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":29,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":73},{"name":"ENI","type":"boolean","link":86},{"name":"ENO","type":"boolean","link":87},{"name":"DI","type":"boolean","link":100}],"outputs":[{"name":"DO","type":"boolean","links":[159],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":49,"type":"custom/RWMemory","pos":{"0":810.9204711914062,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":28,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":74},{"name":"ENI","type":"boolean","link":84},{"name":"ENO","type":"boolean","link":85},{"name":"DI","type":"boolean","link":102}],"outputs":[{"name":"DO","type":"boolean","links":[161],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":84,"type":"custom/RWMemory","pos":{"0":810.9204711914062,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":38,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":185},{"name":"ENI","type":"boolean","link":132},{"name":"ENO","type":"boolean","link":141},{"name":"DI","type":"boolean","link":114}],"outputs":[{"name":"DO","type":"boolean","links":[162],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":80,"type":"basic/watch","pos":[814.3632692352298,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":62,"mode":0,"inputs":[{"name":"value","type":0,"link":149,"label":"false"}],"title":"输出4","properties":{}},{"id":50,"type":"custom/RWMemory","pos":{"0":959.9210205078125,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":27,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":75},{"name":"ENI","type":"boolean","link":82},{"name":"ENO","type":"boolean","link":83},{"name":"DI","type":"boolean","link":104}],"outputs":[{"name":"DO","type":"boolean","links":[165],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":85,"type":"custom/RWMemory","pos":{"0":959.9210205078125,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":39,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":186,"slot_index":0},{"name":"ENI","type":"boolean","link":134},{"name":"ENO","type":"boolean","link":142},{"name":"DI","type":"boolean","link":117}],"outputs":[{"name":"DO","type":"boolean","links":[166],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":81,"type":"basic/watch","pos":[963.3632692352301,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":63,"mode":0,"inputs":[{"name":"value","type":0,"link":150,"label":"false"}],"title":"输出5","properties":{}},{"id":98,"type":"logic/OR","pos":[963.3632692352301,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":55,"mode":0,"inputs":[{"name":"a","type":"boolean","link":165},{"name":"b","type":"boolean","link":166}],"outputs":[{"name":"out","type":"boolean","links":[150],"slot_index":0}],"properties":{}},{"id":51,"type":"custom/RWMemory","pos":{"0":1114.9227294921875,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":26,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":76},{"name":"ENI","type":"boolean","link":80},{"name":"ENO","type":"boolean","link":81},{"name":"DI","type":"boolean","link":106}],"outputs":[{"name":"DO","type":"boolean","links":[167],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":86,"type":"custom/RWMemory","pos":{"0":1114.9227294921875,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":40,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":187},{"name":"ENI","type":"boolean","link":135},{"name":"ENO","type":"boolean","link":143},{"name":"DI","type":"boolean","link":118}],"outputs":[{"name":"DO","type":"boolean","links":[179],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":99,"type":"logic/OR","pos":[1118.3632692352305,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":56,"mode":0,"inputs":[{"name":"a","type":"boolean","link":167},{"name":"b","type":"boolean","link":179}],"outputs":[{"name":"out","type":"boolean","links":[151],"slot_index":0}],"properties":{}},{"id":82,"type":"basic/watch","pos":[1118.3632692352305,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":64,"mode":0,"inputs":[{"name":"value","type":0,"link":151,"label":"false"}],"title":"输出6","properties":{}},{"id":83,"type":"basic/watch","pos":[1275.3632692352298,465.0141583337438],"size":{"0":140,"1":26},"flags":{},"order":65,"mode":0,"inputs":[{"name":"value","type":0,"link":152,"label":"false"}],"title":"输出7","properties":{}},{"id":100,"type":"logic/OR","pos":[1275.3632692352298,382.01415833374296],"size":{"0":140,"1":46},"flags":{},"order":57,"mode":0,"inputs":[{"name":"a","type":"boolean","link":169},{"name":"b","type":"boolean","link":170}],"outputs":[{"name":"out","type":"boolean","links":[152],"slot_index":0}],"properties":{}},{"id":89,"type":"custom/RWMemory","pos":{"0":1271.9224853515625,"1":252.61265563964844,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":41,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":188},{"name":"ENI","type":"boolean","link":136},{"name":"ENO","type":"boolean","link":144},{"name":"DI","type":"boolean","link":119}],"outputs":[{"name":"DO","type":"boolean","links":[170],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":54,"type":"custom/RWMemory","pos":{"0":1271.9224853515625,"1":121.61235046386719,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":25,"mode":0,"inputs":[{"name":"Addr","type":"boolean","link":77},{"name":"ENI","type":"boolean","link":78},{"name":"ENO","type":"boolean","link":79},{"name":"DI","type":"boolean","link":108}],"outputs":[{"name":"DO","type":"boolean","links":[169],"slot_index":0}],"title":"读写存储器","properties":{"precision":1}},{"id":62,"type":"basic/boolean","pos":[357.9212409344491,53.70643766967732],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[96,111],"slot_index":0}],"title":"输入1","properties":{"value":true},"widgets_values":[true]},{"id":63,"type":"basic/boolean","pos":[508.9212409344491,53.70643766967732],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[98,112],"slot_index":0}],"title":"输入2","properties":{"value":true},"widgets_values":[true]},{"id":64,"type":"basic/boolean","pos":[658.9212409344483,53.70643766967732],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[100,116],"slot_index":0}],"title":"输入3","properties":{"value":true},"widgets_values":[true]},{"id":65,"type":"basic/boolean","pos":[810.9212409344486,53.70643766967732],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[102,114],"slot_index":0}],"title":"输入4","properties":{"value":false},"widgets_values":[false]},{"id":66,"type":"basic/boolean","pos":[959.9212409344489,53.70643766967732],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[104,117],"slot_index":0}],"title":"输入5","properties":{"value":false},"widgets_values":[false]},{"id":67,"type":"basic/boolean","pos":[1114.9212409344493,53.70643766967732],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[106,118],"slot_index":0}],"title":"输入6","properties":{"value":false},"widgets_values":[false]},{"id":68,"type":"basic/boolean","pos":[1271.9212409344486,53.70643766967732],"size":[140,30],"flags":{},"order":6,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[108,119],"slot_index":0}],"title":"输入7","properties":{"value":false},"widgets_values":[false]},{"id":101,"type":"logic/NOT","pos":[25.380211623535175,257],"size":{"0":140,"1":26},"flags":{},"order":24,"mode":0,"inputs":[{"name":"in","type":"boolean","link":171}],"outputs":[{"name":"out","type":"boolean","links":[181,182,183,184,185,186,187,188],"slot_index":0}],"properties":{}},{"id":60,"type":"basic/boolean","pos":[26,53],"size":[140,30],"flags":{},"order":7,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[78,80,82,84,86,88,90,92,128,129,130,131,132,134,135,136],"slot_index":0}],"title":"写入","properties":{"value":true},"widgets_values":[true]},{"id":58,"type":"basic/boolean","pos":[201,55],"size":[140,30],"flags":{},"order":8,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[94,110],"slot_index":0}],"title":"输入0","properties":{"value":true},"widgets_values":[true]},{"id":57,"type":"basic/boolean","pos":[25,131],"size":[140,30],"flags":{"collapsed":false},"order":9,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[70,71,72,73,74,75,76,77,171],"slot_index":0}],"title":"地址线","properties":{"value":true},"widgets_values":[true]},{"id":61,"type":"basic/boolean","pos":[25,455],"size":[140,30],"flags":{},"order":10,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[79,81,83,85,87,89,91,93,137,138,139,140,141,142,143,144],"slot_index":0}],"title":"读取","properties":{"value":true},"widgets_values":[true]},{"id":76,"type":"basic/watch","pos":[208,465],"size":{"0":140,"1":26},"flags":{},"order":58,"mode":0,"inputs":[{"name":"value","type":0,"link":145,"label":"true"}],"title":"输出0","properties":{}},{"id":116,"type":"basic/watch","pos":[220,1108],"size":{"0":140,"1":26},"flags":{},"order":42,"mode":0,"inputs":[{"name":"value","type":0,"link":204,"label":"true"}],"title":"输出0","properties":{}},{"id":117,"type":"basic/watch","pos":[370,1108],"size":{"0":140,"1":26},"flags":{},"order":43,"mode":0,"inputs":[{"name":"value","type":0,"link":205,"label":"false"}],"title":"输出1","properties":{}},{"id":118,"type":"basic/watch","pos":[519,1106],"size":{"0":140,"1":26},"flags":{},"order":44,"mode":0,"inputs":[{"name":"value","type":0,"link":206,"label":"true"}],"title":"输出2","properties":{}},{"id":119,"type":"basic/watch","pos":[669,1105],"size":{"0":140,"1":26},"flags":{},"order":45,"mode":0,"inputs":[{"name":"value","type":0,"link":207,"label":"false"}],"title":"输出3","properties":{}},{"id":120,"type":"basic/watch","pos":[819,1103],"size":{"0":140,"1":26},"flags":{},"order":46,"mode":0,"inputs":[{"name":"value","type":0,"link":208,"label":"true"}],"title":"输出4","properties":{}},{"id":121,"type":"basic/watch","pos":[969,1102],"size":{"0":140,"1":26},"flags":{},"order":47,"mode":0,"inputs":[{"name":"value","type":0,"link":209,"label":"false"}],"title":"输出5","properties":{}},{"id":122,"type":"basic/watch","pos":[1119,1101],"size":{"0":140,"1":26},"flags":{},"order":48,"mode":0,"inputs":[{"name":"value","type":0,"link":210,"label":"true"}],"title":"输出6","properties":{}},{"id":123,"type":"basic/watch","pos":[1272,1099],"size":{"0":140,"1":26},"flags":{},"order":49,"mode":0,"inputs":[{"name":"value","type":0,"link":211,"label":"false"}],"title":"输出7","properties":{}},{"id":102,"type":"custom/RAM","pos":{"0":719,"1":743,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":266},"flags":{},"order":33,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":193},{"name":"I1","type":"boolean","link":190},{"name":"I2","type":"boolean","link":191},{"name":"I3","type":"boolean","link":194},{"name":"I4","type":"boolean","link":195},{"name":"I5","type":"boolean","link":196},{"name":"I6","type":"boolean","link":197},{"name":"I7","type":"boolean","link":198},{"name":"S0","type":"boolean","link":201},{"name":"S1","type":"boolean","link":202},{"name":"S2","type":"boolean","link":203},{"name":"RI","type":"boolean","link":199},{"name":"RO","type":"boolean","link":200}],"outputs":[{"name":"O0","type":"boolean","links":[204],"slot_index":0},{"name":"O1","type":"boolean","links":[205],"slot_index":1},{"name":"O2","type":"boolean","links":[206],"slot_index":2},{"name":"O3","type":"boolean","links":[207],"slot_index":3},{"name":"O4","type":"boolean","links":[208],"slot_index":4},{"name":"O5","type":"boolean","links":[209],"slot_index":5},{"name":"O6","type":"boolean","links":[210],"slot_index":6},{"name":"O7","type":"boolean","links":[211],"slot_index":7}],"title":"随机访问存储器","properties":{"precision":1}},{"id":115,"type":"basic/boolean","pos":[64,1027],"size":[140,30],"flags":{},"order":19,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[200],"slot_index":0}],"title":"读取","properties":{"value":true},"widgets_values":[true]},{"id":103,"type":"basic/boolean","pos":[215.5842986444096,617.4010944372544],"size":[140,30],"flags":{},"order":13,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[193],"slot_index":0}],"title":"输入0","properties":{"value":true},"widgets_values":[true]},{"id":106,"type":"basic/boolean","pos":[519.5842986444096,617.4010944372544],"size":[140,30],"flags":{},"order":12,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[191],"slot_index":0}],"title":"输入2","properties":{"value":true},"widgets_values":[true]},{"id":108,"type":"basic/boolean","pos":[821.5842986444089,617.4010944372544],"size":[140,30],"flags":{},"order":15,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[195],"slot_index":0}],"title":"输入4","properties":{"value":true},"widgets_values":[true]},{"id":110,"type":"basic/boolean","pos":[1125.58429864441,617.4010944372544],"size":[140,30],"flags":{},"order":17,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[197],"slot_index":0}],"title":"输入6","properties":{"value":true},"widgets_values":[true]},{"id":105,"type":"basic/boolean","pos":[368.5842986444096,617.4010944372544],"size":[140,30],"flags":{},"order":11,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[190],"slot_index":0}],"title":"输入1","properties":{"value":false},"widgets_values":[false]},{"id":107,"type":"basic/boolean","pos":[669.5842986444086,617.4010944372544],"size":[140,30],"flags":{},"order":14,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[194],"slot_index":0}],"title":"输入3","properties":{"value":false},"widgets_values":[false]},{"id":109,"type":"basic/boolean","pos":[970.5842986444092,617.4010944372544],"size":[140,30],"flags":{},"order":16,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[196],"slot_index":0}],"title":"输入5","properties":{"value":false},"widgets_values":[false]},{"id":111,"type":"basic/boolean","pos":[1282.5842986444093,617.4010944372544],"size":[140,30],"flags":{},"order":18,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[198],"slot_index":0}],"title":"输入7","properties":{"value":false},"widgets_values":[false]},{"id":104,"type":"basic/boolean","pos":[55,679],"size":[140,30],"flags":{},"order":23,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[199],"slot_index":0}],"title":"写入","properties":{"value":true},"widgets_values":[true]},{"id":112,"type":"basic/boolean","pos":[59,783],"size":[140,30],"flags":{"collapsed":false},"order":22,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[201],"slot_index":0}],"title":"地址线S0","properties":{"value":false},"widgets_values":[false]},{"id":113,"type":"basic/boolean","pos":[60,850],"size":[140,30],"flags":{"collapsed":false},"order":21,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[202],"slot_index":0}],"title":"地址线S1","properties":{"value":false},"widgets_values":[false]},{"id":114,"type":"basic/boolean","pos":[59,917],"size":[140,30],"flags":{"collapsed":false},"order":20,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[203],"slot_index":0}],"title":"地址线S2","properties":{"value":false},"widgets_values":[false]}],"links":[[70,57,0,56,0,"boolean"],[71,57,0,55,0,"boolean"],[72,57,0,53,0,"boolean"],[73,57,0,52,0,"boolean"],[74,57,0,49,0,"boolean"],[75,57,0,50,0,"boolean"],[76,57,0,51,0,"boolean"],[77,57,0,54,0,"boolean"],[78,60,0,54,1,"boolean"],[79,61,0,54,2,"boolean"],[80,60,0,51,1,"boolean"],[81,61,0,51,2,"boolean"],[82,60,0,50,1,"boolean"],[83,61,0,50,2,"boolean"],[84,60,0,49,1,"boolean"],[85,61,0,49,2,"boolean"],[86,60,0,52,1,"boolean"],[87,61,0,52,2,"boolean"],[88,60,0,53,1,"boolean"],[89,61,0,53,2,"boolean"],[90,60,0,55,1,"boolean"],[91,61,0,55,2,"boolean"],[92,60,0,56,1,"boolean"],[93,61,0,56,2,"boolean"],[94,58,0,56,3,"boolean"],[96,62,0,55,3,"boolean"],[98,63,0,53,3,"boolean"],[100,64,0,52,3,"boolean"],[102,65,0,49,3,"boolean"],[104,66,0,50,3,"boolean"],[106,67,0,51,3,"boolean"],[108,68,0,54,3,"boolean"],[110,58,0,91,3,"boolean"],[111,62,0,90,3,"boolean"],[112,63,0,88,3,"boolean"],[114,65,0,84,3,"boolean"],[116,64,0,87,3,"boolean"],[117,66,0,85,3,"boolean"],[118,67,0,86,3,"boolean"],[119,68,0,89,3,"boolean"],[128,60,0,91,1,"boolean"],[129,60,0,90,1,"boolean"],[130,60,0,88,1,"boolean"],[131,60,0,87,1,"boolean"],[132,60,0,84,1,"boolean"],[134,60,0,85,1,"boolean"],[135,60,0,86,1,"boolean"],[136,60,0,89,1,"boolean"],[137,61,0,91,2,"boolean"],[138,61,0,90,2,"boolean"],[139,61,0,88,2,"boolean"],[140,61,0,87,2,"boolean"],[141,61,0,84,2,"boolean"],[142,61,0,85,2,"boolean"],[143,61,0,86,2,"boolean"],[144,61,0,89,2,"boolean"],[145,93,0,76,0,"boolean"],[146,94,0,77,0,"boolean"],[147,95,0,78,0,"boolean"],[148,96,0,79,0,"boolean"],[149,97,0,80,0,"boolean"],[150,98,0,81,0,"boolean"],[151,99,0,82,0,"boolean"],[152,100,0,83,0,"boolean"],[153,56,0,93,0,"boolean"],[154,91,0,93,1,"boolean"],[155,55,0,94,0,"boolean"],[156,90,0,94,1,"boolean"],[157,53,0,95,0,"boolean"],[158,88,0,95,1,"boolean"],[159,52,0,96,0,"boolean"],[160,87,0,96,1,"boolean"],[161,49,0,97,0,"boolean"],[162,84,0,97,1,"boolean"],[165,50,0,98,0,"boolean"],[166,85,0,98,1,"boolean"],[167,51,0,99,0,"boolean"],[169,54,0,100,0,"boolean"],[170,89,0,100,1,"boolean"],[171,57,0,101,0,"boolean"],[179,86,0,99,1,"boolean"],[181,101,0,91,0,"boolean"],[182,101,0,90,0,"boolean"],[183,101,0,88,0,"boolean"],[184,101,0,87,0,"boolean"],[185,101,0,84,0,"boolean"],[186,101,0,85,0,"boolean"],[187,101,0,86,0,"boolean"],[188,101,0,89,0,"boolean"],[190,105,0,102,1,"boolean"],[191,106,0,102,2,"boolean"],[193,103,0,102,0,"boolean"],[194,107,0,102,3,"boolean"],[195,108,0,102,4,"boolean"],[196,109,0,102,5,"boolean"],[197,110,0,102,6,"boolean"],[198,111,0,102,7,"boolean"],[199,104,0,102,11,"boolean"],[200,115,0,102,12,"boolean"],[201,112,0,102,8,"boolean"],[202,113,0,102,9,"boolean"],[203,114,0,102,10,"boolean"],[204,102,0,116,0,"boolean"],[205,102,1,117,0,"boolean"],[206,102,2,118,0,"boolean"],[207,102,3,119,0,"boolean"],[208,102,4,120,0,"boolean"],[209,102,5,121,0,"boolean"],[210,102,6,122,0,"boolean"],[211,102,7,123,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',CLKTriggerJSON='{"last_node_id":35,"last_link_id":57,"nodes":[{"id":30,"type":"logic/NOT","pos":[39,154],"size":{"0":140,"1":26},"flags":{},"order":5,"mode":0,"inputs":[{"name":"in","type":"boolean","link":44}],"outputs":[{"name":"out","type":"boolean","links":[49,50],"slot_index":0}],"properties":{}},{"id":20,"type":"logic/NOT","pos":[37,382],"size":{"0":140,"1":26},"flags":{},"order":4,"mode":0,"inputs":[{"name":"in","type":"boolean","link":29}],"outputs":[{"name":"out","type":"boolean","links":[52],"slot_index":0}],"properties":{}},{"id":27,"type":"logic/AND","pos":[264,189],"size":{"0":140,"1":46},"flags":{},"order":7,"mode":0,"inputs":[{"name":"a","type":"boolean","link":52},{"name":"b","type":"boolean","link":49}],"outputs":[{"name":"out","type":"boolean","links":[40],"slot_index":0}],"properties":{}},{"id":28,"type":"logic/AND","pos":[264,308],"size":{"0":140,"1":46},"flags":{},"order":8,"mode":0,"inputs":[{"name":"a","type":"boolean","link":50},{"name":"b","type":"boolean","link":51}],"outputs":[{"name":"out","type":"boolean","links":[41],"slot_index":0}],"properties":{}},{"id":25,"type":"custom/NOR","pos":{"0":431,"1":70,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":17,"mode":0,"inputs":[{"name":"A","type":"boolean","link":40},{"name":"B","type":"boolean","link":39}],"outputs":[{"name":"NOR","type":"boolean","links":[38,47],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":26,"type":"custom/NOR","pos":{"0":420,"1":373,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":18,"mode":0,"inputs":[{"name":"A","type":"boolean","link":38},{"name":"B","type":"boolean","link":41}],"outputs":[{"name":"NOR","type":"boolean","links":[39,43],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":19,"type":"logic/AND","pos":[591,277],"size":{"0":140,"1":46},"flags":{},"order":16,"mode":0,"inputs":[{"name":"a","type":"boolean","link":53},{"name":"b","type":"boolean","link":43}],"outputs":[{"name":"out","type":"boolean","links":[26],"slot_index":0}],"properties":{}},{"id":18,"type":"logic/AND","pos":[593,184],"size":{"0":140,"1":46},"flags":{},"order":15,"mode":0,"inputs":[{"name":"a","type":"boolean","link":47},{"name":"b","type":"boolean","link":46}],"outputs":[{"name":"out","type":"boolean","links":[25],"slot_index":0}],"properties":{}},{"id":14,"type":"custom/NOR","pos":{"0":747,"1":182,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":11,"mode":0,"inputs":[{"name":"A","type":"boolean","link":25},{"name":"B","type":"boolean","link":22}],"outputs":[{"name":"NOR","type":"boolean","links":[21,23],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":15,"type":"custom/NOR","pos":{"0":751,"1":280,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":12,"mode":0,"inputs":[{"name":"A","type":"boolean","link":21},{"name":"B","type":"boolean","link":26}],"outputs":[{"name":"NOR","type":"boolean","links":[22,24],"slot_index":0}],"title":"或非门","properties":{"precision":1}},{"id":16,"type":"basic/watch","pos":[811,88],"size":{"0":140,"1":26},"flags":{},"order":13,"mode":0,"inputs":[{"name":"value","type":0,"link":23,"label":"true"}],"title":"Q非","properties":{}},{"id":17,"type":"basic/watch","pos":[813,392],"size":{"0":140,"1":26},"flags":{},"order":14,"mode":0,"inputs":[{"name":"value","type":0,"link":24,"label":"false"}],"title":"Q","properties":{}},{"id":34,"type":"basic/watch","pos":[678,674],"size":{"0":140,"1":26},"flags":{},"order":10,"mode":0,"inputs":[{"name":"value","type":0,"link":57,"label":"true"}],"title":"Q非","properties":{}},{"id":35,"type":"basic/watch","pos":[678,565],"size":{"0":140,"1":26},"flags":{},"order":9,"mode":0,"inputs":[{"name":"value","type":0,"link":56,"label":"false"}],"title":"Q","properties":{}},{"id":31,"type":"custom/CLKTrigger","pos":{"0":431,"1":597,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":6,"mode":0,"inputs":[{"name":"D","type":"boolean","link":54},{"name":"clk","type":"boolean","link":55}],"outputs":[{"name":"Q","type":"boolean","links":[56],"slot_index":0},{"name":"Q非","type":"boolean","links":[57],"slot_index":1}],"title":"边沿触发器","properties":{"precision":1}},{"id":13,"type":"basic/boolean","pos":[37,296],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[29,51],"slot_index":0}],"title":"数据端","properties":{"value":false},"widgets_values":[false]},{"id":32,"type":"basic/boolean","pos":[182,546],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[54],"slot_index":0}],"title":"数据端","properties":{"value":false},"widgets_values":[false]},{"id":12,"type":"basic/boolean","pos":[36,72],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[44,46,53],"slot_index":0}],"title":"控制端","properties":{"value":false},"widgets_values":[false]},{"id":33,"type":"basic/boolean","pos":[177,670],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[55],"slot_index":0}],"title":"控制端","properties":{"value":false},"widgets_values":[false]}],"links":[[21,14,0,15,0,"boolean"],[22,15,0,14,1,"boolean"],[23,14,0,16,0,"boolean"],[24,15,0,17,0,"boolean"],[25,18,0,14,0,"boolean"],[26,19,0,15,1,"boolean"],[29,13,0,20,0,"boolean"],[38,25,0,26,0,"boolean"],[39,26,0,25,1,"boolean"],[40,27,0,25,0,"boolean"],[41,28,0,26,1,"boolean"],[43,26,0,19,1,"boolean"],[44,12,0,30,0,"boolean"],[46,12,0,18,1,"boolean"],[47,25,0,18,0,"boolean"],[49,30,0,27,1,"boolean"],[50,30,0,28,0,"boolean"],[51,13,0,28,1,"boolean"],[52,20,0,27,0,"boolean"],[53,12,0,19,0,"boolean"],[54,32,0,31,0,"boolean"],[55,33,0,31,1,"boolean"],[56,31,0,35,0,"boolean"],[57,31,1,34,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',frequencyDividerJSON='{"last_node_id":15,"last_link_id":17,"nodes":[{"id":14,"type":"tools/Through","pos":{"0":361,"1":174,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":2,"mode":0,"inputs":[{"name":"I","type":"boolean","link":15}],"outputs":[{"name":"O","type":"boolean","links":[16],"slot_index":0}],"title":"数据直传","properties":{"precision":1}},{"id":12,"type":"custom/CLKTrigger","pos":{"0":356,"1":355,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":1,"mode":0,"inputs":[{"name":"D","type":"boolean","link":16},{"name":"clk","type":"boolean","link":14}],"outputs":[{"name":"Q","type":"boolean","links":[17],"slot_index":0},{"name":"Q非","type":"boolean","links":[15],"slot_index":1}],"title":"边沿触发器","properties":{"precision":1}},{"id":13,"type":"tools/PulseSignal","pos":{"0":109,"1":371,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"clk","type":"boolean","links":[14],"slot_index":0}],"title":"脉冲信号","properties":{"precision":1}},{"id":15,"type":"basic/watch","pos":[606,364],"size":{"0":140,"1":26},"flags":{},"order":3,"mode":0,"inputs":[{"name":"value","type":0,"link":17,"label":"false"}],"properties":{}}],"links":[[14,13,0,12,1,"boolean"],[15,12,1,14,0,"boolean"],[16,14,0,12,0,"boolean"],[17,12,0,15,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',PCJSON='{"last_node_id":29,"last_link_id":33,"nodes":[{"id":17,"type":"custom/CLKTrigger","pos":{"0":624,"1":228,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":13,"mode":0,"inputs":[{"name":"D","type":"boolean","link":21},{"name":"clk","type":"boolean","link":26}],"outputs":[{"name":"Q","type":"boolean","links":[24],"slot_index":0},{"name":"Q非","type":"boolean","links":[20],"slot_index":1}],"title":"边沿触发器","properties":{"precision":1}},{"id":12,"type":"custom/CLKTrigger","pos":{"0":248,"1":228,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{},"order":9,"mode":0,"inputs":[{"name":"D","type":"boolean","link":16},{"name":"clk","type":"boolean","link":14}],"outputs":[{"name":"Q","type":"boolean","links":[22],"slot_index":0},{"name":"Q非","type":"boolean","links":[15,25],"slot_index":1}],"title":"边沿触发器","properties":{"precision":1}},{"id":16,"type":"custom/CLKTrigger","pos":{"0":439,"1":228,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":46},"flags":{"collapsed":false},"order":12,"mode":0,"inputs":[{"name":"D","type":"boolean","link":19},{"name":"clk","type":"boolean","link":25}],"outputs":[{"name":"Q","type":"boolean","links":[23],"slot_index":0},{"name":"Q非","type":"boolean","links":[18,26],"slot_index":1}],"title":"边沿触发器","properties":{"precision":1}},{"id":14,"type":"tools/Through","pos":{"0":249,"1":369,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":10,"mode":0,"inputs":[{"name":"I","type":"boolean","link":15}],"outputs":[{"name":"O","type":"boolean","links":[16],"slot_index":0}],"title":"数据直传","properties":{"precision":1}},{"id":18,"type":"tools/Through","pos":{"0":440,"1":369,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":14,"mode":0,"inputs":[{"name":"I","type":"boolean","link":18}],"outputs":[{"name":"O","type":"boolean","links":[19],"slot_index":0}],"title":"数据直传","properties":{"precision":1}},{"id":19,"type":"tools/Through","pos":{"0":627,"1":369,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":15,"mode":0,"inputs":[{"name":"I","type":"boolean","link":20}],"outputs":[{"name":"O","type":"boolean","links":[21],"slot_index":0}],"title":"数据直传","properties":{"precision":1}},{"id":13,"type":"tools/PulseSignal","pos":{"0":44,"1":263,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"clk","type":"boolean","links":[14,28],"slot_index":0}],"title":"脉冲信号","properties":{"precision":1}},{"id":22,"type":"logic/NOT","pos":[44,329],"size":{"0":140,"1":26},"flags":{},"order":2,"mode":0,"inputs":[{"name":"in","type":"boolean","link":28}],"outputs":[{"name":"out","type":"boolean","links":[27],"slot_index":0}],"properties":{}},{"id":23,"type":"basic/watch","pos":[216,75],"size":{"0":140,"1":26},"flags":{},"order":4,"mode":0,"inputs":[{"name":"value","type":0,"link":27,"label":"false"}],"title":"Q0","properties":{}},{"id":15,"type":"basic/watch","pos":[409,75],"size":{"0":140,"1":26},"flags":{},"order":11,"mode":0,"inputs":[{"name":"value","type":0,"link":22,"label":"true"}],"title":"Q1","properties":{}},{"id":21,"type":"basic/watch","pos":[792,75],"size":{"0":140,"1":26},"flags":{},"order":17,"mode":0,"inputs":[{"name":"value","type":0,"link":24,"label":"true"}],"title":"Q3","properties":{}},{"id":20,"type":"basic/watch","pos":[606,75],"size":{"0":140,"1":26},"flags":{},"order":16,"mode":0,"inputs":[{"name":"value","type":0,"link":23,"label":"false"}],"title":"Q2","properties":{}},{"id":29,"type":"basic/watch","pos":[193,508],"size":{"0":140,"1":26},"flags":{},"order":5,"mode":0,"inputs":[{"name":"value","type":0,"link":30,"label":"true"}],"title":"Q0","properties":{}},{"id":26,"type":"basic/watch","pos":[391,503],"size":{"0":140,"1":26},"flags":{},"order":6,"mode":0,"inputs":[{"name":"value","type":0,"link":31,"label":"true"}],"title":"Q1","properties":{}},{"id":27,"type":"basic/watch","pos":[596,504],"size":{"0":140,"1":26},"flags":{},"order":7,"mode":0,"inputs":[{"name":"value","type":0,"link":32,"label":"false"}],"title":"Q2","properties":{}},{"id":28,"type":"basic/watch","pos":[790,504],"size":{"0":140,"1":26},"flags":{},"order":8,"mode":0,"inputs":[{"name":"value","type":0,"link":33,"label":"false"}],"title":"Q3","properties":{}},{"id":25,"type":"tools/PulseSignal","pos":{"0":193,"1":655,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":26},"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[{"name":"clk","type":"boolean","links":[29],"slot_index":0}],"title":"脉冲信号","properties":{"precision":1}},{"id":24,"type":"custom/PC","pos":{"0":396,"1":641,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":3,"mode":0,"inputs":[{"name":"clk","type":"boolean","link":29}],"outputs":[{"name":"Q0","type":"boolean","links":[30],"slot_index":0},{"name":"Q1","type":"boolean","links":[31],"slot_index":1},{"name":"Q2","type":"boolean","links":[32],"slot_index":2},{"name":"Q3","type":"boolean","links":[33],"slot_index":3}],"title":"计数器","properties":{"precision":1}}],"links":[[14,13,0,12,1,"boolean"],[15,12,1,14,0,"boolean"],[16,14,0,12,0,"boolean"],[18,16,1,18,0,"boolean"],[19,18,0,16,0,"boolean"],[20,17,1,19,0,"boolean"],[21,19,0,17,0,"boolean"],[22,12,0,15,0,"boolean"],[23,16,0,20,0,"boolean"],[24,17,0,21,0,"boolean"],[25,12,1,16,1,"boolean"],[26,16,1,17,1,"boolean"],[27,22,0,23,0,"boolean"],[28,13,0,22,0,"boolean"],[29,25,0,24,0,"boolean"],[30,24,0,29,0,"boolean"],[31,24,1,26,0,"boolean"],[32,24,2,27,0,"boolean"],[33,24,3,28,0,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',computerJSON='{"last_node_id":159,"last_link_id":337,"nodes":[{"id":131,"type":"custom/Cache","pos":{"0":988.3814697265625,"1":511.13934326171875,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":206},"flags":{},"order":24,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":285},{"name":"I1","type":"boolean","link":286},{"name":"I2","type":"boolean","link":287},{"name":"I3","type":"boolean","link":288,"slot_index":3},{"name":"I4","type":"boolean","link":289,"slot_index":4},{"name":"I5","type":"boolean","link":290},{"name":"I6","type":"boolean","link":291},{"name":"I7","type":"boolean","link":292},{"name":"AI","type":"boolean","link":271},{"name":"AO","type":"boolean","link":270}],"outputs":[{"name":"O0","type":"boolean","links":[303],"slot_index":0},{"name":"O1","type":"boolean","links":[304],"slot_index":1},{"name":"O2","type":"boolean","links":[305],"slot_index":2},{"name":"O3","type":"boolean","links":[306],"slot_index":3},{"name":"O4","type":"boolean","links":[307],"slot_index":4},{"name":"O5","type":"boolean","links":[308],"slot_index":5},{"name":"O6","type":"boolean","links":[309],"slot_index":6},{"name":"O7","type":"boolean","links":[310],"slot_index":7}],"title":"寄存器","properties":{"precision":1}},{"id":132,"type":"custom/Cache","pos":{"0":988.3814697265625,"1":257.1392822265625,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":206},"flags":{},"order":23,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":277},{"name":"I1","type":"boolean","link":278},{"name":"I2","type":"boolean","link":279},{"name":"I3","type":"boolean","link":280},{"name":"I4","type":"boolean","link":281},{"name":"I5","type":"boolean","link":282},{"name":"I6","type":"boolean","link":283},{"name":"I7","type":"boolean","link":284},{"name":"AI","type":"boolean","link":267},{"name":"AO","type":"boolean","link":268}],"outputs":[{"name":"O0","type":"boolean","links":[302],"slot_index":0},{"name":"O1","type":"boolean","links":[294],"slot_index":1},{"name":"O2","type":"boolean","links":[295],"slot_index":2},{"name":"O3","type":"boolean","links":[296],"slot_index":3},{"name":"O4","type":"boolean","links":[297],"slot_index":4},{"name":"O5","type":"boolean","links":[299],"slot_index":5},{"name":"O6","type":"boolean","links":[300],"slot_index":6},{"name":"O7","type":"boolean","links":[301],"slot_index":7}],"title":"寄存器","properties":{"precision":1}},{"id":128,"type":"custom/RAM","pos":{"0":703.3822631835938,"1":295.13934326171875,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":266},"flags":{},"order":22,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":312},{"name":"I1","type":"boolean","link":313},{"name":"I2","type":"boolean","link":314},{"name":"I3","type":"boolean","link":315},{"name":"I4","type":"boolean","link":316},{"name":"I5","type":"boolean","link":317},{"name":"I6","type":"boolean","link":318},{"name":"I7","type":"boolean","link":319},{"name":"S0","type":"boolean","link":264},{"name":"S1","type":"boolean","link":265},{"name":"S2","type":"boolean","link":null},{"name":"RI","type":"boolean","link":311},{"name":"RO","type":"boolean","link":275}],"outputs":[{"name":"O0","type":"boolean","links":[277,285],"slot_index":0},{"name":"O1","type":"boolean","links":[278,286],"slot_index":1},{"name":"O2","type":"boolean","links":[279,287],"slot_index":2},{"name":"O3","type":"boolean","links":[280,288],"slot_index":3},{"name":"O4","type":"boolean","links":[281,289],"slot_index":4},{"name":"O5","type":"boolean","links":[282,290],"slot_index":5},{"name":"O6","type":"boolean","links":[283,291],"slot_index":6},{"name":"O7","type":"boolean","links":[284,292],"slot_index":7}],"title":"随机访问存储器","properties":{"precision":1}},{"id":134,"type":"basic/boolean","pos":[291.38212907421865,-60.86027400488278],"size":[140,30],"flags":{},"order":0,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[313],"slot_index":0}],"title":"I1","properties":{"value":true},"widgets_values":[true]},{"id":133,"type":"basic/boolean","pos":[291.38212907421865,-124.86027400488274],"size":[140,30],"flags":{},"order":1,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[312],"slot_index":0}],"title":"I0","properties":{"value":false},"widgets_values":[false]},{"id":141,"type":"basic/boolean","pos":[295.38212907421865,329.1397259951172],"size":[140,30],"flags":{},"order":2,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[319],"slot_index":0}],"title":"I7","properties":{"value":false},"widgets_values":[false]},{"id":139,"type":"basic/boolean","pos":[295.38212907421865,264.1397259951174],"size":[140,30],"flags":{},"order":3,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[318],"slot_index":0}],"title":"I6","properties":{"value":false},"widgets_values":[false]},{"id":138,"type":"basic/boolean","pos":[294.38212907421865,199.13972599511723],"size":[140,30],"flags":{},"order":4,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[317],"slot_index":0}],"title":"I5","properties":{"value":false},"widgets_values":[false]},{"id":137,"type":"basic/boolean","pos":[292.38212907421865,135.13972599511712],"size":[140,30],"flags":{},"order":5,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[316],"slot_index":0}],"title":"I4","properties":{"value":true},"widgets_values":[true]},{"id":136,"type":"basic/boolean","pos":[291.38212907421865,70.1397259951171],"size":[140,30],"flags":{},"order":6,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[315],"slot_index":0}],"title":"I3","properties":{"value":true},"widgets_values":[true]},{"id":135,"type":"basic/boolean","pos":[289.38212907421865,6.139725995117175],"size":[140,30],"flags":{},"order":7,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[314],"slot_index":0}],"title":"I2","properties":{"value":false},"widgets_values":[false]},{"id":126,"type":"custom/PC","pos":{"0":520.3822631835938,"1":438.139404296875,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":21,"mode":0,"inputs":[{"name":"clk","type":"boolean","link":276}],"outputs":[{"name":"Q0","type":"boolean","links":[264],"slot_index":0},{"name":"Q1","type":"boolean","links":[265],"slot_index":1},{"name":"Q2","type":"boolean","links":null},{"name":"Q3","type":"boolean","links":null}],"title":"计数器","properties":{"precision":1}},{"id":130,"type":"custom/ALU","pos":{"0":1192.381591796875,"1":391.139404296875,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":346},"flags":{},"order":25,"mode":0,"inputs":[{"name":"A0","type":"boolean","link":302},{"name":"A1","type":"boolean","link":294},{"name":"A2","type":"boolean","link":295},{"name":"A3","type":"boolean","link":296},{"name":"A4","type":"boolean","link":297},{"name":"A5","type":"boolean","link":299},{"name":"A6","type":"boolean","link":300},{"name":"A7","type":"boolean","link":301},{"name":"B0","type":"boolean","link":303},{"name":"B1","type":"boolean","link":304},{"name":"B2","type":"boolean","link":305},{"name":"B3","type":"boolean","link":306},{"name":"B4","type":"boolean","link":307},{"name":"B5","type":"boolean","link":308},{"name":"B6","type":"boolean","link":309},{"name":"B7","type":"boolean","link":310},{"name":"LU","type":"boolean","link":269}],"outputs":[{"name":"O0","type":"boolean","links":[320],"slot_index":0},{"name":"O1","type":"boolean","links":[321],"slot_index":1},{"name":"O2","type":"boolean","links":[322],"slot_index":2},{"name":"O3","type":"boolean","links":[323],"slot_index":3},{"name":"O4","type":"boolean","links":[324],"slot_index":4},{"name":"O5","type":"boolean","links":[325],"slot_index":5},{"name":"O6","type":"boolean","links":[326],"slot_index":6},{"name":"O7","type":"boolean","links":[327],"slot_index":7}],"title":"8位加法器","properties":{"precision":1}},{"id":142,"type":"basic/watch","pos":[1492.3821290742173,314.13972599511715],"size":{"0":140,"1":26},"flags":{},"order":26,"mode":0,"inputs":[{"name":"value","type":0,"link":320,"label":"false"}],"title":"O0","properties":{}},{"id":143,"type":"basic/watch","pos":[1492.3821290742173,383.13972599511743],"size":{"0":140,"1":26},"flags":{},"order":27,"mode":0,"inputs":[{"name":"value","type":0,"link":321,"label":"false"}],"title":"O1","properties":{}},{"id":144,"type":"basic/watch","pos":[1492.3821290742173,453.13972599511754],"size":{"0":140,"1":26},"flags":{},"order":28,"mode":0,"inputs":[{"name":"value","type":0,"link":322,"label":"false"}],"title":"O2","properties":{}},{"id":145,"type":"basic/watch","pos":[1492.3821290742173,525.1397259951175],"size":{"0":140,"1":26},"flags":{},"order":29,"mode":0,"inputs":[{"name":"value","type":0,"link":323,"label":"false"}],"title":"O3","properties":{}},{"id":146,"type":"basic/watch","pos":[1492.3821290742173,595.1397259951174],"size":{"0":140,"1":26},"flags":{},"order":30,"mode":0,"inputs":[{"name":"value","type":0,"link":324,"label":"false"}],"title":"O4","properties":{}},{"id":149,"type":"basic/watch","pos":[1492.3821290742173,800.1397259951157],"size":{"0":140,"1":26},"flags":{},"order":33,"mode":0,"inputs":[{"name":"value","type":0,"link":327,"label":"false"}],"title":"O7","properties":{}},{"id":147,"type":"basic/watch","pos":[1492.3821290742173,662.139725995117],"size":{"0":140,"1":26},"flags":{},"order":31,"mode":0,"inputs":[{"name":"value","type":0,"link":325,"label":"false"}],"title":"O5","properties":{}},{"id":148,"type":"basic/watch","pos":[1492.3821290742173,732.1397259951161],"size":{"0":140,"1":26},"flags":{},"order":32,"mode":0,"inputs":[{"name":"value","type":0,"link":326,"label":"false"}],"title":"O6","properties":{}},{"id":129,"type":"custom/RAM","pos":{"0":333.3819274902344,"1":642.139404296875,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":266},"flags":{},"order":20,"mode":0,"inputs":[{"name":"I0","type":"boolean","link":328},{"name":"I1","type":"boolean","link":329},{"name":"I2","type":"boolean","link":330},{"name":"I3","type":"boolean","link":331},{"name":"I4","type":"boolean","link":332},{"name":"I5","type":"boolean","link":333},{"name":"I6","type":"boolean","link":334},{"name":"I7","type":"boolean","link":335},{"name":"S0","type":"boolean","link":260},{"name":"S1","type":"boolean","link":261},{"name":"S2","type":"boolean","link":262},{"name":"RI","type":"boolean","link":336},{"name":"RO","type":"boolean","link":337}],"outputs":[{"name":"O0","type":"boolean","links":[276],"slot_index":0},{"name":"O1","type":"boolean","links":[275],"slot_index":1},{"name":"O2","type":"boolean","links":[267],"slot_index":2},{"name":"O3","type":"boolean","links":[268],"slot_index":3},{"name":"O4","type":"boolean","links":[269],"slot_index":4},{"name":"O5","type":"boolean","links":[270],"slot_index":5},{"name":"O6","type":"boolean","links":[271],"slot_index":6},{"name":"O7","type":"boolean","links":null}],"title":"随机访问存储器","properties":{"precision":1}},{"id":127,"type":"custom/PC","pos":{"0":134.3820343017578,"1":803.1392822265625,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"size":{"0":140,"1":86},"flags":{},"order":8,"mode":0,"inputs":[{"name":"clk","type":"boolean","link":null,"slot_index":0}],"outputs":[{"name":"Q0","type":"boolean","links":[260],"slot_index":0},{"name":"Q1","type":"boolean","links":[261],"slot_index":1},{"name":"Q2","type":"boolean","links":[262],"slot_index":2},{"name":"Q3","type":"boolean","links":null}],"title":"计数器","properties":{"precision":1}},{"id":157,"type":"basic/boolean","pos":[-62.61787092578123,1070.1397259951145],"size":[140,30],"flags":{},"order":9,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[335],"slot_index":0}],"title":"I7","properties":{"value":true},"widgets_values":[true]},{"id":156,"type":"basic/boolean","pos":[-62.61787092578123,1002.1397259951146],"size":[140,30],"flags":{},"order":10,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[334],"slot_index":0}],"title":"I6","properties":{"value":false},"widgets_values":[false]},{"id":155,"type":"basic/boolean","pos":[-60.61787092578123,936.1397259951148],"size":[140,30],"flags":{},"order":11,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[333],"slot_index":0}],"title":"I5","properties":{"value":true},"widgets_values":[true]},{"id":154,"type":"basic/boolean","pos":[-60.61787092578123,869.1397259951153],"size":[140,30],"flags":{},"order":12,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[332],"slot_index":0}],"title":"I4","properties":{"value":true},"widgets_values":[true]},{"id":153,"type":"basic/boolean","pos":[-59.61787092578122,800.1397259951157],"size":[140,30],"flags":{},"order":13,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[331],"slot_index":0}],"title":"I3","properties":{"value":true},"widgets_values":[true]},{"id":152,"type":"basic/boolean","pos":[-57.61787092578124,734.1397259951161],"size":[140,30],"flags":{},"order":14,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[330],"slot_index":0}],"title":"I2","properties":{"value":false},"widgets_values":[false]},{"id":151,"type":"basic/boolean","pos":[-56.61787092578125,667.1397259951169],"size":[140,30],"flags":{},"order":15,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[329],"slot_index":0}],"title":"I1","properties":{"value":true},"widgets_values":[true]},{"id":150,"type":"basic/boolean","pos":[-56.61787092578125,600.1397259951174],"size":[140,30],"flags":{},"order":16,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[328],"slot_index":0}],"title":"I0","properties":{"value":false},"widgets_values":[false]},{"id":140,"type":"basic/boolean","pos":[228.3821290742186,515.1397259951175],"size":[140,30],"flags":{},"order":17,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[311],"slot_index":0}],"title":"Control","properties":{"value":true},"widgets_values":[true]},{"id":158,"type":"basic/boolean","pos":[124.38212907421865,971.1397259951148],"size":[140,30],"flags":{},"order":18,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[336],"slot_index":0}],"title":"Control","properties":{"value":true},"widgets_values":[true]},{"id":159,"type":"basic/boolean","pos":[123.38212907421865,1036.1397259951145],"size":[140,30],"flags":{},"order":19,"mode":0,"outputs":[{"name":"bool","type":"boolean","links":[337],"slot_index":0}],"title":"Control","properties":{"value":true},"widgets_values":[true]}],"links":[[260,127,0,129,8,"boolean"],[261,127,1,129,9,"boolean"],[262,127,2,129,10,"boolean"],[264,126,0,128,8,"boolean"],[265,126,1,128,9,"boolean"],[267,129,2,132,8,"boolean"],[268,129,3,132,9,"boolean"],[269,129,4,130,16,"boolean"],[270,129,5,131,9,"boolean"],[271,129,6,131,8,"boolean"],[275,129,1,128,12,"boolean"],[276,129,0,126,0,"boolean"],[277,128,0,132,0,"boolean"],[278,128,1,132,1,"boolean"],[279,128,2,132,2,"boolean"],[280,128,3,132,3,"boolean"],[281,128,4,132,4,"boolean"],[282,128,5,132,5,"boolean"],[283,128,6,132,6,"boolean"],[284,128,7,132,7,"boolean"],[285,128,0,131,0,"boolean"],[286,128,1,131,1,"boolean"],[287,128,2,131,2,"boolean"],[288,128,3,131,3,"boolean"],[289,128,4,131,4,"boolean"],[290,128,5,131,5,"boolean"],[291,128,6,131,6,"boolean"],[292,128,7,131,7,"boolean"],[294,132,1,130,1,"boolean"],[295,132,2,130,2,"boolean"],[296,132,3,130,3,"boolean"],[297,132,4,130,4,"boolean"],[299,132,5,130,5,"boolean"],[300,132,6,130,6,"boolean"],[301,132,7,130,7,"boolean"],[302,132,0,130,0,"boolean"],[303,131,0,130,8,"boolean"],[304,131,1,130,9,"boolean"],[305,131,2,130,10,"boolean"],[306,131,3,130,11,"boolean"],[307,131,4,130,12,"boolean"],[308,131,5,130,13,"boolean"],[309,131,6,130,14,"boolean"],[310,131,7,130,15,"boolean"],[311,140,0,128,11,"boolean"],[312,133,0,128,0,"boolean"],[313,134,0,128,1,"boolean"],[314,135,0,128,2,"boolean"],[315,136,0,128,3,"boolean"],[316,137,0,128,4,"boolean"],[317,138,0,128,5,"boolean"],[318,139,0,128,6,"boolean"],[319,141,0,128,7,"boolean"],[320,130,0,142,0,"boolean"],[321,130,1,143,0,"boolean"],[322,130,2,144,0,"boolean"],[323,130,3,145,0,"boolean"],[324,130,4,146,0,"boolean"],[325,130,5,147,0,"boolean"],[326,130,6,148,0,"boolean"],[327,130,7,149,0,"boolean"],[328,150,0,129,0,"boolean"],[329,151,0,129,1,"boolean"],[330,152,0,129,2,"boolean"],[331,153,0,129,3,"boolean"],[332,154,0,129,4,"boolean"],[333,155,0,129,5,"boolean"],[334,156,0,129,6,"boolean"],[335,157,0,129,7,"boolean"],[336,158,0,129,11,"boolean"],[337,159,0,129,12,"boolean"]],"groups":[],"config":{},"extra":{},"version":0.4}',ConstConfigJSON=Object.freeze(Object.defineProperty({__proto__:null,ALUJSON,CLKTriggerJSON,CacheJSON,PCJSON,RAMJSON,RWMemoryJSON,addJSON,computerJSON,frequencyDividerJSON,latchJSON,triggerJSON,xorJSON},Symbol.toStringTag,{value:"Module"}));class XOR extends litegraph.LGraphNode{constructor(){super("异或门"),this.addInput("A","boolean"),this.addInput("B","boolean"),this.addOutput("XOR","boolean"),this.properties={precision:1}}onExecute(){let o=this.getInputData(0);o===void 0&&(o=0);let s=this.getInputData(1);s===void 0&&(s=0),this.setOutputData(0,!!(o^s))}}class NOR extends litegraph.LGraphNode{constructor(){super("或非门"),this.addInput("A","boolean"),this.addInput("B","boolean"),this.addOutput("NOR","boolean"),this.properties={precision:1}}onExecute(){let o=this.getInputData(0);o===void 0&&(o=0);let s=this.getInputData(1);s===void 0&&(s=0),this.setOutputData(0,!(o|s))}}class ADD extends litegraph.LGraphNode{constructor(){super("全加器"),this.addInput("A","boolean"),this.addInput("B","boolean"),this.addInput("C_in","boolean"),this.addOutput("Y","boolean"),this.addOutput("C_out","boolean"),this.properties={precision:1}}onExecute(){let o=this.getInputData(0);o===void 0&&(o=0);let s=this.getInputData(1);s===void 0&&(s=0);let a=this.getInputData(2);a===void 0&&(a=0),this.setOutputData(0,!!((o+s+a)%2)),this.setOutputData(1,!!(o+s+a>>1))}}class ALU extends litegraph.LGraphNode{constructor(){super("8位加法器"),this.addInput("A0","boolean"),this.addInput("A1","boolean"),this.addInput("A2","boolean"),this.addInput("A3","boolean"),this.addInput("A4","boolean"),this.addInput("A5","boolean"),this.addInput("A6","boolean"),this.addInput("A7","boolean"),this.addInput("B0","boolean"),this.addInput("B1","boolean"),this.addInput("B2","boolean"),this.addInput("B3","boolean"),this.addInput("B4","boolean"),this.addInput("B5","boolean"),this.addInput("B6","boolean"),this.addInput("B7","boolean"),this.addInput("LU","boolean"),this.addOutput("O0","boolean"),this.addOutput("O1","boolean"),this.addOutput("O2","boolean"),this.addOutput("O3","boolean"),this.addOutput("O4","boolean"),this.addOutput("O5","boolean"),this.addOutput("O6","boolean"),this.addOutput("O7","boolean"),this.properties={precision:1}}onExecute(){let o=this.getInputData(0);o===void 0&&(o=0);let s=this.getInputData(1);s===void 0&&(s=0);let a=this.getInputData(2);a===void 0&&(a=0);let h=this.getInputData(3);h===void 0&&(h=0);let d=this.getInputData(4);d===void 0&&(d=0);let c=this.getInputData(5);c===void 0&&(c=0);let g=this.getInputData(6);g===void 0&&(g=0);let b=this.getInputData(7);b===void 0&&(b=0);let $=this.getInputData(8);$===void 0&&($=0);let et=this.getInputData(9);et===void 0&&(et=0);let st=this.getInputData(10);st===void 0&&(st=0);let j=this.getInputData(11);j===void 0&&(j=0);let tt=this.getInputData(12);tt===void 0&&(tt=0);let nt=this.getInputData(13);nt===void 0&&(nt=0);let lt=this.getInputData(14);lt===void 0&&(lt=0);let ct=this.getInputData(15);ct===void 0&&(ct=0);let ot=this.getInputData(16);ot===void 0&&(ot=0);let _e=0,_=0,at=0,it=0,pt=0,mt=0,_t=0,Et=0;if(ot){const Tt=b*128+g*64+c*32+d*16+h*8+a*4+s*2+o,Ot=ct*2**7+lt*2**6+nt*2**5+tt*2**4+j*2**3+st*2**2+et*2**1+$,Ct=Tt+Ot;_e=Ct%2,_=(Ct>>1)%2,at=(Ct>>2)%2,it=(Ct>>3)%2,pt=(Ct>>4)%2,mt=(Ct>>5)%2,_t=(Ct>>6)%2,Et=(Ct>>7)%2}this.setOutputData(0,!!_e),this.setOutputData(1,!!_),this.setOutputData(2,!!at),this.setOutputData(3,!!it),this.setOutputData(4,!!pt),this.setOutputData(5,!!mt),this.setOutputData(6,!!_t),this.setOutputData(7,!!Et)}}class Latch extends litegraph.LGraphNode{constructor(){super("锁存器");jt(this,"prevData",0);this.addInput("EN","boolean"),this.addInput("DI","boolean"),this.addOutput("DO","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0);let a=this.getInputData(1);a===void 0&&(a=0);let h=this.prevData;s&&(h=a,this.prevData=a),this.setOutputData(0,h)}}class RWMemory extends litegraph.LGraphNode{constructor(){super("读写存储器");jt(this,"prevData",0);this.addInput("Addr","boolean"),this.addInput("ENI","boolean"),this.addInput("ENO","boolean"),this.addInput("DI","boolean"),this.addOutput("DO","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0);let a=this.getInputData(1);a===void 0&&(a=0);let h=this.getInputData(2);h===void 0&&(h=0);let d=this.getInputData(3);d===void 0&&(d=0);let c=this.prevData;s&&a&&(c=d,this.prevData=d),this.setOutputData(0,s&&h?c:!1)}}class Cache extends litegraph.LGraphNode{constructor(){super("寄存器");jt(this,"memory",0);this.addInput("I0","boolean"),this.addInput("I1","boolean"),this.addInput("I2","boolean"),this.addInput("I3","boolean"),this.addInput("I4","boolean"),this.addInput("I5","boolean"),this.addInput("I6","boolean"),this.addInput("I7","boolean"),this.addInput("AI","boolean"),this.addInput("AO","boolean"),this.addOutput("O0","boolean"),this.addOutput("O1","boolean"),this.addOutput("O2","boolean"),this.addOutput("O3","boolean"),this.addOutput("O4","boolean"),this.addOutput("O5","boolean"),this.addOutput("O6","boolean"),this.addOutput("O7","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0);let a=this.getInputData(1);a===void 0&&(a=0);let h=this.getInputData(2);h===void 0&&(h=0);let d=this.getInputData(3);d===void 0&&(d=0);let c=this.getInputData(4);c===void 0&&(c=0);let g=this.getInputData(5);g===void 0&&(g=0);let b=this.getInputData(6);b===void 0&&(b=0);let $=this.getInputData(7);$===void 0&&($=0);let et=this.getInputData(8);et===void 0&&(et=0);let st=this.getInputData(9);st===void 0&&(st=0);let j=0,tt=0,nt=0,lt=0,ct=0,ot=0,_e=0,_=0;if(et){const at=$*128+b*64+g*32+c*16+d*8+h*4+a*2+s;this.memory=at}if(st){const at=this.memory;j=at%2,tt=(at>>1)%2,nt=(at>>2)%2,lt=(at>>3)%2,ct=(at>>4)%2,ot=(at>>5)%2,_e=(at>>6)%2,_=(at>>7)%2}this.setOutputData(0,!!j),this.setOutputData(1,!!tt),this.setOutputData(2,!!nt),this.setOutputData(3,!!lt),this.setOutputData(4,!!ct),this.setOutputData(5,!!ot),this.setOutputData(6,!!_e),this.setOutputData(7,!!_)}}class RAM extends litegraph.LGraphNode{constructor(){super("随机访问存储器");jt(this,"memArr",[0,0,0,0,0,0,0,0]);this.addInput("I0","boolean"),this.addInput("I1","boolean"),this.addInput("I2","boolean"),this.addInput("I3","boolean"),this.addInput("I4","boolean"),this.addInput("I5","boolean"),this.addInput("I6","boolean"),this.addInput("I7","boolean"),this.addInput("S0","boolean"),this.addInput("S1","boolean"),this.addInput("S2","boolean"),this.addInput("RI","boolean"),this.addInput("RO","boolean"),this.addOutput("O0","boolean"),this.addOutput("O1","boolean"),this.addOutput("O2","boolean"),this.addOutput("O3","boolean"),this.addOutput("O4","boolean"),this.addOutput("O5","boolean"),this.addOutput("O6","boolean"),this.addOutput("O7","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0);let a=this.getInputData(1);a===void 0&&(a=0);let h=this.getInputData(2);h===void 0&&(h=0);let d=this.getInputData(3);d===void 0&&(d=0);let c=this.getInputData(4);c===void 0&&(c=0);let g=this.getInputData(5);g===void 0&&(g=0);let b=this.getInputData(6);b===void 0&&(b=0);let $=this.getInputData(7);$===void 0&&($=0);let et=this.getInputData(8);et===void 0&&(et=0);let st=this.getInputData(9);st===void 0&&(st=0);let j=this.getInputData(10);j===void 0&&(j=0);let tt=this.getInputData(11);tt===void 0&&(tt=0);let nt=this.getInputData(12);nt===void 0&&(nt=0);let lt=0,ct=0,ot=0,_e=0,_=0,at=0,it=0,pt=0;const mt=j*2**2+st*2**1+et;if(tt){const _t=$*128+b*64+g*32+c*16+d*8+h*4+a*2+s;this.memArr[mt]=_t}if(nt){const _t=this.memArr[mt];lt=_t%2,ct=(_t>>1)%2,ot=(_t>>2)%2,_e=(_t>>3)%2,_=(_t>>4)%2,at=(_t>>5)%2,it=(_t>>6)%2,pt=(_t>>7)%2}this.setOutputData(0,!!lt),this.setOutputData(1,!!ct),this.setOutputData(2,!!ot),this.setOutputData(3,!!_e),this.setOutputData(4,!!_),this.setOutputData(5,!!at),this.setOutputData(6,!!it),this.setOutputData(7,!!pt)}}class CLKTrigger extends litegraph.LGraphNode{constructor(){super("边沿触发器");jt(this,"prevClk",0);jt(this,"prevQ",0);this.addInput("D","boolean"),this.addInput("clk","boolean"),this.addOutput("Q","boolean"),this.addOutput("Q非","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0);let a=this.getInputData(1);a===void 0&&(a=0);let h=this.prevQ;!this.prevClk&&a&&(h=s,this.prevQ=h),this.prevClk=a,this.setOutputData(0,!!h),this.setOutputData(1,!h)}}class PulseSignal extends litegraph.LGraphNode{constructor(){super("脉冲信号");jt(this,"time",Date.now());jt(this,"prevClk",!1);this.addOutput("clk","boolean"),this.properties={precision:1}}onExecute(){let s=this.prevClk;Date.now()-this.time>1e3&&(this.time=Date.now(),this.prevClk=!this.prevClk,s=this.prevClk),this.setOutputData(0,!!s)}}class Through extends litegraph.LGraphNode{constructor(){super("数据直传");jt(this,"time",Date.now());jt(this,"prevClk",!1);this.addInput("I","boolean"),this.addOutput("O","boolean"),this.properties={precision:1}}onExecute(){let s=this.getInputData(0);s===void 0&&(s=0),this.setOutputData(0,!!s)}}class PC extends litegraph.LGraphNode{constructor(){super("计数器");jt(this,"time",Date.now());jt(this,"prevT",0);this.addInput("clk","boolean"),this.addOutput("Q0","boolean"),this.addOutput("Q1","boolean"),this.addOutput("Q2","boolean"),this.addOutput("Q3","boolean"),this.properties={precision:1}}onExecute(){let s=this.prevT;Date.now()-this.time>1e3&&(this.time=Date.now(),this.prevT=(this.prevT+1)%16,s=this.prevT);const a=s,h=a%2,d=(a>>1)%2,c=(a>>2)%2,g=(a>>3)%2;this.setOutputData(0,!!h),this.setOutputData(1,!!d),this.setOutputData(2,!!c),this.setOutputData(3,!!g)}}function initCustomNode(){litegraph.LiteGraph.registerNodeType("custom/XOR",XOR),litegraph.LiteGraph.registerNodeType("custom/NOR",NOR),litegraph.LiteGraph.registerNodeType("custom/ADD",ADD),litegraph.LiteGraph.registerNodeType("custom/ALU",ALU),litegraph.LiteGraph.registerNodeType("custom/Latch",Latch),litegraph.LiteGraph.registerNodeType("custom/RWMemory",RWMemory),litegraph.LiteGraph.registerNodeType("custom/Cache",Cache),litegraph.LiteGraph.registerNodeType("custom/RAM",RAM),litegraph.LiteGraph.registerNodeType("custom/CLKTrigger",CLKTrigger),litegraph.LiteGraph.registerNodeType("tools/PulseSignal",PulseSignal),litegraph.LiteGraph.registerNodeType("tools/Through",Through),litegraph.LiteGraph.registerNodeType("custom/PC",PC)}const NeedNodeTypeList=["basic/boolean","basic/watch","logic/AND","logic/OR","logic/NOT"];function App(){const e=reactExports.useRef(null),o=reactExports.useRef(null),s=reactExports.useRef(null);reactExports.useEffect(()=>{if(!e.current||o.current&&s.current)return;const b=new litegraph.LGraph;o.current=b;const $=new litegraph.LGraphCanvas(e.current,b);s.current=$,console.log(litegraph.LiteGraph.registered_node_types),Object.keys(litegraph.LiteGraph.registered_node_types).forEach(_=>{NeedNodeTypeList.includes(_)||litegraph.LiteGraph.unregisterNodeType(_)}),litegraph.LiteGraph.searchbox_extras={},initCustomNode();const st=litegraph.LiteGraph.createNode("basic/boolean");st.title="A",st.pos=[50,100],b.add(st);const j=litegraph.LiteGraph.createNode("basic/boolean");j.title="B",j.pos=[50,300],b.add(j);const tt=litegraph.LiteGraph.createNode("logic/NOT");tt.pos=[250,100],b.add(tt);const nt=litegraph.LiteGraph.createNode("logic/NOT");nt.pos=[250,300],b.add(nt);const lt=litegraph.LiteGraph.createNode("logic/AND");lt.pos=[450,100],b.add(lt);const ct=litegraph.LiteGraph.createNode("logic/AND");ct.pos=[450,300],b.add(ct);const ot=litegraph.LiteGraph.createNode("logic/OR");ot.pos=[650,200],b.add(ot);const _e=litegraph.LiteGraph.createNode("basic/watch");_e.title="输出",_e.pos=[850,200],b.add(_e),st.connect(0,tt,0),st.connect(0,ct,0),j.connect(0,nt,0),j.connect(0,lt,1),tt.connect(0,lt,0),nt.connect(0,ct,1),lt.connect(0,ot,0),ct.connect(0,ot,1),ot.connect(0,_e,0),b.start()},[]);const a=()=>{var j;const b=JSON.stringify((j=o.current)==null?void 0:j.serialize()),$=new Blob([b]),et=URL.createObjectURL($),st=document.createElement("a");st.setAttribute("href",et),st.setAttribute("download","graph.JSON"),st.style.display="none",document.body.appendChild(st),st.click(),document.body.removeChild(st),setTimeout(function(){URL.revokeObjectURL(et)},1e3*60)},h=()=>{var b;console.log("saved"),localStorage.setItem("litegraph_digital_electronics_save",JSON.stringify((b=o.current)==null?void 0:b.serialize()))},d=()=>{var $,et;const b=localStorage.getItem("litegraph_digital_electronics_save");b&&(($=o.current)==null||$.configure(JSON.parse(b))),console.log("loaded"),(et=o.current)==null||et.start()},c=function(b){b.preventDefault();const et=b.dataTransfer.files[0],st=new FileReader;st.onload=function(j){var nt,lt;const tt=(nt=j.target)==null?void 0:nt.result;tt&&((lt=o.current)==null||lt.configure(JSON.parse(tt)))},st.readAsText(et)},g=b=>()=>{var $,et;($=o.current)==null||$.configure(JSON.parse(ConstConfigJSON[b])),(et=o.current)==null||et.start()};return jsxRuntimeExports.jsxs("div",{className:"litegraph",children:[jsxRuntimeExports.jsxs("div",{className:"header",style:{display:"flex"},children:[jsxRuntimeExports.jsx("button",{onClick:h,title:"配置存储到浏览器",children:"暂存"}),jsxRuntimeExports.jsx("button",{onClick:d,title:"恢复到暂存的配置",children:"恢复"}),jsxRuntimeExports.jsx("button",{onClick:a,title:"下载配置",children:"下载"}),jsxRuntimeExports.jsx("button",{onClick:g("xorJSON"),children:"异或门"}),jsxRuntimeExports.jsx("button",{onClick:g("addJSON"),children:"全加器"}),jsxRuntimeExports.jsx("button",{onClick:g("ALUJSON"),children:"8位加法器"}),jsxRuntimeExports.jsx("button",{onClick:g("triggerJSON"),children:"触发器"}),jsxRuntimeExports.jsx("button",{onClick:g("latchJSON"),children:"锁存器"}),jsxRuntimeExports.jsx("button",{onClick:g("RWMemoryJSON"),children:"读写存储器"}),jsxRuntimeExports.jsx("button",{onClick:g("CacheJSON"),children:"寄存器"}),jsxRuntimeExports.jsx("button",{onClick:g("RAMJSON"),children:"RAM"}),jsxRuntimeExports.jsx("button",{onClick:g("CLKTriggerJSON"),children:"边沿触发器"}),jsxRuntimeExports.jsx("button",{onClick:g("frequencyDividerJSON"),children:"分频器"}),jsxRuntimeExports.jsx("button",{onClick:g("PCJSON"),children:"计数器"}),jsxRuntimeExports.jsx("button",{onClick:g("computerJSON"),children:"计算机"})]}),jsxRuntimeExports.jsx("div",{className:"content",children:jsxRuntimeExports.jsx("canvas",{ref:e,width:document.body.clientWidth-10,height:document.body.clientHeight-50,onDrop:c})})]})}createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
